!***********************************************************************
!   GEXPY065:   MANAGEMENT SALARY ROLLOUT                              *
!***********************************************************************
!                                                                      *
!               Confidentiality Information:                           *
!                                                                      *
! This module is the confidential and proprietary information of       *
! Giant Eagle, Inc.; it is not to be copied, reproduced, or transmitted*
! in any form, by any means, in whole or in part, nor is it to be used *
! for any purpose other than that for which it is expressly provided   *
! without the written permission of Giant Eagle.                       *
!                                                                      *
!***********************************************************************
!                                                                      *
! GEXPY065:             MANAGEMENT SALARY ROLLOUT                      *
!                                                                      *
! Narrative:            Weekly summary of management salaries, broken  *
!                       out by "management" and "general" categories   *  
!                                                                      *
! #Debugx Used:	        #debug9 paragraph trace                        *
!                       #debug8 key variable values                    * 
!                       #debug7 data returned from sql calls           * 
!                                                                      *
! SQL Tables:           JOB                                            *
!                       PERSONAL_DATA                                  *
!                       PAY_CAL_BAL_ID                                 *
!                       PAY_CALENDAR                                   *
!                       CHECK_YTD                                      *
!                       EARNINGS_BAL                                   *
!                       PAY_EARNINGS                                   * 
!                       PAY_OTH_EARNS                                  *
!                       GEX_R_GEXPY065A                                *
!                       GEX_R_GEXPY065B                                *
!                                                                      *
! Written by:           Joe Besagar                                    *                                                           
!                                                                      *
! Normally run:         Weekly                                         *
!                                                                      *
! Control Parms:        FOR WHERE CLAUSE:                              *
!                         Company  	                               *
!                         Company/Paygroup                             *
!      			  Deptid                                       *
!                         Acctcd                                       *	                                   
!                         Jobcode                                      *	                                   
!                         Erncd                                        *	                                   
!                         AsOfDate                                     *	                                   
!                                                                      *
!***********************************************************************
!                         MODIFICATION HISTORY                         *
!***********************************************************************
!  INITIALS    DATE           DESCRIPTION OF THE CHANGE                *        
!***********************************************************************
!  JNB      08/11/1998   INITIAL CREATION                              *
!  JNB      12/01/1998   Changed so that there will be a               *
!                           page advance after dept totals             *
!  JNB      12/13/1998   Changed to Rule                               *
!  SXK      01/25/1999   Changed to increase number field              *
!		         sizes to fit totals, not to print             *
!			 duplicate entries, and separate               *
!			 amounts by reg, otp and other                 *
!  JDH      06/08/1999   Added fiscal MTD and YTD columns              *
!                        Added erncd 170 to reg/sun earnings           *
!                        Added jobcode to break logic                  *
!  SCM      04/08/2002   Modified to pull 'CY' balances instead of 'FY'*
!                        Changed wording on headings to reflect CALENDAR
!                        instead of FISCAL.  Changed colm headings from*
!                        REG/SUN to REGULAR because Sunday earnings    *
!                        codes were not getting summed.                *
!  GBD      05/24/2002   Rewrite of program - was not returning correct*
!                        values.  Compared against Gexpy006, Gexpy010  *
!                        and combined pieces of the two reports.       *
!                                                                      *
!  CWB      02/19/2003   Added EMPL_RCD to the EARNINGS_BAL joins.     * 
! ISDVNPK 08/15/2007 Commented ALTER_SEESION SQC as part of 9.0 upgrade *
! GEX ISDVNPK 04/28/2008  ADDED JOBCODE join as it was printing wrongly *
! GEX ISDVDZK 07/24/2008  Added ERNCD 173 functionality same as the     *
!                         functionality given  for ERNCD otp            *
!************************************************************************

!selection criteria
#define #x000_col_selection_criteria_a 	02
#define #x000_col_selection_criteria_b 	05

!line 1
#define #x000_col_acct_cd           1
#define #x000_col_jobcode           6!6
#define #x000_col_reg_earns        43 !39          !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_otp_earns        54 !50          !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_173_earns        65 !62          !isdvdzk   added it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_oth_earns        76 !73          !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_FMTD_reg_earns   87 !85          !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_FMTD_otp_earns   98 !96          !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_FMTD_173_earns  109 !107         !isdvdzk   added it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_FMTD_oth_earns  120 !118         !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_FYTD_reg_earns  131 !131         !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_FYTD_otp_earns  145 !142         !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_FYTD_173_earns  156 !153         !isdvdzk   added it for ITG#51358 on 07/24/2008 to add earncode 173
#define #x000_col_FYTD_oth_earns  167 !164         !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173



#include 'setenv.sqc' !Set environment
#include 'setup02.sqc'


begin-heading 8
#debug9 show 'begin-heading'

  #Include 'stdhdg02.sqc'
  
  print $Pay_Period     (3,) Center

  do Get-Department-Name

  print 'DeptID'        (4,1)
  print $DeptID         (,13)
  print $DeptName       (,+2)

  print 'ACCOUNT CODE'                                   (+2,{#x000_col_acct_cd})
  print '<------- CURRENT PAY PERIOD EARNINGS ----->'    (,{#x000_col_reg_earns})
  print '<-------- CALENDAR MTD EARNINGS --------->'     (,{#x000_col_FMTD_reg_earns})  !SCM 04/08/2002
  print '<-------- CALENDAR YTD EARNINGS ------------>'  (,{#x000_col_FYTD_reg_earns})  !SCM 04/08/2002
  print 'JOB TITLE'     (+1,{#x000_col_jobcode})
  print '   REGULAR'   (,{#X000_col_reg_earns})          !SCM 04/08/2002 changed from REG/SUN
  print '  OVERTIME'   (,{#x000_col_otp_earns})
  print ' UOT EARNS'   (,{#x000_col_173_earns})          !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '     OTHER'   (,{#x000_col_oth_earns})
  print '   REGULAR'   (,{#X000_col_FMTD_reg_earns})     !SCM 04/08/2002 changed from REG/SUN
  print '  OVERTIME'   (,{#x000_col_FMTD_otp_earns})
  print ' UOT EARNS'   (,{#x000_col_FMTD_173_earns})     !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '    OTHER'    (,{#x000_col_FMTD_oth_earns})
  print '     REGULAR' (,{#X000_col_FYTD_reg_earns})     !SCM 04/08/2002 changed from REG/SUN
  print '  OVERTIME'   (,{#x000_col_FYTD_otp_earns})
  print ' UOT EARNS'   (,{#x000_col_FYTD_173_earns})     !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '     OTHER'    (,{#x000_col_FYTD_oth_earns})
  print '-'             (+1,{#x000_col_acct_cd},22)      fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_reg_earns},10)      fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_otp_earns},10)      fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_173_earns},10)      fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_oth_earns},10)      fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_FMTD_reg_earns},10) fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_FMTD_otp_earns},10) fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_FMTD_173_earns},10) fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_FMTD_oth_earns},10) fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_FYTD_reg_earns},13) fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_FYTD_otp_earns},10) fill      !isdvdzk changed it for ITG#51358 on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_FYTD_173_earns},10) fill      !isdvdzk changed on 07/24/2008 to add earncode 173
  print '-'             (,{#x000_col_FYTD_oth_earns},10) fill      !isdvdzk changed on 07/24/2008 to add earncode 173
end-heading


begin-report
#debug9 show 'begin-report'
  !do Alter-Session      ! ISDVNPK 08/15/2007 Commented ALTER_SEESION SQC as part of 9.0 upgrade             
  do Truncate-Temp-Tables
  do Init-DateTime
  do Init-Number
  do Get-Current-DateTime

  do stdapi-init
  do p010-Init-Variables 
  
  date-time () hh:mi:ss &timeBegan
  show ' '
  show 'Report Began: ' &timebegan

  move 'N' to $Errorfound

  do P100-Pay-Earnings
  IF $rec1_found = 'Y' 
    do P200-Calendar-Check
    do P300-Print-Totals
  ELSE
    show 'No records found with the parameters passed. '
  end-if

  date-time () hh:mi:ss &timeend
  show 'Report Ended: ' &timeend

  do stdapi-term
  do Reset
end-report

Begin-Procedure Truncate-Temp-Tables

Begin-SQL
TRUNCATE TABLE SYSADM.PS_GEX_R_GEXPY065A
End-SQL

Begin-SQL
TRUNCATE TABLE SYSADM.PS_GEX_R_GEXPY065B
End-SQL

End-Procedure Truncate-Temp-Tables

begin-procedure p010-Init-Variables
#debug9 show 'P010-Init-Variables'
  let $x000_new_page_flag = 'N'
  
  let $ReportID           = 'GEXPY065'
  let $ReportTitle        = 'MANAGEMENT SALARY ROLLOUT'
  let $Country            = 'USA'

  show '$ReportID= '     $ReportID
  show '$ReportTitle = ' $ReportTitle   
  show ' '

  Do GEXXX951-Select-Oracle-Instance

  Let $GEXXX900_Company_Alias  = 'PE.COMPANY'
  Let $GEXXX901_Company_Alias  = 'PE.COMPANY'
  Let $GEXXX901_Paygroup_Alias = 'PE.PAYGROUP'
  Let $GEXXX902_Deptid_Alias   = 'PE.DEPTID'
  Let $GEXXX909_Acct_CD_Alias  = 'PE.ACCT_CD'
  Let $GEXXX916_Jobcode_Alias  = 'PE.JOBCODE'
  Let $GEXXX924_Erncd_Alias    = 'ERNCD'

  if $Prcs_process_instance = ''
    do P015-get-input
  else
    Do GEXXX900-Select-Company-Parameters 
    Do GEXXX901-Select-Company-Paygroup-Parameters    
    Do GEXXX902-Select-Deptid-Parameters 
    Do GEXXX909-Select-Acct-Cd-Parameters
    Do GEXXX924-Select-Erncd-Parameters  
    Do GEXXX916-Select-Jobcode-Parameters                                
                                
    Do GEXXX922-Select-Parameters
    let $X000_WHERE_SELECT_ASOFDATE = $GEX_RC_PAY.ASOFDATE
  end-if

  if rtrim($X000_WHERE_SELECT_ASOFDATE, ' ' ) = ''
    let $X000_WHERE_SELECT_ASOFDATE = $asoftoday
  end-if

  LET $AsOfDate = $X000_WHERE_SELECT_ASOFDATE 

  do Get-Date-Codes
  let #AsOfYYYY = to_number($AsOfYYYY)
  let #AsOfMM   = to_number($AsOfMonth)

  let $X000_order_by = 'Company, Deptid, Account Code, Employee ID'

  show '$GEXXX900_INCLUDE_COMPANY_CRITERIA               =' $GEXXX900_INCLUDE_COMPANY_CRITERIA
  show '$GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA      =' $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA   
  show '$GEXXX902_INCLUDE_DEPTID_CRITERIA                =' $GEXXX902_INCLUDE_DEPTID_CRITERIA
  show '$GEXXX909_INCLUDE_ACCT_CD_CRITERIA               =' $GEXXX909_INCLUDE_ACCT_CD_CRITERIA         
  show '$GEXXX916_INCLUDE_JOBCODE_CRITERIA               =' $GEXXX916_INCLUDE_JOBCODE_CRITERIA 
  show '$GEXXX924_INCLUDE_ERNCD_CRITERIA                 =' $GEXXX924_INCLUDE_ERNCD_CRITERIA   
  show '$X000_WHERE_SELECT_ASOFDATE                      =' $X000_WHERE_SELECT_ASOFDATE 

  Do Get-Last-Confirmed-Pay

  print 'RUN CONTROL INFORMATION FOR THIS REPORT RUN:'        (+5,{#x000_col_selection_criteria_a})
  print '$Prcs_OPRID          ='                              (+2,{#x000_col_selection_criteria_b})
  print $Prcs_OPRID                                           (0,+2)
  print '$PRCS_RUN_CNTL_ID    ='                              (+1,{#x000_col_selection_criteria_b})
  print $PRCS_RUN_CNTL_ID                                     (0,+2)

  print 'SELECTION CRITERIA FOR THIS REPORT RUN:'                 (+5,{#x000_col_selection_criteria_a})
  print '$GEXXX900_INCLUDE_COMPANY_DISPLAY_CRITERIA          ='   (+1,{#x000_col_selection_criteria_b})
  print $GEXXX900_INCLUDE_COMPANY_DISPLAY_CRITERIA                (0,+2)
  print '$GEXXX901_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA ='   (+1,{#x000_col_selection_criteria_b})
  print $GEXXX901_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA       (0,+2)
  print '$GEXXX902_INCLUDE_DEPTID_DISPLAY_CRITERIA           ='   (+1,{#x000_col_selection_criteria_b})
  print $GEXXX902_INCLUDE_DEPTID_DISPLAY_CRITERIA	          (0,+2)
  print '$GEXXX909_INCLUDE_ACCT_CD_DISPLAY_CRITERIA          ='   (+1,{#x000_col_selection_criteria_b})
  print $GEXXX909_INCLUDE_ACCT_CD_DISPLAY_CRITERIA                (0,+2)
  print '$GEXXX916_INCLUDE_JOBCODE_DISPLAY_CRITERIA          ='   (+1,{#x000_col_selection_criteria_b})
  print $GEXXX916_INCLUDE_JOBCODE_DISPLAY_CRITERIA                (0,+2)
  print '$GEXXX924_INCLUDE_ERNCD_DISPLAY_CRITERIA            ='   (+1,{#x000_col_selection_criteria_b})                 
  print $GEXXX924_INCLUDE_ERNCD_DISPLAY_CRITERIA                  (0,+2)            
  print '$X000_WHERE_SELECT_ASOFDATE                         ='   (+1,{#x000_col_selection_criteria_b})
  print  $X000_WHERE_SELECT_ASOFDATE                              (0,+2)

  print 'SORT ORDER FOR THIS REPORT RUN:'                         (+5,{#x000_col_selection_criteria_a})
  print '$X000_ORDER_BY                                      ='   (+1,{#x000_col_selection_criteria_b})
  print $X000_ORDER_BY 	(0,+2)
  print 'Balance ID = CY'                                         (+5,{#x000_col_selection_criteria_a})
  print 'Balance Year ='                                          (+1,{#x000_col_selection_criteria_a})
  print $balance_year                                             (,+1)
  print 'Balance Period ='                                        (+1,{#x000_col_selection_criteria_a})
  print $balance_period                                           (,+1)

  let #page-count = 0
end-procedure


begin-procedure P015-get-input
#debug9 show 'P015-get-input'

  Let $GEXXX900_INCLUDE_COMPANY_CRITERIA = '1=1'
  Let $GEXXX900_INCLUDE_COMPANY_DISPLAY_CRITERIA = 'ALL'


  Display 'Enter Company/Paygroup or leave blank to exit.'
  While 1=1
    Input $In-Company Maxlen=3 'Company'
    Uppercase $In-Company
    If Rtrim($In-Company, ' ') = ''
      Break
    Else
      Input $In-Paygroup Maxlen=3 'Paygroup'
      Uppercase $In-Paygroup
      If Rtrim($In-Paygroup, ' ') = ''
        Let $Include_Condition = '(' || $GEXXX901_Company_Alias || ' = '''  || $In-Company || ''')'
      Else
        Let $Include_Condition = '(' || $GEXXX901_Company_Alias || ' = '''  || $In-Company || ''' And ' || $GEXXX901_Paygroup_Alias || ' = '''  || $In-Paygroup || ''')'
      End-If
      Add 1 To #GEX_RC_PAYGROUP_ROWS
      If #GEX_RC_PAYGROUP_ROWS = 1
        Let $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA = '(' || $Include_Condition
      Else
        Let $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA = $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA || ' Or '  || $Include_Condition
      End-If
    End-If
  End-While

  If #GEX_RC_PAYGROUP_ROWS = 0
    Let $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA = '1=1'
    Let $GEXXX901_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA = 'ALL'
  Else
    Let $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA = $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA || ')'
    Let $GEXXX901_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA = $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA
  End-If


  Let $DeptIDString = ''''
  Display 'Enter DeptID or leave blank to exit.'
  While 1=1
    Input $In-DeptID Maxlen=10 'DeptID'
    Uppercase $In-DeptID
    If Rtrim($In-DeptID, ' ') = ''
      Concat '''' With $DeptIDString
      Break
    End-If
    If $DeptIDString <> ''''
      Concat ''',''' With $DeptIDString
    End-If
    Concat $In-DeptID With $DeptIDString
  End-While

  If $DeptIDString = ''''''
    Let $GEXXX902_INCLUDE_DEPTID_CRITERIA = '1=1'
    Let $GEXXX902_INCLUDE_DEPTID_DISPLAY_CRITERIA = 'ALL'
  Else
    Let $GEXXX902_INCLUDE_DEPTID_CRITERIA = $GEXXX902_Deptid_Alias || ' In (' || $DeptIDString || ')'
    Let $GEXXX902_INCLUDE_DEPTID_DISPLAY_CRITERIA = $GEXXX902_INCLUDE_DEPTID_CRITERIA
  End-If


  Let $AcctCdString = ''''
  Display 'Enter Account Code or leave blank to exit.'
  While 1=1
    Input $In-AcctCd Maxlen=25 'Account Code'
    Uppercase $In-AcctCd
    If Rtrim($In-AcctCd, ' ') = ''
      Concat '''' With $AcctCdString
      Break
    End-If
    If $AcctCdString <> ''''
      Concat ''',''' With $AcctCdString
    End-If
    Concat $In-AcctCd With $AcctCdString
  End-While

  If $AcctCdString = ''''''
    Let $GEXXX909_INCLUDE_ACCT_CD_CRITERIA = '1=1'
    Let $GEXXX909_INCLUDE_ACCT_CD_DISPLAY_CRITERIA = 'ALL'
  Else
    Let $GEXXX909_INCLUDE_ACCT_CD_CRITERIA = $GEXXX909_Acct_CD_Alias || ' In (' || $AcctCdString || ')'
    Let $GEXXX909_INCLUDE_ACCT_CD_DISPLAY_CRITERIA = $GEXXX909_INCLUDE_ACCT_CD_CRITERIA
  End-If


  Let $ErncdString = ''''
  Display 'Enter Erncd or leave blank to exit.'
  While 1=1
    Input $In-Erncd Maxlen=3 'Erncd'
    Uppercase $In-Erncd
    If Rtrim($In-Erncd, ' ') = ''
      Concat '''' With $ErncdString
      Break
    End-If
    If $ErncdString <> ''''
      Concat ''',''' With $ErncdString
    End-If
    Concat $In-Erncd With $ErncdString
  End-While

  If $ErncdString = ''''''
    Let $GEXXX924_INCLUDE_ERNCD_CRITERIA = '1=1'
    Let $GEXXX924_INCLUDE_ERNCD_DISPLAY_CRITERIA = 'ALL'
  Else
    Let $GEXXX924_INCLUDE_ERNCD_CRITERIA = $GEXXX924_Erncd_Alias || ' In (' || $ErncdString || ')'
    Let $GEXXX924_INCLUDE_ERNCD_DISPLAY_CRITERIA = $GEXXX924_INCLUDE_ERNCD_CRITERIA
  End-If


  Let $JobcodeString = ''''
  Display 'Enter Jobcode or leave blank to exit.'
  While 1=1
    Input $In-Jobcode Maxlen=6 'Jobcode'
    Uppercase $In-Jobcode
    If Rtrim($In-Jobcode, ' ') = ''
      Concat '''' With $JobcodeString
      Break
    End-If
    If $JobcodeString <> ''''
      Concat ''',''' With $JobcodeString
    End-If
    Concat $In-Jobcode With $JobcodeString
  End-While

  If $JobcodeString = ''''''
    Let $GEXXX916_INCLUDE_JOBCODE_CRITERIA = '1=1'
    Let $GEXXX916_INCLUDE_JOBCODE_DISPLAY_CRITERIA = 'ALL'
  Else
    Let $GEXXX916_INCLUDE_JOBCODE_CRITERIA = $GEXXX916_Jobcode_Alias || ' In (' || $JobcodeString || ')'
    Let $GEXXX916_INCLUDE_JOBCODE_DISPLAY_CRITERIA = $GEXXX916_INCLUDE_JOBCODE_CRITERIA
  End-If


  Do Ask-As-Of-Date
  Let $X000_WHERE_SELECT_ASOFDATE = $AsOfDate
end-procedure

!**********************************************************************
Begin-Procedure Get-Last-Confirmed-Pay
!**********************************************************************
#debug9 Show 'Get-Last-Confirmed-Pay'
Begin-Select
pay_end_dt
balance_year
balance_period

  Let $AsOfDate           = &pay_end_dt
  Let $pay_end_dt         = &pay_end_dt
  Let #balance_year       = &balance_year
  Let #balance_period     = &balance_period

  Move #balance_year   To $balance_year   9999
  Move #balance_period To $balance_period 09

  Do Format-DateTime($pay_end_dt, $payenddt, {DEFMDY}, '', '')
  Let $Pay_Period = 'for pay period ending ' || $payenddt

  If Rtrim($pay_end_dt,' ') = ''
    Show 'No confirmed pay period found in calendar'
    Stop
  Else
    Show 'Pay End Date:   ' $pay_end_dt
!   SCM  04/08/2002         BEGIN
!   Show 'Balance ID:     ' 'FY'
    Show 'Balance ID:     ' 'CY'
!   SCM  04/08/2002         END
    Show 'Balance Year:   ' $balance_year
    Show 'Balance Period: ' $balance_period
  End-If

From   ps_pay_cal_bal_id

Where  company  = 'GEI'
And    paygroup = 'RET'

And    pay_end_dt         =
      (Select Max(pay_end_dt)
       From   ps_pay_calendar
       Where  pay_end_dt <= $AsOfDate
       And    pay_confirm_run = 'Y')
!   SCM  04/08/2002         BEGIN
!And    balance_id = 'FY'
And    balance_id = 'CY'
!   SCM  04/08/2002         END
End-Select
End-Procedure

!**********************************************************************
begin-procedure P100-Pay-Earnings
!**********************************************************************
#debug9 show 'P100-Pay-Earnings'

  let $rec1_found = 'N'
  let $companypaygroup = ''
  let $company_list = ''
  
begin-select ON-ERROR=P900-SQL-Error-Found('P100-Pay-Earnings')
PE.COMPANY,
PE.PAYGROUP,
PE.DEPTID,
PE.ACCT_CD,
PE.JOBCODE   (,) ON-BREAK  LEVEL=4
                           PRINT=NEVER
                           AFTER=P160-STORE-JOBCODE-TOTALS
PE.EMPLID
pe.pay_end_dt
pe.off_cycle
pe.page_num
pe.line_num
pe.addl_nbr
PE.REG_HRLY_EARNS
PE.REG_EARNS
PE.OT_HRLY_EARNS

  Let $x100_Get_Employees_Data_Flag = 'Y'

  Let $Company = &PE.COMPANY
! GBD 05/23/2002 Begin
  Let $Paygroup = &PE.PAYGROUP
! GBD 05/23/2002 End
  Let $DeptID  = &PE.DEPTID
! GBD 05/22/2002 Begin
  Let $Acct_Cd = &PE.ACCT_CD
! GBD 05/22/2002 End
  Let $Jobcode = &PE.JOBCODE
  Let $Emplid  = &PE.EMPLID

!**
  let $companypaygroup = $Company||$Paygroup
  if $companypaygroup <> $companypaygroup_old
     if $company_list = ''
        let $company_list = 'A.COMPANY||A.PAYGROUP IN (' || '''' || $companypaygroup || ''''
     else
        let $company_list = $company_list || ',' || '''' || $companypaygroup || ''''
     end-if
     let $companypaygroup_old = $companypaygroup
  end-if
!**
  let $rec1_found = 'Y'
  Let $Year4 = '1'
  Do Format-DateTime(&pe.pay_end_dt, $pe.pay_end_dt, {DEFYMD}, '', '')

  Add &PE.REG_HRLY_EARNS To #jc_reg_earns
  Add &PE.REG_EARNS      To #jc_reg_earns
  Add &PE.OT_HRLY_EARNS  To #jc_otp_earns
  

  Do P120-Pay-Oth-Earns

FROM   PS_PAY_EARNINGS PE
WHERE  PE.PAY_END_DT = $pay_end_dt
AND   [$GEXXX900_INCLUDE_COMPANY_CRITERIA]
AND   [$GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA] 
AND   [$GEXXX902_INCLUDE_DEPTID_CRITERIA]
AND   [$GEXXX909_INCLUDE_ACCT_CD_CRITERIA]
AND   [$GEXXX916_INCLUDE_JOBCODE_CRITERIA] 

ORDER BY PE.COMPANY, PE.DEPTID, PE.ACCT_CD, PE.JOBCODE, PE.EMPLID
end-select

  if $company_list <> ''
    let $company_list = $company_list || ')'
  end-if

  if $x100_Get_Employees_Data_Flag <> 'Y'
    new-page
    print 'NO DATA SELECTED FOR THIS REPORT RUN'	(25,) CENTER
  end-if

END-PROCEDURE

!**********************************************************************
begin-procedure P120-Pay-Oth-Earns
!**********************************************************************
#debug9 Show 'P120-Pay-Oth-Earns'
begin-select ON-ERROR=P900-SQL-Error-Found('P120-Pay-Oth-Earns')
poe.erncd
poe.oth_earns

  If &poe.erncd = 'REG' Or
     &poe.erncd = '170'
    Add &poe.oth_earns   To #jc_reg_earns
  Else
       If &poe.erncd = 'OTP'
               Add &poe.oth_earns To #jc_otp_earns
       Else
               IF &poe.erncd = '173'
                       Add &poe.oth_earns To #jc_173_earns
               Else
                       Add &poe.oth_earns To #jc_oth_earns
               End-If
       End-IF
  End-If
  
  show 'other earns' #jc_oth_earns
  show '173  earns'  #jc_173_earns                      !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173

From   ps_pay_oth_earns poe

where  company      = &pe.company
and    paygroup     = &pe.paygroup    
and    pay_end_dt   = &pe.pay_end_dt
and    off_cycle    = &pe.off_cycle
and    page_num        = &pe.page_num
and    line_num        = &pe.line_num
and    addl_nbr        = &pe.addl_nbr

and   [$GEXXX924_INCLUDE_ERNCD_CRITERIA]
end-select
end-procedure

!**********************************************************************
begin-procedure P160-STORE-JOBCODE-TOTALS
!**********************************************************************
#debug9 Show 'P160-STORE-JOBCODE-TOTALS'

begin-sql on-error=P900-sql-error-found('P160-STORE-JOBCODE-TOTALS')
Insert Into PS_GEX_R_GEXPY065B
(COMPANY,
 PAYGROUP,
 DEPTID,
 ACCT_CD,
 JOBCODE,
 PAY_END_DT,
 REG_EARNS,
 GEX_OTP_EARNS,
 GEX_173_EARNS,                        !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
 OTH_EARNS)
Values
($Company,
 $Paygroup,
 $Deptid,
 $Acct_Cd,
 $Jobcode,
 $Pay_End_Dt,
 #jc_reg_earns,
 #jc_otp_earns,
 #jc_173_earns,                        !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
 #jc_oth_earns)
end-sql

!** For Testing
!  let $show_jc = $Company||' '||$Paygroup||' '||$Deptid||' '||$Acct_Cd||' '||$Jobcode
!  let $jc_reg_earns = to_char(#jc_reg_earns)
!  let $jc_otp_earns = to_char(#jc_otp_earns)
!  let $jc_oth_earns = to_char(#jc_oth_earns)
!  let $show_jc_amt = $jc_reg_earns||' '||$jc_otp_earns||' '||$jc_oth_earns
!  show $show_jc
!  show $show_jc_amt
!**

  let #jc_reg_earns      = 0
  let #jc_otp_earns      = 0
  let #jc_oth_earns      = 0
  let #jc_173_earns      = 0           !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173   

End-Procedure

!**********************************************************************
begin-procedure P200-Calendar-Check
!**********************************************************************
begin-select
A.COMPANY    () on-break print=never  level=1 save=$prev_company
A.PAY_END_DT () on-break print=never  level=2 save=$prev_pay_end_dt
A.PAYGROUP   () on-break print=never  level=3 save=$prev_paygroup
A.CHECK_DT 
  move &A.check_dt to $prev_check_dt
  do convert-to-dtu-date($prev_CHECK_DT, $check_dt_dtu)
  let $balance_year = substr($check_dt_dtu,1,4)
  let #balance_period = substr($check_dt_dtu,6,2)

  do P210-Earnings-Bal
from ps_pay_calendar A
where [$company_list]
and   A.PAY_END_DT = $pay_end_dt
!where [$SlctCalendar]

end-select

end-procedure P200-Calendar-Check

!**********************************************************************
Begin-Procedure P210-Earnings-Bal
!**********************************************************************
begin-SELECT
J.DEPTID     () on-break print=never  level=4 save=$prev_deptid
J.ACCT_CD    () on-break print=never  level=5 save=$prev_acct_cd
J.JOBCODE    () on-break print=never  level=6 save=$prev_jobcode
J.EMPLID () on-break print=never level=7 after=get-earnings-ytd save=$prev_emplid
! CWB 02/19/2003 BEGIN
!J.EMPL_RCD
J.EMPL_RCD   () on-break print=never  level=7 save=$prev_empl_rcd
! CWB 02/19/2003 END

  move &A.Company     to $A_Company
  move &A.PayGroup    to $A_PayGroup
  move &A.Pay_End_Dt  to $A_PayEndDate
  move &J.Deptid      to $A_Deptid
  move &A.Check_Dt    to $AsOfDate  !for included procedures
  move &J.Acct_Cd     to $A_AcctCd
  move &J.Jobcode     to $A_Jobcode

FROM  PS_JOB          J,
      PS_PERSONAL_DATA P2

WHERE P2.EMPLID = J.EMPLID
  AND J.EMPLID > '0'
  AND J.COMPANY  = &A.COMPANY
  AND J.PAYGROUP = &A.PAYGROUP
  AND J.EFFDT     =
      (SELECT MAX(EFFDT)
         FROM PS_JOB
        WHERE EMPLID    = j.EMPLID
          AND EMPL_RCD = j.EMPL_RCD
          AND EFFDT    <= &A.PAY_END_DT
          AND COMPANY   = j.COMPANY
          AND PAYGROUP  = j.PAYGROUP)
  AND J.EFFSEQ          =
      (SELECT MAX(EFFSEQ)
         FROM PS_JOB
        WHERE EMPLID    = J.EMPLID
          AND EMPL_RCD = J.EMPL_RCD
          AND EFFDT     = J.EFFDT
          AND COMPANY   = J.COMPANY
          AND PAYGROUP  = J.PAYGROUP)
  and J.EMPLID IN (select y.emplid from ps_check_ytd y
		where Y.EMPLID = J.EMPLID
		  AND Y.BALANCE_YEAR = $Balance_year
		  AND Y.BALANCE_ID = 'CY')
ORDER BY 
         J.DEPTID,
         J.ACCT_CD,
         J.JOBCODE,
         J.EMPLID
end-SELECT

End-Procedure P210-Earnings-Bal

!**********************************************************************
Begin-Procedure Get-Earnings-ytd
!**********************************************************************
#debug8 show 'Get-Earnings-Ytd'

Begin-Select
b2.balance_period
b2.erncd
b2.grs_mtd &earns_mtd
b2.grs_ytd &earns_ytd

  move &b2.balance_period to #b2_balance_period
  move &b2.erncd to $erncd
  move &earns_mtd to #earns_mtd
  move &earns_ytd to #earns_ytd

  if #balance_period = #b2_balance_period
     add #earns_mtd to #insert_earns_mtd
  end-if
  add #earns_ytd to #insert_earns_ytd

  if (#insert_earns_mtd = 0 and #insert_earns_ytd = 0)
    !Skip
  else    
!    let $show_jobcode = $A_Company||' '||$A_Deptid ||' '||$A_AcctCd||' '||$A_Jobcode||' '||$erncd
!    let $insert_earns_mtd = to_char(#insert_earns_mtd)
!    let $insert_earns_ytd = to_char(#insert_earns_ytd)
!    let $totals = 'MTD: ' || $insert_earns_mtd || '  YTD: ' || $insert_earns_ytd
!    show $show_jobcode
!    show $totals

    do P260-Check-Existing-EYTD

    if $ERow_Exists='Y'
      do P270-Update-ETemp-Table
    else
      do P280-Insert-ETemp-Table
    end-if

    let #insert_earns_mtd = 0
    let #insert_earns_ytd = 0
  end-if

  let #earns_mtd = 0
  let #earns_ytd = 0

from   ps_earnings_bal b2
where  b2.emplid = $prev_EMPLID
and    b2.empl_rcd = $prev_empl_rcd    ! CWB 02/19/2003
and    b2.company              = $prev_COMPANY
and    b2.balance_id           = 'CY'
and    b2.balance_year         = $balance_year
and    b2.balance_period       = (select max(balance_period)
				from ps_earnings_bal
				where emplid = b2.emplid
                                and empl_rcd = b2.empl_rcd  ! CWB 02/19/2003
				and company = b2.company
				and balance_id = 'CY'
				and balance_year = $balance_year
                                and erncd = b2.erncd
                                and spcl_balance = b2.spcl_balance
				and balance_period <= #balance_period)
and    b2.spcl_balance         = 'N'
order by b2.erncd
end-select

end-procedure

!**********************************************************************
Begin-Procedure P260-Check-Existing-EYTD
!**********************************************************************
#debug8 show 'P260-Check-Existing-YTD'
  let $ERow_Exists ='N'
Begin-Select
etmp.company
etmp.paygroup
etmp.deptid
etmp.acct_cd
etmp.jobcode
etmp.balance_period
etmp.balance_year
etmp.erncd

  let $ERow_Exists='Y'

from   ps_gex_r_gexpy065a etmp
where etmp.company            	= $prev_company
and   etmp.paygroup		= $prev_paygroup
and   etmp.deptid		= $prev_deptid
and   etmp.acct_cd		= $prev_acct_cd
and   etmp.jobcode              = $prev_jobcode
and   etmp.balance_period       = #b2_balance_period
and   etmp.balance_year         = $balance_year
and   etmp.erncd		= &b2.erncd
end-select
end-procedure

!**********************************************************************
begin-procedure P270-Update-Etemp-table
!**********************************************************************
begin-sql
Update ps_gex_r_gexpy065a
    set grs_mtd = grs_mtd + #insert_earns_mtd,
        grs_ytd = grs_ytd + #insert_earns_ytd
where company           = $prev_company
and   paygroup		= $prev_paygroup
and   deptid		= $prev_deptid
and   acct_cd		= $prev_acct_cd
and   jobcode           = $prev_jobcode
and   balance_period    = #b2_balance_period
and   balance_year      = $balance_year
and   erncd		= &b2.erncd
end-sql
end-procedure

!**********************************************************************
begin-procedure P280-Insert-Etemp-table
!**********************************************************************
begin-sql
insert into ps_gex_r_gexpy065a values(
$prev_company,
$prev_paygroup,
$prev_deptid,
$Prev_acct_cd,
$Prev_jobcode,
#b2_balance_period,
$balance_year,
&b2.erncd,
#insert_earns_mtd,
#insert_earns_ytd)
end-sql
end-procedure

!**********************************************************************
Begin-Procedure P300-Print-Totals
!**********************************************************************
Begin-Select
GA.COMPANY     (,) ON-BREAK  LEVEL=1
                   PRINT=NEVER
                   AFTER=P320-PRINT-COMPANY-TOTALS

GA.DEPTID      (,) ON-BREAK  LEVEL=2
                   PRINT=NEVER
                   BEFORE=P330-BEFORE-DEPT
                   AFTER=P340-PRINT-DEPT-TOTALS

GA.ACCT_CD     (,) ON-BREAK  LEVEL=3
                   PRINT=NEVER
                   BEFORE=P350-BEFORE-ACCT-CD
                   AFTER=P360-PRINT-ACCT-CD-TOTALS

GA.JOBCODE     (,) ON-BREAK  LEVEL=4
                   PRINT=NEVER
                   BEFORE=P380-BEFORE-JOBCODE
                   AFTER=P370-PRINT-JOBCODE-TOTALS

GA.PAYGROUP
GA.BALANCE_PERIOD
GA.BALANCE_YEAR
GA.ERNCD
GA.GRS_MTD
GA.GRS_YTD

  let $Company = &GA.COMPANY
  let $Deptid = &GA.DEPTID
  let $ga_erncd = &GA.ERNCD
  let #ga_grs_mtd = &GA.GRS_MTD
  let #ga_grs_ytd = &GA.GRS_YTD
  Evaluate $ga_erncd
  When = 'REG'
     add #ga_grs_mtd to #gross_reg_mtd
     add #ga_grs_ytd to #gross_reg_ytd
     break
  When = '170'
     add #ga_grs_mtd to #gross_reg_mtd
     add #ga_grs_ytd to #gross_reg_ytd
     break
  When = 'OTP'
     add #ga_grs_mtd to #gross_otp_mtd
     add #ga_grs_ytd to #gross_otp_ytd
     break
  When = '173'                                         !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173  start
     add #ga_grs_mtd to #gross_173_mtd
     add #ga_grs_ytd to #gross_173_ytd
     break                                             !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173   end
  When-other
     add #ga_grs_mtd to #gross_oth_mtd
     add #ga_grs_ytd to #gross_oth_ytd
     break
  End-Evaluate

FROM PS_GEX_R_GEXPY065A GA
WHERE EXISTS (SELECT 'X'
      FROM PS_GEX_R_GEXPY065B
      WHERE COMPANY = GA.COMPANY
      AND   PAYGROUP = GA.PAYGROUP
      AND   DEPTID = GA.DEPTID
      AND   ACCT_CD = GA.ACCT_CD
      AND   JOBCODE = GA.JOBCODE)  ! GEX ISDVNPK 04/28/2008  ADDED this as it was printing wrongly
AND   GA.ERNCD IN (SELECT ERNCD
      FROM PS_GEX_R_GEXPY065A
      WHERE COMPANY = GA.COMPANY
      AND   PAYGROUP = GA.PAYGROUP
      AND   DEPTID = GA.DEPTID
      AND   ACCT_CD = GA.ACCT_CD
      AND   JOBCODE = GA.JOBCODE  ! GEX ISDVNPK 04/28/2008  ADDED this as it was printing wrongly
      AND   [$GEXXX924_INCLUDE_ERNCD_CRITERIA])
ORDER BY GA.COMPANY, GA.PAYGROUP, GA.DEPTID, GA.ACCT_CD, GA.JOBCODE,
         GA.BALANCE_PERIOD, GA.BALANCE_YEAR, GA.ERNCD
End-Select


    print 'Report Totals'      (+2,1)
    print  #rpt_reg_earns      (0,{#X000_col_reg_earns})      edit  999,999.99                                            !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173
    print  #rpt_otp_earns      (0,{#X000_col_otp_earns})      edit  999,999.99     ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173
    print  #rpt_173_earns      (0,{#x000_col_173_earns})      edit  999,999.99     ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173
    print  #rpt_oth_earns      (0,{#X000_col_oth_earns})      edit  999,999.99     ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173
    print  #rpt_FMTD_reg_earns (0,{#X000_col_FMTD_reg_earns}) edit 999,999.99                                             !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173
    print  #rpt_FMTD_otp_earns (0,{#X000_col_FMTD_otp_earns}) edit 999,999.99      ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173
    print  #rpt_FMTD_173_earns (0,{#x000_col_FMTD_173_earns}) edit 999,999.99      ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173                
    print  #rpt_FMTD_oth_earns (0,{#X000_col_FMTD_oth_earns}) edit 999,999.99      ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173                
    print  #rpt_FYTD_reg_earns (0,{#X000_col_FYTD_reg_earns}) edit 99,999,999.99   ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173                
    print  #rpt_FYTD_otp_earns (0,{#X000_col_FYTD_otp_earns}) edit 999,999.99      ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173                
    print  #rpt_FYTD_173_earns (0,{#x000_col_FYTD_173_earns}) edit 999,999.99      ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
    print  #rpt_FYTD_oth_earns (0,{#X000_col_FYTD_oth_earns}) edit 999,999.99      ! 99,999,999.99                        !isdvdzk Added it for ITG #51358   on 08/11/2008 to add earncode 173                

End-Procedure P300-Print-Totals

!**********************************************************************
Begin-Procedure P310-Get-Current-Pay
!**********************************************************************
  let #current_reg_earns = 0
  let #current_otp_earns = 0
  let #current_173_earns = 0                                        !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #current_oth_earns = 0

Begin-Select
GB.COMPANY
GB.PAYGROUP
GB.DEPTID
GB.ACCT_CD
GB.JOBCODE
GB.PAY_END_DT
GB.REG_EARNS
GB.GEX_OTP_EARNS
GB.GEX_173_EARNS                                                     !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
GB.OTH_EARNS

  let $Jobcode = &GB.JOBCODE
  let #current_reg_earns = &GB.REG_EARNS
  let #current_otp_earns = &GB.GEX_OTP_EARNS
  let #current_173_earns = &GB.GEX_173_EARNS                        !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #current_oth_earns = &GB.OTH_EARNS

FROM PS_GEX_R_GEXPY065B GB
WHERE GB.COMPANY = &GA.COMPANY
AND   GB.PAYGROUP = &GA.PAYGROUP
AND   GB.DEPTID = &GA.DEPTID
AND   GB.ACCT_CD = &GA.ACCT_CD
AND   GB.JOBCODE = &GA.JOBCODE
AND   GB.PAY_END_DT = $pay_end_dt
End-Select

End-Procedure P310-Get-Current-Pay

!**********************************************************************
begin-procedure P380-BEFORE-JOBCODE
!**********************************************************************
  Do P310-Get-Current-Pay

  Do Get-Job-Title

  print $Jobcode            (+1,{#x000_col_jobcode})
  print $JobTitle           (,+2)
  

end-procedure P380-BEFORE-JOBCODE

!**********************************************************************
begin-procedure P370-PRINT-JOBCODE-TOTALS
!**********************************************************************
#debug9 Show 'P370-PRINT-JOBCODE-TOTALS'

  print #current_reg_earns  (,{#X000_col_reg_earns})      edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #current_otp_earns  (,{#X000_col_otp_earns})      edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #current_173_earns  (,{#x000_col_173_earns})      edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #current_oth_earns  (,{#X000_col_oth_earns})      edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #gross_reg_mtd      (,{#X000_col_FMTD_reg_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #gross_otp_mtd      (,{#X000_col_FMTD_otp_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #gross_173_mtd      (,{#x000_col_FMTD_173_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #gross_oth_mtd      (,{#X000_col_FMTD_oth_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #gross_reg_ytd      (,{#X000_col_FYTD_reg_earns}) edit 99,999,999.99               
  print #gross_otp_ytd      (,{#X000_col_FYTD_otp_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #gross_173_ytd      (,{#x000_col_FYTD_173_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #gross_oth_ytd      (,{#X000_col_FYTD_oth_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                

  Add #current_oth_earns      To #act_oth_earns
  Add #current_reg_earns      To #act_reg_earns
  Add #current_otp_earns      To #act_otp_earns
  Add #current_173_earns      To #act_173_earns                                                                         !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  Add #gross_oth_mtd          To #act_FMTD_oth_earns
  Add #gross_reg_mtd          To #act_FMTD_reg_earns
  Add #gross_otp_mtd          To #act_FMTD_otp_earns
  add #gross_173_mtd          To #act_FMTD_173_earns                   !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173                                                                              
  Add #gross_oth_ytd          To #act_FYTD_oth_earns
  Add #gross_reg_ytd          To #act_FYTD_reg_earns
  Add #gross_otp_ytd          To #act_FYTD_otp_earns
  Add #gross_173_ytd          To #act_FYTD_173_earns                    !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173                               

  let #current_oth_earns = 0
  let #current_reg_earns = 0
  let #current_otp_earns = 0
  let #current_173_earns = 0                                            !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #gross_oth_mtd     = 0
  let #gross_reg_mtd     = 0
  let #gross_otp_mtd     = 0
  let #gross_173_mtd     = 0                                            !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #gross_oth_ytd     = 0
  let #gross_reg_ytd     = 0
  let #gross_otp_ytd     = 0
  let #gross_173_ytd     = 0                                             !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173

End-Procedure

!**********************************************************************
begin-procedure P360-PRINT-ACCT-CD-TOTALS
!**********************************************************************
#debug9 Show 'P360-PRINT-ACCT-CD-TOTALS'
  print $AcctCd              (+1,{#x000_col_acct_cd})
  print $AcctCDName          (,+2)
  print #act_reg_earns       (,{#X000_col_reg_earns})      edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #act_otp_earns       (,{#X000_col_otp_earns})      edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #act_173_earns       (,{#x000_col_173_earns})      edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #act_oth_earns       (,{#X000_col_oth_earns})      edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                  
  print #act_FMTD_reg_earns  (,{#X000_col_FMTD_reg_earns}) edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #act_FMTD_otp_earns  (,{#X000_col_FMTD_otp_earns}) edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #act_FMTD_173_earns  (,{#x000_col_FMTD_173_earns}) edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #act_FMTD_oth_earns  (,{#X000_col_FMTD_oth_earns}) edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #act_FYTD_reg_earns  (,{#X000_col_FYTD_reg_earns}) edit 99,999,999.99
  print #act_FYTD_otp_earns  (,{#X000_col_FYTD_otp_earns}) edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #act_FYTD_173_earns  (,{#x000_col_FYTD_173_earns}) edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print #act_FYTD_oth_earns  (,{#X000_col_FYTD_oth_earns}) edit 999,999.99!99,999,999.99           !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  position (+1)

  Add #act_oth_earns      To #dpt_oth_earns
  Add #act_reg_earns      To #dpt_reg_earns
  Add #act_otp_earns      To #dpt_otp_earns
  Add #act_173_earns      To #dpt_173_earns                            !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  Add #act_FMTD_oth_earns To #dpt_FMTD_oth_earns
  Add #act_FMTD_reg_earns To #dpt_FMTD_reg_earns
  Add #act_FMTD_otp_earns To #dpt_FMTD_otp_earns
  add #act_FMTD_173_earns To #dpt_FMTD_173_earns                       !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  Add #act_FYTD_oth_earns To #dpt_FYTD_oth_earns
  Add #act_FYTD_reg_earns To #dpt_FYTD_reg_earns
  Add #act_FYTD_otp_earns To #dpt_FYTD_otp_earns
  Add #act_FYTD_173_earns To #dpt_FYTD_173_earns                        !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173

  let #act_oth_earns      = 0
  let #act_reg_earns      = 0
  let #act_otp_earns      = 0
  let #act_173_earns      = 0                                           !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #act_FMTD_oth_earns = 0
  let #act_FMTD_reg_earns = 0
  let #act_FMTD_otp_earns = 0                                 
  let #act_FMTD_173_earns = 0                                 !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #act_FYTD_oth_earns = 0
  let #act_FYTD_reg_earns = 0
  let #act_FYTD_otp_earns = 0
  let #act_FYTD_173_earns = 0                                 !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
END-PROCEDURE

!**********************************************************************
begin-procedure P330-BEFORE-DEPT
!**********************************************************************
#debug9 Show 'P330-BEFORE-DEPT'
  New-Page

END-PROCEDURE


!**********************************************************************
begin-procedure P340-PRINT-DEPT-TOTALS
!**********************************************************************
#debug9 Show 'P340-PRINT-DEPT-TOTALS'

  print 'Dept'               (+2,1)
  print $Deptid              (,+1)
  print 'Totals'             (,+1)
  print  #dpt_reg_earns      (,{#X000_col_reg_earns})      edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_otp_earns      (,{#X000_col_otp_earns})      edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_173_earns      (,{#x000_col_173_earns})      edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_oth_earns      (,{#X000_col_oth_earns})      edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_FMTD_reg_earns (,{#X000_col_FMTD_reg_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_FMTD_otp_earns (,{#X000_col_FMTD_otp_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_FMTD_173_earns (,{#x000_col_FMTD_173_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_FMTD_oth_earns (,{#X000_col_FMTD_oth_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_FYTD_reg_earns (,{#X000_col_FYTD_reg_earns}) edit 99,999,999.99
  print  #dpt_FYTD_otp_earns (,{#X000_col_FYTD_otp_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_FYTD_173_earns (,{#x000_col_FYTD_173_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #dpt_FYTD_oth_earns (,{#X000_col_FYTD_oth_earns}) edit 999,999.99!99,999,999.99       !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                

  Add #dpt_oth_earns      To #cmp_oth_earns
  Add #dpt_reg_earns      To #cmp_reg_earns
  Add #dpt_otp_earns      To #cmp_otp_earns
  Add #dpt_173_earns      To #cmp_173_earns                         !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  Add #dpt_FMTD_oth_earns To #cmp_FMTD_oth_earns
  Add #dpt_FMTD_reg_earns To #cmp_FMTD_reg_earns
  Add #dpt_FMTD_otp_earns To #cmp_FMTD_otp_earns
  Add #dpt_FMTD_173_earns To #cmp_FMTD_173_earns                    !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  Add #dpt_FYTD_oth_earns To #cmp_FYTD_oth_earns
  Add #dpt_FYTD_reg_earns To #cmp_FYTD_reg_earns
  Add #dpt_FYTD_otp_earns To #cmp_FYTD_otp_earns
  Add #dpt_FYTD_173_earns To #cmp_FYTD_173_earns                     !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173

  let #dpt_oth_earns      = 0
  let #dpt_reg_Earns      = 0
  let #dpt_otp_earns      = 0
  let #dpt_173_earns      = 0                      !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #dpt_FMTD_oth_earns = 0
  let #dpt_FMTD_reg_Earns = 0
  let #dpt_FMTD_otp_earns = 0
  let #dpt_FMTD_173_earns = 0                      !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #dpt_FYTD_oth_earns = 0
  let #dpt_FYTD_reg_Earns = 0
  let #dpt_FYTD_otp_earns = 0
  let #dpt_FYTD_173_earns = 0                      !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  
End-Procedure

!**********************************************************************
begin-procedure P350-BEFORE-ACCT-CD
!**********************************************************************
#debug9 Show 'P350-BEFORE-ACCT-CD'
  Let $AcctCd  = &GA.ACCT_CD
  do Get-Acct-Cd-Descr
  print $AcctCd              (+1,{#x000_col_acct_cd})
  print $AcctCDName          (,+2)
END-PROCEDURE

!**********************************************************************
begin-procedure P320-PRINT-COMPANY-TOTALS
!**********************************************************************
#debug9 Show 'P320-PRINT-COMPANY-TOTALS'
  print 'Company'            (+2,1)
  print $company             (,+1)
  print 'Totals'             (,+1)
  print  #cmp_reg_earns      (0,{#X000_col_reg_earns})      edit 999,999.99!99,999,999.99   !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_otp_earns      (0,{#X000_col_otp_earns})      edit 999,999.99!99,999,999.99   !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_173_earns      (0,{#x000_col_173_earns})      edit 999,999.99!99,999,999.99   !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_oth_earns      (0,{#X000_col_oth_earns})      edit 999,999.99!99,999,999.99   !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_FMTD_reg_earns (0,{#X000_col_FMTD_reg_earns}) edit 999,999.99!99,999,999.99   !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_FMTD_otp_earns (0,{#X000_col_FMTD_otp_earns}) edit 999,999.99!99,999,999.99   !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_FMTD_173_earns (0,{#x000_col_FMTD_173_earns}) edit 999,999.99!99,999,999.99    !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_FMTD_oth_earns (0,{#X000_col_FMTD_oth_earns}) edit 999,999.99!99,999,999.99    !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_FYTD_reg_earns (0,{#X000_col_FYTD_reg_earns}) edit 99,999,999.99
  print  #cmp_FYTD_otp_earns (0,{#X000_col_FYTD_otp_earns}) edit 999,999.99!99,999,999.99   !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_FYTD_173_earns (0,{#x000_col_FYTD_173_earns}) edit 999,999.99!99,999,999.99   !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                
  print  #cmp_FYTD_oth_earns (0,{#X000_col_FYTD_oth_earns}) edit 999,999.99!99,999,999.99   !isdvdzk changed it for ITG #51358   on 08/11/2008 to add earncode 173                

  Add #cmp_oth_earns      To #rpt_oth_earns
  Add #cmp_reg_earns      To #rpt_reg_earns
  Add #cmp_otp_earns      To #rpt_otp_earns
  Add #cmp_173_earns      To #rpt_173_earns                              !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  Add #cmp_FMTD_oth_earns To #rpt_FMTD_oth_earns
  Add #cmp_FMTD_reg_earns To #rpt_FMTD_reg_earns
  Add #cmp_FMTD_otp_earns To #rpt_FMTD_otp_earns
  Add #cmp_FMTD_173_earns To #rpt_FMTD_173_earns                         !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173                        
  Add #cmp_FYTD_oth_earns To #rpt_FYTD_oth_earns
  Add #cmp_FYTD_reg_earns To #rpt_FYTD_reg_earns
  Add #cmp_FYTD_otp_earns To #rpt_FYTD_otp_earns
  Add #cmp_FYTD_173_earns To #rpt_FYTD_173_earns                         !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173

  let #cmp_oth_earns      = 0
  let #cmp_otp_earns      = 0
  let #cmp_173_earns      = 0                                     !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #cmp_reg_earns      = 0
  let #cmp_FMTD_oth_earns = 0
  let #cmp_FMTD_otp_earns = 0
  let #cmp_FMTD_173_earns = 0                                     !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #cmp_FMTD_reg_earns = 0
  let #cmp_FYTD_oth_earns = 0
  let #cmp_FYTD_otp_earns = 0
  let #cmp_FYTD_173_earns = 0                                     !isdvdzk Added it for ITG #51358   on 07/24/2008 to add earncode 173
  let #cmp_FYTD_reg_earns = 0
END-PROCEDURE

!**********************************************************************
begin-procedure P900-SQL-Error-Found($Proc_Name) 
!**********************************************************************
#debug9 Show 'P900-SQL-Error-Found'
  do P990-error-found
  display 'SQL Error in ' 
  display $Proc_Name 
  display $_sql-error
  display 'sql-status:' 
  display #_sql-status 
  STOP
end-procedure

!**********************************************************************
begin-procedure P990-Error-Found
!**********************************************************************
#debug9 Show 'P990-Error-Found'
  move 'Y' to $ErrorFound
  do Format-Number(#Inputrec, $out, '99999')
  print $out (+1,1)
end-procedure

!**********************************************************************
#Include 'curdttim.sqc'  !Get-Current-DateTime procedure
#Include 'datetime.sqc'  !Routines for date and time formatting
#Include 'number.sqc'    !Routines to format numbers
#Include 'datemath.sqc'  !Does the date-math functions
#Include 'getdatcd.sqc'  !Get-Date-Codes procedure
#Include 'reset.sqc'     !Reset printer procedure
#Include 'stdapi.sqc'    !Get_run_control procedure
 
#include 'gexxx900.sqc'  !Get company multiple row table
#include 'gexxx901.sqc'  !Get company/paygroup multiple row table
#include 'gexxx902.sqc'  !Get deptid multiple row table
#include 'gexxx903.sqc'  !Get employee status multiple row table
#include 'gexxx909.sqc'  !Get acct_cd code multiple row table
#include 'gexxx916.sqc'  !Get job code multiple row table
#include 'gexxx924.sqc'  !Get ERNCD multiple row table
#Include 'gexxx922.sqc'  !Run Control parameters from GEX_RC_PAY record 
#Include 'gexxx951.sqc'  !Select Oracle Instance

#include 'askaod.sqc'    !Ask-As-Of-Date procedure
#include 'getcodta.sqc'  !Get-Company-Data procedure
#include 'getdptnm.sqc'  !Get Department Name
#include 'getactnm.sqc'  !Get Acct Cd Name
#include 'getjobtl.sqc'  !Get Job Title
!#include 'gexaltse.sqc'  !Alter Oracle Session   JNB 12/13/1998 ! ISDVNPK 08/15/2007 Commented ALTER_SEESION SQC as part of 9.0 upgrade
