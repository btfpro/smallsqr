!***********************************************************************
!  GEXPL010:  Local 19 Pension Contributions                           *
!***********************************************************************
!                                                                      *
!               Confidentiality Information:                           *
!                                                                      *
! This module is the confidential and proprietary information of       *
! Giant Eagle, Inc.; it is not to be copied, reproduced,or transmitted *
! in any form, by any means, in whole or in part, nor is it to be used *
! for any purpose other than that for which it is expressly provided   *
! without the written permission of Giant Eagle.                       *
!                                                                      *
! Copyright (c) 1997-1998 Giant Eagle,Inc. All Rights Reserved         *
!                                                                      *
!***********************************************************************
!                                                                      *
! GEXPL010:             Local 19 Pension Contributions                 *
!                                                                      *
! Narrative:            This program creates a monthly report for      *
!                       Local 19 that contains employee information    *
!                       required by the union to administer the        *
!                       pension benefit.                               *
!                                                                      *
! #Debugx Used:         #debug9 paragraph trace                        *
!                       #debug8 key variable values                    *
!                       #debug7 data returned from sql calls           *
!                                                                      *
! SQL Tables:           xlattable                                      *
!                       pay_calendar                                   *
!                       ben_defn_optn                                  *
!                       ben_defn_cost                                  *
!                       ben_defn_pgm                                   *
!                       personal_data                                  *
!                       employment                                     *
!                       job                                            *
!                       benef_plan_tbl                                 *
!                       pay_line                                       *
!                       pay_check                                      *
!                       pay_deduction                                  *
!                       earnings_bal                                   *
!                       health_benefit                                 *
!                                                                      *
! Written by:           Jim Hutchison                                  *
!                                                                      *
! Normally Run:         Monthly                                        *
!                                                                      *
! Control Parms:        FOR WHERE CLAUSE:                              *
!                         Plan Type(s)                                 *
!                         Vendor ID(s)                                 *
!                                                                      *
!***********************************************************************
!                         MODIFICATION HISTORY                         *
!***********************************************************************
!  INITIALS   DATE       DESCRIPTION OF THE CHANGE                     *
!***********************************************************************
!  JDH        01/26/98   Initial Creation                              *
!                                                                      *
!  JDH        02/26/99   Pull pay_check rows by the check date of the  *
!                        pay end rather than the check date of the     *
!                        pay_check row.                                *
!                        Add descending sort on effseq.                *
!                        $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA being set*
!                        incorrectly under process scheduler.          *
!                                                                      *
!  JDH        03/01/99   Added missing line to select.                 *
!                                                                      *
!  JDH        04/13/99   Get the effdt, action, action_reason from     *
!                        the job row that originally set the           *
!                        empl_status to its current value for          *
!                        empl_status in ('L','P','R','T').             *
!                                                                      *
!  JNB        05/28/99   Added MAX(EFFDT) to the following statement   *
!                            AND    BDP.EFFDT               =          *
!                            (SELECT MAX(EFFDT)                        *
!                             FROM   PS_BEN_DEFN_PGM                   *
!                             WHERE BENEFIT_PROGRAM=BDP.BENEFIT_PROGRAM*
!                             AND    EFFDT           <= $pay_end_dt)   *
!                                                                      *    
!  JDH        06/29/99   Changed logic to get action, action_reason,   *
!                        effdt.                                        *
!                                                                      *
!  SXK        10/21/99   Changed to have union from job_labor          *
!                                                                      *
!  CJH        12/12/2000 Change sort order to add Vendor ID and        *
!                        summary totals by Vendor ID.                  *
!                                                                      *                  
!  CWB        02/27/2001 Added logic to correct page break when plan or*
!                        vendor id changes.                            *
!                                                                      *                  
!  CWB        03/28/2001 Removed unneccessary select for union_cd and  * 
!                        the join to JOB_LABOR.                        *        
!                                                                      *                  
!  AXC        08/01/2002 EmplRCD is not part of Key for Earnings balance. 
!			 Added to join.				       *
!                                                                      *                  
!  GBD        07/15/2002 Added Fieldvalue to effective dated selection *
!                        of the Load-Lookup procedure.                 *
!                        Corrected spacing issue with report output.   *
!                                                                      *                  
!  GBD        10/16/2002 Modify code to eliminate multiple row selects.*
!                                                                      *
!  AXL        02/16/2004 Change sort order in Get-Status-Date procedure*
!                        to retrieve most current status.  Add last-dt-*
!                        worked to report.                             *
! AMS 	      09/10/2007	8.3 to 9.0 upgrade retrofit changes    *
! VENDKXY     04/30/2009      Done Changes requested from S3 12651638  *
! VENDKXY     02/03/2010   Done the Changes for ITG  72828             *
!                           when store changes in month being processed*
!ISDVAWD     04/22/2014     ITG# 827  - Changed file path  '\\nt5\' *
!			       with '\\corp.gianteagle.com\'`	       *
! GEX_SEC_REENG 2015-04-29 Vahini Katta                                *
! Changes related to gex_emplid_mapp/7 digit emplid                    *
!***********************************************************************


#Include 'setenv.sqc'    !Set environment
#Include 'setup32.sqc'   !Printer and page-size initialization


#define #column1     1
#define #column2    32
#define #column3    42
!GBD 07/15/2002 Begin
!#define #column4    51
#define #column4    54
!#define #column5    60
#define #column5    64

!#define #column6   71
#define #column6    71
!#define #column7   82
#define #column7    82
!#define #column8   87
#define #column8    87
!#define #column9   91
#define #column9    92
!#define #column10  101
#define #column10   97
!#define #column11  110
#define #column11   110
#define #column11a 119
!#define #column12  120
#define #column12  129
!#define #column13  136
#define #column13  140
#define #column13a  143
!#define #column14  145
#define #column14  148
#define #column15  161
!GBD 07/15/2002 End

Begin-Heading 8
#debug9 Show 'Begin-Heading'

#Include 'stdhdg01.sqc'

  Print 'Deptid:'              (3,1)
  Print $Deptid                (3,13)
  Print $DeptName              (,+2)

  Print $Reporting_Period      (3,) Center 

! 12/12/2000 - CJH - Add Vendor ID to report header
!  Print 'Provider:'             (4,1)
  Print 'VendorID:'             (4,1)
  Print $Provider_id              (4,13)
! 12/12/2000 - end
  
  Move #weeks-in-month To $weeks-in-month 9
  Let $weeks-in-month-head = '(' || $weeks-in-month || ' pay periods this month)'
  Print $weeks-in-month-head   (4,) Center

  Print 'BIRTH'                (+2,{#column3})
  Print 'SERVICE'              (+0,{#column4})
  Print 'REG'                  (+0,{#column5})
  Print 'IN STORE'             (+0,{#column6})
  Print 'EMPL'                 (+0,{#column7})
  Print 'ACT'   	       (+0,{#column9})
  Print 'EFF'                  (+0,{#column10})
  Print 'BENEFIT'              (+0,{#column11})
  Print 'LAST DT'              (+0,{#column11a})	!AXL 2/16/2004 -Add  
  Print 'WEEKS'                (+0,{#column13})
!GBD 07/15/2002 Begin
!  Print '  CONTRIBUTION'       (+0,{#column14})
  Print 'CONTRIBUTION'       (+0,{#column14})
!GBD 07/15/2002 End
  Print '  CONTRIBUTION'       (+0,{#column15})

  Print 'EMPLOYEE NAME'        (+1,{#column1})
  Print 'SSN'                  (+0,{#column2})
  Print 'DATE'                 (+0,{#column3})
  Print 'DATE'                 (+0,{#column4})
  Print 'TEMP'                 (+0,{#column5})
  Print 'DEPARTMENT'           (+0,{#column6})
  Print 'STAT'                 (+0,{#column7})
  Print 'ACT'               (+0,{#column8})
  Print 'RSN'               (+0,{#column9})
  Print 'DATE'                 (+0,{#column10})
  Print 'TERM DTE'             (+0,{#column11})
  Print 'WORKED'               (+0,{#column11a})	!AXL 2/16/2004 -Add
!GBD 07/15/2002 Begin
!  Print '    MTD HOURS'       (+0,{#column12})
!  Print '   MTD HOURS'         (+0,{#column12}) !VENDKXY Done the Changes for ITG  72828
  Print 'MTD HOURS'         (+0,{#column12})    !VENDKXY Done the Changes for ITG  72828
!GBD 07/15/2002 End
  Print 'CONTRIB'              (+0,{#column13})
!GBD 07/15/2002 Begin
!  Print '          RATE'       (+0,{#column14})
  Print '        RATE'         (+0,{#column14})
!GBD 07/15/2002 End
  Print '        AMOUNT'       (+0,{#column15})

  Print '-'                    (+1,{#column1},30)  Fill
  Print '-'                    (+0,{#column2},09)  Fill
  Print '-'                    (+0,{#column3},9)  Fill
  Print '-'                    (+0,{#column4},9)  Fill
  Print '-'                    (+0,{#column5},7)   Fill
  Print '-'                    (+0,{#column6},10)  Fill
  Print '-'                    (+0,{#column7},04)  Fill
  Print '-'                    (+0,{#column8},04)  Fill
  Print '-'                    (+0,{#column9},04)  Fill
  Print '-'                    (+0,{#column10},9) Fill
  Print '-'                    (+0,{#column11},9) Fill
  Print '-'                    (+0,{#column11a},9) Fill		!AXL 2/16/2004 -Add
  Print '-'                    (+0,{#column12},12) Fill
  Print '-'                    (+0,{#column13},07) Fill
  Print '-'                    (+0,{#column14},12) Fill
  Print '-'                    (+0,{#column15},14) Fill
End-Heading


Begin-Report
#debug9 Show 'Begin-Report'

!VENDKXY Done the Changes for ITG  72828 -- Begin 
MOVE $CURRENT-DATE TO $CURRDT 'MMDDYY'   
     
  #ifdef NT
!*****************************************************************
! ISDVAWD ITG# 827- 4/22/2014 - Begin - - Changed Report name 
!*****************************************************************
!  let $report-name = '\\nt5\ftproot\benefits\Local 19_GEXPL010\'|| 'PL010PDF_' || $CURRDT ||'.pdf'
  let $report-name = '\\corp.gianteagle.com\common\HR\HRPS\secure\benefitsk\Local 19_GEXPL010\'|| 'PL010PDF_' || $CURRDT ||'.pdf'
!******************************************************************
! ISDVAWD ITG# 827- 4/22/2014 - End  
!******************************************************************
  
  new-report  $report-name   
  #end-if			
  
  !VENDKXY Done the Changes for ITG  72828 -- End

  Do Set-Optimizer-Goal
  Do Init-DateTime           !datetime.sqc
  Do Init-Number             !number.sqc
  Do Get-Current-DateTime    !curdttim.sqc
  Do Stdapi-Init             !stdapi.sqc

  Do P100-Start
  !VENDKXY Done the Changes for ITG  72828
  #ifdef NT  
    Do Openfile    
  #end-if  
  !VENDKXY Done the Changes for ITG  72828
  Do P200-Main-Process
  Do P300-Finish

  Do Reset                   !reset.sqc
  Do Stdapi-Term             !stdapi.sqc

  Show 'Successful end of report'
End-Report


Begin-Procedure Set-Optimizer-Goal
#debug9 Show 'Set-Optimizer-Goal'
  Begin-SQL

!    Alter Session Set OPTIMIZER_GOAL=RULE;							!AMS 09/10/2007  
  End-SQL
End-Procedure


!VENDKXY Done the Changes for ITG  72828-- Begin
Begin-Procedure Openfile
  
    encode '<009>' into $delim
    

!*****************************************************************
! ISDVAWD ITG# 827- 4/22/2014 - Begin - Updated File path   
!*****************************************************************
!       Let $file010 = '\\nt5\ftproot\benefits\Local 19_GEXPL010\'|| 'PL010XLS_' || $CURRDT ||'.xls'  
      let $file010 = '\\corp.gianteagle.com\common\HR\HRPS\secure\benefitsk\Local 19_GEXPL010\'|| 'PL010XLS_' || $CURRDT ||'.xls' 
!******************************************************************
! ISDVAWD ITG# 827- 4/22/2014 - End  
!******************************************************************
   	  		
    Open $file010 As 1 For-Writing Record=1000:Vary
    

   Move 'PL010XLS'			To $Report  
   encode '<012>' into $newline 
   String 'Report ID:' $Report  ' ' ' ' ' ' ' ' ' ' $ReportTitle by $delim into $gexpl010
   Write 1 from $gexpl010
   Write 1 from $newline 
   
    
    String 'VENDORID' 'DEPTID' 'EMPLOYEE NAME' 'SSN' 'BIRTH DATE' 'SERVICE DATE' 'REG TEMP' 'JOB TITLE' 'EMPL STAT'    
    'ACTION' 'ACTION REASON' 'EFF DATE' 'BENEFIT TERM DATE' 'LAST DATE WORKED' 'MTD HOURS' 'WEEKS CONTRIB' 'CONTRIBUTION RATE' 'CONTRIBUTION AMOUNT' by $delim into $gexpl010   
    Write 1 from $gexpl010
    
End-Procedure

!VENDKXY Done the Changes for ITG  72828-- End

Begin-Procedure P100-Start
#debug9 Show 'P100-Start'

   Move 'GEXPL010'                    To $ReportID 

!VENDKXY Done the Changes for ITG  72828
   #ifdef NT   														
   Move 'PL010PDF'			To $ReportID    
   #end-if  
!VENDKXY Done the Changes for ITG  72828

  Move 'LOCAL 19 PENSION CONTRIBUTIONS' To $ReportTitle

  Show '$ReportID=' $ReportID
  Show '$ReportTitle=' $ReportTitle

  Create-Array Name=Plan-Array Size=50
    Field=plantype:Char:2
    Field=benefitplan:Char:6
    Field=gexspclaccumcd:Char:3
    Field=contributionrate:Number

  Clear-Array Name=Plan-Array

  If $prcs_process_instance = ''

    Move '''' to $ProviderString
    Display 'Enter Vendor ID or leave blank to exit.'
    While 1=1
      Input $Provider maxlen=6 'Provider ID'
      if RTRIM($Provider, ' ') = ''
	concat '''' with $ProviderString
	break
      end-if
      if $ProviderString <> ''''
	concat ''',''' with $ProviderString
      end-if
      concat $Provider with $ProviderString
    End-While

    let $Vendor_ID = $Provider_id

    if $ProviderString = ''''''
      let $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA = '1=1'
      let $GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA = 'ALL'
      let $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA2 = '1=1'
      let $GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA2 = 'ALL'
    else
      let $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA = 'bpt.vendor_id In (' || $ProviderString || ')'
      let $GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA = $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA
      let $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA2 = 'bpt2.vendor_id In (' || $ProviderString || ')'
      let $GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA2 = $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA
    end-if

    Move '''' to $PlanTypeString
    Display 'Enter Plan Type or leave blank to exit.'
    While 1=1
      Input $PlanType Maxlen=2 'Plan Type'
      Uppercase $PlanType
      if RTRIM($PlanType, ' ') = ''
	concat '''' with $PlanTypeString
	break
      end-if
      if $PlanTypeString <> ''''
	concat ''',''' with $PlanTypeString
      end-if
      concat $PlanType with $PlanTypeString
    End-While

    if $PlanTypeString = ''''''
      let $GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA = '1=1'
      let $GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA = 'ALL'
      let $GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA2 = '1=1'
      let $GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA2 = 'ALL'
    else
      let $GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA = 'bpt.plan_type In (' || $PlanTypeString || ')'
      let $GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA = $GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA
      let $GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA2 = 'bpt2.plan_type In (' || $PlanTypeString || ')'
      let $GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA2 = $GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA
    end-if

  Else

    Let $GEXXX912_Plan_Type_Alias = 'bpt2.plan_type'
    Let $GEXXX912_Benefit_Plan_Alias = 'bpt2.benefit_plan'
    Do GEXXX912-Select-Benefit-Plan-Parameters
    Let $GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA2 = $GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA
    Let $GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA2 = $GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA

    Let $GEXXX912_Plan_Type_Alias = 'bpt.plan_type'
    Let $GEXXX912_Benefit_Plan_Alias = 'bpt.benefit_plan'
    Do GEXXX912-Select-Benefit-Plan-Parameters

    Let $GEXXX927_Vendor_ID_Alias = 'bpt2.vendor_id'
    Do GEXXX927-Select-Vendor-ID-Parameters
    Let $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA2 = $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA
    Let $GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA2 = $GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA

    Let $GEXXX927_Vendor_ID_Alias = 'bpt.vendor_id'
    Do GEXXX927-Select-Vendor-ID-Parameters

  End-If

  date-time () HH:MI:SS &timeBegan
  date-time () MM/DD/YYYY &dateBegan
  show 'Report Began at ' &timeBegan ' on ' &dateBegan

  If $GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA = '1=1'
    Display 'At least one plan type parameter must be specified'
    Stop
  End-If

  If $GEXXX927_INCLUDE_VENDOR_ID_CRITERIA = '1=1'
    Display 'At least one vendor id parameter must be specified'
    Stop
  End-If

!  Let $X000_ORDER_BY = 'Deptid, Employee Name' ! CWB 02/27/2001
  Let $X000_ORDER_BY = 'vendor_id, Benefit plan, Deptid, Employee name'

  Show '$GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA  = '   $GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA
  Show '$GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA      = '   $GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA

  Do Get-Calendar-Year-Id    !getbalid.sqc

  Do P140-Get-Last-Confirmed-Pay
  Do P150-Print-Cover-Page
  Do P170-Get-Xlat-Lookup
  Do P180-Get-Rate-Type
End-Procedure


Begin-Procedure P140-Get-Last-Confirmed-Pay
#debug9 Show 'P140-Get-Last-Confirmed-Pay'

Begin-Select Loops=1
pay_end_dt
To_Number(To_Char(pay_end_dt,'MM'))          &balance_period
To_Number(To_Char(pay_end_dt,'YYYY'))        &balance_year
To_Char(pay_end_dt,'fmMonth YYYY')           &period
Last_Day(pay_end_dt)                         &current_month_end
Last_Day(Add_Months(pay_end_dt,-1))          &prev_month_end
Last_Day(Add_Months(pay_end_dt,1))           &next_month_end

  Let $AsOfDate         = &pay_end_dt
  Let $pay_end_dt       = &pay_end_dt
  Let #balance_year     = &balance_year
  Let #balance_period   = &balance_period
  Let $Reporting_Period = &period

  Let $current_month_begin = '01-'||Substr($pay_end_dt,4,8)
  Let $current_month_end   = &current_month_end
  Let $next_month_end      = &next_month_end
  Let $prev_month_begin    = '01-'||Substr(&prev_month_end,4,8)

  let #balance_qtr = #balance_period
  let #balance_qtr = ((#balance_qtr - 1)/ 3) + 1
  do Format-Number(#balance_qtr, $balance_qtr, '9.99') !avoid rounding the integer portion
  move $balance_qtr to $balance_qtr x     !save the integer portion
  let #balance_qtr = $balance_qtr

  Show 'Report will contain balances for the month of ' $Reporting_Period
  Show 'Last confirmed pay end date:  ' $pay_end_dt

  Do P145-Get-Num-Pay-Periods

  If Rtrim($pay_end_dt,' ') = ''
    Show 'No confirmed pay period found in calendar'
    Stop
  End-If

From   ps_pay_calendar

Where  company                 = 'GEI'
And    paygroup                = 'RET'

And    pay_end_dt              =
      (Select Max(pay_end_dt)
       From   ps_pay_calendar
       Where  company          = 'GEI'
       And    paygroup         = 'RET'
       And    pay_end_dt      <= $AsOfToday
       And    pay_confirm_run  = 'Y')
And    pay_confirm_run         = 'Y'
End-Select
End-Procedure


Begin-Procedure P145-Get-Num-Pay-Periods
#debug9 Show 'P145-Get-Num-Pay-Periods'
Begin-Select
Max(pay_period) &pay_period

  Let #weeks-in-month   = &pay_period

From   ps_pay_calendar

Where  company    = 'GEI'
And    paygroup   = 'RET'
And    To_Char(check_dt,'YYYYMM')
                  = To_Char(To_Date($pay_end_dt),'YYYYMM')
End-Select
End-Procedure


begin-procedure P150-Print-Cover-Page
#debug9 Show 'P150-Print-Cover-Page'

  Print 'RUN CONTROL INFORMATION FOR THIS REPORT RUN:'        (+5,1)
  Print '$Prcs_OPRID          = '                             (+2,5)
  Print $Prcs_OPRID                                           (0,+2)
  Print '$PRCS_RUN_CNTL_ID    = '                             (+1,5)
  Print $PRCS_RUN_CNTL_ID                                     (0,+2)

  Print 'SELECTION CRITERIA FOR THIS REPORT RUN:'             (+5,2)
  Print '$GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA = '  (+2,5)
  Print $GEXXX912_INCLUDE_BENEFIT_PLAN_DISPLAY_CRITERIA       (0,+2)
  Print '$GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA     = ' (+2,5)
  Print $GEXXX927_INCLUDE_VENDOR_ID_DISPLAY_CRITERIA          (0,+2)

  Print 'Report will contain balances for the month of'       (+2,5)
  Print $Reporting_Period                                     (0,+1)
  Print 'Last confirmed pay end date:'                        (+2,5)
  Print $pay_end_dt                                           (0,+2)

  Print 'SORT ORDER FOR THIS REPORT RUN:'                     (+5,2)
  Print $X000_ORDER_BY                                        (+2,5)

  Let #PAGE-COUNT = 0
  NEW-PAGE
End-Procedure


begin-procedure P170-Get-Xlat-Lookup
#debug9 Show 'P170-Get-Xlat-Lookup'

  Let $Where = '     x.fieldname   = ''REG_TEMP''' ||
	       ' And x.eff_status  = ''A''' ||
!	       ' And x.language_cd = ''ENG''' ||																		! AMS 09/10/2007
	       ' And x.effdt       = (Select Max(effdt)' ||
!	       '                      From   xlattable x1' ||													! AMS 09/10/2007
	       '                      From   psxlatitem x1' ||												! AMS 09/10/2007
	       '                      Where  x1.fieldname    = x.fieldname' ||
!GBD 07/15/2002 Begin
!	       '                       And    x1.language_cd  = ''ENG''' ||
!	       '                      And    x1.language_cd  = x.language_cd' ||			! AMS 09/10/2007
	       '                      And    x1.fieldvalue  = x.fieldvalue' ||
!GBD 07/15/2002 End
	       '                      And    x1.effdt       <= ''' || $pay_end_dt || '''' ||
	       '                      And    x1.eff_status   = ''A'')'

  Load-Lookup
    Name=XlatLookup
    Rows=10
!    Table='XLATTABLE X'										! AMS 09/10/2007
    Table='PSXLATITEM X'										! AMS 09/10/2007
    Key='X.FIELDVALUE'
    Return_Value='X.XLATSHORTNAME'
    Where=$Where
    Quiet
End-Procedure


Begin-Procedure P180-Get-Rate-Type
#debug9 Show 'P180-Get-Rate-Type'
Begin-Select DISTINCT                              !GBD 10/16/2002
BPT2.PLAN_TYPE
BPT2.BENEFIT_PLAN
BDP.GEX_SPCL_ACCUM_CD
BDC.RATE_TYPE
BDC.RATE_TBL_ID

  If &BDC.RATE_TYPE = '2'
    Do P190-Flat-Rate
  Else
    Display 'Rate type other than flat was found.'
    Display 'Code to handle other type needs to be added.'
    Stop
  End-If

FROM   PS_BEN_DEFN_PGM    BDP,
       PS_BEN_DEFN_COST   BDC,
       PS_BEN_DEFN_OPTN   BDO,
       PS_BENEF_PLAN_TBL  BPT2

WHERE [$GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA2]
AND   [$GEXXX927_INCLUDE_VENDOR_ID_CRITERIA2]

AND    BPT2.EFFDT              = 
      (SELECT MAX(EFFDT)
       FROM   PS_BENEF_PLAN_TBL
       WHERE  PLAN_TYPE        = BPT2.PLAN_TYPE
       AND    BENEFIT_PLAN     = BPT2.BENEFIT_PLAN
       AND    EFFDT           <= $pay_end_dt)
!GBD 10/16/2002 Begin
AND    BDO.BENEFIT_PROGRAM     = BDP.BENEFIT_PROGRAM
AND    BDO.EFFDT               = BDP.EFFDT
AND    BDO.PLAN_TYPE           = BPT2.PLAN_TYPE
AND    BDO.BENEFIT_PLAN        = BPT2.BENEFIT_PLAN

!AND    BDO.EFFDT               =
!      (SELECT MAX(EFFDT)
!       FROM   PS_BEN_DEFN_OPTN
!       WHERE  BENEFIT_PROGRAM  = BDO.BENEFIT_PROGRAM
!       AND    EFFDT           <= $pay_end_dt
!       AND    PLAN_TYPE        = BDO.PLAN_TYPE      
!       AND    OPTION_ID        = BDO.OPTION_ID)

AND    BDC.BENEFIT_PROGRAM     = BDO.BENEFIT_PROGRAM 
AND    BDC.EFFDT               = BDP.EFFDT

!AND    BDC.EFFDT               =
!      (SELECT MAX(EFFDT)
!       FROM   PS_BEN_DEFN_COST
!       WHERE  BENEFIT_PROGRAM  = BDC.BENEFIT_PROGRAM
!       AND    EFFDT           <= $pay_end_dt
!       AND    PLAN_TYPE        = BDC.PLAN_TYPE 
!       AND    OPTION_ID        = BDC.OPTION_ID 
!       AND    COST_ID          = BDC.COST_ID) 

AND    BDC.PLAN_TYPE           = BDO.PLAN_TYPE
AND    BDC.OPTION_ID           = BDO.OPTION_ID

!AND    BDP.BENEFIT_PROGRAM     = BDO.BENEFIT_PROGRAM

AND    BDP.EFFDT               =
      (SELECT MAX(EFFDT)
       FROM   PS_BEN_DEFN_PGM
       WHERE  BENEFIT_PROGRAM  = BDP.BENEFIT_PROGRAM
       AND    EFFDT           <= $pay_end_dt)
!GBD 10/16/2002 End
End-Select
End-Procedure


Begin-Procedure P190-Flat-Rate
#debug9 Show 'P190-Flat-Rate'
Begin-Select
!FRT.EMPLR_COVRG_RATE									!Vendkxy changed for the S3 12651638
FRT.BN_EMPLR_RATE											!Vendkxy changed for the S3 12651638

  Add 1 To #i
  !Put &BPT2.PLAN_TYPE &BPT2.BENEFIT_PLAN &BDP.GEX_SPCL_ACCUM_CD &FRT.EMPLR_COVRG_RATE Into Plan-Array(#i)		!Vendkxy changed for the S3 12651638
  Put &BPT2.PLAN_TYPE &BPT2.BENEFIT_PLAN &BDP.GEX_SPCL_ACCUM_CD &FRT.BN_EMPLR_RATE Into Plan-Array(#i)			!Vendkxy changed for the S3 12651638
 
!FROM   PS_FLAT_RATE_TBL FRT					!Vendkxy changed for the S3 12651638 
FROM PS_BN_RATE_DATA  FRT							!Vendkxy changed for the S3 12651638 

!WHERE  FRT.FLAT_RATE_ID     = &BDC.RATE_TBL_ID				!Vendkxy changed for the S3 12651638 

WHERE  FRT.RATE_TBL_ID     = &BDC.RATE_TBL_ID					!Vendkxy changed for the S3 12651638 

AND    FRT.EFFDT            =
      (SELECT MAX(EFFDT)
       !FROM   PS_FLAT_RATE_TBL										!Vendkxy changed for the S3 12651638 
       !WHERE  FLAT_RATE_ID  = FRT.FLAT_RATE_ID		!Vendkxy changed for the S3 12651638 
       FROM PS_BN_RATE_DATA												!Vendkxy changed for the S3 12651638 
       WHERE RATE_TBL_ID = FRT.RATE_TBL_ID				!Vendkxy changed for the S3 12651638 
       AND    EFFDT        <= $pay_end_dt)
       
End-Select
End-Procedure


Begin-Procedure P200-Main-Process
#debug9 Show 'P200-Main-Process'
 
  Let $Data-Found-Flag = 'N'

Begin-Select
! 12/12/2000 - CJH - add vendor id to subtotals
bpt.vendor_id     ()         On-Break
                            Level=1
			    Print=Never
			    Save=$Save_Vendor_ID
			    After=P291-After-Vendor-ID-Break
! 12/12/2000 - CJH - end

bpt.plan_type

bpt.benefit_plan  ()        On-Break
                            Level=2
			    Print=Never
			    Save=$Save_Plan
			    After=P292-After-Plan-Break

pl.deptid         ()        On-Break
                            Level=3
			    Print=Never
			    Save=$Save_Deptid
			    After=P290-After-Deptid-Break
! CWB 03/28/2001 BEGIN
!JL.union_cd    
! CWB 03/28/2001 END

e.service_dt

per.name
per.birthdate

j.emplid
j.empl_rcd
j.effdt
j.company
j.reg_temp
j.empl_status
j.acct_cd
j.last_date_worked	!AXL 2/16/2004 - Add
j.position_nbr  !VENDKXY Done the Changes for ITG  72828

Count(pd.ded_cur) &num_periods
Sum(pd.ded_cur) &pd.ded_cur

!VENDKXY Done the Changes for ITG  72828-- Begin
  Let $Position_Nbr          = &j.position_nbr  
  Let $AsOfDate = $pay_end_dt
  do Get-Position-Title
  Let $jobtitle		     = $PosName 
  Let $Deptid1 = &pl.deptid   
  !VENDKXY Done the Changes for ITG  72828--End

! CJH - 12/11/2000 - Add for COD
  Let $Provider_id = &bpt.vendor_id
  Let $Vendor_ID = &bpt.vendor_id
! CJH - emd

  Let $Data-Found-Flag = 'Y'

  Let #contribution_amt = &pd.ded_cur
  Let #num_periods = &num_periods

  Do P220-Get-Benefit-Termination-Row

  Evaluate &j.empl_status
    When = 'L'
    When = 'P'
    When = 'R'
    When = 'T'
      Do P230-Get-Leave-Begin-Date
      Break
    When-Other
      Do P235-Get-Status-Date
  End-Evaluate

  Let #j = 1
  While #j <= #i
    Get $PLANTYPE $BENEFITPLAN $GEXSPCLACCUMCD #EMPLRCOVRGRATE From Plan-Array(#j)
      If   &BPT.PLAN_TYPE    = $PLANTYPE    And
	   &BPT.BENEFIT_PLAN = $BENEFITPLAN
        Let $spcl_accum_cd = $GEXSPCLACCUMCD
        Let #coverage_rate = #EMPLRCOVRGRATE
        Break
      Else
        Add 1 To #j
      End-If
  End-While

  Do P240-Get-MTD-Hours
  Do P250-Format-Record
  Do P260-Print-Record

  Add #hrs_mtd          To #Deptid-Hours
  Add #contribution_amt To #Deptid-Amount

! 12/12/2000 - CJH - add total accums for Vendor ID
  Add #hrs_mtd          To #Vendor-ID-Hours
  Add #contribution_amt To #Vendor-ID-Amount

  Add #hrs_mtd          To #Plan-Hours
  Add #contribution_amt To #Plan-Amount
! 12/12/2000 - end

From   ps_personal_data          per,
       ps_employment             e,
       ps_job                    j,
       ps_benef_plan_tbl         bpt,
       ps_pay_cal_bal_id         pcbi,
       ps_pay_line               pl,
       ps_pay_check              pc,
       ps_pay_deduction          pd

! CWB 03/28/2001 BEGIN
!      ps_job_labor 		 jl    
! CWB 03/28/2001 END

Where  per.emplid                = j.emplid
And    e.emplid                  = j.emplid
And    e.empl_rcd               = j.empl_rcd

! CWB 03/28/2001 BEGIN
!AND    JL.EMPLID    = J.EMPLID
!AND    JL.EMPL_RCD = J.EMPL_RCD
!AND    JL.EFFDT               = (SELECT MAX(EFFDT) FROM PS_JOB_LABOR
!       WHERE  EMPLID          = JL.EMPLID
!       AND    EMPL_RCD       = JL.EMPL_RCD
!       AND    EFFDT          <= $pay_end_dt)
!AND    Jl.EFFSEQ              = (SELECT MAX(EFFSEQ) FROM PS_JOB_LABOR
!       WHERE  EMPLID          = JL.EMPLID
!       AND    EMPL_RCD       = JL.EMPL_RCD
!       AND    EFFDT           = JL.EFFDT)
! CWB 03/28/2001 END

And    j.effdt                   = (Select Max(effdt) From ps_job
       Where  emplid             = j.emplid
       And    empl_rcd          = j.empl_rcd
       And    effdt             <= $pay_end_dt)
And    j.effseq                  = (Select Max(effseq) From ps_job
       Where  emplid             = j.emplid
       And    empl_rcd          = j.empl_rcd
       And    effdt              = j.effdt)

And    bpt.effdt                 = (Select Max(effdt) From ps_benef_plan_tbl
       Where  plan_type          = bpt.plan_type
       And    benefit_plan       = bpt.benefit_plan
       And    effdt             <= $pay_end_dt)

And    pcbi.company              = pc.company
And    pcbi.paygroup             = pc.paygroup
And    pcbi.balance_id           = 'CY'
And    pcbi.balance_year         = #balance_year
And    pcbi.balance_period       = #balance_period

And    pc.pay_end_dt             = pcbi.pay_end_dt
And    pc.emplid                 = j.emplid
And    pc.empl_rcd              = j.empl_rcd

And    pd.company                = pc.company
And    pd.paygroup               = pc.paygroup
And    pd.pay_end_dt             = pc.pay_end_dt
And    pd.off_cycle              = pc.off_cycle
And    pd.page_num                  = pc.page_num
And    pd.line_num                  = pc.line_num
And    pd.sepchk                 = pc.sepchk

And    pl.company                = pc.company
And    pl.paygroup               = pc.paygroup
And    pl.pay_end_dt             = pc.pay_end_dt
And    pl.off_cycle              = pc.off_cycle
And    pl.page_num                  = pc.page_num
And    pl.line_num                  = pc.line_num

And    pd.plan_type              = bpt.plan_type
And    pd.benefit_plan           = bpt.benefit_plan
And    pd.ded_class              = 'N'

And   [$GEXXX912_INCLUDE_BENEFIT_PLAN_CRITERIA]
And   [$GEXXX927_INCLUDE_VENDOR_ID_CRITERIA]

! 12/12/2000 - CJH - add vendor to group by, sort order
! Group By pl.deptid,
Group By bpt.vendor_id,
       pl.deptid,
       bpt.plan_type,
       bpt.benefit_plan,

! CWB 03/28/2001 BEGIN
!       jl.union_cd,
! CWB 03/28/2001 END

       e.service_dt,
       per.name,
       per.birthdate,
       j.emplid,
       j.empl_rcd,
       j.effdt,
       j.company,
       j.reg_temp,
       j.empl_status,
       j.acct_cd,
       j.last_date_worked,	!AXL 2/16/2004 - Add
       j.position_nbr  !VENDKXY Done the Changes for ITG  72828
! Order By pl.deptid, per.name
Order By bpt.vendor_id, bpt.benefit_plan, pl.deptid, per.name
! 12/12/2000 - CJH - end

End-Select
End-Procedure


Begin-Procedure P220-Get-Benefit-Termination-Row
#debug9 Show 'P220-Get-Benefit-Termination-Row'
Begin-Select
hb.coverage_begin_dt

From   ps_health_benefit hb

Where  hb.emplid         = &j.emplid
And    hb.empl_rcd      = &j.empl_rcd
And    hb.plan_type      = &bpt.plan_type

And    hb.effdt          =
      (Select Max(effdt)
       From   ps_health_benefit
       Where  emplid     = &j.emplid
       And    empl_rcd  = &j.empl_rcd
       And    plan_type  = &bpt.plan_type)

And    hb.coverage_begin_dt Between $prev_month_begin
                                And $next_month_end

And    hb.coverage_elect = 'T'
End-Select
End-Procedure


Begin-Procedure P230-Get-Leave-Begin-Date
#debug9 Show 'P230-Get-Leave-Begin-Date'
  Let $Status-Change = 'N'
Begin-Select
JOB.EFFDT
JOB.EMPL_STATUS
JOB.ACTION
JOB.ACTION_REASON
JOB.LAST_DATE_WORKED	!AXL 2/16/2004 - Add


  If &JOB.EMPL_STATUS = &J.EMPL_STATUS And
      $Status-Change = 'N'
    Let $Effective-Date = &JOB.EFFDT
    Let $Action         = &JOB.ACTION
    Let $Action_Reason  = &JOB.ACTION_REASON
    !AXL - Begin
    Do Format-DateTime(&job.last_date_worked, $last_date_worked , {DEFMDY}, '', '')
    !AXL - End
    Let $Status-Change = 'N'
  Else
    Let $Status-Change = 'Y'
  End-If

FROM   PS_JOB JOB

WHERE  EMPLID     = &J.EMPLID
AND    EMPL_RCD  = &J.EMPL_RCD
AND    EFFDT     <= &J.EFFDT
ORDER BY JOB.EFFDT DESC, JOB.EFFSEQ DESC
End-Select
End-Procedure


Begin-Procedure P235-Get-Status-Date
#debug9 Show 'P235-Get-Status-Date'
  Let $Reg-Temp-Change = 'N'
Begin-Select
J1.EFFDT
J1.REG_TEMP
J1.ACTION
J1.ACTION_REASON
J1.EMPL_STATUS

!AXL 2/16/2004 - Disable various in style of GEXPL014 - Begin
!  If &J1.REG_TEMP = &J.REG_TEMP And
!      $Reg-Temp-Change = 'N'
!    Let $Reg-Temp-Change = 'N'
!    If &J1.EMPL_STATUS <> 'T'
      Let $Effective-Date = &J1.EFFDT
      Let $Action         = &J1.ACTION
      Let $Action_Reason  = &J1.ACTION_REASON
!    End-If
!  Else
!    Let $Reg-Temp-Change = 'Y'
!  End-If
!AXL 2/16/2004 - Disable various in style of GEXPL014 - End

FROM   PS_JOB J1

WHERE  EMPLID     = &J.EMPLID
AND    EMPL_RCD  = &J.EMPL_RCD
AND    EFFDT     <= &J.EFFDT
!ORDER BY J1.EFFDT DESC, J1.EFFSEQ DESC	-AXL 2/16/2004
ORDER BY J1.EFFDT, J1.EFFSEQ 	!AXL 2/16/2004
End-Select
End-Procedure


Begin-Procedure P240-Get-MTD-Hours
#debug9 Show 'P240-Get-MTD-Hours'

  Let #hrs_mtd = 0

Begin-Select
eb.hrs_mtd

  Let #hrs_mtd = &eb.hrs_mtd

From   ps_earnings_bal eb

Where  eb.emplid             = &j.emplid
!AXC empl_rcd is now part of key Upgrade 8.3
and    eb.empl_rcd	     = &j.empl_rcd
And    eb.company            = &j.company
And    eb.balance_id         = 'CY'
And    eb.balance_year       = #balance_year
And    eb.balance_qtr        = #balance_qtr
And    eb.balance_period     = #balance_period
And    eb.spcl_balance       = 'Y'
And    eb.erncd              = $spcl_accum_cd
End-Select
End-Procedure


Begin-Procedure P250-Format-Record
#debug9 Show 'P250-Format-Record'

  Lookup XlatLookup &j.reg_temp $reg_temp

  Let $acctcd = &j.acct_cd
  Do Get-Acct-cd-descr

  !Do Format-DateTime(&e.service_dt, $Service_Dt, {DEFMDY}, '', '')	!Manoj
  !Do Format-DateTime(&per.birthdate, $Birthdate, {DEFMDY}, '', '')	!Manoj
  !Do Format-DateTime($Effective-Date, $eff_dt, {DEFMDY}, '', '')	!Manoj
  !Do Format-DateTime(&hb.coverage_begin_dt, $Term_Date, {DEFMDY}, '', '')	!Manoj
  !AXL 2/16/2004 - Begin
  !Do Format-DateTime(&j.last_date_worked, $last_date_worked , {DEFMDY}, '', '')	!Manoj
  !AXL 2/16/2004 - End
  !GEX-MXR Added for upgarde 9.0 on 15/10/2007  - Begin
Let $Service_Dt = Edit(&e.service_dt,'mm/dd/yy')
Let $Birthdate = Edit(&per.birthdate,'mm/dd/yy')
Let $eff_dt = Edit($Effective-Date,'mm/dd/yy')
Let $Term_Date = Edit(&hb.coverage_begin_dt,'mm/dd/yy')
Let $last_date_worked = Edit(&j.last_date_worked,'mm/dd/yy')
!GEX-MXR Added for upgarde 9.0 on 15/10/2007  - End
End-Procedure


Begin-Procedure P260-Print-Record
#debug9 Show 'P260-Print-Record'
  do Get-Emp-Ssn (&j.emplid, $Ssn_Out) !GEX_SEC_REENG 2015-04-29 Vahini Katta 
  Print &per.name                  (+1,{#column1},30)
  !GEX_SEC_REENG 2015-04-29 Vahini Katta Begins
  !Print &j.emplid                  (+0,{#column2})
  Print $Ssn_Out                   (+0,{#column2})
  !GEX_SEC_REENG 2015-04-29 Vahini Katta Ends
  Print $Birthdate                 (+0,{#column3})
  Print $Service_Dt                (+0,{#column4})
  Print $reg_temp                  (+0,{#column5})
  Print $AcctNameAbbrv             (+0,{#column6})
  Print &j.empl_status             (+0,{#column7})
  Print $Action                    (+0,{#column8})
  Print $Action_Reason             (+0,{#column9})
  Print $eff_dt                    (+0,{#column10})
  Print $Term_Date                 (+0,{#column11})
  Print $last_date_worked          (+0,{#column11a})	!AXL 2/16/2004 - Add 
!GBD 07/15/2002 Begin
!  Print #hrs_mtd                   (+0,{#column12})  Edit 999,999,999.99
  Print #hrs_mtd                   (+0,{#column12})  Edit 9,999,999.99
  Print #num_periods               (+0,{#column13a})  Edit 9		!AXL 2/16/2004 - Move over
!  Print #coverage_rate             (+0,{#column14})  Edit 999,999,999.99
  Print #coverage_rate             (+0,{#column14})  Edit 9,999,999.99
!GBD 07/15/2002 End
  Print #contribution_amt          (+0,{#column15})  Edit 999,999,999.99
  
   !VENDKXY Done the Changes for ITG  72828-- Begin 
    #ifdef NT   
     !GEX_SEC_REENG 2016-10-19 Jyotsna Negi Begins   
     !STRING $Vendor_ID $Deptid1 &per.name &j.emplid  &per.birthdate &e.service_dt $reg_temp $jobtitle &j.empl_status  $Action  $Action_Reason  $Effective-Date &hb.coverage_begin_dt &j.last_date_worked  #hrs_mtd #num_periods #coverage_rate #contribution_amt  BY $DELIM INTO $GEXPL010 
     STRING $Vendor_ID $Deptid1 &per.name $Ssn_Out  &per.birthdate &e.service_dt $reg_temp $jobtitle &j.empl_status  $Action  $Action_Reason  $Effective-Date &hb.coverage_begin_dt &j.last_date_worked  #hrs_mtd #num_periods #coverage_rate #contribution_amt  BY $DELIM INTO $GEXPL010   
    !GEX_SEC_REENG 2016-10-19 Jyotsna Negi Ends
WRITE 1 FROM $GEXPL010
    #end-if   
  !VENDKXY Done the Changes for ITG  72828-- End
  
End-Procedure


Begin-Procedure P290-After-Deptid-Break
#debug9 Show 'P290-After-Deptid-Break'

! CWB 02/27/2001 BEGIN ! Don't print if dept totals are zero.
  If (#deptid-hours > 0 and #Deptid-Amount > 0)
! CWB 02/27/2001 END 
    Let $Deptid = $save_deptid
    Do Get-Department-Name
!GBD 07/15/2002 Begin
!    Print '-'                        (+2,{#column12},014)   Fill
    Print '-'                        (+2,{#column12},012)   Fill
!GBD 07/15/2002 End
    Print '-'                        (+0,{#column15},014)   Fill
    Print 'Deptid'                   (+2,{#column9})
    Print $Save_Deptid               (0,+1)
    Print 'Totals'                   (0,+1)
!GBD 07/15/2002 Begin
!    Print #Deptid-Hours              (0,{#column12})        Edit 999,999,999.99
    Print #Deptid-Hours              (0,{#column12})        Edit 9,999,999.99
!GBD 07/15/2002 End
    Print #Deptid-Amount             (0,{#column15})        Edit 999,999,999.99

    Add #Deptid-Hours  To #Report-Hours
    Add #Deptid-Amount To #Report-Amount

    Let #Deptid-Hours  = 0
    Let #Deptid-Amount = 0

! CWB 02/27/2001 BEGIN 
! Added to correct page break when plan changes.  
!  New-Page
    If &bpt.benefit_plan = $save_plan
       New-Page
    end-if
  End-if
! CWB 02/27/2001 END

End-Procedure

! 12/12/2000 - CJH - Add Vendor ID to report
Begin-Procedure P291-After-Vendor-ID-Break
#debug9 Show 'P291-After-Vendor-ID-Break'

  Let $Provider_id = $save_Vendor_ID
  Let $Vendor_ID = $save_Vendor_ID
!GBD 07/15/2002 Begin
!  Print '-'                        (+2,{#column12},014)   Fill
  Print '-'                        (+2,{#column12},012)   Fill
!GBD 07/15/2002 End
  Print '-'                        (+0,{#column15},014)   Fill
!  Print 'Provider'                 (+2,{#column9})
  Print 'VendorID'                 (+2,{#column9})
  Print $Save_Vendor_ID            (0,+1)
  Print 'Totals'                   (0,+1)
!GBD 07/15/2002 Begin
!  Print #Vendor-ID-Hours            (0,{#column12})        Edit 999,999,999.99
  Print #Vendor-ID-Hours           (0,{#column12})        Edit 9,999,999.99
!GBD 07/15/2002 End
  Print #Vendor-ID-Amount          (0,{#column15})        Edit 999,999,999.99

  Let #Vendor-ID-Hours  = 0
  Let #Vendor-ID-Amount = 0
  New-Page
End-Procedure

Begin-Procedure P292-After-Plan-Break
#debug9 Show 'P291-After-Plan-Break'

  Let $Ben_Plan = $save_Plan
!GBD 07/15/2002 Begin
!  Print '-'                        (+2,{#column12},014)   Fill
  Print '-'                        (+2,{#column12},012)   Fill
!GBD 07/15/2002 End
  Print '-'                        (+0,{#column15},014)   Fill
  Print 'Ben Plan'                 (+2,{#column9})
  Print $Save_Plan                 (0,+1)
  Print 'Totals'                   (0,+1)
!GBD 07/15/2002 Begin
!  Print #Plan-Hours                (0,{#column12})        Edit 999,999,999.99
  Print #Plan-Hours                (0,{#column12})        Edit 9,999,999.99
!GBD 07/15/2002 End
  Print #Plan-Amount               (0,{#column15})        Edit 999,999,999.99

  Let #Plan-Hours  = 0
  Let #Plan-Amount = 0
! CWB 02/27/2001 BEGIN 
! Added to correct page break when vendor id changes.  
!  New-Page
    If &bpt.vendor_id = $save_vendor_id
       New-Page
    end-if
! CWB 02/27/2001 END 

End-Procedure
! 12/12/2000 - CJH - end

Begin-Procedure P300-Finish
#debug9 Show 'P300-Finish'

  Do P310-Print-Report-Totals

  date-time () HH:MI:SS &timeEnded
  date-time () MM/DD/YYYY &dateEnded
  show 'Report Ended at ' &timeEnded ' on ' &dateEnded
End-Procedure


Begin-Procedure P310-Print-Report-Totals
#debug9 Show 'P310-Print-Report-Totals'

  If $Data-Found-Flag = 'Y'
    Let $Deptid   = ''
    Let $DeptName = ''
    Print 'Report Totals'            (+2,{#column9})
!GBD 07/15/2002 Begin
!    Print #Report-Hours              (0,{#column12})    Edit 999,999,999.99
    Print #Report-Hours              (0,{#column12})    Edit 9,999,999.99
!GBD 07/15/2002 End
    Print #Report-Amount             (0,{#column15})    Edit 999,999,999.99
  Else
    Print 'NO DATA SELECTED FOR THIS REPORT RUN'        (25,) Center
  End-If
End-Procedure


#include 'gexxx912.sqc'  !Get plan type multiple row table
#include 'gexxx927.sqc'  !Get vendor id multiple row table
#include 'getdptnm.sqc'  !Get department name
#include 'getactnm.sqc'  !Get account code name
#Include 'stdapi.sqc'    !Routines to Update Run Status
#Include 'curdttim.sqc'  !Get-Current-DateTime Procedure
#Include 'datetime.sqc'  !Routines for date and time formatting
#Include 'number.sqc'    !Routines to format numbers
#Include 'reset.sqc'     !Reset printer Procedure
#Include 'getbalid.sqc'  !Get-Calendar-Year-Id
#Include 'getposnm.sqc'  !Get-Position-Title procedure !VENDKXY Done the Changes for ITG  72828
#Include 'getgeid.sqc'   !Get SSN !GEX_SEC_REENG 2015-04-29 Vahini Katta