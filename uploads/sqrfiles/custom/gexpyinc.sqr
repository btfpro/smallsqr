!***********************************************************************
! GEXPYINC: This program allows the Payroll Department to 'mass update'*
!            a group of compensation rates based on a Contract         *
!            Increase, Wage Increase, or a Bonus Increase.             *
!***********************************************************************
!                                                                      *
!               Confidentiality Information:                           *
!                                                                      *
! This module is the confidential and proprietary information of       *
! Giant Eagle, Inc.; it is not to be copied, reproduced, or transmitted*
! in any form, by any means, in whole or in part, nor is it to be used *
! for any purpose other than that for which it is expressly provided   *
! without the written permission of Giant Eagle.                       *
!                                                                      *
!                                                                      *
!***********************************************************************
!                         MODIFICATION HISTORY                         *
!***********************************************************************
!  ID#     INITIALS  DATE         DESCRIPTION OF THE CHANGE            *        
!***********************************************************************
!  GEXPYINC  GXD     03/17/1998   INITIAL CREATION                     *
!                                                                      *
!                    04/20/1998   DEFAULT GEX_CHANGE_RECORD TO 'Y ON   *
!                                 JOB ROW INSERT AND TO SET CHANGE_AMT *
!                                 TO THE RATE INCREASE AMOUNT WHEN RATE*    
!                                 TYPE = 'F' OR TO SET CHANGE_PCT TO   *
!                                 THE RATE INCREASE AMOUNT WHEN RATE   *
!                                 TYPE = 'P'                           *
!                                                                      *
!             MDJ    05/22/1998   ADDED DEPTID,ACCTCD,DESCR,JOBCD,     *
!                                 DESCR, SERVICE_DT AND UNION TO THE   *   
!                                 REPORT.                              *
!                                 MADE CHANGES TO WHERE CLAUSE BUILT   *
!                                 FOR MINIMUM WAGE INCREASE.           *
!                                 MADE CHANGES TO HANDLE A CONCESSION  *
!                                 (DECREASE) IN WAGES.                 *
!                                                                      *
!             CJH    07/09/1998   REASON 0F CONTRACT CONCESSION AND    *
!                                 TYPE OF PERCENT CHANGE-DECREASE RATE.*   
!                                 STEP DISPLAYED ON PREVIEW REPORT.    *
!                                                                      *
!             CJH    07/21/1998   SORT REPORT BY CO/PYGRP/DEPT/UNION/  *
!                                 JOBCODE/HIRE DATE/ HOURLY RATE.      *
!                                 REMOVE REG_TEMP AND USE FULL_PART FOR*
!                                 PROCESSING.                          *
!                                                                      *
!             SXK    07/28/1998   Added Future Report to show employees*
!                                 with future rows as of contract rates*
!                                 change date                          *
!                                                                      *
!             SXK    09/22/1998   Added New Mobius ReportID            *
!                                                                      *
!             GXD    05/04/1999   Removed Existing Run Control Panels  *
!                                  from GE Batch-Payroll Payroll. Set  *
!                                  up Manage Payroll Process U.S. -    *
!                                  Process - GE Rate Increase Process as
!                                  the Run Control Panel               *
!                                 Update Personal_Data.Bas_Data_Flag to*
!                                  'Y' when inserting a Job row        *
!                                 Set Action_Dt = Current Date in the  *
!                                  Job row insert                      *
!                                 Verify that that a HIR row exists    *
!                                  with an Effdt <= the Effdt of the   *
!                                  new Job row. If the HIR row is future
!                                  dated, set the Effdt of the new Job *
!                                  row equal to the Effdt of the HIR row
!                                  and the Effseq# = 1                 *
!                                 Add note to bottom of report to remind
!                                  Benefits to process all open Job rows
!                                  through Ben Admin that exist prior to
!                                  Job row insert                      *
!                                                                      *
!	      SXK    07/01/1999	  Modified to use previous row         *
!                                 information while inserting a new    *
!                                 contract increase job row. Previously*
!                                 it was using latest row as of today. *
!                                                                      *
!             AXL    09/24/1999   Flipped EEO CLASS and OFFICER_CD     *
!                                 columns on the insert routine.       *
!                                                                      *
!             AXL    09/27/1999   Altered effseq calculation and       *
!                                 removed dead code.                   *
!                                                                      *
!	      SXK    11/03/1999   Modified to have union from job_labor*
!                                                                      *
!             SXK    11/09/1999   Modified to add new JOB columns and  *
!				  remove updating personal data, add   *
!				  insert to bas_activity               *
!                                                                      *
!	      SXK    11/16/1999   Modified to remove move statements   *
!				  where target variable is a numeric   *
!                                 and the move is with mask.           *
!                                                                      *
!	      SXK    01/25/2000   Modified to comment out insert into  *
!				  PS_BAS_ACTIVITY table                *
!                                                                      *
!             AXL    10/20/2000   Altered sort sequence per user       *
!                                                                      *
!  HR70133    AXL    05/14/2001   Add new job field GEX_SEASONAL_EMP.  *
!                                                                      *
!             CJH    11/07/2001   Add insert into ps_compensation for  *
!                                 rt changes                           *
!                                                                      *
!             CWB    05/20/2002   Major changes due to CSR HR-10078    *
!                                                                      *
!             PSR    10/03/2002   Modified to get Union_cd from JOB.   *
!                                 Added code to populate PS_JOB_JR tbl *
!                                                                      *
!  HR10306    GBD    01/03/2003   Added BAS_SUPPRESS_FORMS field to    *
!                                 Bas_Activity table insert.           *
!                                                                      *
!  HR10302    AXL    02/28/2003   Revised code for compensation inserts*
!                                                                      *
!             SCM    06/23/2003   Used new comprate when inserting     *    
!                                 compensation row.                    *
!  VENDSYS    NYS    08/27/2007   Upgrade 8.3 to 9.0                   *
!                                 Changed the references of ps_job,    *
!                                 ps_job_jr and ps_action_reason_tbl   * 
!            RBC     09/26/2007   Replaced PS_ACCT_CD_TBL with         *
!                                 PS_GEX_ACCT_CD_TBL
! ISDVDZK            23/03/2009   Added the Code as per the ITG 56878   *
!                                 for pulling description from Position *
!                                 data  Start                           *
!***********************************************************************

#include 'setenv.sqc' !Set environment
!SXK 07/28/98 Begin

begin-setup
   #Include 'setup32a.sqc'
   declare-report Report-Log
Printer-Type=HPLASERJET
      layout=DEFAULT
   end-declare

   declare-report Future-Report
Printer-Type=HPLASERJET
      layout=DEFAULT
   end-declare

end-setup

!SXK 07/28/98 End

!*********************************************************************
!Initial processing, retrieving current dates and calls the main 
!procedure to do the processing.                                     
!*********************************************************************
begin-report

  do Init-DateTime
  do Init-Number
  do Get-Current-DateTime
  do stdapi-init
  do Report
  do Commit-Transaction
  date-time () hh:mi:ss &timeEnded
  display 'Report Ended: ' noline
  display &timeEnded
  do Reset
  do stdapi-term

end-report

!*********************************************************************
!Calls the main logic paragraph
!*********************************************************************
begin-procedure Report

 move 'N' to $Errorfound

date-time () hh:mi:ss &timeBegan
display 'Report Began: ' noline
display &timeBegan

move 'GEXPYINC' to $ReportID

if $prcs_process_instance = ''

   input $oprid type=char 'Enter the Operator ID '
   let $oprid = upper($oprid) 
   if RTRIM($oprid,' ') = ''
      display 'An Operator ID must be entered.'
      goto report-exit
   end-if
   input $run_cntl type=char 'Enter the Run Control ID '
   if RTRIM($run_cntl,' ') = ''
      display 'A Run Control ID must be entered.'
      goto report-exit
   end-if
   input $gex_seq type=char 'Enter the Update Request Number '
   if RTRIM($gex_seq,' ') = ''
      display 'An Update Request Number must be entered.'
      goto report-exit
   end-if
   let #gex_seq = to_number($gex_seq)
   move 'N' to $check-runcntl
   do Check-for-RunCntl
   if $check-runcntl = 'N' 
      display 'Run Control doesnt exist'
      display $oprid
      display $run_cntl
      display #gex_seq
      goto report-exit
   end-if
! CWB 05/20/2002 BEGIN
    Let $GEXXX964_Company_Alias = 'JB.COMPANY'                  
    Let $GEXXX964_Paygroup_Alias = 'JB.PAYGROUP'                
    Do GEXXX964-Select-Company-Paygroup-Parameters
    show 'GEXXX964 Criteria: ' $GEXXX964_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA
    Let $GEXXX965_Deptid_Alias = 'JB.DEPTID'
    Do GEXXX965-Select-Deptid-Parameters
    show 'GEXXX965_CRITERIA: ' $GEXXX965_DEPTID_CRITERIA
    Let $GEXXX966_jobcode_Alias = 'JB.JOBCODE'
    Do GEXXX966-Select-Jobcode-Parameters
    show 'GEXXX966_CRITERIA: ' $GEXXX966_JOBCODE_CRITERIA
    Let $GEXXX967_union_cd_Alias = 'JB.UNION_CD'
    Do GEXXX967-Select-Union-Cd-Parameters
    show 'GEXXX967_CRITERIA: ' $GEXXX967_UNION_CD_CRITERIA
    Let $GEXXX968_SAL_ADMIN_PLAN_Alias = 'JB.SAL_ADMIN_PLAN'
    Do GEXXX968-Select-Sal-Admin-Plan-Parameters
    show 'GEXXX968_CRITERIA: ' $GEXXX968_SAL_ADMIN_PLAN_CRITERIA
    Let $GEXXX969_RT_CHG_Alias = 'JB.HOURLY_RT'                
    Do GEXXX969-Select-HRLY-CHG-Parameters  
    show 'GEXXX969 Criteria: ' $GEXXX969_HRLY_CHG_DISPLAY_CRITERIA                                 
else
   do GEXXX922-Select-Parameters
      move $Prcs_OprID          to $oprid
      move $Prcs_Run_Cntl_ID    to $run_cntl
      move #GEX_RC_PAY.GEX_Seq  to #gex_seq   
      move $GEX_RC_PAY.Descr    to $descr
!#############################################################################
    Let $GEXXX964_Company_Alias = 'JB.COMPANY'                  
    Let $GEXXX964_Paygroup_Alias = 'JB.PAYGROUP'                
    Do GEXXX964-Select-Company-Paygroup-Parameters
    show 'GEXXX964 Criteria: ' $GEXXX964_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA
    Let $GEXXX965_Deptid_Alias = 'JB.DEPTID'
    Do GEXXX965-Select-Deptid-Parameters
    show 'GEXXX965_CRITERIA: ' $GEXXX965_DEPTID_CRITERIA
    Let $GEXXX966_jobcode_Alias = 'JB.JOBCODE'
    Do GEXXX966-Select-Jobcode-Parameters
    show 'GEXXX966_CRITERIA: ' $GEXXX966_JOBCODE_CRITERIA
    Let $GEXXX967_union_cd_Alias = 'JB.UNION_CD'
    Do GEXXX967-Select-Union-Cd-Parameters
    show 'GEXXX967_CRITERIA: ' $GEXXX967_UNION_CD_CRITERIA
    Let $GEXXX968_SAL_ADMIN_PLAN_Alias = 'JB.SAL_ADMIN_PLAN'
    Do GEXXX968-Select-Sal-Admin-Plan-Parameters
    show 'GEXXX968_CRITERIA: ' $GEXXX968_SAL_ADMIN_PLAN_CRITERIA
    Let $GEXXX969_RT_CHG_Alias = 'JB.HOURLY_RT'                
    Do GEXXX969-Select-HRLY-CHG-Parameters  
    show 'GEXXX969 Criteria: ' $GEXXX969_HRLY_CHG_DISPLAY_CRITERIA                                 
! CWB 05/20/2002 END
end-if
 do Process-Employee-Data

 if $sev-error = 'Y'
    goto report-exit
 end-if
  

Report-Exit:

  date-time () hh:mi:ss &timeProcess
  display #InputTran 99999 noline
  display ' Transactions Processed: ' noline
  display &timeProcess

end-procedure

!*********************************************************************
!Prints the header information in the report log.
!*********************************************************************

begin-heading 8 for-reports=(report-log)
LET $REPORTID = 'PYINCLOG'
#Include 'stdhdg01.sqc'

  move &PI.GEX_SEQ to $gex_seq_num
  move &PI.DESCR   to $gex_descr
  let $Subtitle = 'Request Number: ' || $gex_seq_num||' - '||$gex_descr
  position (+1)
  print $Subtitle         () center

  position (+2)
  print 'Emplid'         (+1,01)
  print 'Name'            (0,13)
!MDJ 05/22/98 START
  print 'Deptid'          (0,44)
! CWB 05/20/2002 BEGIN
  print 'Acct Cd'         (0,52)
!  print 'Descr'           (0,61)
  print 'F/P'              (0,64)
!  print 'Job Cd'          (0,83)
  print 'Job Cd'          (0,74)
!  print 'Descr'           (0,91)  
  print 'Descr'           (0,82)  
!  print 'Union'           (0,113)
  print 'Union'           (0,104)
!  print 'Service Dt'      (0,121)
  print 'Service Dt'      (0,112)
! CWB 05/20/2002 END
!MDJ 05/22/98 END
!CJH 07/08/98 BEGIN
! CWB 05/20/2002 BEGIN
  print 'Plan'             (0,124)
  print 'Grade'            (0,129)  
!  print 'Step'            (0,134)
  print 'Step'            (0,135)
! CWB 05/20/2002 END
  print 'From Rate'       (0,142)
  print 'To Rate'         (0,163)
!CJH 07/08/98 END
  print '-'           (+1,01,172) fill
 
end-heading

!SXK 07/28/98 Begin

!*********************************************************************
!Prints the header information in the future report log.
!*********************************************************************

begin-heading 11 for-reports=(Future-Report)
move 'Employees with future rows as of contract change ' to $reporttitle
LET $REPORTID = 'PYINCFUT'
#Include 'stdhdg01.sqc'

  move &PI.GEX_SEQ to $gex_seq_num
  move &PI.DESCR   to $gex_descr
  let $Subtitle = 'Request Number: ' || $gex_seq_num||' - '||$gex_descr
  position (-1)
  print $Subtitle         () center

  position (+1)

  print '******************************************************' () center
  print 'NOTE:Hourly rate for these future rows for each employee' (+1) center
  print '     need to be verified.                               ' (+1) center
  print '******************************************************' (+1) center

  position (+2)

  print 'Emplid'         (+1,01)
  print 'Name'            (0,13)
  print 'Deptid'          (0,44)
! CWB 05/20/2002 BEGIN
  print 'Acct Cd'         (0,52)
!  print 'Descr'           (0,61)
  print 'F/P'             (0,64)
!  print 'Job Cd'          (0,83)
  print 'Job Cd'          (0,74)
!  print 'Descr'           (0,91)  
  print 'Descr'           (0,82)  
!  print 'Union'           (0,113)
  print 'Union'           (0,104)
!  print 'Service Dt'      (0,121)
  print 'Service Dt'      (0,112)
  print 'Plan'             (0,124)
  print 'Grade'            (0,129)  
!  print 'Step'            (0,134)
  print 'Step'            (0,135)
! CWB 05/20/2002 END
  print 'From Rate'       (0,142)
  print 'To Rate'         (0,163)
  print '-'           (+1,01,172) fill
 
end-heading

!SXK 07/28/98 End

!*********************************************************************
!Selects employees who satisfy the conditions specified in the where  
!clause and retrieves the elig config1 rules for the benefit program
!employee is assigned
!*********************************************************************

Begin-Procedure Process-Employee-Data

show ' Begin-Procedure Process-Employee-Data '  #gex_seq

move 'N' to $found

begin-select on-error=sql-error-found('process-employee-data')
PI.GEX_SEQ               &pi.gex_seq
PI.DESCR                  &pi.descr
PI.ACTION_DT              &pi.action_dt
PI.GEX_COMPANY_DIV_CD     &pi.gex_company_div_cd
!>>PI.COMPANY                &pi.company   
!>>PI.PAYGROUP               &pi.paygroup  
!>>PI.UNION_CD               &pi.union_cd
!>>PI.DEPTID                 &pi.deptid
PI.FULL_PART_TIME         &pi.full_part_time
PI.GEX_OPERATOR1          &pi.gex_operator1
PI.GEX_HIRE_FROM          &pi.gex_hire_from
PI.GEX_OPERATOR2          &pi.gex_operator2
PI.GEX_HIRE_TO            &pi.gex_hire_to
PI.GEX_OPERATOR3          &pi.gex_operator3              
PI.GEX_SERVICE_FROM       &pi.gex_service_from
PI.GEX_OPERATOR4          &pi.gex_operator4
PI.GEX_SERVICE_TO         &pi.gex_service_to
PI.GEX_S_ACTION           &pi.gex_s_action
PI.GEX_S_ACT_REAS         &pi.gex_s_act_reas
PI.GEX_COMP_FREQUENCY     &pi.gex_comp_frequency
PI.EMPL_CLASS             &pi.empl_class
!>>PI.JOBCODE                &pi.jobcode
!>>PI.SAL_ADMIN_PLAN         &pi.sal_admin_plan
!>>PI.GRADE                  &pi.grade
!>>PI.STEP                   &pi.step
!PI.HOURLY_RT              &pi.hourly_rt
PI.PAY_BEGIN_DT           &pi.pay_begin_dt
   Do format-datetime (&pi.pay_begin_dt,$begindt,{DEFCMP},'','') !AXL 09/27/1999
PI.ACTION                 &pi.action
PI.ACTION_REASON          &pi.action_reason
PI.GEX_RATE_TYPE          &pi.gex_rate_type
PI.RATE_AMOUNT            &pi.rate_amount
PI.GEX_PROCESS_OPTN       &pi.gex_process_optn
PI.GEX_PREVIEW_RUN        &pi.gex_preview_run
! CWB 05/20/2002 BEGIN
PI.SORT_ORDER             &pi.sort_order
! CWB 05/20/2002 END

   move 'Y' to $found

   move &pi.rate_amount to #rate_amount

!MDJ 05/22/98 START
   move &pi.rate_amount to $rate_amount
!MDJ 05/22/98 END

   if &pi.gex_process_optn = 'P'
      move 'Employee Listing for review only.  No Rate Updates have been processed.' to $ReportTitle
   else
      if &pi.gex_process_optn = 'E'
	 move 'Rate Update Process Log' to $ReportTitle
      end-if
   end-if
! CWB 05/20/2002 BEGIN
  do select-sort-order
! CWB 05/20/2002 END
   
   do Check-Data
   do Prepare-Comp-Strings
! CWB 05/20/2002 BEGIN
   do Print-Cover-Page 
! CWB 05/20/2002 END
   do Process-Selection

FROM PS_GEX_PAY_INC_TBL PI
WHERE PI.GEX_SEQ = #gex_seq

end-SELECT

  if $found = 'N'
     print 'No Pay Increase information found.'   (+1,1)
  end-if

end-procedure

!*********************************************************************
! Main Select - using the Where Clause string
!*********************************************************************
begin-procedure process-selection
move 'N' to $rec-exists

show ' begin-procedure process-selection  '

begin-select
JB.EMPLID
JB.EMPL_RCD 
JB.EFFDT
    Do format-datetime (&jb.effdt,$effdt,{DEFCMP},'','')  !AXL 09/27/1999
JB.EFFSEQ    
JB.effseq+1	       &jb.effseq2	!AXL 09/27/1999 
JB.DEPTID
JB.JOBCODE
JB.POSITION_NBR
JB.POSITION_OVERRIDE
JB.POSN_CHANGE_RECORD
JB.EMPL_STATUS
JB.ACTION
JB.ACTION_dT
JB.ACTION_REASON
JB.LOCATION
JB.TAX_LOCATION_cD
JB.JOB_ENTRY_DT
JB.DEPT_ENTRY_DT
JB.POSITION_ENTRY_DT
JB.SHIFT
JB.REG_TEMP
JB.FULL_PART_TIME
JB.COMPANY
JB.PAYGROUP
!SXK 11/09/1999 Begin
!JB.PIN_NUM                                           !PSR 09/20/2002
!JB.PAY_BASIS_NUM                                     !PSR 09/20/2002
!SXK 11/09/1999 End
JB.BAS_GROUP_ID
JB.ELIG_CONFIG1
JB.ELIG_CONFIG2
JB.ELIG_CONFIG3
JB.ELIG_CONFIG4
JB.ELIG_CONFIG5
JB.ELIG_CONFIG6
JB.ELIG_CONFIG7
JB.ELIG_CONFIG8
JB.ELIG_CONFIG9
JB.BEN_STATUS
!SXK 11/09/1999 Begin
JB.BAS_ACTION
!SXK 11/09/1999 End
JB.COBRA_aCTION
JB.EMPL_TYPE
JB.HOLIDAY_SCHEDULE
JB.STD_HOURS
JB.STD_HRS_FREQUENCY                                  !PSR 09/20/2002
JB.OFFICER_CD
JB.EMPL_CLASS
JB.SAL_ADMIN_PLAN
JB.GRADE
JB.GRADE_ENTRY_dT
JB.STEP
JB.STEP_ENTRY_DT
JB.GL_PAY_TYPE
JB.ACCT_cD
JB.EARNS_DIST_TYPE
! JB.SALARY_MATRIX_CD	            ! upgrade 9.0 deleted field
! JB.RATING_SCALE		    ! upgrade 9.0 deleted field
! JB.REVIEW_RATING		    ! upgrade 9.0 deleted field
! JB.REVIEW_DT			    ! upgrade 9.0 deleted field
JB.COMP_FREQUENCY
JB.COMPRATE
JB.CHANGE_AMT
JB.CHANGE_PCT
JB.ANNUAL_RT
JB.MONTHLY_RT
JB.DAILY_RT                                           !PSR 09/20/2002
JB.HOURLY_RT
JB.ANNL_BENEF_BASE_RT
JB.SHIFT_RT
JB.SHIFT_FACTOR
JB.CURRENCY_CD
!sxk 11/09/1999 Begin
JB.BUSINESS_UNIT
JB.SETID_DEPT
JB.SETID_JOBCODE
JB.SETID_LOCATION                                     !PSR 09/20/2002
JB.SETID_SALARY                                       !PSR 09/20/2002
JB.REG_REGION
JB.DIRECTLY_TIPPED
!SXK 11/09/1999 End
JB.FLSA_STATUS
JB.EEO_CLASS
JB.FUNCTION_CD
JB.TARIFF_GER                                         !PSR 09/20/2002
JB.TARIFF_AREA_GER
JB.PERFORM_GROUP_GER
JB.LABOR_TYPE_GER
JB.SPK_COMM_ID_GER
! JB.WRKS_CNCL_MEM_GER                                  ! upgrade 9.0 deleted field
JB.HOURLY_RT_FRA
JB.ACCDNT_CD_FRA
JB.VALUE_1_FRA                                        !PSR 09/20/2002 Begin      
JB.VALUE_2_FRA            
JB.VALUE_3_FRA            
JB.VALUE_4_FRA            
JB.VALUE_5_FRA            
JB.CTG_RATE               
JB.PAID_HOURS             
JB.PAID_FTE               
JB.PAID_HRS_FREQUENCY  
! start upgrade 9.0 deleted fields commented
! JB.GVT_EFFDT              
! JB.GVT_EFFDT_PROPOSED     
! JB.GVT_TRANS_NBR          
! JB.GVT_TRANS_NBR_SEQ      
! JB.GVT_WIP_STATUS         
! JB.GVT_STATUS_TYPE        
! JB.GVT_NOA_CODE           
! JB.GVT_LEG_AUTH_1         
! JB.GVT_PAR_AUTH_D1        
! JB.GVT_PAR_AUTH_D1_2      
! JB.GVT_LEG_AUTH_2         
! JB.GVT_PAR_AUTH_D2        
! JB.GVT_PAR_AUTH_D2_2      
! JB.GVT_PAR_NTE_DATE       
! JB.GVT_WORK_SCHED         
! JB.GVT_SUB_AGENCY         
! JB.GVT_ELIG_FEHB          
! JB.GVT_FEHB_DT            
! JB.GVT_PAY_RATE_DETER     
! JB.GVT_STEP               
! JB.GVT_RTND_PAY_PLAN      
! JB.GVT_RTND_SAL_PLAN      
! JB.GVT_RTND_GRADE         
! JB.GVT_RTND_STEP          
! JB.GVT_RTND_GVT_STEP      
! JB.GVT_PAY_BASIS          
! JB.GVT_COMPRATE           
! JB.GVT_LOCALITY_ADJ       
! JB.GVT_BIWEEKLY_RT        
! JB.GVT_DAILY_RT           
! JB.GVT_HRLY_RT_NO_LOC     
! JB.GVT_DLY_RT_NO_LOC      
! JB.GVT_BW_RT_NO_LOC       
! JB.GVT_MNLY_RT_NO_LOC     
! JB.GVT_ANNL_RT_NO_LOC     
! JB.GVT_XFER_FROM_AGCY     
! JB.GVT_XFER_TO_AGCY       
! JB.GVT_RETIRE_PLAN        
! JB.GVT_ANN_IND            
! JB.GVT_FEGLI              
! JB.GVT_FEGLI_LIVING       
! JB.GVT_LIVING_AMT         
! JB.GVT_ANNUITY_OFFSET     
! JB.GVT_CSRS_FROZN_SVC     
! JB.GVT_PREV_RET_COVRG     
! JB.GVT_FERS_COVERAGE      
! JB.GVT_TYPE_OF_APPT       
! JB.GVT_POI                
! JB.GVT_POSN_OCCUPIED      
! JB.GVT_CONT_EMPLID        
! JB.GVT_ROUTE_NEXT         
! JB.GVT_CHANGE_FLAG        
! JB.GVT_TSP_UPD_IND        
! JB.GVT_PI_UPD_IND         
! JB.GVT_SF52_NBR           
! JB.GVT_S113G_CEILING      
! JB.GVT_LEO_POSITION       
! JB.GVT_ANNUIT_COM_DT      
! JB.GVT_BASIC_LIFE_RED     
! JB.GVT_DED_PRORT_DT       
! JB.GVT_FEGLI_BASC_PCT     
! JB.GVT_FEGLI_OPT_PCT      
! JB.GVT_FEHB_PCT           
! JB.GVT_RETRO_FLAG         
! JB.GVT_RETRO_DED_FLAG     
! JB.GVT_RETRO_JOB_FLAG     
! JB.GVT_RETRO_BSE_FLAG     
! JB.GVT_OTH_PAY_CHG        
! JB.GVT_DETL_POSN_NBR      
! JB.ANNL_BEN_BASE_OVRD     
! JB.BENEFIT_PROGRAM        
! JB.UPDATE_PAYROLL         
! JB.GVT_PAY_PLAN           
! JB.GVT_PAY_FLAG           
! JB.GVT_NID_CHANGE 
! end upgrade 9.0 deleted fields commented
JB.UNION_FULL_PART        
JB.UNION_POS              
JB.MATRICULA_NBR          
JB.SOC_SEC_RISK_CODE      
JB.UNION_FEE_AMOUNT       
JB.UNION_FEE_START_DT     
JB.UNION_FEE_END_DT       
JB.EXEMPT_JOB_LBR         
JB.EXEMPT_HOURS_MONTH     
JB.WRKS_CNCL_FUNCTION     
JB.INTERCTR_WRKS_CNCL     
JB.CURRENCY_CD1           
JB.PAY_UNION_FEE          
JB.UNION_CD               
JB.BARG_UNIT              
JB.UNION_SENIORITY_DT     
JB.ENTRY_DATE             
JB.LABOR_AGREEMENT        
JB.EMPL_CTG               
JB.EMPL_CTG_L1            
JB.EMPL_CTG_L2            
JB.SETID_LBR_AGRMNT       
JB.GP_PAYGROUP            
JB.GP_DFLT_ELIG_GRP       
JB.GP_ELIG_GRP            
JB.GP_DFLT_CURRTTYP       
JB.CUR_RT_TYPE            
JB.GP_DFLT_EXRTDT         
JB.GP_ASOF_DT_EXG_RT      
JB.ADDS_TO_FTE_ACTUAL     
JB.CLASS_INDC             
JB.ENCUMB_OVERRIDE        
JB.FICA_STATUS_EE         
JB.FTE                    
JB.PRORATE_CNT_AMT        
JB.PAY_SYSTEM_FLG         
JB.BORDER_WALKER          
JB.LUMP_SUM_PAY           
JB.CONTRACT_NUM           
JB.JOB_INDICATOR          
JB.WRKS_CNCL_ROLE_CHE     
! JB.WRKS_CNCL_ID_LCL        	     ! upgrade 9.0 deleted field
JB.BENEFIT_SYSTEM         
JB.WORK_DAY_HOURS         
JB.SUPERVISOR_ID          
JB.REPORTS_TO             
JB.FORCE_PUBLISH          
JB.JOB_DATA_SRC_CD                                    !PSR 09/20/2002 end
JB.ESTABID
JB.LAST_dATE_WORKED
JB.GEX_LIGHT_DUTY
JB.GEX_CHANGE_RECORD
JB.GEX_VOLUN_LOW_HRS
JB.GEX_STUDENT_IND
JB.GEX_MOON_IND
JB.GEX_DEPTID_OVR
JB.GEX_ACCT_CD_OVR
JB.GEX_GL_EXP_OVR
JB.GEX_STEWARD
JB.GEX_DUES_EXEMPT
JB.GEX_FINAN_CORE
JB.GEX_INFLATED_HRS
JB.GEX_FP_CODE
JB.GEX_SEASONAL_EMP	!AXL 5/14/2001 New job field
! START 9.0 NEWLY ADDED FIELDS
JB.PER_ORG              ! upgrade 9.0 changes
JB.HR_STATUS            ! upgrade 9.0 changes
JB.WPP_STOP_FLAG        ! upgrade 9.0 changes
JB.LABOR_FACILITY_ID    ! upgrade 9.0 changes
JB.LBR_FAC_ENTRY_DT     ! upgrade 9.0 changes
JB.LAYOFF_EXEMPT_FLAG   ! upgrade 9.0 changes
JB.LAYOFF_EXEMPT_RSN    ! upgrade 9.0 changes
JB.SUPV_LVL_ID          ! upgrade 9.0 changes
JB.SETID_SUPV_LVL       ! upgrade 9.0 changes
JB.ABSENCE_SYSTEM_CD	! upgrade 9.0 changes
JB.POI_TYPE		! upgrade 9.0 changes
JB.HIRE_DT		! upgrade 9.0 changes
JB.LAST_HIRE_DT		! upgrade 9.0 changes
JB.TERMINATION_DT	! upgrade 9.0 changes
JB.ASGN_START_DT	! upgrade 9.0 changes
JB.LST_ASGN_START_DT	! upgrade 9.0 changes
JB.ASGN_END_DT		! upgrade 9.0 changes
JB.LDW_OVR		! upgrade 9.0 changes
JB.EXPECTED_RETURN_DT	! upgrade 9.0 changes
JB.EXPECTED_END_DATE	! upgrade 9.0 changes
JB.AUTO_END_FLG		! upgrade 9.0 changes
JB.LASTUPDDTTM		! upgrade 9.0 changes
JB.LASTUPDOPRID		! upgrade 9.0 changes
JB.APPT_TYPE		! upgrade 9.0 changes
JB.MAIN_APPT_NUM_JPN	! upgrade 9.0 changes
! END 9.0 NEWLY ADDED FIELDS
EM.HIRE_DT               &em.hire_dt
EM.SERVICE_DT            &em.service_dt
!SXK 11/03/99 Begin
!EM.UNION_CD           
!JL.UNION_CD  V8.3 Upgrade
!SXK 11/03/99 End
PD.NAME
JC.DESCR
AC.DESCR
!SXK 11/09/1999 Begin
EM.BENEFIT_RCD_NBR
!SXK 11/09/1999 End
   add 1 to #inputtran

   !SXK 07/28/98 Begin
   use-report report-log
   !SXK 07/28/98 End

   move 'Y' to $rec-exists
   move &PD.NAME       to $name            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX 
   move &JB.EMPLID     to $emplid
   move &JB.JOBCODE    to $jobcode
   move &JB.EMPL_RCD  to #empl_rcd
   move &JB.STD_HOURS  to #std_hours
   move &JB.EMPL_STATUS to $empl_status
   move &JB.SAL_ADMIN_PLAN to $sal_admin_plan
   move &JB.GRADE      to $grade
   move &JB.STEP       to #step
   move &JB.COMP_FREQUENCY to $comp_frequency
   move &JB.COMPRATE   to #old_comprate    
   move &JB.CHANGE_AMT to #change_amt      
   move &JB.CHANGE_PCT to #change_pct      
   move &JB.ANNUAL_RT  to #annual_rt       
   move &JB.MONTHLY_RT to #monthly_rt      
   move &JB.HOURLY_RT  to #job_hourly_rt   
   move &JB.CURRENCY_CD to $currency_cd
! CWB 05/20/2002 BEGIN
!   move &JL.UNION_CD    to $jl.union_cd    !SXK 11/03/99 
   move &JB.UNION_CD    to $union_cd     
! CWB 05/20/2002 END
   move &JB.DEPTID      to $deptid         XXXXX
   move &JB.ACCT_CD     to $acct_cd        XXXXX
 ! move &JC.DESCR       to $descr_job          XXXXXXXXXXXXXXXXXXX  
   move &AC.DESCR       to $descr          XXXXXXXXXXXXXXXXXXX
   move &EM.SERVICE_DT  to $service_dt  
  
!GXD 05/05/1999 Begin

    move &JB.position_nbr to $position_nbr
   
   
! ISDVDZK Added the Code as per the ITG 56878 on 23/03/2009 for pulling description from Position data  Start
  Let $position_nbr= LTrim(RTrim($position_nbr,' '),' ')
  
   Do Get-Position-Title				
   !show 'position_nbr' $position_nbr 'PosName' $PosName
 
 If $PosName = ' '			
   move &JC.DESCR    to $descr_job    XXXXXXXXXXXXXXXXXXX  
 Else
   move $PosName   to $descr_job     XXXXXXXXXXXXXXXXXXX  
 End-If					

!ISDVDZK Added the Code as per the ITG 56878 on 23/03/2009 for pulling description from Position data End   
   
   move &JB.position_override to $position_override
   move &JB.posn_change_record to $posn_change_record
   move &JB.ACTION to $action
   move &JB.action_dt to $action_dt
   move &JB.ACTION_REASON to $action_reason
   move &JB.location to $location
   move &JB.tax_location_cd to $tax_location_cd
   move &JB.job_entry_dt to $job_entry_dt
   move &JB.dept_entry_dt to $dept_entry_dt
   move &JB.position_entry_dt to $position_entry_dt
   move &JB.shift to $shift
   move &JB.reg_temp to $reg_temp
   move &JB.full_part_time to $full_part_time
   move &JB.company to $company
   move &JB.paygroup to $paygroup
   move &JB.bas_group_id to $bas_group_id
   move &JB.elig_config1 to $elig_config1
   move &JB.elig_config2 to $elig_config2
   move &JB.elig_config3 to $elig_config3
   move &JB.elig_config4 to $elig_config4
   move &JB.elig_config5 to $elig_config5
   move &JB.elig_config6 to $elig_config6
   move &JB.elig_config7 to $elig_config7
   move &JB.elig_config8 to $elig_config8
   move &JB.elig_config9 to $elig_config9
   move &JB.ben_status to $ben_status
   move &JB.cobra_action to $cobra_action
   move &JB.empl_type to $empl_type
   move &JB.holiday_schedule to $holiday_schedule
   move &JB.eeo_class to $eeo_class
   move &JB.empl_class to $empl_class
   move &JB.grade_entry_dt to $grade_entry_dt
   move &JB.step_entry_dt to $step_entry_dt
   move &JB.gl_pay_type to $gl_pay_type
   move &JB.acct_cd to $acct_cd
   move &JB.earns_dist_type to $earns_dist_type
   ! move &JB.salary_matrix_cd to $salary_matrix_cd	  ! upgrade 9.0 deleted field
   ! move &JB.rating_scale to $rating_scale		  ! upgrade 9.0 deleted field
   ! move &JB.review_rating to $review_rating		  ! upgrade 9.0 deleted field
   ! move &JB.review_dt to $review_dt			  ! upgrade 9.0 deleted field
   move &JB.annl_benef_base_rt to $annl_benef_base_rt
   move &JB.shift_rt to $shift_rt
   move &JB.shift_factor to $shift_factor
   move &JB.FLSA_status to $flsa_status
   move &JB.officer_cd to $officer_cd
   move &JB.function_cd to $function_cd
   move &JB.hourly_rt_fra to $hourly_rt_fra
   move &JB.accdnt_cd_fra to $acctdnt_cd_fra
   move &JB.estabid to $estabid
   move &JB.last_date_worked to $last_date_worked
   move &JB.gex_light_duty to $gex_light_duty
   move &JB.gex_change_record to $gex_change_record
   move &JB.gex_volun_low_hrs to $gex_volun_low_hrs
   move &JB.gex_student_ind to $gex_student_ind
   move &JB.gex_moon_ind to $gex_moon_ind
   move &JB.gex_deptid_ovr to $gex_deptid_ovr
   move &JB.gex_acct_cd_ovr to $gex_acct_cd_ovr
   move &JB.gex_gl_exp_ovr to $gex_gl_exp_ovr
   move &JB.gex_steward to $gex_steward
   move &JB.gex_dues_exempt to $gex_dues_exempt
   move &JB.gex_finan_core to $gex_finan_core
   move &JB.gex_inflated_hrs to $gex_inflated_hrs
   move &JB.gex_fp_code to $gex_fp_code
   move &JB.GEX_SEASONAL_EMP to $GEX_SEASONAL_EMP	!AXL 5/14/2001 New job field
   
   ! START 9.0 NEWLY ADDED FIELDS
   move &JB.PER_ORG              to $per_org                    ! upgrade 9.0 changes
   move &JB.HR_STATUS            to $hr_status	                ! upgrade 9.0 changes
   move &JB.WPP_STOP_FLAG        to $wpp_stop_flag              ! upgrade 9.0 changes
   move &JB.LABOR_FACILITY_ID    to $labor_facility_id          ! upgrade 9.0 changes
   move &JB.LBR_FAC_ENTRY_DT     to $lbr_fac_entry_dt           ! upgrade 9.0 changes
   move &JB.LAYOFF_EXEMPT_FLAG   to $layoff_exempt_flag 	! upgrade 9.0 changes
   move &JB.LAYOFF_EXEMPT_RSN    to $layoff_exempt_rsn		! upgrade 9.0 changes
   move &JB.SUPV_LVL_ID          to $supv_lvl_id		! upgrade 9.0 changes
   move &JB.SETID_SUPV_LVL       to $setid_supv_lvl		! upgrade 9.0 changes
   move &JB.ABSENCE_SYSTEM_CD	 to $absence_system_cd          ! upgrade 9.0 changes
   move &JB.POI_TYPE		 to $poi_type                   ! upgrade 9.0 changes
   move &JB.HIRE_DT		 to $job_hire_dt                ! upgrade 9.0 changes
   move &JB.LAST_HIRE_DT	 to $job_last_hire_dt 	        ! upgrade 9.0 changes
   move &JB.TERMINATION_DT	 to $job_term_dt                ! upgrade 9.0 changes
   move &JB.ASGN_START_DT	 to $job_asgn_st_dt             ! upgrade 9.0 changes
   move &JB.LST_ASGN_START_DT	 to $job_lst_asgn_start_dt      ! upgrade 9.0 changes
   move &JB.ASGN_END_DT		 to $job_asgn_end_dt            ! upgrade 9.0 changes
   move &JB.LDW_OVR		 to $job_ldw_ovr                ! upgrade 9.0 changes
   move &JB.EXPECTED_RETURN_DT	 to $job_exp_return_dt          ! upgrade 9.0 changes
   move &JB.EXPECTED_END_DATE	 to $job_exp_end_dt             ! upgrade 9.0 changes
   move &JB.AUTO_END_FLG	 to $auto_end_flg         	! upgrade 9.0 changes
   move $AsOfDate		 to $job_current_dt             ! upgrade 9.0 changes
   move $Prcs_OprID              to $job_prcs_oprid             ! upgrade 9.0 changes
   move &JB.APPT_TYPE		 to $appt_type                  ! upgrade 9.0 changes
   move &JB.MAIN_APPT_NUM_JPN	 to $main_appt_num_jpn          ! upgrade 9.0 changes
   ! END 9.0 NEWLY ADDED FIELDS
  

!GXD 05/05/1999 End
   do Check-Rate-Type
   do Check-Process-Option

FROM PS_JOB JB, PS_EMPLOYMENT EM, PS_PERSONAL_DATA PD, PS_GEX_DEPT_TBL GD,
     PS_JOBCODE_TBL JC,
 !GEX-RBC Modified for Upgrade 9.0 on 09/26/2007 - Begin
     !PS_ACCT_CD_TBL AC
     PS_GEX_ACCT_CD_TBL AC
 !GEX-RBC Modified for Upgrade 9.0 on 09/26/2007 - END
     !PS_JOB_LABOR jl !SXK 11/03/99 Added job_labor !Commented out V8.3 Upgrade 10/03/02

WHERE JB.EMPLID = EM.EMPLID
AND   EM.EMPLID = PD.EMPLID
AND   JB.EMPL_RCD = EM.EMPL_RCD
! CWB 05/20/2002 BEGIN
AND   [$GEXXX965_DEPTID_CRITERIA]
! CWB 05/20/2002 END
AND   JB.DEPTID = GD.DEPTID
AND   JB.EMPL_STATUS IN ('A','L','P','S')
! CWB 05/20/2002 BEGIN
AND   [$GEXXX966_JOBCODE_CRITERIA] 
! CWB 05/20/2002 END
AND   JB.JOBCODE = JC.JOBCODE
AND   JB.ACCT_CD = AC.ACCT_CD
!SXK 10/28/1999 begin
! CWB 05/20/2002 BEGIN
AND   [$GEXXX967_UNION_CD_CRITERIA]
! CWB 05/20/2002 END
!PSR V8.3 Upgrade 10/03/2002 Begin
!AND    JL.EMPLID    = JB.EMPLID
!AND    JL.EMPL_RCD = JB.EMPL_RCD

!AND    JL.EFFDT                =
!      (SELECT MAX(EFFDT)
!       FROM   PS_JOB_LABOR
!       WHERE  EMPLID          = JL.EMPLID
!       AND    EMPL_RCD       = JL.EMPL_RCD
!       AND    EFFDT          <= &pi.pay_begin_dt)

!AND    Jl.EFFSEQ               =
!      (SELECT MAX(EFFSEQ)
!       FROM   PS_JOB_LABOR
!       WHERE  EMPLID          = JL.EMPLID
!       AND    EMPL_RCD       = JL.EMPL_RCD
!       AND    EFFDT           = JL.EFFDT)
!SXK 10/28/1999 end
!PSR V8.3 Upgrade 10/03/2002 End

[$where-clause]

! CWB 05/20/2002 BEGIN
AND [$GEXXX964_INCLUDE_COMPANY_PAYGROUP_CRITERIA]
AND [$GEXXX968_SAL_ADMIN_PLAN_CRITERIA]
AND [$GEXXX969_HRLY_CHG_CRITERIA]
! CWB 05/20/2002 END

AND   GD.EFFDT = (SELECT MAX(GD2.EFFDT)
		  FROM PS_GEX_DEPT_TBL GD2
		  WHERE GD2.DEPTID = GD.DEPTID
		  AND   GD2.EFFDT <= &pi.pay_begin_dt)  !used to be $asoftoday

AND   JB.EFFDT = (SELECT MAX(JB2.EFFDT)
		  FROM PS_JOB JB2
		  WHERE JB2.EMPLID = JB.EMPLID
		  AND   JB2.EMPL_RCD = JB.EMPL_RCD
		  AND   JB2.EFFDT <= &pi.pay_begin_dt) !used to be $asoftoday
AND   JB.EFFSEQ = (SELECT MAX(JB3.EFFSEQ)
		    FROM PS_JOB JB3
		    WHERE JB3.EMPLID = JB.EMPLID
		    AND   JB3.EMPL_RCD = JB.EMPL_RCD
		    AND   JB3.EFFDT = JB.EFFDT)
AND   JC.EFFDT = (SELECT MAX(JC2.EFFDT)
		  FROM PS_JOBCODE_TBL JC2
		  WHERE JC2.JOBCODE = JB.JOBCODE
		  AND   JC2.EFFDT <= &pi.pay_begin_dt) !used to be $asoftoday
!GEX-RBC Modified for Upgrade 9.0 on 09/26/2007 - Begin	
 AND   AC.EFFDT = (SELECT MAX(AC2.EFFDT)              !upgrade 9.0 changes                         
		  FROM PS_GEX_ACCT_CD_TBL AC2              !upgrade 9.0 changes
		  WHERE AC2.ACCT_CD = JB.ACCT_CD       !upgrade 9.0 changes
		  AND   AC2.EFFDT <= &pi.pay_begin_dt) !upgrade 9.0 changes
!GEX-RBC Modified for Upgrade 9.0 on 09/26/2007 - END
!SXK 07/01/1999 Begin
And  EXISTS (SELECT 'X' FROM PS_JOB JB1
		WHERE JB1.EMPLID = JB.EMPLID
		AND JB1.EMPL_RCD = JB.EMPL_RCD
		AND JB1.EMPL_STATUS IN ('A','L','P','S')
  		AND JB1.EFFDT = (SELECT MAX(EFFDT)
				FROM PS_JOB
				WHERE EMPLID = JB1.EMPLID
				AND EMPL_RCD = JB1.EMPL_RCD
				AND EFFDT <= $AsofToday)
		AND JB1.EFFSEQ = (Select max(Effseq)
				from ps_job
				where emplid = jb1.emplid
				and empl_rcd = jb1.empl_rcd
				and effdt = jb1.effdt))
!SXK 07/01/1999 End
!SXK 11/03/99 Changed from em.union_cd
!AXL 10/20/2000 Changed sort to alpha only - Begin
!ORDER BY JB.DEPTID, JL.UNION_CD, JB.JOBCODE,
!	 EM.SERVICE_DT, JB.HOURLY_RT
!ORDER by PD.NAME
!AXL 10/20/2000 Changed sort to alpha only - End
! CWB 05/20/2002 BEGIN - Get sort order from panel.
[$SORT_ORDER_CRITERIA]
! CWB 05/20/2002 END 

end-select

if $rec-exists = 'N'
   print 'No matching record on PS_JOB and/or PS_EMPLOYMENT.'  (+1,59)
else

move #preview-count to $preview-count BB,BB9

print ' '                       (+2,1)
print 'Total Employees: '       (0,59)
print $preview-count            (0,81)

print 'NOTE: Remember to process all open Job rows through Ben Admin that exist prior to the Job row insert.' (+3,1)

end-if

end-procedure
!PSR 10/03/2002 End
!*********************************************************************
begin-procedure process-n-insert-jobjr
#debug9 show 'process-n-insert-jobjr'

begin-select on-error=sql-error-found('process-n-insert-jobjr')
I2.EMPLID 
I2.EMPL_RCD 
I2.EFFDT 
I2.EFFSEQ 
I2.LASTUPDDTTM 
I2.LASTUPDOPRID 
I2.TAXCODE_UK 
I2.TAX_BASIS_UK 
I2.WORKER_TYPE_MEX 
I2.REDUCED_WEEK_MEX 
I2.LOCATED_CD_MEX 
I2.SALARY_TYPE_MEX 
I2.IMS_TERM_DT_MEX 
I2.BALANCE_GRP_NUM 
I2.FP_ACTION_2 
I2.CTG_RATE 
I2.FP_LEGALSTAT_CD 
I2.FP_SCNDMT_CD 
I2.FP_SCND_TYP 
I2.FP_CIVIL_PENSION 
I2.FP_SOURCE_ORG 
I2.FP_RECEP_ORG 
I2.FP_RETURN_CD 
I2.FP_PR_LEGSTA 
I2.FP_FOREND_DT 
I2.FP_END_DT 
I2.FP_CAREFRZPCT 
I2.FP_HIR_DOS_SIT 
I2.FP_PT_PCT_DET 
I2.FP_TITLE_NUM 
I2.FP_DURATION_PCT 
I2.FP_RATING_PRS_FLG 
I2.FP_BUDGET_NBR 
I2.FP_HDCNT_NBR 
I2.FP_POTENT_NBR 
I2.FP_RANK_CD 
I2.FP_STEP_CD 
I2.FP_RK_ENT_DT 
I2.FP_CORPS_CD 
I2.FP_CHG_COR_DT 
I2.FP_CATG_FP 
I2.FP_CATG_LEVEL 
I2.FP_RK_TRIALPD 
I2.FP_STEP_END_DT 
I2.FP_FOR_PROM_DT 
I2.FP_NOMINATION_DT 
I2.FP_TRAINEE 
I2.FP_TRNE_POSN 
I2.FP_RK_PD_END_DT 
I2.FP_SANCTION 
I2.FP_DOWN_GRA 
I2.FP_APPL_SAL_DT 
I2.FP_CHG_IND 
I2.FP_CLD_INST 
I2.FP_SETID_RANK 
I2.FP_INSTALL_DT 
I2.FP_EQUIV_STEP 
I2.FP_STEP_CD2 
I2.FP_BUSINESS_CD 
I2.FP_APPL_DT 
I2.FP_CHG_SAL 
I2.FP_POINTYP_CD 
I2.FP_GROSS_IND 
I2.FP_INCS_IND 
I2.FP_INCS_IND2 
I2.FP_PT_PCT 
I2.FP_PT_END_DT 
I2.FP_PT_FOREND_DT 
I2.FP_COMPRATE 
I2.FP_INST_STAT 
I2.FP_RETROSPECT 
I2.FP_ROW_END_DT 
I2.LAST_UPDATE_DATE 
I2.OTHER_ID_JPN 
I2.INTCP_XFR_FLG 
I2.INTCP_XFR_START_DT 
I2.INTCP_XFR_END_DT 
I2.INTCP_BUS_UNIT 
I2.INTCP_DEPTID 
I2.INTCP_DEPTID2 
I2.INTCP_SETID_DEPT 
I2.INTCP_COMPANY 
I2.INTCP_COMPANY2 
I2.INTCP_SUPV_LVL_ID 
I2.INTCP_SUPV_LVL_ID2 
I2.START_DATE_JPN 
I2.EXP_END_DATE_JPN 
I2.END_DATE_JPN 
I2.DUTIES_TYPE 
I2.ASSIGNMENT_ID 
I2.TARGET_COMPRATE 
I2.CMP_DONT_ABSORB 
I2.SSN_EMPLOYER 
I2.UNITA_PROD_CD 
I2.ACTION_ITA 
I2.ACTION_REASON_ITA 
I2.SPECIAL_HIRCTG_ITA 
I2.PART_TIME_TYPE_ITA 
I2.PART_TIME_PERC_ITA 
I2.PARTTIME_ENDDT_ITA 
I2.WORKDAYS_NLD 
I2.CONT_SAL_TYPE_BRA 
I2.CBO_CD_BRA 
I2.SEFIP_CATEGORY_BRA 
I2.UNION_CD_ALT_BRA

    DO insert-jobjr

FROM PS_JOB_JR I2

WHERE I2.EMPLID   =  &JB.EMPLID
  AND I2.EMPL_RCD =  &JB.EMPL_RCD
  AND I2.EFFDT    =  &JB.EFFDT
  AND I2.EFFSEQ   =  &JB.EFFSEQ
end-select

end-procedure
!*********************************************************************
begin-procedure insert-jobjr
#debug9 show 'insert-jobjr'

display 'insert-job-jr-row'
begin-sql on-error=sql-error-found('insert-jobjr')

insert into PS_JOB_JR
(
 EMPLID,
 EMPL_RCD,
 EFFDT,
 EFFSEQ,
 LASTUPDDTTM,
 LASTUPDOPRID,
 TAXCODE_UK,
 TAX_BASIS_UK,
 WORKER_TYPE_MEX,
 REDUCED_WEEK_MEX,
 LOCATED_CD_MEX,
 SALARY_TYPE_MEX,
 IMS_TERM_DT_MEX,
 BALANCE_GRP_NUM,
 FP_ACTION_2,
 CTG_RATE,
 FP_LEGALSTAT_CD,
 FP_SCNDMT_CD,
 FP_SCND_TYP,
 FP_CIVIL_PENSION,
 FP_SOURCE_ORG,
 FP_RECEP_ORG,
 FP_RETURN_CD,
 FP_PR_LEGSTA,
 FP_FOREND_DT,
 FP_END_DT,
 FP_CAREFRZPCT,
 FP_HIR_DOS_SIT,
 FP_PT_PCT_DET,
 FP_TITLE_NUM,
 FP_DURATION_PCT,
 FP_RATING_PRS_FLG,
 FP_BUDGET_NBR,
 FP_HDCNT_NBR,
 FP_POTENT_NBR,
 FP_RANK_CD,
 FP_STEP_CD,
 FP_RK_ENT_DT,
 FP_CORPS_CD,
 FP_CHG_COR_DT,
 FP_CATG_FP,
 FP_CATG_LEVEL,
 FP_RK_TRIALPD,
 FP_STEP_END_DT,
 FP_FOR_PROM_DT,
 FP_NOMINATION_DT,
 FP_TRAINEE,
 FP_TRNE_POSN,
 FP_RK_PD_END_DT,
 FP_SANCTION,
 FP_DOWN_GRA,
 FP_APPL_SAL_DT,
 FP_CHG_IND,
 FP_CLD_INST,
 FP_SETID_RANK,
 FP_INSTALL_DT,
 FP_EQUIV_STEP,
 FP_STEP_CD2,
 FP_BUSINESS_CD,
 FP_APPL_DT,
 FP_CHG_SAL,
 FP_POINTYP_CD,
 FP_GROSS_IND,
 FP_INCS_IND,
 FP_INCS_IND2,
 FP_PT_PCT,
 FP_PT_END_DT,
 FP_PT_FOREND_DT,
 FP_COMPRATE,
 FP_INST_STAT,
 FP_RETROSPECT,
 FP_ROW_END_DT,
 LAST_UPDATE_DATE,
 OTHER_ID_JPN,
 INTCP_XFR_FLG,
 INTCP_XFR_START_DT,
 INTCP_XFR_END_DT,
 INTCP_BUS_UNIT,
 INTCP_DEPTID,
 INTCP_DEPTID2,
 INTCP_SETID_DEPT,
 INTCP_COMPANY,
 INTCP_COMPANY2,
 INTCP_SUPV_LVL_ID,
 INTCP_SUPV_LVL_ID2,
 START_DATE_JPN,
 EXP_END_DATE_JPN,
 END_DATE_JPN,
 DUTIES_TYPE,
 ASSIGNMENT_ID,
 TARGET_COMPRATE,
 CMP_DONT_ABSORB,
 SSN_EMPLOYER,
 UNITA_PROD_CD,
 ACTION_ITA,
 ACTION_REASON_ITA,
 SPECIAL_HIRCTG_ITA,
 PART_TIME_TYPE_ITA,
 PART_TIME_PERC_ITA,
 PARTTIME_ENDDT_ITA,
 WORKDAYS_NLD,
 CONT_SAL_TYPE_BRA,
 CBO_CD_BRA,
 SEFIP_CATEGORY_BRA,
 UNION_CD_ALT_BRA
 )
VALUES
(&JB.EMPLID,
&JB.EMPL_RCD,
&PI.PAY_BEGIN_DT,  
#effseq,
&I2.LASTUPDDTTM,
&I2.LASTUPDOPRID,
&I2.TAXCODE_UK,
&I2.TAX_BASIS_UK,
&I2.WORKER_TYPE_MEX,
&I2.REDUCED_WEEK_MEX,
&I2.LOCATED_CD_MEX,
&I2.SALARY_TYPE_MEX,
&I2.IMS_TERM_DT_MEX,
&I2.BALANCE_GRP_NUM,
&I2.FP_ACTION_2,
&I2.CTG_RATE,
&I2.FP_LEGALSTAT_CD,
&I2.FP_SCNDMT_CD,
&I2.FP_SCND_TYP,
&I2.FP_CIVIL_PENSION,
&I2.FP_SOURCE_ORG,
&I2.FP_RECEP_ORG,
&I2.FP_RETURN_CD,
&I2.FP_PR_LEGSTA,
&I2.FP_FOREND_DT,
&I2.FP_END_DT,
&I2.FP_CAREFRZPCT,
&I2.FP_HIR_DOS_SIT,
&I2.FP_PT_PCT_DET,
&I2.FP_TITLE_NUM,
&I2.FP_DURATION_PCT,
&I2.FP_RATING_PRS_FLG,
&I2.FP_BUDGET_NBR,
&I2.FP_HDCNT_NBR,
&I2.FP_POTENT_NBR,
&I2.FP_RANK_CD,
&I2.FP_STEP_CD,
&I2.FP_RK_ENT_DT,
&I2.FP_CORPS_CD,
&I2.FP_CHG_COR_DT,
&I2.FP_CATG_FP,
&I2.FP_CATG_LEVEL,
&I2.FP_RK_TRIALPD,
&I2.FP_STEP_END_DT,
&I2.FP_FOR_PROM_DT,
&I2.FP_NOMINATION_DT,
&I2.FP_TRAINEE,
&I2.FP_TRNE_POSN,
&I2.FP_RK_PD_END_DT,
&I2.FP_SANCTION,
&I2.FP_DOWN_GRA,
&I2.FP_APPL_SAL_DT,
&I2.FP_CHG_IND,
&I2.FP_CLD_INST,
&I2.FP_SETID_RANK,
&I2.FP_INSTALL_DT,
&I2.FP_EQUIV_STEP,
&I2.FP_STEP_CD2,
&I2.FP_BUSINESS_CD,
&I2.FP_APPL_DT,
&I2.FP_CHG_SAL,
&I2.FP_POINTYP_CD,
&I2.FP_GROSS_IND,
&I2.FP_INCS_IND,
&I2.FP_INCS_IND2,
&I2.FP_PT_PCT,
&I2.FP_PT_END_DT,
&I2.FP_PT_FOREND_DT,
&I2.FP_COMPRATE,
&I2.FP_INST_STAT,
&I2.FP_RETROSPECT,
&I2.FP_ROW_END_DT,
&I2.LAST_UPDATE_DATE,
&I2.OTHER_ID_JPN,
&I2.INTCP_XFR_FLG,
&I2.INTCP_XFR_START_DT,
&I2.INTCP_XFR_END_DT,
&I2.INTCP_BUS_UNIT,
&I2.INTCP_DEPTID,
&I2.INTCP_DEPTID2,
&I2.INTCP_SETID_DEPT,
&I2.INTCP_COMPANY,
&I2.INTCP_COMPANY2,
&I2.INTCP_SUPV_LVL_ID,
&I2.INTCP_SUPV_LVL_ID2,
&I2.START_DATE_JPN,
&I2.EXP_END_DATE_JPN,
&I2.END_DATE_JPN,
&I2.DUTIES_TYPE,
&I2.ASSIGNMENT_ID,
&I2.TARGET_COMPRATE,
&I2.CMP_DONT_ABSORB,
&I2.SSN_EMPLOYER,
&I2.UNITA_PROD_CD,
&I2.ACTION_ITA,
&I2.ACTION_REASON_ITA,
&I2.SPECIAL_HIRCTG_ITA,
&I2.PART_TIME_TYPE_ITA,
&I2.PART_TIME_PERC_ITA,
&I2.PARTTIME_ENDDT_ITA,
&I2.WORKDAYS_NLD,
&I2.CONT_SAL_TYPE_BRA,
&I2.CBO_CD_BRA,
&I2.SEFIP_CATEGORY_BRA,
&I2.UNION_CD_ALT_BRA
)
end-sql

end-procedure
!PSR 10/03/2002 End
!********************************************************************
! Get Run Control Variables
!********************************************************************
begin-procedure Check-for-Runcntl
begin-select
rc.gex_seq
rc.descr

   move &rc.descr to $seq_descr
   move 'Y' to $check-runcntl

from ps_gex_rc_pay rc
where oprid = $oprid
and   run_cntl_id = $run_cntl
and   gex_seq = $gex_seq

end-select
end-procedure

!********************************************************************
! Check PS_GEX_PAY_INC_TBL values - Selection Criteria
!********************************************************************
begin-procedure Check-Data

!let $where-clause = 'AND '

if RTRIM(&PI.GEX_COMPANY_DIV_CD,' ') <> ''
   move &PI.GEX_COMPANY_DIV_CD to $gex_company_div_cd
   let $where-clause = $where-clause||' AND ' ||'GD.GEX_COMPANY_DIV_CD = '||''''||$gex_company_div_cd||''''
end-if

!display $where-clause

if RTRIM(&PI.FULL_PART_TIME,' ') <> ''
   move &PI.FULL_PART_TIME to $full_part
   let $where-clause = $where-clause||' AND '||'JB.FULL_PART_TIME = '||''''||$full_part||''''
end-if
if RTRIM(&PI.GEX_S_ACTION,' ') <> ''
   move &PI.GEX_S_ACTION to $gex_s_action
   let $where-clause = $where-clause||' AND '||'JB.ACTION = '||''''||$gex_s_action||''''
end-if
if RTRIM(&PI.GEX_S_ACT_REAS,' ') <> ''
   move &PI.GEX_S_ACT_REAS to $gex_s_act_reas
   let $where-clause = $where-clause||' AND '||'JB.ACTION_REASON = '||''''||$gex_s_act_reas||''''
end-if
if RTRIM(&PI.EMPL_CLASS,' ') <> ''
   move &PI.EMPL_CLASS to $empl_class
   let $where-clause = $where-clause||' AND '||'JB.EMPL_CLASS = '||''''||$empl_class||''''
end-if
if RTRIM(&PI.GEX_COMP_FREQUENCY,' ') <> ''
   if RTRIM(&PI.GEX_COMP_FREQUENCY,' ') <> 'Z'
     move &PI.GEX_COMP_FREQUENCY to $gex_comp_frequency
     let $where-clause =
     $where-clause||' AND '||'JB.COMP_FREQUENCY = '||''''||$gex_comp_frequency||''''
   end-if
end-if

!MDJ 05/22/98 START
!Build where clause for the Minimum Wage Increases to select all employees with an
!hourly rate less than the new Minimum Wage amount
 
 if &pi.gex_rate_type = 'M' and
    &pi.action_reason = 'MWI'
    let $where-clause = $where-clause||' AND '||'JB.HOURLY_RT < '|| $rate_amount   
 end-if 

!MDJ 05/22/98 END

end-procedure

!********************************************************************
! Setup Comparison strings for Where clause
!********************************************************************
begin-procedure Prepare-comp-strings

let $oper_comp1 = ''

if RTRIM(&PI.GEX_OPERATOR1,' ') <> ''
   if RTRIM(&PI.GEX_OPERATOR2,' ') <> ''
      let $oper_comp1 = 'AND ( EM.HIRE_DT'||' '||&PI.GEX_OPERATOR1||' '||''''||&pi.gex_hire_from||''''||') AND ( EM.HIRE_DT'||' '||&PI.GEX_OPERATOR2||' '||''''||&pi.gex_hire_to||''''||') '
   else
      let $oper_comp1 = 'AND ( EM.HIRE_DT'||' '||&PI.GEX_OPERATOR1||' '||''''||&pi.gex_hire_from||''''||') '
   end-if

   if $oper_comp1 <> ''
     let $where-clause = $where-clause||' '||$oper_comp1
   end-if

end-if

let $oper_comp2 = ''

if RTRIM(&PI.GEX_OPERATOR3,' ') <> ''
   if RTRIM(&PI.GEX_OPERATOR4,' ') <> ''
      let $oper_comp2 = 'AND ( EM.SERVICE_DT'||' '||&PI.GEX_OPERATOR3||' '||''''||&pi.gex_service_from||''''||') AND ( EM.SERVICE_DT'||' '||&PI.GEX_OPERATOR4||' '||''''||&pi.gex_service_to||''''||') '
   else
      let $oper_comp2 = 'AND ( EM.SERVICE_DT'||' '||&PI.GEX_OPERATOR3||' '||''''||&pi.gex_service_from||''''||') '
   end-if
   
   if $oper_comp2 <> ''
      let $where-clause = $where-clause||' '||$oper_comp2
   end-if

end-if

  show 'Where Clause Used: ' $where-clause
end-procedure

!********************************************************************
! Rate Type Check and new Hourly Rate Calculation
!********************************************************************
begin-procedure Check-Rate-Type

move 0 to #to_rate

evaluate &PI.GEX_RATE_TYPE
   when = 'F'
      !Flat Rate Increase
!MDJ 05/22/98 START
      if &pi.action_reason = 'CON'
	 let #to_rate = #job_hourly_rt - #rate_amount
	 let #change_amt = #rate_amount - #job_hourly_rt
      else      
	 let #to_rate = #job_hourly_rt + #rate_amount
	 let #change_amt = #rate_amount
      end-if
!MDJ 05/22/98 END
      break
   when = 'P'
      !Percent Increase
      if #rate_amount > 1
	 display 'Rate Amount is greater than 1 - in Percent Rate Type'
      end-if

!CJH 07/09/98 START
      if &pi.action_reason = 'CON' 
	 let #calc = 1.0 - #rate_amount
      else      
	 let #calc = 1.0 + #rate_amount
      end-if
!CJH 07/09/98 END
      let #to_rate = #job_hourly_rt * #calc
      let #change_pct = #rate_amount
      break
   when = 'C'
      !Rate Change
      let #to_rate = #rate_amount
      break
   when = 'M'
      !Minimum Wage Adjustment
      let #to_rate = #rate_amount
      break
   when-other
      !Invalid Rate Type
      print &PI.GEX_RATE_TYPE              (+1,1)
      print ' is an invalid Rate Type.'    (0,+1)
      let #to_rate = #job_hourly_rt
      break
end-evaluate
end-procedure

!********************************************************************
! Check Process Option to determine Preview or Update Execution
!********************************************************************
begin-procedure Check-Process-Option

if &pi.gex_process_optn = 'P'
   do Print-Preview
   do Update-Gex-Pay-Inc-Tbl
else
   if &pi.gex_process_optn = 'E'

!** Update Rate Information **

      let #annual_rt = #to_rate * #std_hours * 52
      let #monthly_rt = #annual_rt / 12

      do Determine-Comp-Freq
      do Calc-Comprate
      do Calc-Comp-Change

!AXL 09/27/1999 Begin
        if $effdt < $begindt
           let #effseq = 0
        else
           let #effseq = &jb.effseq2
	end-if
!AXL 09/27/1999 End
 show ' calling job insert********************* ' 

	do insert-Job-Record
        do process-n-insert-jobjr
! 11/7/2001 - CJH - add insert to ps_compensation
        do process-compensation-rows
! 11/7/2001 - end

!SXK 11/09/1999 Begin
!GXD 05/04/1999 Begin
!	do Update-Personal-Data
!GXD 05/04/1999 End
!        let $bas_activity_exists = 'N'
!	do select-bas-activity-row
!	if $bas_activity_exists = 'N'
!	   do insert-bas-activity-row
!	end-if
!SXK 11/09/1999 End

!SXK 07/28/1998 Begin
	do check-future-rows
	if $future_rows_exist = 'Y'
	   do print-future-report
	end-if
!SXK 07/28/1998 End
	do Print-Process-Log
	do Update-Gex-Preview-Run
   end-if
end-if

end-procedure

!********************************************************************
! Print Preview List
!********************************************************************
begin-procedure Print-Preview

move #job_hourly_rt to $job_hourly_rt BBBB9.999999
move #to_rate       to $to_rate       BBBB9.999999
!CJH 07/08/98 START
move #step          to $print_step    999

print $emplid                  (+1,01)
print $name                     (0,13)
!MDJ 05/22/98 START
print $deptid                   (0,44)
! CWB 05/20/2002 BEGIN
print $acct_cd                  (0,52)
!print $descr                    (0,61)
print $full_part_time           (0,65)
!print $jobcode                 (0,83)
print $jobcode                 (0,74)
!print $descr_job               (0,91)
print $descr_job               (0,82)
!print $union_cd                (0,114)
print $union_cd                (0,105)
do Format-DateTime($service_dt, $out, {DEFDATE}, '', '') 
!print $out                     (0,122) 
print $out                     (0,113) 
print $sal_admin_plan          (0,125)
print $grade                   (0,130)  
!print $print_step              (0,134) 
print $print_step              (0,135) 
! CWB 05/20/2002 END
!MDJ 05/22/98 END           
print $job_hourly_rt           (0,139)
print $to_rate                 (0,158)
!CJH 07/08/98 END

add 1 to #preview-count

end-procedure

!********************************************************************
! Update Preview Run field
!********************************************************************
begin-procedure Update-Gex-Pay-Inc-Tbl
begin-sql

update ps_gex_pay_inc_tbl
set gex_preview_run = 'Y'
where gex_seq = &PI.GEX_SEQ
and   descr = &PI.DESCR

end-sql

begin-sql
commit
end-sql
end-procedure

!********************************************************************
! Update Gex Preview Run field
!********************************************************************
begin-procedure Update-Gex-Preview-Run
begin-sql

update ps_gex_pay_inc_tbl
set gex_preview_run = 'N',
    gex_process_optn = 'P'
where gex_seq = &PI.GEX_SEQ
and   descr = &PI.DESCR

end-sql

begin-sql
commit
end-sql
end-procedure

!********************************************************************
! Insert the new Job Record
!********************************************************************
begin-procedure Insert-Job-Record 


!SXK 11/09/1999 Begin
  if $bas_action_retrieved <> 'Y'
     do get-bas-action
  end-if
!SXK 11/09/1999 End


	
  do Check-Null($emplid)
  do Check-Null($deptid)
  do Check-Null($jobcode)
  do Check-Null($position_nbr)
  do Check-Null($posn_change_record)
  do Check-Null($empl_status)
  do Check-Null($location)
  do Check-Null($tax_location_cd)
  do Check-Null($shift) 
  do Check-Null($reg_temp) 
  do Check-Null($full_part_time) 
  do Check-Null($company) 
  do Check-Null($paygroup) 
  do Check-Null($bas_group_id) 
  do Check-Null($elig_config1) 
  do Check-Null($elig_config2) 
  do Check-Null($elig_config3) 
  do Check-Null($elig_config4) 
  do Check-Null($elig_config5) 
  do Check-Null($elig_config6) 
  do Check-Null($elig_config7) 
  do Check-Null($elig_config8) 
  do Check-Null($elig_config9) 
  do Check-Null($ben_status)
  do Check-Null($cobra_action) 
  do Check-Null($empl_type) 
  do Check-Null($holiday_schedule) 
  do Check-Null($eeo_class)
  do Check-Null($empl_class) 
  do Check-Null($sal_admin_plan) 
  do Check-Null($grade) 
  do Check-Null($gl_pay_type) 
  do Check-Null($acct_cd) 
  do Check-Null($earns_dist_type) 
  ! do Check-Null($salary_matrix_cd)     ! upgrade 9.0 deleted field
  ! do Check-Null($rating_scale)         ! upgrade 9.0 deleted field
  ! do Check-Null($review_rating)        ! upgrade 9.0 deleted field
  do Check-Null($comp_frequency)         ! upgrade 9.0 deleted field
  do Check-Null($currency_cd) 
  do Check-Null($FLSA_status) 
  do Check-Null($officer_cd) 
  do Check-Null($function_cd) 
  do Check-Null($hourly_rt_fra) 
  do Check-Null($accdnt_cd_fra) 
  do Check-Null($estabid) 
  do Check-Null($gex_light_duty) 
  do Check-Null($gex_volun_low_hrs) 
  do Check-Null($gex_student_ind) 
  do Check-Null($gex_moon_ind) 
  do Check-Null($gex_deptid_ovr) 
  do Check-Null($gex_acct_cd_ovr) 
  do Check-Null($gex_gl_exp_ovr) 
  do Check-Null($gex_steward) 
  do Check-Null($gex_dues_exempt) 
  do Check-Null($gex_finan_core) 
  do Check-Null($gex_inflated_hrs) 
  do Check-Null($gex_fp_code)
  do Check-Null($GEX_SEASONAL_EMP)	!AXL 5/14/2001 New job field
  do Check-Null($per_org)                    ! upgrade 9.0 changes
  do Check-Null($hr_status)	                ! upgrade 9.0 changes
  do Check-Null($wpp_stop_flag)              ! upgrade 9.0 changes
  do Check-Null($labor_facility_id)          ! upgrade 9.0 changes
  do Check-Null2($lbr_fac_entry_dt)           ! upgrade 9.0 changes !VENDKXY changed to check-null2
  do Check-Null($layoff_exempt_flag)     	! upgrade 9.0 changes
  do Check-Null($layoff_exempt_rsn)		! upgrade 9.0 changes
  do Check-Null($supv_lvl_id)		! upgrade 9.0 changes
  do Check-Null($setid_supv_lvl)		! upgrade 9.0 changes
  do Check-Null($absence_system_cd)          ! upgrade 9.0 changes
  do Check-Null($poi_type)                   ! upgrade 9.0 changes
  do Check-Null($job_ldw_ovr)                ! upgrade 9.0 changes
  do Check-Null($auto_end_flg)            	! upgrade 9.0 changes
  do Check-Null($appt_type)                  ! upgrade 9.0 changes
  do Check-Null($main_appt_num_jpn)          ! upgrade 9.0 changes
 
  do Check-Null2($action_dt)
  do Check-Null2($job_entry_dt)
  
  do Check-Null2($dept_entry_dt)
  
  do Check-Null2($position_entry_dt)
 
  do Check-Null2($grade_entry_dt)
 
  do Check-Null2($step_entry_dt)
 
  ! do Check-Null2($review_dt)              ! upgrade 9.0 deleted field
  do Check-Null2($job_hire_dt)                ! upgrade 9.0 changes

  do Check-Null2($job_last_hire_dt) 	        ! upgrade 9.0 changes

  do Check-Null2($job_term_dt)                ! upgrade 9.0 changes
 
  do Check-Null2($job_asgn_st_dt)             ! upgrade 9.0 changes
 
  do Check-Null2($job_lst_asgn_start_dt)      ! upgrade 9.0 changes
 
  do Check-Null2($job_asgn_end_dt)            ! upgrade 9.0 changes
 
  do Check-Null2($job_exp_return_dt)          ! upgrade 9.0 changes
 
  do Check-Null2($job_exp_end_dt)             ! upgrade 9.0 changes
 
 

 let $deptid = rtrim($deptid,' ')
  
 

begin-sql on-error=sql-error-found('Insert-Job-Record')
insert into ps_job 
(EMPLID,
EMPL_RCD,
EFFDT,
EFFSEQ,
DEPTID,
JOBCODE,
POSITION_NBR,
POSITION_OVERRIDE,
POSN_CHANGE_RECORD,
EMPL_STATUS,
ACTION,
ACTION_DT,
ACTION_REASON,
LOCATION,
TAX_LOCATION_CD,
JOB_ENTRY_DT,
DEPT_ENTRY_DT,
POSITION_ENTRY_DT,
SHIFT,
REG_TEMP,
FULL_PART_TIME,
COMPANY,
PAYGROUP,
BAS_GROUP_ID,
ELIG_CONFIG1,
ELIG_CONFIG2,
ELIG_CONFIG3,
ELIG_CONFIG4,
ELIG_CONFIG5,
ELIG_CONFIG6,
ELIG_CONFIG7,
ELIG_CONFIG8,
ELIG_CONFIG9,
BEN_STATUS,
BAS_ACTION,
COBRA_ACTION,
EMPL_TYPE,
HOLIDAY_SCHEDULE,
STD_HOURS,
OFFICER_CD,
EMPL_CLASS,
SAL_ADMIN_PLAN,
GRADE,
GRADE_ENTRY_DT,
STEP,
STEP_ENTRY_DT,
GL_PAY_TYPE,
ACCT_CD,
EARNS_DIST_TYPE,
! SALARY_MATRIX_CD,                ! upgrade 9.0 deleted field
! RATING_SCALE,                    ! upgrade 9.0 deleted field
! REVIEW_RATING,                   ! upgrade 9.0 deleted field
! REVIEW_DT,                       ! upgrade 9.0 deleted field
COMP_FREQUENCY,
COMPRATE,
CHANGE_AMT,
CHANGE_PCT,
ANNUAL_RT,
MONTHLY_RT,
HOURLY_RT,
ANNL_BENEF_BASE_RT,
SHIFT_RT,
SHIFT_FACTOR,
CURRENCY_CD,
BUSINESS_UNIT,
SETID_DEPT,
SETID_JOBCODE,
REG_REGION,
DIRECTLY_TIPPED,
FLSA_STATUS,
EEO_CLASS,
FUNCTION_CD,
HOURLY_RT_FRA,
ACCDNT_CD_FRA,
ESTABID,
LAST_DATE_WORKED,
GEX_LIGHT_DUTY,
GEX_CHANGE_RECORD,
GEX_VOLUN_LOW_HRS,
GEX_STUDENT_IND,
GEX_MOON_IND,
GEX_DEPTID_OVR,
GEX_ACCT_CD_OVR,
GEX_GL_EXP_OVR,
GEX_STEWARD,
GEX_DUES_EXEMPT,
GEX_FINAN_CORE,
GEX_INFLATED_HRS,
GEX_FP_CODE,
GEX_SEASONAL_EMP,

STD_HRS_FREQUENCY,
DAILY_RT,
SETID_LOCATION,
SETID_SALARY,
TARIFF_GER,
TARIFF_AREA_GER,
PERFORM_GROUP_GER,
LABOR_TYPE_GER,
SPK_COMM_ID_GER,
! WRKS_CNCL_MEM_GER,	          ! upgrade 9.0 deleted field
VALUE_1_FRA,
VALUE_2_FRA,
VALUE_3_FRA,
VALUE_4_FRA,
VALUE_5_FRA,
CTG_RATE,
PAID_HOURS,
PAID_FTE,
PAID_HRS_FREQUENCY,
! start upgrade 9.0 deleted fields
! GVT_EFFDT,
! GVT_EFFDT_PROPOSED,
! GVT_TRANS_NBR,
! GVT_TRANS_NBR_SEQ,
! GVT_WIP_STATUS,
! GVT_STATUS_TYPE,
! GVT_NOA_CODE,
! GVT_LEG_AUTH_1,
! GVT_PAR_AUTH_D1,
! GVT_PAR_AUTH_D1_2,
! GVT_LEG_AUTH_2,
! GVT_PAR_AUTH_D2,
! GVT_PAR_AUTH_D2_2,
! GVT_PAR_NTE_DATE,
! GVT_WORK_SCHED,
! GVT_SUB_AGENCY,
! GVT_ELIG_FEHB,
! GVT_FEHB_DT,
! GVT_PAY_RATE_DETER,
! GVT_STEP,
! GVT_RTND_PAY_PLAN,
! GVT_RTND_SAL_PLAN,
! GVT_RTND_GRADE,
! GVT_RTND_STEP,
! GVT_RTND_GVT_STEP,
! GVT_PAY_BASIS,
! GVT_COMPRATE,
! GVT_LOCALITY_ADJ,
! GVT_BIWEEKLY_RT,
! GVT_DAILY_RT,
! GVT_HRLY_RT_NO_LOC,
! GVT_DLY_RT_NO_LOC,
! GVT_BW_RT_NO_LOC,
! GVT_MNLY_RT_NO_LOC,
! GVT_ANNL_RT_NO_LOC,
! GVT_XFER_FROM_AGCY,
! GVT_XFER_TO_AGCY,
! GVT_RETIRE_PLAN,
! GVT_ANN_IND,
! GVT_FEGLI,
! GVT_FEGLI_LIVING,
! GVT_LIVING_AMT,
! GVT_ANNUITY_OFFSET,
! GVT_CSRS_FROZN_SVC,
! GVT_PREV_RET_COVRG,
! GVT_FERS_COVERAGE,
! GVT_TYPE_OF_APPT,
! GVT_POI,
! GVT_POSN_OCCUPIED,
! GVT_CONT_EMPLID,
! GVT_ROUTE_NEXT,
! GVT_CHANGE_FLAG,
! GVT_TSP_UPD_IND,
! GVT_PI_UPD_IND,
! GVT_SF52_NBR,
! GVT_S113G_CEILING,
! GVT_LEO_POSITION,
! GVT_ANNUIT_COM_DT,
! GVT_BASIC_LIFE_RED,
! GVT_DED_PRORT_DT,
! GVT_FEGLI_BASC_PCT,
! GVT_FEGLI_OPT_PCT,
! GVT_FEHB_PCT,
! GVT_RETRO_FLAG,
! GVT_RETRO_DED_FLAG,
! GVT_RETRO_JOB_FLAG,
! GVT_RETRO_BSE_FLAG,
! GVT_OTH_PAY_CHG,
! GVT_DETL_POSN_NBR,
! ANNL_BEN_BASE_OVRD,
! BENEFIT_PROGRAM,
! UPDATE_PAYROLL,
! GVT_PAY_PLAN,
! GVT_PAY_FLAG,
! GVT_NID_CHANGE,
! end upgrade 9.0 deleted fields
UNION_FULL_PART,
UNION_POS,
MATRICULA_NBR,
SOC_SEC_RISK_CODE,
UNION_FEE_AMOUNT,
UNION_FEE_START_DT,
UNION_FEE_END_DT,
EXEMPT_JOB_LBR,
EXEMPT_HOURS_MONTH,
WRKS_CNCL_FUNCTION,
INTERCTR_WRKS_CNCL,
CURRENCY_CD1,
PAY_UNION_FEE,
UNION_CD,
BARG_UNIT,
UNION_SENIORITY_DT,
ENTRY_DATE,
LABOR_AGREEMENT,
EMPL_CTG,
EMPL_CTG_L1,
EMPL_CTG_L2,
SETID_LBR_AGRMNT,
GP_PAYGROUP,
GP_DFLT_ELIG_GRP,
GP_ELIG_GRP,
GP_DFLT_CURRTTYP,
CUR_RT_TYPE,
GP_DFLT_EXRTDT,
GP_ASOF_DT_EXG_RT,
ADDS_TO_FTE_ACTUAL,
CLASS_INDC,
ENCUMB_OVERRIDE,
FICA_STATUS_EE,
FTE,
PRORATE_CNT_AMT,
PAY_SYSTEM_FLG,
BORDER_WALKER,
LUMP_SUM_PAY,
CONTRACT_NUM,
JOB_INDICATOR,
WRKS_CNCL_ROLE_CHE,
! WRKS_CNCL_ID_LCL,		       ! upgrade 9.0 delted field
BENEFIT_SYSTEM,
WORK_DAY_HOURS,
SUPERVISOR_ID,
REPORTS_TO,
FORCE_PUBLISH,
JOB_DATA_SRC_CD,
! start upgrade 9.0 newly added fields
PER_ORG,             
HR_STATUS,           
WPP_STOP_FLAG,       
LABOR_FACILITY_ID ,  
LBR_FAC_ENTRY_DT,    
LAYOFF_EXEMPT_FLAG,  
LAYOFF_EXEMPT_RSN ,  
SUPV_LVL_ID ,        
SETID_SUPV_LVL ,     
ABSENCE_SYSTEM_CD,	
POI_TYPE,		
HIRE_DT	,	
LAST_HIRE_DT,	
TERMINATION_DT,	
ASGN_START_DT,	
LST_ASGN_START_DT,	
ASGN_END_DT,		
LDW_OVR	,	
EXPECTED_RETURN_DT,	
EXPECTED_END_DATE,	
AUTO_END_FLG,	
LASTUPDDTTM,
LASTUPDOPRID,
APPT_TYPE,		
MAIN_APPT_NUM_JPN	
! end upgrade 9.0 newly added fields
)
values (
   $emplid,
   #empl_rcd,
!SXK 07/01/1999 Begin - Use &pi.pay_begin_dt
   &PI.PAY_BEGIN_DT,  
!GXD 05/04/1999 End
!SXK 07/01/1999 End
   #effseq,           !effseq
   $deptid,
   $jobcode,
   $position_nbr,
   $position_override,
   'N',		!position_override-Do not carry forward if present AXL-09/27/99
   $empl_status,
   &PI.ACTION,
!GXD 05/04/1999
   $AsofToday,
!GXD 05/04/1999
   &PI.ACTION_REASON,
   $location,
   $tax_location_cd,
   $job_entry_dt,
   $dept_entry_dt,
   $position_entry_dt,
   $shift,
   $reg_temp,
   $full_part_time,
   $company,
   $paygroup,
!SXK 11/09/1999 Begin
!   &JB.PIN_NUM,
!   &JB.PAY_BASIS_NUM,
!SXK 11/09/1999 End
   $bas_group_id,
   $elig_config1,
   $elig_config2,
   $elig_config3,
   $elig_config4,
   $elig_config5,
   $elig_config6,
   $elig_config7,
   $elig_config8,
   $elig_config9,
   $ben_status,
!SXK 11/09/1999 Begin
   &BAC.BAS_ACTION,
!SXK 11/09/1999 End
   $cobra_action,
   $empl_type,
   $holiday_schedule,
   #std_hours,
   $officer_cd,
   $empl_class,
   $sal_admin_plan,
   $grade,
   $grade_entry_dt,
   #step,
   $step_entry_dt,
   $gl_pay_type,
   $acct_cd,
   $earns_dist_type,
  ! $salary_matrix_cd,         ! upgrade 9.0 changes
  ! $rating_scale,             ! upgrade 9.0 changes
  ! $review_rating,            ! upgrade 9.0 changes
  ! $review_dt,                ! upgrade 9.0 changes
   $comp_frequency,
   #comprate,                  !comprate   - changed 04/22/98
   #change_amt,                !change_amt - changed 04/20/98
   #change_pct,                !change_pct - changed 04/20/98
   #annual_rt,                 !annual_rt  - changed 04/22/98
   #monthly_rt,                !monthly_rt - changed 04/22/98
   #to_rate,                   !New Hourly Rate
   #annl_benef_base_rt,
   #shift_rt,
   #shift_factor,
   $currency_cd,
!sxk 11/09/1999 Begin
   &JB.BUSINESS_UNIT,
   &JB.SETID_DEPT,
   &JB.SETID_JOBCODE,
   &JB.REG_REGION,
   &JB.DIRECTLY_TIPPED,
!SXK 11/09/1999 End
   $FLSA_status,
   $eeo_class,
   $function_cd,
   $hourly_rt_fra,
   $accdnt_cd_fra,
   $estabid,
   '',	              !last_date_worked-Do not carry forward if present AXL-09/27/99
   $gex_light_duty,
   'Y',               !gex_change_record - changed 04/20/98
   $gex_volun_low_hrs,
   $gex_student_ind,
   $gex_moon_ind,
   $gex_deptid_ovr,
   $gex_acct_cd_ovr,
   $gex_gl_exp_ovr,
   $gex_steward,
   $gex_dues_exempt,
   $gex_finan_core,
   $gex_inflated_hrs,
   $gex_fp_code,
   $GEX_SEASONAL_EMP,	!AXL 5/14/2001 New job field
	
	&JB.STD_HRS_FREQUENCY,
	&JB.DAILY_RT,
	&JB.SETID_LOCATION,
	&JB.SETID_SALARY,
	&JB.TARIFF_GER,
	&JB.TARIFF_AREA_GER,
	&JB.PERFORM_GROUP_GER,
	&JB.LABOR_TYPE_GER,
	&JB.SPK_COMM_ID_GER,
	! &JB.WRKS_CNCL_MEM_GER,	  ! upgrade 9.0 deleted field
	&JB.VALUE_1_FRA,
	&JB.VALUE_2_FRA,
	&JB.VALUE_3_FRA,
	&JB.VALUE_4_FRA,
	&JB.VALUE_5_FRA,
	&JB.CTG_RATE,
	&JB.PAID_HOURS,
	&JB.PAID_FTE,
	&JB.PAID_HRS_FREQUENCY,
	! start upgrade 9.0 deleted fields
	! &JB.GVT_EFFDT,
	! &JB.GVT_EFFDT_PROPOSED,
	! &JB.GVT_TRANS_NBR,
	! &JB.GVT_TRANS_NBR_SEQ,
	! &JB.GVT_WIP_STATUS,
	! &JB.GVT_STATUS_TYPE,
	! &JB.GVT_NOA_CODE,
	! &JB.GVT_LEG_AUTH_1,
	! &JB.GVT_PAR_AUTH_D1,
	! &JB.GVT_PAR_AUTH_D1_2,
	! &JB.GVT_LEG_AUTH_2,
	! &JB.GVT_PAR_AUTH_D2,
	! &JB.GVT_PAR_AUTH_D2_2,
	! &JB.GVT_PAR_NTE_DATE,
	! &JB.GVT_WORK_SCHED,
	! &JB.GVT_SUB_AGENCY,
	! &JB.GVT_ELIG_FEHB,
	! &JB.GVT_FEHB_DT,
	! &JB.GVT_PAY_RATE_DETER,
	! &JB.GVT_STEP,
	! &JB.GVT_RTND_PAY_PLAN,
	! &JB.GVT_RTND_SAL_PLAN,
	! &JB.GVT_RTND_GRADE,
	! &JB.GVT_RTND_STEP,
	! &JB.GVT_RTND_GVT_STEP,
	! &JB.GVT_PAY_BASIS,
	! &JB.GVT_COMPRATE,
	! &JB.GVT_LOCALITY_ADJ,
	! &JB.GVT_BIWEEKLY_RT,
	! &JB.GVT_DAILY_RT,
	! &JB.GVT_HRLY_RT_NO_LOC,
	! &JB.GVT_DLY_RT_NO_LOC,
	! &JB.GVT_BW_RT_NO_LOC,
	! &JB.GVT_MNLY_RT_NO_LOC,
	! &JB.GVT_ANNL_RT_NO_LOC,
	! &JB.GVT_XFER_FROM_AGCY,
	! &JB.GVT_XFER_TO_AGCY,
	! &JB.GVT_RETIRE_PLAN,
	! &JB.GVT_ANN_IND,
	! &JB.GVT_FEGLI,
	! &JB.GVT_FEGLI_LIVING,
	! &JB.GVT_LIVING_AMT,
	! &JB.GVT_ANNUITY_OFFSET,
	! &JB.GVT_CSRS_FROZN_SVC,
	! &JB.GVT_PREV_RET_COVRG,
	! &JB.GVT_FERS_COVERAGE,
	! &JB.GVT_TYPE_OF_APPT,
	! &JB.GVT_POI,
	! &JB.GVT_POSN_OCCUPIED,
	! &JB.GVT_CONT_EMPLID,
	! &JB.GVT_ROUTE_NEXT,
	! &JB.GVT_CHANGE_FLAG,
	! &JB.GVT_TSP_UPD_IND,
	! &JB.GVT_PI_UPD_IND,
	! &JB.GVT_SF52_NBR,
	! &JB.GVT_S113G_CEILING,
	! &JB.GVT_LEO_POSITION,
	! &JB.GVT_ANNUIT_COM_DT,
	! &JB.GVT_BASIC_LIFE_RED,
	! &JB.GVT_DED_PRORT_DT,
	! &JB.GVT_FEGLI_BASC_PCT,
	! &JB.GVT_FEGLI_OPT_PCT,
	! &JB.GVT_FEHB_PCT,
	! &JB.GVT_RETRO_FLAG,
	! &JB.GVT_RETRO_DED_FLAG,
	! &JB.GVT_RETRO_JOB_FLAG,
	! &JB.GVT_RETRO_BSE_FLAG,
	! &JB.GVT_OTH_PAY_CHG,
	! &JB.GVT_DETL_POSN_NBR,
	! &JB.ANNL_BEN_BASE_OVRD,
	! &JB.BENEFIT_PROGRAM,
	! &JB.UPDATE_PAYROLL,
	! &JB.GVT_PAY_PLAN,
	! &JB.GVT_PAY_FLAG,
	! &JB.GVT_NID_CHANGE,
	! end upgrade 9.0 deleted fields
	&JB.UNION_FULL_PART,
	&JB.UNION_POS,
	&JB.MATRICULA_NBR,
	&JB.SOC_SEC_RISK_CODE,
	&JB.UNION_FEE_AMOUNT,
	&JB.UNION_FEE_START_DT,
	&JB.UNION_FEE_END_DT,
	&JB.EXEMPT_JOB_LBR,
	&JB.EXEMPT_HOURS_MONTH,
	&JB.WRKS_CNCL_FUNCTION,
	&JB.INTERCTR_WRKS_CNCL,
	&JB.CURRENCY_CD1,
	&JB.PAY_UNION_FEE,
	&JB.UNION_CD,
	&JB.BARG_UNIT,
	&JB.UNION_SENIORITY_DT,
	&JB.ENTRY_DATE,
	&JB.LABOR_AGREEMENT,
	&JB.EMPL_CTG,
	&JB.EMPL_CTG_L1,
	&JB.EMPL_CTG_L2,
	&JB.SETID_LBR_AGRMNT,
	&JB.GP_PAYGROUP,
	&JB.GP_DFLT_ELIG_GRP,
	&JB.GP_ELIG_GRP,
	&JB.GP_DFLT_CURRTTYP,
	&JB.CUR_RT_TYPE,
	&JB.GP_DFLT_EXRTDT,
	&JB.GP_ASOF_DT_EXG_RT,
	&JB.ADDS_TO_FTE_ACTUAL,
	&JB.CLASS_INDC,
	&JB.ENCUMB_OVERRIDE,
	&JB.FICA_STATUS_EE,
	&JB.FTE,
	&JB.PRORATE_CNT_AMT,
	&JB.PAY_SYSTEM_FLG,
	&JB.BORDER_WALKER,
	&JB.LUMP_SUM_PAY,
	&JB.CONTRACT_NUM,
	&JB.JOB_INDICATOR,
	&JB.WRKS_CNCL_ROLE_CHE,
	! &JB.WRKS_CNCL_ID_LCL,		   ! upgrade 9.0 deleted field
	&JB.BENEFIT_SYSTEM,
	&JB.WORK_DAY_HOURS,
	&JB.SUPERVISOR_ID,
	&JB.REPORTS_TO,
	&JB.FORCE_PUBLISH,
	&JB.JOB_DATA_SRC_CD,
	! start upgrade 9.0 newly added fields
	$per_org,                 
	$hr_status,	             
	$wpp_stop_flag,           
	$labor_facility_id,      
	$lbr_fac_entry_dt,        
	$layoff_exempt_flag, 	
	$layoff_exempt_rsn,		
	$supv_lvl_id,		
	$setid_supv_lvl,	
	$absence_system_cd,       
	$poi_type,                
	$job_hire_dt ,            
	$job_last_hire_dt ,	     
	$job_term_dt,             
	$job_asgn_st_dt ,         
	$job_lst_asgn_start_dt,   
	$job_asgn_end_dt,         
	$job_ldw_ovr,             
	$job_exp_return_dt,       
	$job_exp_end_dt,          
	$auto_end_flg,         	
	$job_current_dt,          
	$job_prcs_oprid,          
	$appt_type,               
	$main_appt_num_jpn       
	! end upgrade 9.0 newly added fields
	)
end-sql

!begin-sql
!rollback
!end-sql

begin-sql
commit
end-sql

end-procedure

!********************************************************************
begin-procedure process-compensation-rows
!********************************************************************
  let $sql-statement = 'GEXPYINC.SQR,Process-Compensation-Rows,PS_COMPENSATION'
  let $found = 'N'
begin-SELECT On-Error=Sql-error-found('Process-Compensation-Rows')
SC.EMPLID                 
SC.EMPL_RCD
SC.EFFDT
SC.EFFSEQ                 
SC.COMP_EFFSEQ            
SC.COMP_RATECD            
SC.COMP_RATE_POINTS       
SC.COMPRATE               
SC.COMP_PCT               
SC.COMP_FREQUENCY         
SC.CURRENCY_CD            
SC.MANUAL_SW              
SC.CONVERT_COMPRT         
SC.RATE_CODE_GROUP        
SC.CHANGE_AMT             
SC.CHANGE_PCT             
SC.CHANGE_PTS             
SC.FTE_INDICATOR          
SC.CMP_SRC_IND       

   do insert-compensation

from ps_compensation SC
WHERE SC.EMPLID   =  &JB.EMPLID
  AND SC.EMPL_RCD =  &JB.EMPL_RCD
  AND SC.EFFDT    =  &JB.EFFDT
  AND SC.EFFSEQ   =  &JB.EFFSEQ
end-SELECT

end-procedure

!********************************************************************
begin-procedure insert-compensation
!********************************************************************
  let $sql-statement = 'GEXPYINC.SQR,Insert-compensation,PS_COMPENSATION'

begin-SQL On-Error=Sql-error-found('Insert-Compensation')
Insert into ps_compensation
(EMPLID,
EMPL_RCD,
EFFDT,
EFFSEQ,
COMP_EFFSEQ,
COMP_RATECD,
COMP_RATE_POINTS,
COMPRATE,
COMP_PCT,
COMP_FREQUENCY,
CURRENCY_CD,
MANUAL_SW,
!PIN_NUM, PSR 10/03/2002  V8.3 Upgrade
CONVERT_COMPRT,
RATE_CODE_GROUP,
!PSR 10/03/2002 V8.3 Upgrade Begin
CHANGE_AMT,             
CHANGE_PCT,             
CHANGE_PTS,             
FTE_INDICATOR,          
CMP_SRC_IND            
!PSR 10/03/2002 V8.3 Upgrade End
)
values
(&JB.EMPLID,
&JB.EMPL_RCD,
&PI.PAY_BEGIN_DT,  
#effseq,
&SC.COMP_EFFSEQ,  
&SC.COMP_RATECD,            
&SC.COMP_RATE_POINTS,       
#comprate,                       !SCM 06/23/2003 changed from &SC.COMPRATE                 
&SC.COMP_PCT,               
&SC.COMP_FREQUENCY,         
&SC.CURRENCY_CD,            
&SC.MANUAL_SW,              
&SC.CONVERT_COMPRT,         
&SC.RATE_CODE_GROUP,        
&SC.CHANGE_AMT,             
&SC.CHANGE_PCT,             
&SC.CHANGE_PTS,             
&SC.FTE_INDICATOR,          
&SC.CMP_SRC_IND 
)

end-sql
end-procedure

!*******************************************************************
!Retrieves Bas Action Value from Action Reason Table
!*******************************************************************
Begin-Procedure get-bas-action

begin-select on-error=sql-error-found('Get-Bas-Action')
BAC.BAS_ACTION
  let $bas_action_retrieved = 'Y'
! FROM PS_ACTN_REASON_TBL BAC		      ! Upgrade 8.3 - 9.0 code commented
FROM PS_ACT_RSN_TBL_NA BAC                    ! Upgrade 8.3 - 9.0 changes
WHERE BAC.ACTION = &PI.ACTION
AND BAC.ACTION_REASON = &PI.ACTION_REASON
AND BAC.EFFDT = (select max(effdt)
		! from ps_actn_reason_tbl     ! Upgrade 8.3 - 9.0 code commented
		FROM PS_ACT_RSN_TBL_NA        ! Upgrade 8.3 - 9.0 changes
		where action = bac.action
		and action_Reason = bac.action_reason
		and effdt <= &PI.PAY_BEGIN_DT)
end-select
end-procedure

!********************************************************************
!Check to see if bas_activity already exists
!********************************************************************
begin-procedure select-bas-activity-row

Begin-Select on-error=sql-error-found('Select-Bas-Activity-Row')
'BAC'
    let $bas_activity_exists = 'Y'
FROM PS_BAS_ACTIVITY BAC1
WHERE BAC1.EMPLID = $emplid
and bac1.empl_rcd = #empl_rcd
and bac1.bas_action_source = 'TJ'
and bac1.event_dt = &PI.PAY_BEGIN_DT
and bac1.event_effseq = #effseq
end-select
end-procedure

!*******************************************************************
!Inserts into BAS_ACTIVITY table
!*******************************************************************
begin-procedure insert-bas-activity-row


do select-benefit-rcdnum

begin-sql on-error=sql-error-found('Insert-Bas-Activity-Row')
INSERT INTO PS_BAS_ACTIVITY
(EMPLID,
EMPL_RCD,
BAS_ACTION_SOURCE,
EVENT_DT,
EVENT_EFFSEQ,
BAS_ACTION,
BENEFIT_RCD_NBR,
COBRA_ACTION,
BAS_ALL_JOBS,
BAS_SUPPRESS_FORMS)                                    !GBD 01/03/2003
VALUES(
$emplid,
#empl_rcd,
'TJ',
&PI.PAY_BEGIN_DT,
#effseq,
&BAC.BAS_ACTION,
&EM.BENEFIT_RCD_NBR,
&JB.cobra_action,
'Y',
' ')                                                   !GBD 01/03/2003
end-sql
end-procedure

!********************************************************************
!Selects Employment.benefit_rcd_nbr
!********************************************************************
Begin-Procedure Select-Benefit-RcdNum
#debug9 show 'Select-Benefit-RcdNum'
let #bac_benefit_rcd = 0
begin-select on-error=sql-error-found('Select-Benefit-RcdNum')
EBAC.BENEFIT_RCD_NBR
 move &EBAC.BENEFIT_RCD_NBR to #bac_benefit_rcd
FROM PS_EMPLOYMENT EBAC
WHERE EBAC.EMPLID = $bac_emplid
and ebac.empl_rcd = #bac_empl_rcd
end-select
end-procedure

!SXK 11/09/1999 End
!********************************************************************
!GXD 05/04/1999 Begin
begin-procedure Update-Personal-Data

!begin-sql on-error=sql-error-found('Update-Personal-Data')

!update ps_personal_data
!set bas_data_chg = 'Y' Column not found in V8.3 
!where emplid = $emplid

!end-sql

!begin-sql
!rollback
!end-sql

end-procedure
!GXD 05/04/1999 End
!********************************************************************
! Print Process Log
!********************************************************************
begin-procedure Print-Process-Log

move #job_hourly_rt to $job_hourly_rt BBBB9.999999
move #to_rate       to $to_rate       BBBB9.999999

move #step          to $print_step    999 

print $emplid           (+1,01)
print $name              (0,13)
!MDJ 05/22/98 START
print $deptid            (0,44)
! CWB 05/20/2002 BEGIN
print $acct_cd                  (0,52)
!print $descr                    (0,61)
print $full_part_time           (0,65)
!print $jobcode                 (0,83)
print $jobcode                 (0,74)
!print $descr_job               (0,91)
print $descr_job               (0,82)
!print $union_cd                (0,114)
print $union_cd                (0,105)
do Format-DateTime($service_dt, $out, {DEFDATE}, '', '') 
!print $out                     (0,122) 
print $out                     (0,113) 
print $sal_admin_plan          (0,125)
print $grade                   (0,130)  
!print $print_step              (0,134) 
print $print_step              (0,135) 
! CWB 05/20/2002 END
print $job_hourly_rt    (0,139)
print $to_rate          (0,158)

add 1 to #preview-count

end-procedure

!********************************************************************
! Determine Comp Frequency
!********************************************************************
begin-procedure Determine-Comp-Freq
   evaluate $comp_frequency
      when = 'D'
	 let #comp_freq = 365
	 break
      when = 'W'
	 let #comp_freq = 52
	 break
      when = 'B'
	 let #comp_freq = 26
	 break
      when = 'S'
	 let #comp_freq = 24
	 break
      when = 'M'
	 let #comp_freq = 12
	 break
      when = 'Q'
	 let #comp_freq = 4
	 break
      when-other
	 let #comp_freq = 1
	 break
   end-evaluate

end-procedure

!*********************************************************
begin-procedure Calc-Comprate

! CWB 05/20/2002 BEGIN
!   if (#to_rate > #job_hourly_rt) or &PI.ACTION = 'DEM'
! CWB 05/20/2002 END

      if $comp_frequency = 'H'
	 let #comprate = #to_rate
      else
	 let #comprate = #annual_rt / #comp_freq
      end-if
! CWB 05/20/2002 BEGIN
!   else
!      let #comprate = 0
!   end-if
! CWB 05/20/2002 END

end-procedure

!***************************************************
begin-procedure Calc-Comp-Change

!** Recalc Change Amt **

   if &PI.GEX_RATE_TYPE = 'F'
      let #change_amt = #rate_amount
   else
      let #change_amt = #comprate - #old_comprate
   end-if

!** Recalc Change Pct **

   if &PI.GEX_RATE_TYPE = 'P'
      let #change_pct = #rate_amount
   else
      if #old_comprate = 0
	 let #change_pct = 0
      else
	 let #change_pct_tmp = (#change_amt / #old_comprate) * 100
	 if #change_pct_tmp > 999.999
	    let #change_pct = 999.999
	 else
	    if #change_pct_tmp < -999.999
	       let #change_pct = -999.999
	    else
	       let #change_pct = #change_pct_tmp
	    end-if
	 end-if
      end-if
   end-if

end-procedure

!SXK 07/28/98 Begin
!*********************************************************************
!Checks if there are any future rows as of &PI.PAY_BEGIN_DT
!*********************************************************************
Begin-Procedure Check-Future-Rows

move 'N' to $future_rows_exist
begin-select on-error=sql-error-found('Check-Future-Rows')
'xx'
  move 'Y' to $future_rows_exist
FROM PS_JOB FUT
WHERE FUT.EMPLID = $emplid
  AND FUT.EMPL_RCD = #EMPL_RCD
!  AND FUT.EFFDT > $pay_end_dt  !SXK 07/01/1999 Begin
  AND FUT.EFFDT > &PI.PAY_BEGIN_DT
end-select

end-procedure

!*********************************************************************
! Print Future Report
!*********************************************************************
begin-procedure Print-Future-Report

  use-report future-report

   if #current-line > 51
      new-page
   end-if
move #job_hourly_rt to $job_hourly_rt BBBB9.999999
move #to_rate       to $to_rate       BBBB9.999999
move #step to $print_step 999
print $emplid           (+1,01)
print $name              (0,13)
print $deptid            (0,44)
! CWB 05/20/2002 BEGIN
print $acct_cd                  (0,52)
!print $descr                    (0,61)
print $full_part_time           (0,65)
!print $jobcode                 (0,83)
print $jobcode                 (0,74)
!print $descr_job               (0,91)
print $descr_job               (0,82)
!print $union_cd                (0,114)
print $union_cd                (0,105)
do Format-DateTime($service_dt, $out, {DEFDATE}, '', '') 
!print $out                     (0,122) 
print $out                     (0,113) 
print $sal_admin_plan          (0,125)
print $grade                   (0,130)  
!print $print_step              (0,134) 
print $print_step              (0,135) 
! CWB 05/20/2002 END
print $job_hourly_rt    (0,142)
print $to_rate          (0,163)

use-report report-log

end-procedure

!SXK 07/28/98 End

!********************************************************************
!This procedure displays in the error report if there are any sql errors
!happened in the program
!********************************************************************

begin-procedure SQL-Error-Found($Proc_Name) 
  do error-found
  print 'SQL Error in ' (,59)
  print $Proc_Name ()  
  print $_sql-error () 
  print 'sql-status:' ()
  print #_sql-status () edit 99999 

end-procedure

!*********************************************************************
!GXD 05/05/1999 Begin
begin-procedure Check-Null (:$fieldval)
if isnull($fieldval)
   move ' ' to $fieldval
end-if
end-procedure

begin-procedure Check-Null2 (:$fieldval)
if isnull($fieldval)
   move '' to $fieldval
end-if
end-procedure

!GXD 05/05/1999 End

!*********************************************************************
!This procedure displays the error message for the records that are in
!progress
!*********************************************************************

begin-procedure Error-Found
  move 'Y' to $ErrorFound
  do Format-Number(#InputTran, $out, '99999')
  print $out (+1,1)
  let $EmplId_1st3 = substr($EmplId,1,3)
  let $EmplId_mid2 = substr($EmplId,4,2)
  let $EmplId_last4 = substr($EmplId,6,4)
 
  String $EmplId_1st3 $EmplID_mid2 $EmplId_last4 by '-' into $EmplId11

  print $EmplID11 (,16)
end-procedure

! CWB 05/20/2002 BEGIN
Begin-Procedure Select-sort-order
#debug9 Show 'Select-sort-order'
  evaluate &pi.sort_order 
  when = 1
    let $sort_order_criteria = 'ORDER by PD.NAME'
  break
  when = 2
    let $sort_order_criteria = 'ORDER BY JB.UNION_CD, JB.HOURLY_RT, EM.SERVICE_DT, JB.JOBCODE'
  break
  when = 3
    let $sort_order_criteria = 'ORDER by JB.SAL_ADMIN_PLAN, JB.GRADE, JB.STEP'
  break
  end-evaluate
  show 'SORT ORDER = ' $SORT_ORDER_CRITERIA 

end-procedure  !Select-sort-order

Begin-Procedure Print-Cover-Page
#debug9 Show 'Print-Cover-Page'
  Print 'RUN CONTROL INFORMATION FOR THIS REPORT RUN:'            (+5,1)
  Print '$Prcs_OprID          ='                                  (+2,5)
  Print $Prcs_OprID                                               (0,+2)
  Print '$Prcs_Run_Cntl_ID    ='                                  (+1,5)
  Print $Prcs_Run_Cntl_ID                                         (0,+2)

  Print 'SELECTION CRITERIA FOR THIS REPORT RUN:'                 (+5,2)
  Print '$GEXXX964_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA ='   (+2,5)
  Print $GEXXX964_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA       (0,+2)
  Print '$GEXXX965_DEPTID_DISPLAY_CRITERIA                   ='   (+2,5)
  Print $GEXXX965_DEPTID_DISPLAY_CRITERIA                         (0,+2)
  Print '$GEXXX966_JOBCODE_DISPLAY_CRITERIA                  ='   (+1,5)
  Print $GEXXX966_JOBCODE_DISPLAY_CRITERIA                        (0,+2)
  Print '$GEXXX967_UNION_CD_DISPLAY_CRITERIA                 ='   (+1,5)
  Print $GEXXX967_UNION_CD_DISPLAY_CRITERIA                       (0,+2)
  Print '$GEXXX968_SAL_ADMIN_PLAN_DISPLAY_CRITERIA           ='   (+1,5)
  Print $GEXXX968_SAL_ADMIN_PLAN_DISPLAY_CRITERIA                 (0,+2)
  Print '$GEXXX969_HRLY_CHG_DISPLAY_CRITERIA                 ='   (+1,5)
  Print $GEXXX969_HRLY_CHG_DISPLAY_CRITERIA                       (0,+2)
  Print '$Where-clause                                       ='   (+1,5)
  print $Where-clause                                             (0,+2)
  Print '$SORT_ORDER_CRITERIA                                ='   (+1,5)
  Print $SORT_ORDER_CRITERIA                                      (0,+2)       

  Let #PAGE-COUNT = 0
  NEW-PAGE
End-Procedure

!*********************************************************************
#Include 'tranctrl.sqc'  !Common Transaction Control Procedures
#Include 'reset.sqc'     !Reset printer procedure
#Include 'curdttim.sqc'  !Get-Current-DateTime procedure
#Include 'datetime.sqc'  !Routines for date and time formatting
#Include 'number.sqc'    !Routines to format numbers
#Include 'gexxx922.sqc'  !Run Control Variables
#Include 'stdapi.sqc'    !Get_Run_Control Procedure
#Include 'datemath.sqc'  !Does the date-math functions
#include 'gexxx964.sqc'  !Company & Paygroup parameters.
#include 'gexxx965.sqc'  !Deptid selection parameters.
#include 'gexxx966.sqc'  !Jobcode selection parameters.
#include 'gexxx967.sqc'  !Union Cd selection parameters.
#include 'gexxx968.sqc'  !Plan, Grade, Step parameters.
#include 'gexxx969.sqc'  !Hourly rate change parameters.
#include 'getposnm.sqc'  !Get-Position-Title prodecure