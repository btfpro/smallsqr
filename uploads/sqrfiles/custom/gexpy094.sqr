!***********************************************************************
!   GEXPY094:  401K & Census for Franchise                             *
!***********************************************************************
!                                                                      *
!               Confidentiality Information:                           *
!                                                                      *
! This module is the confidential and proprietary information of       *
! Giant Eagle, Inc.; it is not to be copied, reproduced, or transmitted*
! in any form, by any means, in whole or in part, nor is it to be used *
! for any purpose other than that for which it is expressly provided   *
! without the written permission of Giant Eagle.                       * 
!                                                                      *
!  Created By : Tony Labra                                             *
!  Date       : 05/28/1999                                             *
!  Overview   : This SQR is based on GEXPY610. The procedures for      *
!               creating an output file have been commented out. The   *
!               sqr creates a report of withholding information for    *
!               the Franchise Stores.                                  *
!***********************************************************************
! Prerequisite: 	None                                           *
!                                                                      *
! Entered Run                                                          * 
! Control Parms:	FOR WHERE CLAUSE:                              *
!                                                                      *
!			Co/Div Code	 Company Division code         *
!                                        grouping                      *
!                                                                      *
!			Company  	 Franchise companies to be     *
!                                        entered and maintained        *
!					 by user)                      *
!                                                                      *
!			MonthEnd/                                      *
!			YearEnd_Flag     User to enter parm to         *
!                                        indicate if run is a monthend *
!                                        or yearend run. SQR will then *
!                                        print/create MTD or YTD       *
!                                        balances.                     *
!                                                                      *
!			As Of Date	 Allow for entry or default to *
!                                        todays date.	               *
!                                                                      *
!***********************************************************************
!                         MODIFICATION HISTORY                         *
!***********************************************************************
! Proj#/INIT	DATE		DESCR OF THE CHANGE                    *
! ---------------------------------------------------------------------*
! HR459	AXL	5/28/1999	Initial creation.                      *
!                                                                      *
!       AXL     7/15/1999       Combined MTD & YTD logic into same     *
!                               procedures for efficiency.             *
!       AXL     7/26/1999       Added Oracle Hints to major begin      *
!                               select paragraphs to force rule-based  *
!                               approach for ensuing Alter Sessions    *  
!       AXL     8/09/1999       Corrected DEDBAL select which was      *
!                               selecting non-401k rows.               *              
!                                                                      *
!       SXK     10/28/1999      Modified to have union from job_labor  *
!	SXK     11/16/1999      Modified from ZIP to POSTAL            *
!                                                                      *
!       JNB     01/20/2000      Include new ded codes LOAN01, LOAN02 & *
!                               LOAN03                                 *
!                                                                      *
!       AXL     02/14/2000      Print EMPLOYMENT.HIRE_DT not           *
!                               PERSONAL_DATA.Orig_Hire_Dt.  Add code  *
!                               for Hourly vs Salaried.                *
!                                                                      *
!       AXL     03/27/2000      Use GEXERNC2.SQC instead of            *
!                               GEXERNCD.SQC                           *
!                                                                      *
!       SXC     04/27/2000      Re-write to use different main         *
!                               select and a temp table to not         *
!                               show dupes in the same company,        *
!                               but more than 1 deptid.                *
!                               Added JOB_LABOR for the HR7.51         *
!                               version to get union code.             *   
!                               Changed ZIP to POSTAL.                 *
!       SXC     05/15/2000      Fixed a problem where the company total*
!                               was not printing if at least one empl  *
!                               was selected.                          *
!                                                                      *
!       AXL     09/18/2000      Adjusted P200-Get-Deduction-Bal select *
!                               logic to include DEDCD's LOAN01-03     *
!                               Original mod done 1/20/2000.           *
!       CWB     03/14/2001      Added company and deptid to the header *
!                               for Mobius sorting purposes. Added     *
!                               EMPL_RCD to select in order to get     *
!                               correct union code.                    *   
!       PSR     08/06/2002      Modified to get UNION_CD FROM JOB      * 
!                               - Upgrade 8.3                          *
!       PSR     08/27/2002      EMPL_RCD is now part of the key for 
!                               PS_EARNINGS_BAL - Upgrade 8.3
!                                                                      *
!       SRK     02/20/2003      removed empl_rcd in the earnings_bal   *
!                               where clause as we want sum of both    *
!                               records                                *
!       SRK     02/25/2003      Added logic to print detail always on  *
!	                        active status otherwise check ytd bal>0*
!                               Also, get the right termination date   *
!                               by adding 1 to job.last_date_worked    *
!                               if empl_Status is terminated but       *
!                               employment.termination_Dt is blank     *
!                               since employee got rehired             *
!                                                                      *
!	SRK	02/27/2003	As per users, empl_rcd is needed for   *
!				balances                               *
!                                                                      *
!       CJH     08/29/2003      Correct temp table create statement to *
!                               define number columns with the correct *
!                               precision as the source table.         *
!                                                                      *
!       AXL     09/28/2003      Address1,2 field sizes in TEMP Tbl     *
!                        	       increased to 55 to mirror the field    *
!                               size from PS_PERSONAL_DATA.            *
!                                                                      *
!       CWB     01/15/2004      Changed #include from gexernc2.sqc     *
!                                   to gexerncd.sqc                    * 
!                                                                      *
!       ISDVSRC     06/01/2006      Added New DEDCD in Procedure       *
!                               P200-Get-Deduction-Bal                 * 
!                                                                      *
!       ISDVMXR     07/06/2006  ITG # 35981: GEXPY094 - new 401K deduction codes *
!                                Added code in P200-Get-Deduction-Bal   *
!GEX_PY256 SXD      08/22/2007  Sqr from 8.3 is moved as it to 9.0     *  
!                               No changes are made.        
!GEX-MXR	10/03/2007	Changed print co-ordinate	       *
!GEX-AXG        10/15/2007      Made Changes to display the date in the  *
!				format mm/dd/yy.                         *
!GEX-TLL	03/27/2008	Changed print co-ordinate	         *
!GEX-MXT        04/02/2008      ADDED THE join condition for PER_ORG_INST*
!GEX-TLL	04/02/2008	HCM 9.0 Upgrade	      			 *
!GEX-TLL 	07/09/2008 	ITG #51358 (Added Erncd=173) 		 *
!VENDKXY        11/04/2008      Removed the wrong code which was migrated*
!				as part of old migration   		 *
!ISDVDZk        10/02/2010      added the new deduction codes as per the * 
!                               S3 13749826 start                        * 
!***********************************************************************

#include 'setenv.sqc' !Set environment
#Include 'setup02.sqc'  !Printer and page-size initialization

!selection criteria
#define #x000_col_selection_criteria_a 	2
#define #x000_col_selection_criteria_b 	5

!line 1
#define #x000_col_company		02
#define #x000_col_deptid		06
#define #x000_col_union_cd		11
#define #x000_col_empl_status		17
#define #x000_col_hire_date     	24
!GEX-TLL 03/27/2008 HCM 9.0 Upgrade Begin 
!#define #x000_col_termination_dt	35	!GEX-MXR-Changed print co-ordinate
!#define #x000_col_birth_dt		47	!GEX-MXR-Changed print co-ordinate
!#define #x000_col_name			58	!GEX-MXR-Changed print co-ordinate
!#define #x000_col_emplid		85	  !AXL 2/14/2000-mod !GEX-MXR-Changed print co-ordinate
!#define #x000_col_hourly_rt		92	  !AXL 2/14/2000-mod !GEX-MXR-Changed print co-ordinate
!#define #x000_col_empl_type            100	  !AXL 2/14/2000-add !GEX-MXR-Changed print co-ordinate
!#define #x000_col_MTD_401K	      	102       !GEX003-add !GEX-MXR-Changed print co-ordinate
!#define #x000_col_MTD_Gross	      	117       !GEX003-add !GEX-MXR-Changed print co-ordinate
!#define #x000_col_MTD_Hours	      	130       !GEX003-add !GEX-MXR-Changed print co-ordinate
!#define #x000_col_YTD_401K	      	142       !GEX003-add !GEX-MXR-Changed print co-ordinate
!#define #x000_col_YTD_Gross	      	156       !GEX003-add !GEX-MXR-Changed print co-ordinate
!#define #x000_col_YTD_Hours	      	168       !GEX003-add !GEX-MXR-Changed print co-ordinate
#define #x000_col_termination_dt	33	!GEX-MXR-Changed print co-ordinate
#define #x000_col_birth_dt		42	!GEX-MXR-Changed print co-ordinate
#define #x000_col_name			51	!GEX-MXR-Changed print co-ordinate
#define #x000_col_emplid		78	  !AXL 2/14/2000-mod !GEX-MXR-Changed print co-ordinate
#define #x000_col_hourly_rt		88	  !AXL 2/14/2000-mod !GEX-MXR-Changed print co-ordinate
#define #x000_col_empl_type             96	  !AXL 2/14/2000-add !GEX-MXR-Changed print co-ordinate
#define #x000_col_MTD_401K	      	98       !GEX003-add !GEX-MXR-Changed print co-ordinate
#define #x000_col_MTD_Gross	      	113       !GEX003-add !GEX-MXR-Changed print co-ordinate
#define #x000_col_MTD_Hours	      	126       !GEX003-add !GEX-MXR-Changed print co-ordinate
#define #x000_col_YTD_401K	      	138       !GEX003-add !GEX-MXR-Changed print co-ordinate
#define #x000_col_YTD_Gross	      	152       !GEX003-add !GEX-MXR-Changed print co-ordinate
#define #x000_col_YTD_Hours	      	165       !GEX003-add !GEX-MXR-Changed print co-ordinate

!GEX-TLL 03/27/2008 HCM 9.0 Upgrade End



!line totals
#define #x000_col_totals_literal	4
#define #x000_col_totals_literal2	20
#define #x000_col_totals_literal3	30


!***********************************************************************
begin-heading 10
!***********************************************************************

 let $Company = rtrim($x000_Company,' ')

 #Include 'stdhdg01.sqc'

! CWB 03/14/2001 BEGIN
 do get-company-desc 
 let $x000_company_hdr = 'Company:    '|| $company || '  ' || $company_desc
 print $x000_company_hdr                (3,1) 
! CWB 03/14/2001 END

 let $x000_temp_out =  'Sorted by Company, Dept, UnionCD, Name' 
 print $x000_temp_out 			(3,) center 

! CWB 03/14/2001 BEGIN
 let $deptid = rtrim($x000_deptid,' ') 
 let $x000_deptid_hdr = 'Deptid:     '|| $deptid
 print $x000_deptid_hdr                 (4,1) 
! CWB 03/14/2001 END

 let $x000_temp_out =  'Report as of ' || $X000_REPORT_HEADING_ASOFDATE 
 print $x000_temp_out 	                (4,) center 

!line 1
 print 'Co'		(+2,{#x000_col_company})
 print 'Dept'       	(0,{#x000_col_deptid})
 print 'Union' 	      	(0,{#x000_col_union_cd})
 print 'Empl'	      	(0,{#x000_col_empl_status})
 print 'Hire'	      	(0,{#x000_col_hire_date})
 print 'Term'	      	(0,{#x000_col_termination_dt})
 print 'Birth'	      	(0,{#x000_col_birth_dt})
 print 'Name'      	(0,{#x000_col_name})	
 print 'Emplid'	      	(0,{#x000_col_emplid})
 print 'Hourly'         (0,{#x000_col_hourly_rt})
 Print 'H/'             (0,{#x000_col_empl_type})	 !AXL 2/14/2000-add	
 print '        MTD'   	(0,{#x000_col_MTD_401K})       
 print '     MTD'       (0,{#x000_col_MTD_Gross})         
 print '     MTD'  	(0,{#x000_col_MTD_Hours})     
 print '        YTD' 	(0,{#x000_col_YTD_401K})
 print '     YTD'       (0,{#x000_col_YTD_Gross})
 print '     YTD'    	(0,{#x000_col_YTD_Hours})

!line 2 
 print 'Code'	     	(+1,{#x000_col_union_cd})
 print 'Status'	     	(0,{#x000_col_empl_status})
 print 'Date'	     	(0,{#x000_col_hire_date})
 print 'Date'	     	(0,{#x000_col_termination_dt})
 print 'Date'	     	(0,{#x000_col_birth_dt})
 print '    Rt'        	(0,{#x000_col_hourly_rt})
 print 'S'              (0,{#x000_col_empl_type})	 !AXL 2/14/2000-add
 print '      401K/'   	(0,{#x000_col_MTD_401K})               !GEX003-chg
 print '   Gross'      	(0,{#x000_col_MTD_Gross})              !GEX003-chg
 print '   Hours'      	(0,{#x000_col_MTD_Hours})              !GEX003-chg
 print '      401K/'   	(0,{#x000_col_YTD_401K})               !GEX003-add
 print '   Gross'      	(0,{#x000_col_YTD_Gross})              !GEX003-add
 print '   Hours'      	(0,{#x000_col_YTD_Hours})              !GEX003-add

!line 3 
 print '     401KPB'   	(+1,{#x000_col_MTD_401K})
 print    '    Wage'   	(0,{#x000_col_MTD_Gross})             !GEX003-add
 print '     401KPB'   	(0,{#x000_col_YTD_401K}) 
 print    '    Wage'   	(0,{#x000_col_YTD_Gross})             !GEX003-add

end-heading

!***********************************************************************
begin-report
!***********************************************************************
#debug9 show 'begin-report'

  do Init-DateTime
  do Init-Number
  do Get-Current-DateTime
  show '$asoftoday=' $asoftoday 
 
  do StdAPI-Init
  do P010-Init-Variables

! SXC Begin. 04/27/2000.  Temp tbl creation
  do WT100-create-work-table
  do WT200-select-for-work-table
! SXC End.   04/27/2000  

  do P100-Get-Job-Data

! SXC Begin. 04/27/2000.  Drop Temp tbl
  do WT900-drop-work-table
! SXC End.   04/27/2000

  do StdAPI-Term
  do Reset

  show 'Successful End of Report'

end-report

!***********************************************************************
begin-procedure P010-Init-Variables
!***********************************************************************
#debug9 show 'P010-Init-Variables'

  do P012-Array-Initialization

  do Get-Calendar-Year-Id
  show '$Calendar_Year_Id=' $Calendar_Year_Id

  let $x000_new_page_flag = 'N'

  let $ReportID    = 'GEXPY094'
  let $ReportTitle = '401K & Census for Franchise'
  let $Country     = 'USA'

  show '$ReportID=' $ReportID 
  show '$ReportTitle=' $ReportTitle
  show '$ReportDate=' $ReportDate
  show '$ReportTime=' $ReportTime

  Let $GEXXX901_Company_Alias  = 'J.COMPANY'
  Let $GEXXX901_Paygroup_Alias = 'J.PAYGROUP'
  Let $GEXXX902_Deptid_Alias   = 'J.DEPTID'
  Let $GEXXX903_Emp_Stat_Alias = 'J.EMPL_STATUS'
  Let $GEXXX907_Div_CD_Alias   = 'GEX_DEPT.GEX_COMPANY_DIV_CD'
  Let $GEXXX909_Acct_CD_Alias  = 'J.ACCT_CD'

!RUN CONTROL LOGIC
  if $Prcs_Process_Instance = ''
    do GEXXX950-Input-Parameters
  else
!get parameters from single row run control record 
    do GEXXX922-Select-Parameters
    let $X000_WHERE_SELECT_MONTHEND_YEAREND_FLAG = $GEX_RC_PAY.GEX_MTH_YR_END_CD
    let $X000_WHERE_SELECT_ASOFDATE = $GEX_RC_PAY.ASOFDATE
    if rtrim($GEX_RC_PAY.ASOFDATE,' ') = ''
      let $X000_WHERE_SELECT_ASOFDATE = $asoftoday
    end-if

    do Format-DateTime($X000_WHERE_SELECT_ASOFDATE, $X000_REPORT_HEADING_ASOFDATE ,{DEFDATE}, '', '')
!get parameters from multiples run control record
    Let $GEXXX900_Company_Alias  = 'J.COMPANY'                           

    Do GEXXX900-Select-Company-Parameters 
    Do GEXXX901-Select-Company-Paygroup-Parameters
    Do GEXXX902-Select-Deptid-Parameters 
    Do GEXXX903-Select-Emp-Stat-Parameters
    Do GEXXX907-Select-DIV-CD-Parameters
    Do GEXXX907-Select-Div-CD-Parameters 
    Do GEXXX909-Select-ACCT-CD-Parameters
    !Do GEXXX909-Select-Acct-CD-Parameters !ISDVMXR changed to the correct procedure name
!SXK 10/28/1999 changed from emp.union_cd
    let $X000_ORDER_BY = 'J.COMPANY, J.DEPTID, J.UNION_CD, P.NAME'

    show '$Prcs_Process_Instance =' $Prcs_Process_Instance 
    show 'test'

  end-if

!default the selection date to today, if not entered by user
    if rtrim($X000_WHERE_SELECT_ASOFDATE, ' ' ) = ''
       let $X000_WHERE_SELECT_ASOFDATE = $asoftoday
    end-if

    do Format-DateTime($X000_WHERE_SELECT_ASOFDATE, $X000_REPORT_HEADING_ASOFDATE ,{DEFDATE}, '', '')

    show '$GEXXX907_INCLUDE_DIV_CD_CRITERIA                =' $GEXXX907_INCLUDE_DIV_CD_CRITERIA
    show '$GEXXX900_INCLUDE_COMPANY_CRITERIA               =' $GEXXX900_INCLUDE_COMPANY_CRITERIA
    show '$GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA      =' $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA   
    show '$GEXXX902_INCLUDE_DEPTID_CRITERIA                =' $GEXXX902_INCLUDE_DEPTID_CRITERIA
    show '$GEXXX903_INCLUDE_EMP_STAT_CRITERIA              =' $GEXXX903_INCLUDE_EMP_STAT_CRITERIA
    show '$GEXXX909_INCLUDE_ACCT_CD_CRITERIA               =' $GEXXX909_INCLUDE_ACCT_CD_CRITERIA         
    show '$X000_ORDER_BY                                   =' $X000_ORDER_BY
    show '$X000_WHERE_SELECT_ASOFDATE                      =' $X000_WHERE_SELECT_ASOFDATE 
    show '$X000_WHERE_SELECT_MONTHEND_YEAREND_FLAG         =' $X000_WHERE_SELECT_MONTHEND_YEAREND_FLAG

    print 'RUN CONTROL INFORMATION FOR THIS REPORT RUN:'        (+5,{#x000_col_selection_criteria_a})
    print '$Prcs_OPRID          ='                              (+1,{#x000_col_selection_criteria_b})
    print $Prcs_OPRID                                           (0,+2)
    print '$PRCS_RUN_CNTL_ID    ='                              (+1,{#x000_col_selection_criteria_b})
    print $PRCS_RUN_CNTL_ID                                     (0,+2)
    
    print 'SELECTION CRITERIA FOR THIS REPORT RUN:'             (+5,{#x000_col_selection_criteria_a})
    print '$GEXXX907_INCLUDE_DIV_CD_DISPLAY_CRITERIA           ='   (+1,{#x000_col_selection_criteria_b})
    print $GEXXX907_INCLUDE_DIV_CD_DISPLAY_CRITERIA 	    (0,+2)
    print '$GEXXX900_INCLUDE_COMPANY_DISPLAY_CRITERIA          ='   (+1,{#x000_col_selection_criteria_b})
    print $GEXXX900_INCLUDE_COMPANY_DISPLAY_CRITERIA            (0,+2)
    print '$GEXXX901_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA ='   (+1,{#x000_col_selection_criteria_b})
    print $GEXXX901_INCLUDE_COMPANY_PAYGROUP_DISPLAY_CRITERIA   (0,+2)
    print '$GEXXX902_INCLUDE_DEPTID_DISPLAY_CRITERIA           ='   (+1,{#x000_col_selection_criteria_b})
    print $GEXXX902_INCLUDE_DEPTID_DISPLAY_CRITERIA	            (0,+2)
    print '$GEXXX903_INCLUDE_EMP_STAT_DISPLAY_CRITERIA         ='   (+1,{#x000_col_selection_criteria_b})
    print $GEXXX903_INCLUDE_EMP_STAT_DISPLAY_CRITERIA           (0,+2)
    print '$GEXXX909_INCLUDE_ACCT_CD_DISPLAY_CRITERIA          ='   (+1,{#x000_col_selection_criteria_b})
    print $GEXXX909_INCLUDE_ACCT_CD_DISPLAY_CRITERIA            (0,+2)

    print '$X000_WHERE_SELECT_ASOFDATE                         ='   (+1,{#x000_col_selection_criteria_b})
    print $X000_WHERE_SELECT_ASOFDATE                           (0,+2)
    print '$X000_WHERE_SELECT_MONTHEND_YEAREND_FLAG            =' (+1,{#x000_col_selection_criteria_b})
    print $X000_WHERE_SELECT_MONTHEND_YEAREND_FLAG              (0,+2) 
   
    print 'SORT ORDER FOR THIS REPORT RUN:'                     (+5,{#x000_col_selection_criteria_a})
    print '$X000_ORDER_BY                                      ='   (+1,{#x000_col_selection_criteria_b})
    print $X000_ORDER_BY 	(0,+2)
  

    Let $GEXERNCD_Erncd_Alias = 'ERNCD'
    do Get-Non-Productive-Erncds 

 LET #PAGE-COUNT = 0
 NEW-PAGE
 LET #PAGE-COUNT = 1

end-procedure

!***********************************************************************
begin-procedure P012-Array-Initialization
!***********************************************************************
#debug9 show 'P012-Array-Initialization'

!TOTALS ARRAY *****************  Total Type *****************************
!                           (0)                (1)                   (2)	
!Level
!(0) Grand Total	MTD/YTD 401K	MTD/YTD Gross Wage	MTD/YTD Hours
!(1) Company		MTD/YTD 401K	MTD/YTD Gross Wage	MTD/YTD Hours
!(2) Deptid		MTD/YTD 401K	MTD/YTD Gross Wage	MTD/YTD Hours
!(3) Union Cd		MTD/YTD 401K	MTD/YTD Gross Wage	MTD/YTD Hours
	 
  create-array name=Total-Array size=4 -
    field=TotalName:char 
    field=total:number:4
    field=total_ytd:number:4	                                  !**GEX003-add

  put 'Grand Total'      into Total-Array(0) TotalName
  put 'Company Total'    into Total-Array(1) TotalName
  put 'Deptid'		 into Total-Array(2) TotalName
  put 'Union Cd'         into Total-Array(3) TotalName
 
end-procedure


!***********************************************************************
begin-procedure P015-get-input
!***********************************************************************
#debug9 show 'P015-get-input'

!must have been submitted via SQRW
	let $GEXXX907_INCLUDE_DIV_CD_CRITERIA          	= '1=1'           
	let $GEXXX900_INCLUDE_COMPANY_CRITERIA 		= '1=1'
	let $GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA = '1=1' 
	let $GEXXX902_INCLUDE_DEPTID_CRITERIA		= '1=1'
	let $GEXXX903_INCLUDE_EMP_STAT_CRITERIA 	= '1=1'
	let $GEXXX904_INCLUDE_GRADE_CRITERIA 		= '1=1'		  
	let $GEXXX905_INCLUDE_HRLY_RT_CRITERIA 		= '1=1'
	let $GEXXX906_INCLUDE_WKLY_SAL_CRITERIA         = '1=1'
	let $GEXXX908_INCLUDE_SAL_ADMIN_PLAN_CRITERIA 	= '1=1'
	let $GEXXX909_INCLUDE_ACCT_CD_CRITERIA          = '1=1'
      	let $GEXXX952_INCLUDE_DIV_CD_DEPTID_DISPLAY_CRITERIA = '1=1'
      	let $X000_WHERE_SELECT_ASOFDATE                 = $asoftoday
      	let $X000_WHERE_SELECT_MONTHEND_YEAREND_FLAG = 'M' 
!SXK 10/28/1999 Changed from emp.union_cd
      	let $X000_ORDER_BY = 'J.COMPANY, J.DEPTID, J.UNION_CD, P.NAME'
end-procedure

!**********************************************************************
! SXC 04/27/2000 - Begin
!******************************************
begin-procedure WT100-create-work-table
!******************************************
#debug9 show 'WT100-create-work-table'

 Let $tablename = 'PS_WT_GEXPY094'

begin-sql 
CREATE TABLE [$tablename] 
       (COMPANY		VARCHAR2(3)		NOT NULL,			
	DEPTID		VARCHAR2(10)		NOT NULL,
	UNION_CD	VARCHAR2(3)		NOT NULL,
	EMPLID		VARCHAR2(11)		NOT NULL,
	EMPL_RCD	NUMBER(38)		NOT NULL,
	EFFDT		DATE 			NOT NULL,
	EFFSEQ		NUMBER(38)		NOT NULL,
	EMPL_STATUS	VARCHAR2(1)		NOT NULL,
	ACTION		VARCHAR2(3)		NOT NULL,
	ACTION_REASON	VARCHAR2(3)		NOT NULL,
	JOBCODE		VARCHAR2(6)		NOT NULL,
	REG_TEMP	VARCHAR2(1)		NOT NULL,
	paygroup	VARCHAR2(3)		NOT NULL,
	cobra_action	VARCHAR2(3)		NOT NULL,
	HOURLY_RT	NUMBER(18,6)		NOT NULL,
        empl_type	VARCHAR2(1)		NOT NULL,
	NAME		VARCHAR2(50)		NOT NULL,
	ORIG_HIRE_DT	DATE,
	BIRTHDATE	DATE			NOT NULL,
	SEX		VARCHAR2(1)		NOT NULL,
	ADDRESS1	VARCHAR2(55)		NOT NULL,	
	ADDRESS2	VARCHAR2(55)		NOT NULL,		
	CITY		VARCHAR2(30)		NOT NULL,
	STATE		VARCHAR2(6)		NOT NULL,
	postal		VARCHAR2(10)		NOT NULL,
	PAY_END_DT	DATE			NOT NULL,
	BALANCE_YEAR	NUMBER(38)		NOT NULL,
	BALANCE_QTR	NUMBER(38)		NOT NULL,
	BALANCE_PERIOD	NUMBER(38)		NOT NULL,
	HIRE_DT		DATE,
	TERMINATION_DT	DATE,
	BENEFIT_RCD_NBR	NUMBER(38)		NOT NULL,
	GEX_DEPTID	VARCHAR2(10)		NOT NULL,
	GEX_EFFDT	DATE			NOT NULL,
	GEX_SEQUENCE_NUMBER NUMBER(38)		NOT NULL,
	GEX_COMPANY_DIV_CD	VARCHAR2(3)	NOT NULL)
 
        TABLESPACE TE7TOOLS001

End-Sql
End-Procedure

!********************************************
begin-procedure WT200-select-for-work-table
!********************************************
#debug9 show 'WT200-select-for-work-table'


begin-SELECT 

J.COMPANY		
J.DEPTID	
!SXK 10/28/1999 Changed from emp.union_cd
J.UNION_CD	
		
J.EMPLID
J.EMPL_RCD
J.EFFDT
J.EFFSEQ
J.EMPL_STATUS
J.ACTION
J.ACTION_REASON
J.JOBCODE
J.REG_TEMP
J.paygroup
J.cobra_action
J.HOURLY_RT
J.empl_type               ! AXL 2/14/2000 Add
to_char(J.LAST_DATE_WORKED,'YYYY-MM-DD') &j.last_date_worked        !SRK 02/25/2003 Add

P.NAME
!P.ORIG_HIRE_DT   !SXD   08/22/2007   
INST.ORIG_HIRE_DT
P.BIRTHDATE
P.SEX
P.ADDRESS1
P.ADDRESS2
P.CITY
P.STATE
P.postal

PCB.PAY_END_DT
PCB.BALANCE_YEAR
PCB.BALANCE_QTR
PCB.BALANCE_PERIOD
EMP.HIRE_DT
EMP.TERMINATION_DT
EMP.BENEFIT_RCD_NBR

GEX_DEPT.DEPTID
GEX_DEPT.EFFDT
GEX_DEPT.SEQUENCE_NUMBER
GEX_DEPT.GEX_COMPANY_DIV_CD
  
  if (&J.COMPANY = $hold_company) and (&J.EMPLID = $hold_emplid) 
  else
  
    !SRK 02/25/2003 Added this logic so when employee gets rehired but this report still has to print
    !the previous term row, it will get the correct termination_dt since employment will not hold
    !termination date any more since the employee is active
  
    let $term_date = ''
    let $hire_date = ''
    if (&j.empl_status = 'A') or (&j.empl_Status = 'L') or (&j.empl_status = 'P') or (&j.empl_Status = 'S')
       let $term_date = &emp.termination_dt
       let $hire_date = &emp.hire_dt
    else
          let $latest_job = 'Y'
          do check-if-this-is-latest-job
          if $latest_job = 'Y'
             let $term_date = &emp.termination_dt
             let $hire_date = &emp.hire_dt
          else
             do dtu-add-days(&j.last_date_worked,1,$term_date_dtu)
             do convert-from-dtu-date($term_date_Dtu,$term_date)
             do select-this-term-hire-date
             let $hire_date = &tx.effdt
          end-if
    end-if
                     
    do WT250-insert-into-work-table
  end-if

  let $hold_company = &J.COMPANY
  let $hold_emplid  = &J.EMPLID

FROM  PS_JOB          	J,
      PS_PERSONAL_DATA 	P,
      PS_PAY_CAL_BAL_ID	PCB,
      PS_EMPLOYMENT 	EMP,
      !PS_GEX_DEPT_TBL   GEX_DEPT
      PS_GEX_DEPT_TBL   GEX_DEPT,
      PS_PER_ORG_INST INST

WHERE P.EMPLID = J.EMPLID
!SXD  08/22/2007  Begin
 AND  P.EMPLID = INST.EMPLID
 AND  INST.ORG_INSTANCE_ERN  = J.EMPL_RCD	!GEX-MXT added for PER_ORG_INST join	
!SXD  08/22/2007  End 
 AND [$GEXXX900_INCLUDE_COMPANY_CRITERIA]
 AND [$GEXXX901_INCLUDE_COMPANY_PAYGROUP_CRITERIA] 
 AND [$GEXXX902_INCLUDE_DEPTID_CRITERIA]
 AND [$GEXXX903_INCLUDE_EMP_STAT_CRITERIA]
 AND [$GEXXX909_INCLUDE_ACCT_CD_CRITERIA]
                  
  	AND J.EFFDT  =
    		(SELECT MAX(EFFDT)
       		FROM PS_JOB
      		WHERE EMPLID  = J.EMPLID
        		AND EMPL_RCD = J.EMPL_RCD
                        AND COMPANY = J.COMPANY !###
                        AND DEPTID = J.DEPTID   !###
        		AND EFFDT    <= $X000_WHERE_SELECT_ASOFDATE)
  	AND J.EFFSEQ =
    		(SELECT MAX(EFFSEQ)
       		FROM PS_JOB
      		WHERE EMPLID  = J.EMPLID
        		AND EMPL_RCD = J.EMPL_RCD
                        AND COMPANY = J.COMPANY !###
                        AND DEPTID = J.DEPTID   !### 
        		AND EFFDT     = J.EFFDT)
                  
	AND J.COMPANY = PCB.COMPANY 
	AND J.PAYGROUP = PCB.PAYGROUP
	AND PCB.PAY_END_DT = (SELECT MAX(PCB1.PAY_END_DT) FROM PS_PAY_CAL_BAL_ID PCB1
					WHERE PCB1.COMPANY = PCB.COMPANY  AND 
					PCB1.PAYGROUP = PCB.PAYGROUP      AND
                              PCB1.BALANCE_ID = PCB.BALANCE_ID  AND              !GEX003-add
					PCB1.PAY_END_DT <= $X000_WHERE_SELECT_ASOFDATE)
	AND PCB.BALANCE_ID = $Calendar_Year_Id !GEX-TLL 04/02/2008 Uncommented for HCM 9.0 Upgrade
	AND J.EMPLID	= EMP.EMPLID
	AND J.EMPL_RCD	= EMP.EMPL_RCD
                  
	AND J.DEPTID = GEX_DEPT.DEPTID 
                  
	AND [$GEXXX907_INCLUDE_DIV_CD_CRITERIA]
                  
	AND GEX_DEPT.EFFDT = (SELECT MAX(GEX_DEPT1.EFFDT) FROM PS_GEX_DEPT_TBL GEX_DEPT1
			WHERE GEX_DEPT1.DEPTID = GEX_DEPT.DEPTID AND
				GEX_DEPT1.EFFDT <= $X000_WHERE_SELECT_ASOFDATE) 
	AND GEX_DEPT.SEQUENCE_NUMBER = (SELECT MAX(GEX_DEPT2.SEQUENCE_NUMBER) FROM PS_GEX_DEPT_TBL GEX_DEPT2
			WHERE GEX_DEPT2.DEPTID = GEX_DEPT.DEPTID AND
				GEX_DEPT2.EFFDT = GEX_DEPT.EFFDT)
                  
ORDER BY J.COMPANY, J.EMPLID, J.EFFDT desc
					        
end-SELECT        
                  
End-Procedure     
!*********************************************
begin-procedure WT250-insert-into-work-table
!*********************************************
#debug9 show 'WT250-insert-into-work-table'
                  
Begin-SQL         
                  
Insert Into [$tablename]
   Values (&J.COMPANY,		
	&J.DEPTID,	    
	&J.UNION_CD,	  
	&J.EMPLID,      
	&J.EMPL_RCD,    
	&J.EFFDT,       
	&J.EFFSEQ,      
	&J.EMPL_STATUS, 
	&J.ACTION,      
	&J.ACTION_REASON,
	&J.JOBCODE,     
	&J.REG_TEMP,    
	&j.paygroup,    
	&j.cobra_action,
	&J.HOURLY_RT,   
	&j.empl_type,   
	&P.NAME,        
	!&P.ORIG_HIRE_DT,                !SXD      08/22/2007
	&INST.ORIG_HIRE_DT,
	&P.BIRTHDATE,   
	&P.SEX,         
	&P.ADDRESS1,    
	&P.ADDRESS2,    
	&P.CITY,        
	&P.STATE,       
	&P.postal,      
	&PCB.PAY_END_DT,
	&PCB.BALANCE_YEAR,
	&PCB.BALANCE_QTR,
	&PCB.BALANCE_PERIOD,
!	&EMP.HIRE_DT,                     SRK 02/25/03
        $hire_date,                       !SRK 02/25/2003 added this
!	&EMP.TERMINATION_DT,              SRK 02/25/2003
        $term_date,                       !SRK 02/25/2003 added this
	&EMP.BENEFIT_RCD_NBR,
	&GEX_DEPT.DEPTID,
	&GEX_DEPT.EFFDT,
	&GEX_DEPT.SEQUENCE_NUMBER,
	&GEX_DEPT.GEX_COMPANY_DIV_CD)
                  
End-SQL           
End-Procedure     
                  
! SXC 04/27/2000 - End
                  
!SRK 02/25/2003 Begin - To get this termination's corresponding
!hire row since employment has already lost this hire date because
!employee after this termination got hired again.
!***********************************************************************
Begin-Procedure select-this-term-hire-date
!***********************************************************************
#debug9 show 'Select-this-term-hire-date'
begin-select
tx.effdt

from ps_job tx
where tx.emplid = &j.emplid
and tx.empl_rcd = &j.empl_rcd
and tx.effdt = (select max(effdt)
                  from ps_job
                 where emplid = tx.emplid
                   and empl_Rcd = tx.empl_rcd
                   and action in ('HIR','REH')
                   and effdt <= &j.effdt)
and tx.effseq = (select max(effseq)
                   from ps_job
                  where emplid = tx.emplid
                    and empl_rcd = tx.empl_rcd
                    and effdt = tx.effdt)
end-select

end-procedure
!***********************************************************************
begin-procedure check-if-this-is-latest-job
!***********************************************************************
#debug9 show 'Check-if-this-is-latest-job'
begin-select
'x'
   let $latest_job = 'N'
from ps_job tx1
where tx1.emplid = &j.emplid
and tx1.empl_rcd = &j.empl_rcd
and ((tx1.effdt > &j.effdt) or
     (tx1.effdt = &j.effdt and tx1.effseq > &j.effseq))
end-select
end-procedure
!SRK 02/25/2003 End

!***********************************************************************
begin-procedure P100-Get-Job-Data
!***********************************************************************
#debug9 show 'P100-Get-Job-Data'
! JNB 02/09/1999 Address 3 is commented. Instead selected state and city

  let $x100_Get_Job_Data_Flag = 'N'

! SXC 04/27/2000 Begin - Modified the select to use the work table.

begin-SELECT 
!/*+ RULE */

WT.COMPANY	() on-break print=never after=P800-Company-After-Change print=never
	           before=P700-Company-Before-Change
		   level=01	
WT.DEPTID	() on-break print=never after=P850-Deptid-After-Change print=never
		   before=P750-Deptid-Before-Change								
		   level=02	
WT.UNION_CD	() on-break print=never after=P875-Union-Cd-After-Change print=never
		   before=P775-Union-Cd-Before-Change								
		   level=03
WT.EMPLID
WT.EMPL_RCD
WT.EFFDT
WT.EFFSEQ
WT.EMPL_STATUS
WT.ACTION
WT.ACTION_REASON
WT.JOBCODE
WT.REG_TEMP
WT.paygroup
WT.cobra_action
WT.EMPL_TYPE
WT.HOURLY_RT
WT.NAME
WT.ORIG_HIRE_DT
WT.BIRTHDATE
WT.SEX
WT.ADDRESS1
WT.ADDRESS2
WT.CITY
WT.STATE
WT.postal
WT.PAY_END_DT
WT.BALANCE_YEAR
WT.BALANCE_QTR
WT.BALANCE_PERIOD
WT.HIRE_DT
WT.TERMINATION_DT
WT.BENEFIT_RCD_NBR

  #debug7 show '******* JOB DATA **************'
  #debug7 show '&WT.COMPANY=' &WT.COMPANY
  #debug7 show '&WT.DEPTID=' &WT.DEPTID 
  #debug7 show '&WT.PAYGROUP=' &WT.PAYGROUP 
  #debug7 show '&WT.EMPLID=' &WT.EMPLID
  #debug7 show '&WT.EMPL_RCD=' &WT.EMPL_RCD
  #debug7 show '&WT.EFFDT=' &WT.EFFDT
  #debug7 show '&WT.EFFSEQ=' &WT.EFFSEQ
  #debug7 show '&WT.JOBCODE=' &WT.JOBCODE
  #debug7 show '&WT.cobra_action=' &WT.cobra_action
  #debug7 show '&WT.REG_TEMP=' &WT.REG_TEMP
  #debug7 show '&WT.HOURLY_RT=' &WT.HOURLY_RT
  #debug7 show '&WT.EMPL_STATUS=' &WT.EMPL_STATUS
  #debug7 show '&WT.ACTION_REASON=' &WT.ACTION_REASON
  #debug7 show '&WT.NAME=' &WT.NAME
  #debug7 show '&WT.ORIG_HIRE_DT=' &WT.ORIG_HIRE_DT
  #debug7 show '&WT.TERMINATION_DT=' &WT.TERMINATION_DT
  #debug7 show '&WT.UNION_CD=' &WT.UNION_CD           ! SXK 10/28/99 Changed from emp.union_cd
  #debug7 show '&WT.BENEFIT_RCD_NBR=' &WT.BENEFIT_RCD_NBR

! SXC 04/27/2000 Changed the following fields on the right hand side to retrieve values from
!                the work table (&WT).
 let #x200_balance_year = &WT.BALANCE_YEAR
 let #x200_balance_qtr = &WT.BALANCE_QTR
 let #x200_balance_period = &WT.BALANCE_PERIOD 
 let $x200_deptid = &WT.DEPTID
 let $x200_Union_Cd = &WT.UNION_CD
 let $x200_Name = &WT.NAME
 let $x200_Empl_Status = &WT.EMPL_STATUS
 let $x200_Action_Reason = &WT.ACTION_REASON
 let $x200_hire_date = &WT.HIRE_DT
 let $x200_Termination_Dt = &WT.TERMINATION_DT
 let $x200_Birthdate = &WT.BIRTHDATE
 let $x200_Orig_Hire_Dt = &WT.ORIG_HIRE_DT
 let $x200_Sex = &WT.SEX
 let $x200_Address1 = &WT.ADDRESS1
 let $x200_Address2 = &WT.ADDRESS2
!JNB 02/09/1999 Commented &WT.ADDRESS3 and used 
!let $x200_Address3 = &WT.ADDRESS3
 let $x200_Address3 = &WT.CITY || &WT.STATE
 let $x200_postal = &WT.postal
 let $x200_Emplid = &WT.EMPLID
 let $x100_JobCode = &WT.JOBCODE

 do P200-Get-Deduction-Bal					     	
 do P300-Get-Earnings-Bal
 do P400-Get-Hours-Bal     				          

!only print the detail if a balance row was found for the employee   	!GEX003-add
 if $P200_Get_Deduction_Bal_Flag = 'Y' or                            	!GEX003-add
    $P300_Get_Earnings_Bal_Flag = 'Y' or                             	!GEX003-add
    $P400_Get_Hours_Bal_flag = 'Y'

    let $one_row_found = 'Y'  ! SXC 05/15/2000

  ! following line commented by SXC 05/15/2000
  ! let $x100_At_Least_One_Selected_For_CO_DEPT_UNION_Flag = 'Y'   	!GEX003-add

    let $x100_Get_Job_Data_Flag = 'Y'                              	!GEX003-moved
    do P900-Get-Job-Code-Info

!SRK 02/25/2003 Added this to print always if empl is active otherwise
!check ytd balances 

    evaluate &WT.EMPL_STATUS
      when = 'A'
      when = 'L'
      when = 'P'
      when = 'S'
         do P600-Write-Detail-Report-Line
      when-other
	if (#x205_ded_ytd > 0) or
	   (#x205_ded_401kpb_ytd > 0) or
           (#x305_grs_ytd > 0) or
	   (#x405_hrs_ytd > 0)
              do P600-Write-Detail-Report-Line
        end-if
     end-evaluate
     
 end-if 

! SXC 05/15/2000 begin
 if $one_row_found = 'Y'
    let $x100_At_Least_One_Selected_For_CO_DEPT_UNION_Flag = 'Y'
 end-if
! SXC 05/15/2000 end                                                          

FROM  [$tablename] WT

ORDER BY WT.COMPANY, WT.DEPTID, WT.UNION_CD, WT.NAME
					
end-SELECT

 if $x100_Get_Job_Data_Flag = 'N'
  print 'NO DATA SELECTED FOR THIS REPORT RUN'	(25,) CENTER
 else
  print 'Grand' 	  (+2,{#x000_col_totals_literal})
  let $x000_out = 'Total'
  print $x000_out  	  (0,{#x000_col_totals_literal3})
		
!get and print grand  401K totals
  get #x000_MTD_xxx from Total-Array(0) Total(0)                	!GEX003-chg
  get #x000_mtd_401kpb_xxx from total-array(0) total(1)
  get #x000_YTD_xxx from Total-Array(0) Total_YTD(0)            	!GEX003-add
  get #x000_ytd_401kpb_xxx from total-array(0) total_YTD(1)     	!AXL-5/28/1999-chg

  let #x000_temp_col = {#x000_col_MTD_401K} - 1                 	!GEX003-chg
  print #x000_MTD_xxx (0,#x000_temp_col) EDIT 9,999,990.00      	!GEX003-chg
  print #x000_mtd_401kpb_xxx (+1,#x000_temp_col) edit 9,999,990.00
  let #x000_temp_col = {#x000_col_YTD_401K} - 1                 	!GEX003-add
  print #x000_YTD_xxx (-1,#x000_temp_col) EDIT 9,999,990.00      	!GEX003-add
  print #x000_ytd_401kpb_xxx (+1,#x000_temp_col) edit 9,999,990.00
     

!get and print Grand  GROSS totals
  get #x000_MTD_xxx from Total-Array(0) Total(2)                	!GEX003-chg
  get #x000_YTD_xxx from Total-Array(0) Total_YTD(2)            	!GEX003-add

  let #x000_temp_col = {#x000_col_MTD_Gross} - 1                	!GEX003-chg
  print #x000_MTD_xxx (-1,#x000_temp_col) EDIT 9,999,990.00      	!GEX003-chg
  let #x000_temp_col = {#x000_col_YTD_Gross} - 2                	!GEX003-add
  print #x000_YTD_xxx (0,#x000_temp_col) EDIT 99,999,990.00      	!GEX003-add

!get and print Grand  HOURS totals
  get #x000_MTD_xxx from Total-Array(0) Total(3)                	!GEX003-chg
  get #x000_YTD_xxx from Total-Array(0) Total_YTD(3)            	!gex003-add      
 
  let #x000_temp_col = {#x000_col_MTD_Hours} - 1                 	!GEX003-chg
  print #x000_MTD_xxx (0,#x000_temp_col) EDIT 9,999,990.00      	!GEX003-chg
  let #x000_temp_col = {#x000_col_YTD_Hours} - 1                	!GEX003-add
  print #x000_YTD_xxx (0,#x000_temp_col) EDIT 9,999,990.00      	!GEX003-add

!reinitialize the company array totals
  put 0 0 into Total-Array(0) Total(0) total_ytd(0)              	!GEX003-chg
  put 0 0 into Total-Array(0) Total(1) total_ytd(1)              	!GEX003-chg
  put 0 0 into Total-Array(0) Total(2) total_ytd(2)              	!GEX003-chg
  put 0 0 into Total-Array(0) Total(3) total_ytd(3)
 end-if

end-procedure
! SXC 04/27/2000 End - Modified the select to use the work table

!***********************************************************************
! SXC 04/27/2000 Changed the where clause to point to the Work table (&WT).
begin-procedure P200-Get-Deduction-Bal
!***********************************************************************
#debug9 show 'P200-Get-Deduction-Bal'

 let $P200_Get_Deduction_Bal_Flag = 'N'

 let #x200_ded_mtd = 0
 let #x200_ded_401kpb_mtd = 0

 let #x205_ded_ytd = 0
 let #x205_ded_401kpb_ytd = 0

begin-SELECT
!/*+ RULE */

DEDBAL.EMPLID
DEDBAL.COMPANY 
DEDBAL.BALANCE_ID
DEDBAL.BALANCE_YEAR  
DEDBAL.BALANCE_QTR  
DEDBAL.BALANCE_PERIOD
DEDBAL.PLAN_TYPE   
DEDBAL.BENEFIT_PLAN    
DEDBAL.DEDCD    
DEDBAL.DED_CLASS             
DEDBAL.DED_MTD
DEDBAL.DED_YTD
   
  if &DEDBAL.BALANCE_PERIOD = &PCB.BALANCE_PERIOD  !ISDVDZk added the new deduction codes as per the S3 13749826 start
   if ((&DEDBAL.DEDCD =  '401KAT') or
       (&DEDBAL.DEDCD =  '401KCU') or
       (&DEDBAL.DEDCD =  '401KDF') or
       (&DEDBAL.DEDCD =  '401RTH') or
       (&DEDBAL.DEDCD =  '4AGEDW') or  
       (&DEDBAL.DEDCD =  '4AMFUD') or	
       (&DEDBAL.DEDCD =  '4BBRUN') or
       (&DEDBAL.DEDCD =  '4CBTRA') or
       (&DEDBAL.DEDCD =  '4HART')  or
       (&DEDBAL.DEDCD =  '4INGAE') or
       (&DEDBAL.DEDCD =  '4MACWH') or
       (&DEDBAL.DEDCD =  '4MANUL') or
       (&DEDBAL.DEDCD =  '4MERR2')  or
       (&DEDBAL.DEDCD =  '4PPSFI')) 	!ISDVDZk added the new deduction codes as per the S3 13749826 end
     let #x200_ded_401kpb_mtd = #x200_ded_401kpb_mtd + &DEDBAL.DED_MTD
     
   else
     let #x200_ded_mtd = #x200_ded_mtd + &DEDBAL.DED_MTD
   end-if
  end-if 
  !ISDVDZk added the new deduction codes as per the S3 13749826 start
 if ((&DEDBAL.DEDCD =  '401KAT') or
       (&DEDBAL.DEDCD =  '401KCU') or
       (&DEDBAL.DEDCD =  '401KDF') or
       (&DEDBAL.DEDCD =  '401RTH') or
       (&DEDBAL.DEDCD =  '4AGEDW') or  
       (&DEDBAL.DEDCD =  '4AMFUD') or	
       (&DEDBAL.DEDCD =  '4BBRUN') or
       (&DEDBAL.DEDCD =  '4CBTRA') or
       (&DEDBAL.DEDCD =  '4HART')  or
       (&DEDBAL.DEDCD =  '4INGAE') or
       (&DEDBAL.DEDCD =  '4MACWH') or
       (&DEDBAL.DEDCD =  '4MANUL') or
       (&DEDBAL.DEDCD =  '4MERR2')  or
       (&DEDBAL.DEDCD =  '4PPSFI')) 	!ISDVSRC 06/01/2006 - ADD
       !ISDVDZk added the new deduction codes as per the S3 13749826 End 
    let #x205_ded_401kpb_ytd = #x205_ded_401kpb_ytd + &DEDBAL.DED_YTD
 else
    let #x205_ded_ytd = #x205_ded_ytd + &DEDBAL.DED_YTD
 end-if
 
 let $P200_Get_Deduction_Bal_Flag = 'Y'

#DEBUG7 show '********** DEDUCTION MTD BALANCE DATA ****************'

 #DEBUG7 show 'DEDBAL.EMPLID           =' &DEDBAL.EMPLID
 #DEBUG7 show 'DEDBAL.COMPANY          =' &DEDBAL.COMPANY 
 #DEBUG7 show 'DEDBAL.BALANCE_ID       =' &DEDBAL.BALANCE_ID
 #DEBUG7 show 'DEDBAL.BALANCE_YEAR     =' &DEDBAL.BALANCE_YEAR  
 #DEBUG7 show 'DEDBAL.BALANCE_YEAR     =' &DEDBAL.BALANCE_QTR  
 #DEBUG7 show 'DEDBAL.BALANCE_PERIOD   =' &DEDBAL.BALANCE_PERIOD  
 #DEBUG7 show 'DEDBAL.PLAN_TYPE        =' &DEDBAL.PLAN_TYPE  
 #DEBUG7 show 'DEDBAL.BENEFIT_PLAN     =' &DEDBAL.BENEFIT_PLAN     
 #DEBUG7 show 'DEDBAL.DEDCD            =' &DEDBAL.DEDCD     
 #DEBUG7 show 'DEDBAL.DED_CLASS        =' &DEDBAL.DED_CLASS     
 #DEBUG7 show 'DEDBAL.DED_MTD          =' &DEDBAL.DED_MTD
 #DEBUG7 show 'DEDBAL.DED_YTD          =' &DEDBAL.DED_YTD
 #debug7 show '#x200_ded_mtd           =' #x200_ded_mtd
 #debug7 show '#x200_ded_ytd           =' #x200_ded_ytd

FROM  PS_DEDUCTION_BAL DEDBAL

WHERE DEDBAL.EMPLID         = &WT.EmplID
  AND DEDBAL.COMPANY        = &WT.Company
  AND DEDBAL.BALANCE_ID     = $Calendar_Year_Id 
  AND DEDBAL.BALANCE_YEAR   = &WT.BALANCE_YEAR  
  AND DEDBAL.PLAN_TYPE      = '00'   	
! 09/18/2000 - AXL - Begin		
! AND DEDBAL.DEDCD          LIKE   '4%'   
  AND (DEDBAL.DEDCD LIKE   '4%' or DEDBAL.DEDCD LIKE   'LOAN0%')
! 09/18/2000 - AXL - End
  AND DEDBAL.BALANCE_PERIOD =                         
    (SELECT MAX(DEDBAL1.BALANCE_PERIOD)
       FROM PS_DEDUCTION_BAL DEDBAL1
      WHERE DEDBAL1.EMPLID        = DEDBAL.EMPLID
        AND DEDBAL1.COMPANY       = DEDBAL.COMPANY
        AND DEDBAL1.BALANCE_ID    = DEDBAL.BALANCE_ID
        AND DEDBAL1.BALANCE_YEAR  = DEDBAL.BALANCE_YEAR
        AND DEDBAL1.PLAN_TYPE     = '00'   			!GEX003-add
! 01/04/2000 - JDH - BEGIN
!       AND DEDBAL1.DEDCD         LIKE   '4%'
        AND DEDBAL1.DEDCD         LIKE   DEDBAL.DEDCD
! 01/04/2000 - JDH - END
        AND DEDBAL1.DED_CLASS     = DEDBAL.DED_CLASS
        AND DEDBAL1.BALANCE_PERIOD <= &WT.BALANCE_PERIOD) 
 
end-SELECT 

end-procedure

!***********************************************************************
! SXC 04/27/2000 Changed the where clause to point to the Work table (&WT).
begin-procedure P300-Get-Earnings-Bal
!***********************************************************************
#debug9 show 'P300-Get-Earnings-Bal'

 let $P300_Get_Earnings_Bal_Flag = 'N' 

 let #x300_grs_mtd = 0
 let #x305_grs_ytd = 0

begin-SELECT
!/*+ RULE */

EB.EMPLID
EB.COMPANY
EB.BALANCE_ID 
EB.BALANCE_YEAR 
EB.BALANCE_QTR 
EB.BALANCE_PERIOD 
EB.SPCL_BALANCE
EB.ERNCD   
EB.GRS_MTD
EB.GRS_YTD

 if &EB.BALANCE_PERIOD = &PCB.BALANCE_PERIOD 
   let #x300_grs_mtd = #x300_grs_mtd + &EB.GRS_MTD            
 end-if
 let #x305_grs_ytd = #x305_grs_ytd + &EB.GRS_YTD
 
 let $P300_Get_Earnings_Bal_Flag = 'Y'

#DEBUG7 show '********** EARNINGS BALANCE DATA ****************'

 #DEBUG7 show 'EB.EMPLID=' &EB.EMPLID
 #DEBUG7 show 'EB.COMPANY=' &EB.COMPANY
 #DEBUG7 show 'EB.BALANCE_ID=' &EB.BALANCE_ID 
 #DEBUG7 show 'EB.BALANCE_YEAR=' &EB.BALANCE_YEAR 
 #DEBUG7 show 'EB.BALANCE_YEAR=' &EB.BALANCE_QTR  
 #DEBUG7 show 'EB.BALANCE_PERIOD=' &EB.BALANCE_PERIOD 
 #debug7 show 'WT.BALANCE_PERIOD= ' &PCB.BALANCE_PERIOD  
 #DEBUG7 show 'EB.SPCL_BALANCE=' &EB.SPCL_BALANCE
 #DEBUG7 show 'EB.ERNCD=' &EB.ERNCD   
 #DEBUG7 show 'EB.GRS_MTD=' &EB.GRS_MTD   
 #DEBUG7 show 'EB.GRS_YTD=' &EB.GRS_YTD   
 #debug7 show '#x300_grs_mtd= ' #x300_grs_mtd
 #debug7 show '#x300_grs_ytd= ' #x300_grs_ytd

FROM  PS_EARNINGS_BAL EB

WHERE EB.EMPLID         = &WT.EmplID
  AND EB.COMPANY        = &WT.Company

  AND EB.SPCL_BALANCE   = 'N'
  AND EB.BALANCE_ID     = $Calendar_Year_Id
  AND EB.BALANCE_YEAR   = &WT.BALANCE_YEAR 
!SRK 02/20/2003 as the procedure here is summing up values, we do not need to specify empl_rcd here
!SRK 02/27/2002 Debbie told Cindy that we have to report the balances for that job only, not to 
!roll up even though employee has two jobs in the same company
  And eb.empl_rcd       = &WT.empl_rcd
  AND EB.BALANCE_PERIOD = 
      (SELECT MAX(EB1.BALANCE_PERIOD)
       FROM   PS_EARNINGS_BAL EB1
       WHERE  EB1.EMPLID        = EB.EmplID
         AND  EB1.COMPANY       = EB.Company
         AND  EB1.ERNCD         = EB.ERNCD
         AND  EB1.SPCL_BALANCE  = EB.SPCL_BALANCE
         AND  EB1.BALANCE_ID    = EB.BALANCE_ID
         AND  EB1.BALANCE_YEAR  = EB.BALANCE_YEAR
         And  eb1.empl_rcd      = EB.empl_rcd
         AND  EB1.BALANCE_PERIOD <= &WT.BALANCE_PERIOD)
  AND [$GEXERNCD_EXCLUDE_ERNCD_CRITERIA]

end-SELECT
end-procedure 

! JNB  02/17/99
!***********************************************************************
! SXC 04/27/2000 Changed the where clause to point to the Work table (&WT).
begin-procedure P400-Get-Hours-Bal
!***********************************************************************
#debug9 show 'P400-Get-Hours-Bal'

 let $P400_Get_Hours_Bal_Flag = 'N' 
      
 let #x400_hrs_mtd = 0
 let #x405_hrs_ytd = 0

begin-SELECT
!/*+ RULE */

EBH.EMPLID
EBH.COMPANY
EBH.BALANCE_ID 
EBH.BALANCE_YEAR 
EBH.BALANCE_QTR 
EBH.BALANCE_PERIOD 
EBH.SPCL_BALANCE
EBH.ERNCD   
EBH.HRS_MTD
EBH.HRS_YTD

#DEBUG7 show '********** EARNINGS BALANCE DATA ****************'

 #DEBUG7 show 'EBH.EMPLID=' &EBH.EMPLID
 #DEBUG7 show 'EBH.COMPANY=' &EBH.COMPANY
 #DEBUG7 show 'EBH.BALANCE_ID=' &EBH.BALANCE_ID 
 #DEBUG7 show 'EBH.BALANCE_YEAR=' &EBH.BALANCE_YEAR 
 #DEBUG7 show 'EBH.BALANCE_YEAR=' &EBH.BALANCE_QTR  
 #DEBUG7 show 'EBH.BALANCE_PERIOD=' &EBH.BALANCE_PERIOD 
 #debug7 show 'wt.BALANCE_PERIOD= ' &PCB.BALANCE_PERIOD 
 #DEBUG7 show 'EBH.SPCL_BALANCE=' &EBH.SPCL_BALANCE
 #DEBUG7 show 'EBH.ERNCD=' &EBH.ERNCD   
 #DEBUG7 show 'EBH.BALANCE_PERIOD=' &EBH.BALANCE_PERIOD
 #DEBUG7 show 'EBH.HRS_MTD=' &EBH.HRS_MTD
 #DEBUG7 show 'EBH.HRS_YTD=' &EBH.HRS_YTD
 
 if &EBH.BALANCE_PERIOD = &PCB.BALANCE_PERIOD    
  let #x400_hrs_mtd = #x400_hrs_mtd + &EBH.HRS_MTD            
 end-if
 let #x405_hrs_ytd = #x405_hrs_ytd + &EBH.HRS_YTD 
 
 let $P400_Get_Hours_Bal_Flag = 'Y'

FROM  PS_EARNINGS_BAL EBH
WHERE EBH.EMPLID         = &WT.EmplID
  AND EBH.COMPANY        = &WT.Company
  AND EBH.SPCL_BALANCE   = 'N'
  AND EBH.BALANCE_ID     = $Calendar_Year_Id
!SRK 02/20/2003 as the procedure above is summing up values, we don't need to use empl_rcd
!SRK 02/27/2002 Debbie told Cindy that we have to report the balances for that job only, not to 
!roll up even though employee has two jobs in the same company
  And EBH.empl_rcd	 = &WT.empl_rcd
  AND EBH.BALANCE_YEAR   = &WT.BALANCE_YEAR 
  AND  ((EBH.ERNCD BETWEEN '001' AND '499') OR
                !EBH.ERNCD IN ('REG' , 'OTP')) 
                EBH.ERNCD IN ('REG' , 'OTP','173'))  !GEX-TLL 07/09/2008 ITG #51358 Erncd=173 Added
  AND EBH.BALANCE_PERIOD =                   
      (SELECT MAX(EBH1.BALANCE_PERIOD)
       FROM   PS_EARNINGS_BAL EBH1
       WHERE  EBH1.EMPLID        = EBH.EmplID
         AND  EBH1.COMPANY       = EBH.Company
         AND  EBH1.ERNCD         = EBH.ERNCD
         AND  EBH1.SPCL_BALANCE  = EBH.SPCL_BALANCE
         AND  EBH1.BALANCE_ID    = EBH.BALANCE_ID
         AND  EBH1.BALANCE_YEAR  = EBH.BALANCE_YEAR
         And  EBH1.empl_rcd	 = EBH.empl_rcd
         AND  ((EBH1.ERNCD BETWEEN '001' AND '499') OR
                !EBH1.ERNCD IN ('REG' , 'OTP'))
                EBH1.ERNCD IN ('REG' , 'OTP','173'))  !GEX-TLL 07/09/2008 ITG #51358 Erncd=173 Added
         AND  EBH1.BALANCE_PERIOD <= &WT.BALANCE_PERIOD)

end-SELECT
end-procedure 

!***********************************************************************
! SXC 04/27/2000 Changed some fields to print from the work table (&WT)
begin-procedure P600-Write-Detail-Report-Line
!***********************************************************************
#debug9 show  'P600-Write-Detail-Report-Line'

 print &WT.COMPANY			(+1,{#x000_col_company})
 print &WT.DEPTID			(0,{#x000_col_deptid})
!SXK 10/28/1999 changed from emp.union_Cd
 print &WT.UNION_CD		(0,{#x000_col_union_cd})
 print &WT.EMPL_STATUS		(0,{#x000_col_empl_status})

 !do Format-DateTime(&WT.HIRE_DT, $x600_hire_DT,{DEFDATE}, '', '') !AXL-2/14/2000-mod  !GEX-AXG Commented for upgarde 9.0 on 15/10/2007
 Let $x600_hire_DT = edit(&WT.HIRE_DT,'mm/dd/yy')	!GEX-AXG Added for upgarde 9.0 on 15/10/2007
 print $x600_hire_dt (0,{#x000_col_hire_date})
 !do Format-DateTime(&WT.TERMINATION_DT, $x600_TERMINATION_DT,{DEFDATE}, '', '')  !GEX-AXG Commented for upgarde 9.0 on 15/10/2007
 Let $x600_TERMINATION_DT = edit(&WT.TERMINATION_DT,'mm/dd/yy')	!GEX-AXG Added for upgarde 9.0 on 15/10/2007
 print $x600_TERMINATION_DT	(0,{#x000_col_termination_dt})
 !do Format-DateTime(&WT.BIRTHDATE, $x600_BIRTHDATE,{DEFDATE}, '', '') !GEX-AXG Commented for upgarde 9.0 on 15/10/2007
 Let $x600_BIRTHDATE = edit(&WT.BIRTHDATE,'mm/dd/yy')	!GEX-AXG Added for upgarde 9.0 on 15/10/2007
 print $x600_BIRTHDATE		(0,{#x000_col_birth_dt})
 print &WT.NAME       		(0,{#x000_col_name},30)
 print &WT.EMPLID         	(0,{#x000_col_emplid})
 print &WT.HOURLY_RT		(0,{#x000_col_hourly_rt})     EDIT  990.00	!GEX003-chg
 print &WT.EMPL_TYPE		(0,{#x000_col_empl_type})	!AXL-2/14/2000-add

 print  #x200_ded_mtd   	(0,{#x000_col_MTD_401K})  EDIT 9999,990.00    	!GEX003-chg
 print  #x200_ded_401kpb_mtd  	(+1,{#x000_col_mtd_401k})  EDIT 9999,990.00  
 print  #x300_grs_mtd 		(-1,{#x000_col_MTD_Gross}) EDIT 9999,990.00    	!GEX003-chg
 print  #x400_hrs_mtd 		(0,{#x000_col_MTD_Hours}) EDIT 9999,990.00    	!GEX003-chg

 print  #x205_ded_ytd   	(0,{#x000_col_YTD_401K})  EDIT 9999,990.00    	!GEX003-add
 print  #x205_ded_401kpb_ytd  	(+1,{#x000_col_ytd_401k})  EDIT 9999,990.00    
 print  #x305_grs_ytd 		(-1,{#x000_col_YTD_Gross}) EDIT 9999,990.00    	!GEX003-add
 print  #x405_hrs_ytd 		(0,{#x000_col_YTD_Hours}) EDIT 9999,990.00    	!GEX003-add

!add to Union_Cd totals
 array-add #x200_ded_mtd to Total-Array(3) Total(0) 
 array-add #x205_ded_ytd to Total-Array(3) Total_YTD(0)          !GEX003-add 

 array-add #x200_ded_401kpb_mtd to total-array(3) total(1)
 array-add #x205_ded_401kpb_ytd to total-array(3) total_ytd(1)

 array-add #x300_grs_mtd to Total-Array(3) Total(2)    
 array-add #x305_grs_ytd to Total-Array(3) Total_YTD(2)          !GEX003-add      
   
 array-add #x400_hrs_mtd to Total-Array(3) Total(3)         
 array-add #x405_hrs_ytd to Total-Array(3) Total_YTD(3)          !GEX003-add
 
!add to Deptid totals
 array-add #x200_ded_mtd to Total-Array(2) Total(0) 
 array-add #x205_ded_ytd to Total-Array(2) Total_YTD(0)          !GEX003-add 
 
 array-add #x200_ded_401kpb_mtd to total-array(2) total(1)
 array-add #x205_ded_401kpb_ytd to total-array(2) total_ytd(1)

 array-add #x300_grs_mtd to Total-Array(2) Total(2)   
 array-add #x305_grs_ytd to Total-Array(2) Total_YTD(2)          !GEX003-add
      
 array-add #x400_hrs_mtd to Total-Array(2) Total(3) 
 array-add #x405_hrs_ytd to Total-Array(2) Total_YTD(3)          !GEX003-add
 
!add to Company totals
 array-add #x200_ded_mtd to Total-Array(1) Total(0)
 array-add #x205_ded_ytd to Total-Array(1) Total_YTD(0)          !GEX003-add 

 array-add #x200_ded_401kpb_mtd to total-array(1) total(1) 
 array-add #x205_ded_401kpb_ytd to total-array(1) total_ytd(1) 

 array-add #x300_grs_mtd to Total-Array(1) Total(2)      
 array-add #x305_grs_ytd to Total-Array(1) Total_YTD(2)          !GEX003-add

 array-add #x400_hrs_mtd to Total-Array(1) Total(3)         
 array-add #x405_hrs_ytd to Total-Array(1) Total_YTD(3)          !GEX003-add

!add to Grand totals
 array-add #x200_ded_mtd to Total-Array(0) Total(0) 
 array-add #x205_ded_ytd to Total-Array(0) Total_YTD(0)          !GEX003-add

 array-add #x200_ded_401kpb_mtd to Total-Array(0) Total(1) 
 array-add #x205_ded_401kpb_ytd to Total-Array(0) Total_YTD(1)
 
 array-add #x300_grs_mtd to Total-Array(0) Total(2)    
 array-add #x305_grs_ytd to Total-Array(0) Total_YTD(2)          !GEX003-add 
    
 array-add #x400_hrs_mtd to Total-Array(0) Total(3)         
 array-add #x405_hrs_ytd to Total-Array(0) Total_YTD(3)          !GEX003-add

position (+1)

end-procedure

!***********************************************************************
begin-procedure P700-Company-Before-Change
!***********************************************************************
#debug9 show 'P700-Company-Before-Change'			
	
 if  $x000_new_page_flag = 'Y'
	new-page
	let $x000_new_page_flag = 'N'
 end-if		

 move &WT.COMPANY  to $x000_Company 
 #debug8 show '$x000_Company =' $x000_Company 

 let $x100_At_Least_One_Selected_For_CO_DEPT_UNION_Flag = 'N'     !GEX003-add

end-procedure

!***********************************************************************
begin-procedure P750-Deptid-Before-Change
!***********************************************************************
#debug9 show 'P750-Deptid-Before-Change'	
			
 if  $x000_new_page_flag = 'Y'
	new-page
	let $x000_new_page_flag = 'N'
 end-if

 move &WT.DEPTID to $x000_Deptid
 #debug8 show '$x000_Deptid=' $x000_Deptid

 let $x100_At_Least_One_Selected_For_CO_DEPT_UNION_Flag = 'N'     !GEX003-add

end-procedure

!***********************************************************************
begin-procedure P775-Union-Cd-Before-Change
!***********************************************************************
#debug9 show 'P775-Union-Cd-Before-Change'
				
 if  $x000_new_page_flag = 'Y'
	new-page
	let $x000_new_page_flag = 'N'
 end-if
!SXK 10/28/1999 Changed from emp.union_cd
 move &WT.Union_Cd to $x000_Union_Cd
 #debug8 show '$x000_Union_Cd=' $x000_Union_Cd

 let $x100_At_Least_One_Selected_For_CO_DEPT_UNION_Flag = 'N'     !GEX003-add

end-procedure

!***********************************************************************
begin-procedure P800-Company-After-Change
!***********************************************************************
#debug9 show 'P800-Company-Change'
#debug8 show '$x000_Company=' $x000_Company

if $x100_At_Least_One_Selected_For_CO_DEPT_UNION_Flag = 'Y'     	!GEX003-add

!get and print company 401K totals
 get #x000_MTD_xxx from Total-Array(1) Total(0)                 	!GEX003-chg
 get #x000_mtd_401kpb_xxx from total-array(1) total(1)
 get #x000_YTD_xxx from Total-Array(1) Total_YTD(0)             	!GEX003-add
 get #x000_ytd_401kpb_xxx from total-array(1) total_ytd(1)

 let $x000_out = 'Company' 
 print $x000_out  	(+2,{#x000_col_totals_literal})
 print $x000_Company 	(0,{#x000_col_totals_literal2})
 let $x000_out = 'Total'
 print $x000_out  	(0,{#x000_col_totals_literal3})		

!get and print the 401K totals
 let #x000_temp_col = {#x000_col_MTD_401K} - 1                  	!GEX003-chg
 print #x000_MTD_xxx (0,#x000_temp_col) EDIT 9,999,990.00       	!GEX003-chg
 print #x000_mtd_401kpb_xxx (+1,#x000_temp_col) edit 9,999,990.00
 let #x000_temp_col = {#x000_col_YTD_401K} - 1                  	!GEX003-add
 print #x000_YTD_xxx (-1,#x000_temp_col) EDIT 9,999,990.00       	!GEX003-add
 print #x000_ytd_401kpb_xxx (+1,#x000_temp_col) edit 9,999,990.00

!get and print Company Gross totals
 get #x000_MTD_xxx from Total-Array(1) Total(2)                 	!GEX003-chg
 get #x000_YTD_xxx from Total-Array(1) Total_YTD(2)             	!GEX003-add

 let #x000_temp_col = {#x000_col_MTD_Gross} - 1                 	!GEX003-chg
 print #x000_MTD_xxx (-1,#x000_temp_col) EDIT  9,999,990.00      	!GEX003-chg
! let #x000_temp_col = {#x000_col_YTD_Gross} - 1                 	!GEX003-add
! print #x000_YTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00      	!GEX003-add
  let #x000_temp_col = {#x000_col_YTD_Gross} - 2                	!GEX003-add
  print #x000_YTD_xxx (0,#x000_temp_col) EDIT 99,999,990.00   

!get and print Company Hours totals
 get #x000_MTD_xxx from Total-Array(1) Total(3)                 	!GEX003-add
 get #x000_YTD_xxx from Total-Array(1) Total_YTD(3)             	!GEX003-add

 let #x000_temp_col = {#x000_col_MTD_Hours} - 1                 	!GEX003-chg
 print #x000_MTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00      	!GEX003-chg
 let #x000_temp_col = {#x000_col_YTD_Hours} - 1                 	!GEX003-add
 print #x000_YTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00      	!GEX003-add


!reinitialize the company array totals
 put 0 0 into Total-Array(1) Total(0) Total_YTD(0)                	!GEX003-chg
 put 0 0 into Total-Array(1) Total(1) Total_YTD(1)                	!GEX003-chg
 put 0 0 into Total-Array(1) Total(2) Total_YTD(2)                	!GEX003-chg
 put 0 0 into Total-Array(1) Total(3) Total_YTD(3)    
 position (+1)
 let $x000_new_page_flag = 'Y'

end-if    

end-procedure

!***********************************************************************
begin-procedure P850-Deptid-After-Change
!***********************************************************************
#debug9 show 'P850-Deptid-Change'
#debug8 show '$x000_Deptid =' $x000_Deptid 

if $x100_At_Least_One_Selected_For_CO_DEPT_UNION_Flag = 'Y'     !GEX003-add


 let $x000_out = 'Dept'
 print $x000_out        (+2,{#x000_col_totals_literal})
 print $x000_Deptid 	(0,{#x000_col_totals_literal2})
 let $x000_out = 'Total'
 print $x000_out  	(0,{#x000_col_totals_literal3})		

!get and print Deptid  401K totals
 get #x000_MTD_xxx from Total-Array(2) Total(0)                 !GEX003-chg
 get #x000_mtd_401kpb_xxx from total-array(2) total(1)
 get #x000_YTD_xxx from Total-Array(2) Total_YTD(0)             !GEX003-add
 get #x000_ytd_401kpb_xxx from total-array(2) total_ytd(1)

 let #x000_temp_col = {#x000_col_MTD_401K} - 1                  !GEX003-chg
 print #x000_MTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00      !GEX003-chg
 print #x000_mtd_401kpb_xxx (+1,#x000_temp_col) edit 9,999,990.00
 let #x000_temp_col = {#x000_col_YTD_401K} - 1                  !GEX003-add
 print #x000_YTD_xxx (-1,#x000_temp_col) EDIT  9,999,990.00     !GEX003-add
 print #x000_ytd_401kpb_xxx (+1,#x000_temp_col) edit 9,999,990.00

!get and print Deptid  Gross totals
 get #x000_MTD_xxx from Total-Array(2) Total(2)                 !GEX003-chg
 get #x000_YTD_xxx from Total-Array(2) Total_YTD(2)             !GEX003-add

 let #x000_temp_col = {#x000_col_MTD_Gross} - 1                 !GEX003-chg
 print #x000_MTD_xxx (-1,#x000_temp_col) EDIT  9,999,990.00     !GEX003-chg
 let #x000_temp_col = {#x000_col_YTD_Gross} - 1                 !GEX003-add
 print #x000_YTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00      !GEX003-add

!get and print Deptid  Hours totals
 get #x000_MTD_xxx from Total-Array(2) Total(3)                 !GEX003-chg
 get #x000_YTD_xxx from Total-Array(2) Total_YTD(3)             !GEX003-add

 let #x000_temp_col = {#x000_col_MTD_Hours} - 1                 !GEX003-chg
 print #x000_MTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00      !GEX003-chg
 let #x000_temp_col = {#x000_col_YTD_Hours} - 1                 !GEX003-add
 print #x000_YTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00      !GEX003-add

!reinitialize the dept array totals
 put 0 0 into Total-Array(2) Total(0) Total_YTD(0)              !GEX003-chg
 put 0 0 into Total-Array(2) Total(1) Total_YTD(1)              !GEX003-chg
 put 0 0 into Total-Array(2) Total(2) Total_YTD(2)              !GEX003-chg
 put 0 0 into Total-Array(2) Total(3) Total_YTD(3)                

 let $x000_new_page_flag = 'Y'
 position (+1)
end-if                                                 		!GEX003-add

end-procedure

!***********************************************************************
begin-procedure P875-Union-Cd-After-Change
!***********************************************************************
#debug9 show 'P875-Union-Cd-After-Change'
#debug8 show '$x000_Union_Cd=' $x000_Union_Cd

if $x100_At_Least_One_Selected_For_CO_DEPT_UNION_Flag = 'Y'     !GEX003-add 

 let $x000_out = 'Union Code'
 print $x000_out         (+2,{#x000_col_totals_literal})
 print $x000_Union_Cd   (0,{#x000_col_totals_literal2})
 let $x000_out = 'Total'
 print $x000_out  	(0,{#x000_col_totals_literal3})
	
!get and print Union Code  410K totals
 get #x000_MTD_xxx from Total-Array(3) Total(0)                  !GEX003-chg
 get #x000_mtd_401kpb_xxx from total-array(3) total(1)
 get #x000_YTD_xxx from Total-Array(3) Total_YTD(0)              !GEX003-add
 get #x000_ytd_401kpb_xxx from total-array(3) total_ytd(1)
	
 let #x000_temp_col = {#x000_col_MTD_401K} - 1                   !GEX003-chg
 print #x000_MTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00       !GEX003-chg
 print #x000_mtd_401kpb_xxx (+1,#x000_temp_col) edit 9,999,990.00
 let #x000_temp_col = {#x000_col_YTD_401K} - 1                   !GEX003-add
 print #x000_YTD_xxx (-1,#x000_temp_col) EDIT  9,999,990.00      !GEX003-add
 print #x000_ytd_401kpb_xxx (+1,#x000_temp_col) edit 9,999,990.00

!get and print Union Code  Gross totals
 get #x000_MTD_xxx from Total-Array(3) Total(2)                  !GEX003-chg
 get #x000_YTD_xxx from Total-Array(3) Total_YTD(2)              !GEX003-add

 let #x000_temp_col = {#x000_col_MTD_Gross} - 1                  !GEX003-chg
 print #x000_MTD_xxx (-1,#x000_temp_col) EDIT  9,999,990.00      !GEX003-chg
 let #x000_temp_col = {#x000_col_YTD_Gross} - 1                  !GEX003-add
 print #x000_YTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00       !GEX003-add

!get and print Union Code  Hours totals
 get #x000_MTD_xxx from Total-Array(3) Total(3)                  !GEX003-chg
 get #x000_YTD_xxx from Total-Array(3) Total_YTD(3)              !GEX003-add

 let #x000_temp_col = {#x000_col_MTD_Hours} - 1                  !GEX003-chg
 print #x000_MTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00       !GEX003-chg
 let #x000_temp_col = {#x000_col_YTD_Hours} - 1                  !GEX003-add
 print #x000_YTD_xxx (0,#x000_temp_col) EDIT  9,999,990.00       !GEX003-add

!reinitialize the Union Code array totals
 put 0 0 into Total-Array(3) Total(0) Total_YTD(0)               !GEX003-chg
 put 0 0 into Total-Array(3) Total(1) Total_YTD(1)               !GEX003-chg
 put 0 0 into Total-Array(3) Total(2) Total_YTD(2)               !GEX003-chg
 put 0 0 into Total-Array(3) Total(3) Total_YTD(3)               !GEX003-chg

 let $x000_new_page_flag = 'Y'
 position (+1)
end-if                                                           !GEX003-add

end-procedure

!***********************************************************************
begin-procedure P900-Get-Job-Code-Info
!***********************************************************************
#debug9 show 'P900-Get-Job-Code-Info'

  if rtrim($x100_JobCode,' ') = ''
    move '' to $$x900_JobTitle       
    move '' to $$x900_JobTitleAbbrv  
    move '' to $x900_Union_Cd  
    goto GetJobTlExit
  end-if

begin-SELECT
!/*+ RULE */

JT.DESCR
JT.DESCRSHORT
JT.UNION_CD

  let $x900_JobTitle       = rtrim(&JT.Descr,' ')
  let $x900_JobTitleAbbrv  = rtrim(&JT.DescrShort,' ')
  let $x900_Union_Cd       = rtrim(&JT.UNION_CD,' ')

FROM  PS_JOBCODE_TBL JT
WHERE JT.JOBCODE = $x100_JobCode
  AND JT.EFFDT =
      (SELECT MAX(EFFDT)
       FROM   PS_JOBCODE_TBL
       WHERE  JOBCODE = $JobCode
         AND  EFFDT  <= $X000_WHERE_SELECT_ASOFDATE)
end-SELECT

GetJobTlExit:

end-procedure

! SXC 04/27/2000 - Begin 
!************************************
begin-procedure WT900-drop-work-table
!************************************
#debug9 show 'WT900-drop-work-table' 

begin-sql 
DROP TABLE [$tablename]
end-sql
end-procedure

! SXC 04/27/2000 - End 
!************************************

! CWB 03/14/2001 BEGIN
!*********************************************************************
!Retrieves the Company Description from the database
!*********************************************************************

begin-procedure get-company-desc

move ' ' to $company_desc

begin-select 
J.DESCR

  move &J.DESCR to $company_Desc

from PS_COMPANY_TBL J

WHERE J.COMPANY = $COMPANY
  AND J.EFFDT =
      (SELECT MAX(EFFDT)
	 FROM PS_COMPANY_TBL
	WHERE COMPANY = $COMPANY)
end-select

end-procedure
!*********************************************************************
! CWB 03/14/2001 END

#Include 'getcodta.sqc'  !Get-Company-Data procedure
#Include 'getpgdta.sqc'  !Get-PayGroup-Data procedure
#Include 'getdednm.sqc'  !Get-Deduction-Name procedure
#Include 'getdatcd.sqc'  !Get-Date-Codes procedure
#Include 'readxlat.sqc'  !Read-Translate-Table procedure
#Include 'curdttim.sqc'  !Get-Current-DateTime procedure
#Include 'datetime.sqc'  !Routines for date and time formatting
#Include 'datemath.sqc'  !Routines for date and time math  !SRK 02/25/2003 
#Include 'number.sqc'    !Routines to format numbers
#Include 'stdapi.sqc'    !Update Process API
#Include 'payrnctl.sqc'  !Get-Run-Control procedure
#Include 'getbalid.sqc'  !Get-Calendar-Year-Id
#Include 'reset.sqc'     !Reset 
#include 'gexxx900.sqc'  !Get company multiple row table
#include 'gexxx901.sqc'  !Get company/paygroup multiple row table
#include 'gexxx902.sqc'  !Get deptid multiple row table
#include 'gexxx903.sqc'  !Get employee status multiple row table
#include 'gexxx907.sqc'  !Get company/division code multiple row table
#include 'gexxx908.sqc'  !Get sal_admin_plan multiple row table
#include 'gexxx909.sqc'  !Get acct_cd code multiple row table
#include 'gexxx922.sqc'  !Get pay single row run control
#include 'gexxx950.sqc'  !Get SQRW run controls
#include 'askaod.sqc'    !Ask-As-Of-Date procedure
#include 'gexdept.sqc'   !Get Original dept
!#include 'gexernc2.sqc'  !Set up Erncd exclude code
#include 'gexerncd.sqc'  !Set up Erncd exclude code   ! CWB 01/15/2004
!*************************************************************************
