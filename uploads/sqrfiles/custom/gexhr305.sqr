
!***************************************************************************************
! GEXHR305:             ANALYSIS ON MOVEMENT OF EMPLOYEES ACROSS ORGANIZATION          * 
!                       CREATES SPREADSHEETS FOR USE BY EVP                            *
!***************************************************************************************
!                                                                                      *
!               Confidentiality Information:                                           *
!                                                                                      *
! This module is the confidential and proprietary information of                       *
! Giant Eagle, Inc.; it is not to be copied, reproduced,or transmitted                 *
! in any form, by any means, in whole or in part, nor is it to be used                 *
! for any purpose other than that for which it is expressly provided                   *
! without the written permission of Giant Eagle.                                       *
!                                                                                      *
! Copyright (c) 1997-1998 Giant Eagle,Inc. All Rights Reserved                         *
!                                                                                      *
!***************************************************************************************
!                                                                                      *        
! GEXHR305 :           ANALYSIS ON EMPLOYEE MOVEMENT ACROSS                           *
!                                                                                      *        
! Narrative:                                                                           * 
!                                                                                      *  
! SQL Tables:           PS_GEX_EVP_MVMNT					       *
!                                                                                      *
! Written by:           Abhishek Potnuru                                               *       
!                                                                                      *
! Normally Run:									       *
!                                                                                      *
! Control Parms:									*
!											*
!***************************************************************************************
!                         MODIFICATION HISTORY                                          *
!****************************************************************************************
! CSR    INITIALS     DATE         DESCRIPTION OF THE CHANGE                            *
!****************************************************************************************
!                                                                                       *
!  VENDAPP      21/11/2007   New program                                          *
!	 GEX-TLL      04/03/2008   HCM.90 Upgrade 					*
!	 GEX-TLL      04/08/2008   HCM.90 Upgrade 					*
!	VENDKXY 			02/25/2009	 Done the code changes for ITG 56880										*
!****************************************************************************************
                                                                 
#include 'setenv.sqc'    !set environment
#include 'setup32.sqc'   !printer and page-size initialization
#include 'prcsapi.sqc'   
#include 'sqrtrans.sqc'  ! set translation
#include 'datemath.sqc'

!***********************************************************************************
Begin-Report
!***********************************************************************************
do Initialization
do Movement-Business-Area
do Movement-Operation-Division
do Movement-EVP
do Movement-Salary-Grade
do Movement-FullPartTime-EmployeeType
do MDP-Movement-Business-Area
do MDP-Movement-Operation-Division
do Finalization
do Stdapi-Term             !stdapi.sqc
End-Report


!***********************************************************************************
Begin-Procedure Initialization
!***********************************************************************************
  Do Init-DateTime           !datetime.sqc
  Do Init-Number             !number.sqc
  Do Get-Current-DateTime    !curdttim.sqc
  Do Stdapi-Init             !stdapi.sqc

  Let $ReportID      =   'gexhr305'
  Let $ReportTitle   =   'EMPLOYEE MOVEMENT ANALYSIS FOR EVP'
  
  Show '$ReportID    = ' $ReportID
  Show '$ReportTitle = ' $ReportTitle
  Show '$ReportDate  = ' $ReportDate
  Show '$ReportTime  = ' $ReportTime
  Let $GEXXX916_Jobcode_Alias  = 'Percent.GEX_NEW_JOBCODE'					!Vendkxy added the code for ITG 56880

  Do GEXXX922-Select-Parameters
  Do GEXXX916-Select-Jobcode-Parameters															!Vendkxy added the code for ITG 56880
  Let $AsOfDate = $GEX_RC_PAY.AsOfDate
  !GEX-TLL 04/08/2008 HCM 9.0 Upgrade Begin
  !If Rtrim ($GEX_RC_PAY.AsOfDate, ' ') = ''
  If Ltrim ($GEX_RC_PAY.AsOfDate, ' ') = ''
  !GEX-TLL 04/08/2008 HCM 9.0 Upgrade End
    Let $AsOfDate = $AsOfToday
  End-If
	
  move $GEX_RC_PAY.FromDate to $FromDate YYYYMMDD
  move $GEX_RC_PAY.ThruDate to $ThruDate YYYYMMDD
  !GEX-TLL 04/08/2008 HCM 9.0 Upgrade Begin
  If Ltrim(Rtrim($GEX_RC_PAY.FromDate, ' '),' ') = '' or Ltrim(Rtrim($GEX_RC_PAY.ThruDate, ' '),' ') = ''
     Let $FromDate = dateadd(strtodate($AsOfDate),'YEAR',-1)
     Let $ThruDate = dateadd(strtodate($AsOfDate),'DAY',-1)
     move $FromDate to $FromDate YYYYMMDD
     move $ThruDate to $ThruDate YYYYMMDD
  End-If

  move $FromDate to $Rpt_From_Date MM-DD-YYYY
  move $ThruDate to $Rpt-Thru_Date MM-DD-YYYY
  !move $GEX_RC_PAY.FromDate to $Rpt_From_Date MM-DD-YYYY
  !move $GEX_RC_PAY.ThruDate to $Rpt-Thru_Date MM-DD-YYYY
  !GEX-TLL 04/08/2008 HCM 9.0 Upgrade End
	
  show '$AsofDate- :' $AsOfDate
  show '$FromDate- :' $FromDate
  show '$ThruDate- :' $ThruDate 
  
  !GEX-TLL 04/08/2008 HCM 9.0 Upgrade Begin
  show '$Rpt_From_Date: ' $Rpt_From_Date
  show '$Rpt-Thru_Date: ' $Rpt-Thru_Date
  !GEX-TLL 04/08/2008 HCM 9.0 Upgrade End
  show '$GEXXX916_INCLUDE_JOBCODE_DISPLAY_CRITERIA=' $GEXXX916_INCLUDE_JOBCODE_DISPLAY_CRITERIA  !Vendkxy added the code for ITG 56880
  do Open-Files

  encode '<009>' into $tab  
  encode '<012>' into $newline 
End-Procedure


!***********************************************************************************
Begin-Procedure Finalization
!***********************************************************************************

  Close 1
  If #filestat != 0
     Show 'Error Closing Movement_Business_Area file. Program terminating.'
     Stop
  End-If

  Close 2
  If #filestat != 0
     Show 'Error closing Movement_Operation_Division file.  Program terminating.'
     Stop
  End-If

  Close 3
  If #filestat != 0
     Show 'Error closing Movement_EVP output file.  Program terminating.'
     Stop
  End-If

  Close 4
  If #filestat != 0
     Show 'Error closing Movement_Salary_Grade file.  Program terminating.'
     Stop
  End-If

  Close 5
  If #filestat != 0
     Show 'Error closing MDP_Movement_Business_Area file.  Program terminating.'
     Stop
  End-If

  Close 6
  If #filestat != 0
     Show 'Error closing MDP_Movement_Operation_Division file.  Program terminating.'
     Stop
  End-If

    Close 7
  If #filestat != 0
     Show 'Error closing Movement_FullPartTime_EmployeeType file.  Program terminating.'
     Stop
  End-If

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-Business-Area
!***********************************************************************************

let $where_mdp_jobcodes = $GEXXX916_INCLUDE_JOBCODE_CRITERIA			 !Vendkxy changed the code for ITG 56880
let $GEXXX916_INCLUDE_JOBCODE_CRITERIA = '1=1'						         !Vendkxy added the code for ITG 56880
!show $where_mdp_jobcodes																				     !Vendkxy commented the code for ITG 56880

Let $write_row = 'Movement By Business Area From: ' || $Rpt_From_Date || ' To: ' || $Rpt-Thru_Date 
do Write-Movement-Business-Area

move '' to $write_row 
do Write-Movement-Business-Area

String ' ' ' ' ' ' ' ' 'DESTINATION' '' by $tab into $write_row 
do Write-Movement-Business-Area

String ' ' ' ' ' ' 'NEW BUS AREA' '' '' '' by $tab into $write_row 
do Write-Movement-Business-Area

String 'S' 'OLD BUS AREA' '' 'Corp Off' 'GE Retail' 'GetGo' 'Pharmacy' 'RSC' 'N/A' 'Grand Total' ''
	by $tab into $write_row
do Write-Movement-Business-Area

move 'Corp Off' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_corpoff_total
move #new_corpoff_total to $new_corpoff_total 999,999

move 'GE Retail' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_geretail_total
move #new_geretail_total to $new_geretail_total 999,999

move 'GetGo' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_getgo_total
move #new_getgo_total to $new_getgo_total 999,999

move 'Pharmacy' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_pharmacy_total
move #new_pharmacy_total to $new_pharmacy_total 999,999

move 'RSC' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_rsc_total
move #new_rsc_total to $new_rsc_total 999,999

move ' ' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_NA_total
move #new_NA_total to $new_NA_total 999,999


move 'Corp Off' to $bus_area
move 'O' to $prefix
do Movement-Business-Area-row
do Write-Movement-Business-Area

move 'GE Retail' to $bus_area
move 'U' to $prefix
do Movement-Business-Area-row
do Write-Movement-Business-Area

move 'GetGo' to $bus_area
move 'R' to $prefix
do Movement-Business-Area-row
do Write-Movement-Business-Area

move 'Pharmacy' to $bus_area
move 'C' to $prefix
do Movement-Business-Area-row
do Write-Movement-Business-Area

move 'RSC' to $bus_area
move 'E' to $prefix
do Movement-Business-Area-row
do Write-Movement-Business-Area

move ' ' to $bus_area
move '' to $prefix
do Movement-Business-Area-row
do Write-Movement-Business-Area

let #grand_total=#new_corpoff_total + #new_geretail_total + #new_getgo_total + #new_pharmacy_total + #new_rsc_total + #new_NA_total
move #grand_total to $grand_total 999,999
String ' ' 'Grand Total' '' $new_corpoff_total $new_geretail_total $new_getgo_total $new_pharmacy_total 
	$new_rsc_total $new_NA_total $grand_total by $tab into $write_row
do Write-Movement-Business-Area


move '' to $write_row
do Write-Movement-Business-Area

move '' to $write_row
do Write-Movement-Business-Area

move '% of Moves to Destination Business Area Totals' to $write_row
do Write-Movement-Business-Area

move '' to $write_row
do Write-Movement-Business-Area

String ' ' ' ' ' ' ' ' 'DESTINATION' '' by $tab into $write_row 
do Write-Movement-Business-Area

String ' ' ' ' ' ' 'NEW BUS AREA' '' '' '' by $tab into $write_row 
do Write-Movement-Business-Area

String 'S' 'OLD BUS AREA' '' 'Corp Off' 'GE Retail' 'GetGo' 'Pharmacy' 'RSC' 'N/A'
	by $tab into $write_row
do Write-Movement-Business-Area

move 'Corp Off' to $bus_area
move 'O' to $prefix
do Movement-Business-Area-Percent
do Write-Movement-Business-Area

move 'GE Retail' to $bus_area
move 'U' to $prefix
do Movement-Business-Area-Percent
do Write-Movement-Business-Area

move 'GetGo' to $bus_area
move 'R' to $prefix
do Movement-Business-Area-Percent
do Write-Movement-Business-Area

move 'Pharmacy' to $bus_area
move 'C' to $prefix
do Movement-Business-Area-Percent
do Write-Movement-Business-Area

move 'RSC' to $bus_area
move 'E' to $prefix
do Movement-Business-Area-Percent
do Write-Movement-Business-Area

move ' ' to $bus_area
move '' to $prefix
do Movement-Business-Area-Percent
do Write-Movement-Business-Area

Let $GEXXX916_INCLUDE_JOBCODE_CRITERIA   =  $where_mdp_jobcodes 						 !Vendkxy added the code for ITG 56880

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-Business-Area-row
!***********************************************************************************

move 0 to #count_bus_area_corpoff
move 0 to #count_bus_area_geretail
move 0 to #count_bus_area_getgo
move 0 to #count_bus_area_pharmacy
move 0 to #count_bus_area_rsc
move 0 to #count_bus_area_NA
move 0 to #old_grand_total

Begin-Select
percent.GEX_NEW_BUS_AREA	  &movement_GEX_NEW_BUS_AREA			!Vendkxy changed the code for ITG 56880
COUNT(Emplid) &count_bus_area

   Evaluate &movement_GEX_NEW_BUS_AREA											!Vendkxy changed the code for ITG 56880
   when = 'Corp Off'
	move &count_bus_area to #count_bus_area_corpoff
	let #old_grand_total=#old_grand_total + &count_bus_area
	Break
   when = 'GE Retail'
	move &count_bus_area to #count_bus_area_geretail
        let #old_grand_total=#old_grand_total + &count_bus_area
	Break
   when = 'GetGo'
	move &count_bus_area to #count_bus_area_getgo
	let #old_grand_total=#old_grand_total + &count_bus_area
	Break
   when = 'Pharmacy'
	move &count_bus_area to #count_bus_area_pharmacy
	let #old_grand_total=#old_grand_total + &count_bus_area
	Break
   when = 'RSC'
	move &count_bus_area to #count_bus_area_rsc
	let #old_grand_total=#old_grand_total + &count_bus_area
	Break
   when = ' '
	move &count_bus_area to #count_bus_area_NA
	let #old_grand_total=#old_grand_total + &count_bus_area
	Break
   End-Evaluate

FROM PS_GEX_EVP_MVMNT percent										!Vendkxy changed the code for ITG 56880
WHERE percent.GEX_OLD_BUS_AREA = $bus_area 			!Vendkxy changed the code for ITG 56880
![$where_mdp_jobcodes]													!Vendkxy commented the code for ITG 56880
And   [$GEXXX916_Include_Jobcode_Criteria]			!Vendkxy added the code for ITG 56880
GROUP BY percent.GEX_NEW_BUS_AREA								!Vendkxy changed the code for ITG 56880
End-Select

move #count_bus_area_corpoff to $count_bus_area_corpoff 999,999
move #count_bus_area_geretail to $count_bus_area_geretail 999,999
move #count_bus_area_getgo to $count_bus_area_getgo 999,999
move #count_bus_area_pharmacy to $count_bus_area_pharmacy 999,999
move #count_bus_area_rsc to $count_bus_area_rsc 999,999
move #count_bus_area_NA to $count_bus_area_NA 999,999
move #old_grand_total to $old_grand_total 999,999

if $bus_area = ' '
  move 'N/A              ' to $bus_area
else
  let $bus_area = $bus_area||'              '
end-if

String $prefix $bus_area '' $count_bus_area_corpoff $count_bus_area_geretail $count_bus_area_getgo
	$count_bus_area_pharmacy $count_bus_area_rsc $count_bus_area_NA $old_grand_total '' 
	by $tab into $write_row

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-Business-Area-Percent
!***********************************************************************************

move 0 to #count_bus_area_corpoff
move 0 to #count_bus_area_geretail
move 0 to #count_bus_area_getgo
move 0 to #count_bus_area_pharmacy
move 0 to #count_bus_area_rsc
move 0 to #count_bus_area_NA
move 0 to #old_grand_total
move 0 to #percent_bus_area_corpoff
move 0 to #percent_bus_area_geretail
move 0 to #percent_bus_area_getgo
move 0 to #percent_bus_area_pharmacy
move 0 to #percent_bus_area_rsc
move 0 to #percent_bus_area_NA

Begin-Select
Percent.GEX_NEW_BUS_AREA
COUNT(Percent.Emplid) &count_bus_area_per

   Evaluate &Percent.GEX_NEW_BUS_AREA
   when = 'Corp Off'
	move &count_bus_area_per to #count_bus_area_corpoff
	let #old_grand_total=#old_grand_total + &count_bus_area_per
	let #percent_bus_area_corpoff=round((#count_bus_area_corpoff/#new_corpoff_total)*100,0)
	Break
   when = 'GE Retail'
	move &count_bus_area_per to #count_bus_area_geretail
        let #old_grand_total=#old_grand_total + &count_bus_area_per
	let #percent_bus_area_geretail=round((#count_bus_area_geretail/#new_geretail_total)*100,0)
	Break
   when = 'GetGo'
	move &count_bus_area_per to #count_bus_area_getgo
	let #old_grand_total=#old_grand_total + &count_bus_area_per
	let #percent_bus_area_getgo=round((#count_bus_area_getgo/#new_getgo_total)*100,0)
	Break
   when = 'Pharmacy'
	move &count_bus_area_per to #count_bus_area_pharmacy
	let #old_grand_total=#old_grand_total + &count_bus_area_per
	let #percent_bus_area_pharmacy=round((#count_bus_area_pharmacy/#new_pharmacy_total)*100,0)
	Break
   when = 'RSC'
	move &count_bus_area_per to #count_bus_area_rsc
	let #old_grand_total=#old_grand_total + &count_bus_area_per
	let #percent_bus_area_rsc=round((#count_bus_area_rsc/#new_rsc_total)*100,0)
	Break
   when = ' '
	move &count_bus_area_per to #count_bus_area_NA
	let #old_grand_total=#old_grand_total + &count_bus_area_per
	let #percent_bus_area_NA=round((#count_bus_area_NA/#new_NA_total)*100,0)
	Break
   End-Evaluate

FROM PS_GEX_EVP_MVMNT Percent
WHERE Percent.GEX_OLD_BUS_AREA = $bus_area 
![$where_mdp_jobcodes]												!Vendkxy commented the code for ITG 56880
And   [$GEXXX916_Include_Jobcode_Criteria]			!Vendkxy added the code for ITG 56880
GROUP BY Percent.GEX_NEW_BUS_AREA
End-Select

move #percent_bus_area_corpoff to $percent_bus_area_corpoff 999
let $percent_bus_area_corpoff = $percent_bus_area_corpoff||'%'

move #percent_bus_area_geretail to $percent_bus_area_geretail 999
let $percent_bus_area_geretail = $percent_bus_area_geretail||'%'

move #percent_bus_area_getgo to $percent_bus_area_getgo 999
let $percent_bus_area_getgo = $percent_bus_area_getgo||'%'

move #percent_bus_area_pharmacy to $percent_bus_area_pharmacy 999
let $percent_bus_area_pharmacy = $percent_bus_area_pharmacy||'%'

move #percent_bus_area_rsc to $percent_bus_area_rsc 999
let $percent_bus_area_rsc = $percent_bus_area_rsc||'%'

move #percent_bus_area_NA to $percent_bus_area_NA 999
let $percent_bus_area_NA = $percent_bus_area_NA||'%'

if $bus_area = ' '
  move 'N/A              ' to $bus_area
else
  let $bus_area = $bus_area||'              '
end-if

String 	$prefix $bus_area '' $percent_bus_area_corpoff $percent_bus_area_geretail 
	$percent_bus_area_getgo	$percent_bus_area_pharmacy $percent_bus_area_rsc $percent_bus_area_NA
	by $tab into $write_row

End-Procedure


!***********************************************************************************
Begin-Procedure New-Business-Area-Total
!***********************************************************************************

Begin-Select
COUNT(*) &new_bus_area_total
FROM PS_GEX_EVP_MVMNT percent										!Vendkxy changed the code for ITG 56880
WHERE percent.GEX_NEW_BUS_AREA=$bus_area 				!Vendkxy changed the code for ITG 56880
![$where_mdp_jobcodes]													!Vendkxy commented the code for ITG 56880
And   [$GEXXX916_Include_Jobcode_Criteria]			!Vendkxy added the code for ITG 56880
End-Select

End-Procedure 

!***********************************************************************************
Begin-Procedure MDP-Movement-Business-Area
!***********************************************************************************
 !Vendkxy commented the code for ITG 56880
!let $where_mdp_jobcodes='AND GEX_NEW_JOBCODE IN ('''||'10007'||''','''||'10010'||''','''||'10012'||''','''
!		      ||'10013'||''','''||'10015'||''','''||'10018'||''','''||'10021'||''','''
!		      ||'10023'||''','''||'10027'||''','''||'10028'||''','''||'10029'||''','''
!		      ||'10031'||''','''||'10046'||''','''||'60004'||''','''||'60013'||''','''
!		      ||'70004'||''','''||'70013'||''','''||'70017'||''','''||'70029'||''','''
!		      ||'70031'||''','''||'80012'||''','''||'80017'||''','''||'80019'||''','''
!		      ||'80025'||''','''||'80044'||''','''||'80045'||''','''||'80066'||''','''
!		      ||'80069'||''')'
!show $where_mdp_jobcodes

Let $write_row = 'MDP Movement By Business Area From: ' || $Rpt_From_Date || ' To: ' || $Rpt-Thru_Date 
do Write-MDP-Movement-Business-Area

move '' to $write_row 
do Write-MDP-Movement-Business-Area

String ' ' ' ' ' ' 'DESTINATION' '' by $tab into $write_row 
do Write-MDP-Movement-Business-Area

String 'S' 'BUS AREA' '' 'Corp Off' 'GE Retail' 'GetGo' 'Pharmacy' 'RSC' 'N/A' 'Grand Total' ''
	by $tab into $write_row
do Write-MDP-Movement-Business-Area

move 'Corp Off' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_corpoff_total
move #new_corpoff_total to $new_corpoff_total 999,999

move 'GE Retail' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_geretail_total
move #new_geretail_total to $new_geretail_total 999,999

move 'GetGo' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_getgo_total
move #new_getgo_total to $new_getgo_total 999,999

move 'Pharmacy' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_pharmacy_total
move #new_pharmacy_total to $new_pharmacy_total 999,999

move 'RSC' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_rsc_total
move #new_rsc_total to $new_rsc_total 999,999

move ' ' to $bus_area
do New-Business-Area-Total
move &new_bus_area_total to #new_NA_total
move #new_NA_total to $new_NA_total 999,999


move 'Corp Off' to $bus_area
move 'O' to $prefix
do Movement-Business-Area-row
do Write-MDP-Movement-Business-Area

move 'GE Retail' to $bus_area
move 'U' to $prefix
do Movement-Business-Area-row
do Write-MDP-Movement-Business-Area

move 'GetGo' to $bus_area
move 'R' to $prefix
do Movement-Business-Area-row
do Write-MDP-Movement-Business-Area

move 'Pharmacy' to $bus_area
move 'C' to $prefix
do Movement-Business-Area-row
do Write-MDP-Movement-Business-Area

move 'RSC' to $bus_area
move 'E' to $prefix
do Movement-Business-Area-row
do Write-MDP-Movement-Business-Area

move ' ' to $bus_area
move '' to $prefix
do Movement-Business-Area-row
do Write-MDP-Movement-Business-Area

let #grand_total=#new_corpoff_total + #new_geretail_total + #new_getgo_total + #new_pharmacy_total + #new_rsc_total + #new_NA_total
move #grand_total to $grand_total 999,999
String ' ' 'Grand Total' '' $new_corpoff_total $new_geretail_total $new_getgo_total $new_pharmacy_total 
	$new_rsc_total $new_NA_total $grand_total by $tab into $write_row
do Write-MDP-Movement-Business-Area


move '' to $write_row
do Write-MDP-Movement-Business-Area

move '' to $write_row
do Write-MDP-Movement-Business-Area

 !Vendkxy commented the code for ITG 56880
!let $where_mdp_jobcodes='AND Percent.GEX_NEW_JOBCODE IN ('''||'10007'||''','''||'10010'||''','''||'10012'||''','''
!		      ||'10013'||''','''||'10015'||''','''||'10018'||''','''||'10021'||''','''
!		      ||'10023'||''','''||'10027'||''','''||'10028'||''','''||'10029'||''','''
!		      ||'10031'||''','''||'10046'||''','''||'60004'||''','''||'60013'||''','''
!		      ||'70004'||''','''||'70013'||''','''||'70017'||''','''||'70029'||''','''
!		      ||'70031'||''','''||'80012'||''','''||'80017'||''','''||'80019'||''','''
!		      ||'80025'||''','''||'80044'||''','''||'80045'||''','''||'80066'||''','''
!		      ||'80069'||''')'
!show $where_mdp_jobcodes

move '% of Moves to Destination Business Area Totals' to $write_row
do Write-MDP-Movement-Business-Area

move '' to $write_row
do Write-MDP-Movement-Business-Area

String ' ' ' ' ' ' 'DESTINATION' '' by $tab into $write_row 
do Write-MDP-Movement-Business-Area

String 'S' 'BUS AREA' '' 'Corp Off' 'GE Retail' 'GetGo' 'Pharmacy' 'RSC' 'N/A'
	by $tab into $write_row
do Write-MDP-Movement-Business-Area

move 'Corp Off' to $bus_area
move 'O' to $prefix
do Movement-Business-Area-Percent
do Write-MDP-Movement-Business-Area

move 'GE Retail' to $bus_area
move 'U' to $prefix
do Movement-Business-Area-Percent
do Write-MDP-Movement-Business-Area

move 'GetGo' to $bus_area
move 'R' to $prefix
do Movement-Business-Area-Percent
do Write-MDP-Movement-Business-Area

move 'Pharmacy' to $bus_area
move 'C' to $prefix
do Movement-Business-Area-Percent
do Write-MDP-Movement-Business-Area

move 'RSC' to $bus_area
move 'E' to $prefix
do Movement-Business-Area-Percent
do Write-MDP-Movement-Business-Area

move ' ' to $bus_area
move '' to $prefix
do Movement-Business-Area-Percent
do Write-MDP-Movement-Business-Area

End-Procedure

!***********************************************************************************
Begin-Procedure Movement-EVP
!***********************************************************************************

Let $write_row = 'Movement by EVP From: ' || $Rpt_From_Date || ' To: ' || $Rpt-Thru_Date 
do Write-Movement-EVP

Move '' to $write_row
do Write-Movement-EVP

String ' ' ' ' ' ' 'DESTINATION' by $tab into $write_row 
do Write-Movement-EVP

String ' ' ' ' 'NEW EVP' '' by $tab into $write_row 
do Write-Movement-EVP

String 'S' 'OLD EVP' 'Karet, L'	'Lucot, J' 'Minnaugh, M' 'N/A' 'Grand Total'
        by $tab into $write_row
do Write-Movement-EVP

move '178509093' to $evp
do New-EVP-Total
move &new_evp_total to #new_Karet_total

move '181464707' to $evp
do New-EVP-Total
move &new_evp_total to #new_lucot_total

move '192505706' to $evp
do New-EVP-Total
move &new_evp_total to #new_Minnaugh_total

move ' ' to $evp
do New-EVP-Total
move &new_evp_total to #new_NA_total


move '178509093' to $evp
move 'Karet, L' to $evp_name
move 'O' to $prefix
do Movement-EVP-row
do Write-Movement-EVP

move '181464707' to $evp
move 'Lucot, J' to $evp_name
move 'U' to $prefix
do Movement-EVP-row
do Write-Movement-EVP

move '192505706' to $evp
move 'Minnaugh, M' to $evp_name
move 'R' to $prefix
do Movement-EVP-row
do Write-Movement-EVP

move ' ' to $evp
move 'N/A' to $evp_name
move 'C' to $prefix
do Movement-EVP-row
do Write-Movement-EVP

let #grand_total=#new_Karet_total + #new_lucot_total + #new_Minnaugh_total + #new_NA_total
move #new_Karet_total to $new_Karet_total 999,999
move #new_lucot_total to $new_lucot_total 999,999
move #new_Minnaugh_total to $new_Minnaugh_total 999,999
move #new_NA_total to $new_NA_total 999,999
move #grand_total to $grand_total 999,999
String 'E' 'Grand Total' $new_Karet_total $new_lucot_total $new_Minnaugh_total $new_NA_total $grand_total by $tab into $write_row
do Write-Movement-EVP


move '' to $write_row
do Write-Movement-EVP

move '' to $write_row
do Write-Movement-EVP

move '% of Moves to Destination EVP Totals' to $write_row
do Write-Movement-EVP

move '' to $write_row
do Write-Movement-EVP

String ' ' ' ' ' ' 'DESTINATION' by $tab into $write_row 
do Write-Movement-EVP

String ' ' ' ' 'NEW EVP' '' by $tab into $write_row 
do Write-Movement-EVP

String 'S' 'OLD EVP' 'Karet, L'	'Lucot, J' 'Minnaugh, M' 'N/A'
        by $tab into $write_row
do Write-Movement-EVP

move '178509093' to $evp
move 'Karet, L' to $evp_name
move 'O' to $prefix
do Movement-EVP-Percent
do Write-Movement-EVP

move '181464707' to $evp
move 'Lucot, J' to $evp_name
move 'U' to $prefix
do Movement-EVP-Percent
do Write-Movement-EVP

move '192505706' to $evp
move 'Minnaugh, M' to $evp_name
move 'R' to $prefix
do Movement-EVP-Percent
do Write-Movement-EVP

move ' ' to $evp
move 'N/A' to $evp_name
move 'C' to $prefix
do Movement-EVP-Percent
do Write-Movement-EVP

move 'E' to $write_row
do Write-Movement-EVP

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-EVP-row
!***********************************************************************************

move 0 to #count_EVP_Karet
move 0 to #count_EVP_lucot
move 0 to #count_EVP_Minnaugh
move 0 to #count_EVP_NA
move 0 to #old_grand_total

Begin-Select
GEX_NEW_GEX_EVP
COUNT(Emplid) &count_EVP

   Evaluate &GEX_NEW_GEX_EVP
   when = '178509093'
	move &count_EVP to #count_EVP_Karet
	let #old_grand_total = #old_grand_total + &count_EVP
	Break
   when = '181464707'
	move &count_EVP to #count_EVP_lucot
	let #old_grand_total = #old_grand_total + &count_EVP
	Break
   when = '192505706'
	move &count_EVP to #count_EVP_Minnaugh
	let #old_grand_total = #old_grand_total + &count_EVP
	Break
   when = ' '
	move &count_EVP to #count_EVP_NA
	let #old_grand_total = #old_grand_total + &count_EVP
	Break
   End-Evaluate

FROM PS_GEX_EVP_MVMNT
WHERE GEX_OLD_GEX_EVP = $evp
GROUP BY GEX_NEW_GEX_EVP
End-Select

move #count_EVP_Karet to $count_EVP_Karet 999,999
move #count_EVP_lucot to $count_EVP_lucot 999,999
move #count_EVP_Minnaugh to $count_EVP_Minnaugh 999,999
move #count_EVP_NA to $count_EVP_NA 999,999
move #old_grand_total to $old_grand_total 999,999

String $prefix $evp_name $count_EVP_Karet $count_EVP_lucot $count_EVP_Minnaugh $count_EVP_NA $old_grand_total
	by $tab into $write_row

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-EVP-Percent
!***********************************************************************************

move 0 to #count_EVP_Karet
move 0 to #count_EVP_lucot
move 0 to #count_EVP_Minnaugh
move 0 to #count_EVP_NA
move 0 to #old_grand_total
move 0 to #percent_EVP_Karet
move 0 to #percent_EVP_lucot
move 0 to #percent_EVP_Minnaugh
move 0 to #percent_EVP_NA

Begin-Select
Percent.GEX_NEW_GEX_EVP
COUNT(Percent.Emplid) &count_EVP_Per

   Evaluate &Percent.GEX_NEW_GEX_EVP
   when = '178509093'
	move &count_EVP_Per to #count_EVP_Karet
	let #old_grand_total = #old_grand_total + &count_EVP_Per
	let #percent_EVP_Karet = round((#count_EVP_Karet/#new_Karet_total)*100,0)
	Break
   when = '181464707'
	move &count_EVP_Per to #count_EVP_lucot
	let #old_grand_total = #old_grand_total + &count_EVP_Per
	let #percent_EVP_lucot = round((#count_EVP_lucot/#new_lucot_total)*100,0)
	Break
   when = '192505706'
	move &count_EVP_Per to #count_EVP_Minnaugh
	let #old_grand_total = #old_grand_total + &count_EVP_Per
	let #percent_EVP_Minnaugh = round((#count_EVP_Minnaugh/#new_Minnaugh_total)*100,0)
	Break
   when = ' '
	move &count_EVP_Per to #count_EVP_NA
	let #old_grand_total = #old_grand_total + &count_EVP_Per
	let #percent_EVP_NA = round((#count_EVP_NA/#new_NA_total)*100,0)
	Break
   End-Evaluate

FROM PS_GEX_EVP_MVMNT Percent
WHERE Percent.GEX_OLD_GEX_EVP = $evp
GROUP BY Percent.GEX_NEW_GEX_EVP
End-Select

move #percent_EVP_Karet to $percent_EVP_Karet 999
let $percent_EVP_Karet = $percent_EVP_Karet||'%'

move #percent_EVP_lucot to $percent_EVP_lucot 999
let $percent_EVP_lucot = $percent_EVP_lucot||'%'

move #percent_EVP_Minnaugh to $percent_EVP_Minnaugh 999
let $percent_EVP_Minnaugh = $percent_EVP_Minnaugh||'%'

move #percent_EVP_NA to $percent_EVP_NA 999
let $percent_EVP_NA = $percent_EVP_NA||'%'

String $prefix $evp_name $percent_EVP_Karet $percent_EVP_lucot $percent_EVP_Minnaugh $percent_EVP_NA
	by $tab into $write_row

End-Procedure


!***********************************************************************************
Begin-Procedure New-EVP-Total
!***********************************************************************************

Begin-Select
COUNT(*) &new_evp_total
FROM PS_GEX_EVP_MVMNT 
WHERE GEX_NEW_GEX_EVP = $EVP 
End-Select

End-Procedure 


!***********************************************************************************
Begin-Procedure Movement-Salary-Grade
!***********************************************************************************

Let $write_row = 'Movement by Salary Grade From: ' || $Rpt_From_Date || ' To: ' || $Rpt-Thru_Date 
do Write-Movement-Salary-Grade

Move '' to $write_row
do Write-Movement-Salary-Grade

String ' ' ' ' 'DESTINATION' by $tab into $write_row 
do Write-Movement-Salary-Grade

String 'S' ' ' '  NEW SG  ' by $tab into $write_row 
do Write-Movement-Salary-Grade

String 'O' 'OLD SG' '< 13' '>=13' 'Gand Total' by $tab into $write_row
do Write-Movement-Salary-Grade

move '< 13' to $sal_grade
move 'U' to $prefix
do Movement-Salary-Grade-row
move #count_sal_grade_greaterthan_13 to #sal_grade_greaterthan_13

move '>= 13' to $sal_grade
move 'R' to $prefix
do Movement-Salary-Grade-row
move #count_sal_grade_lessthan_13 to #sal_grade_lessthan_13

let #grand_total=#lessthan_13_total + #greaterthan_13_total

move #lessthan_13_total to $lessthan_13_total 999,999
move #greaterthan_13_total to $greaterthan_13_total 999,999
move #grand_total to $grand_total 999,999

String 'C' 'Grand Total' $lessthan_13_total $greaterthan_13_total $grand_total by $tab into $write_row
do Write-Movement-Salary-Grade

move 'E' to $write_row
do Write-Movement-Salary-Grade

let #percent_move_lowerSG = round((#sal_grade_lessthan_13/#lessthan_13_total)*100,0)
move #percent_move_lowerSG to $percent_move_lowerSG 999
let $percent_move_lowerSG = $percent_move_lowerSG||'%'
String ' ' '% Moves to a lower SG' '' '' $percent_move_lowerSG by $tab into $write_row
do Write-Movement-Salary-Grade
If #greaterthan_13_total <>  0 !Abhishek added as it was giving error divide by zero in dev 90
let #percent_move_greaterSG = round((#sal_grade_greaterthan_13/#greaterthan_13_total)*100,0)
else !Abhishek added as it was giving error divide by zero in dev 90
let #percent_move_greaterSG = 0 !Abhishek added as it was giving error divide by zero in dev 90
End-if !Abhishek added as it was giving error divide by zero in dev 90
move #percent_move_greaterSG to $percent_move_greaterSG 999
let $percent_move_greaterSG = $percent_move_greaterSG||'%'
String ' ' '% Moves to a higher SG' '' '' $percent_move_greaterSG by $tab into $write_row
do Write-Movement-Salary-Grade

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-Salary-Grade-row
!***********************************************************************************

move 0 to #count_sal_grade_lessthan_13
move 0 to #count_sal_grade_greaterthan_13
move 0 to #old_grand_total

Begin-Select
GEX_NEW_SAL_GRADE
COUNT(EMPLID) &count_sal_grade

   Evaluate &GEX_NEW_SAL_GRADE
   when = '< 13'
	move &count_sal_grade to #count_sal_grade_lessthan_13
	let #old_grand_total=#old_grand_total + &count_sal_grade
	let #lessthan_13_total=#lessthan_13_total + &count_sal_grade
	break
   when ='>= 13'
	move &count_sal_grade to #count_sal_grade_greaterthan_13
	let #old_grand_total=#old_grand_total + &count_sal_grade
	let #greaterthan_13_total=#greaterthan_13_total + &count_sal_grade
	break
   End-Evaluate

FROM PS_GEX_EVP_MVMNT 
WHERE GEX_OLD_SAL_GRADE=$sal_grade 
GROUP BY GEX_NEW_SAL_GRADE
End-Select

move #count_sal_grade_lessthan_13 to $count_sal_grade_lessthan_13 999,999
move #count_sal_grade_greaterthan_13 to $count_sal_grade_greaterthan_13 999,999
move #old_grand_total to $old_grand_total 999,999

String $prefix $sal_grade $count_sal_grade_lessthan_13 $count_sal_grade_greaterthan_13
	$old_grand_total by $tab into $write_row
do Write-Movement-Salary-Grade

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-Operation-Division
!***********************************************************************************

let $where_mdp_jobcodes = $GEXXX916_INCLUDE_JOBCODE_CRITERIA		 !Vendkxy changed the code for ITG 56880
let $GEXXX916_INCLUDE_JOBCODE_CRITERIA = '1=1'									 !Vendkxy added the code for ITG 56880
!show $where_mdp_jobcodes																				 !Vendkxy commented the code for ITG 56880

Let $write_row = 'Movement by Operating Division From: ' || $Rpt_From_Date || ' To: ' || $Rpt-Thru_Date 
do Write-Movement-Operation-Division

move '' to $write_row 
do Write-Movement-Operation-Division

String 'S' ' ' ' ' 'DESTINATION' '' by $tab into $write_row 
do Write-Movement-Operation-Division

String 'O' ' ' 'COD' 'COL' 'POD' 'Grand Total' by $tab into $write_row
do Write-Movement-Operation-Division

move 'COD' to $operation_division
do New-Operation-Division-Total
move &new_operation_division_total to #new_cod_total

move 'COL' to $operation_division
do New-Operation-Division-Total
move &new_operation_division_total to #new_col_total

move 'POD' to $operation_division
do New-Operation-Division-Total
move &new_operation_division_total to #new_pod_total


move 'COD' to $operation_division
move 'U' to $prefix
do Movement-Operation-Division-row
do Write-Movement-Operation-Division

move 'COL' to $operation_division
move 'R' to $prefix
do Movement-Operation-Division-row
do Write-Movement-Operation-Division

move 'POD' to $operation_division
move 'C' to $prefix
do Movement-Operation-Division-row
do Write-Movement-Operation-Division

let #grand_total=#new_cod_total + #new_col_total + #new_mod_total + #new_pod_total
move #grand_total to $grand_total 999,999
move #new_cod_total to $new_cod_total 999,999
move #new_col_total to $new_col_total 999,999
move #new_pod_total to $new_pod_total 999,999

String 'E' 'Grand Total' $new_cod_total $new_col_total $new_pod_total $grand_total by $tab into $write_row
do Write-Movement-Operation-Division


move '' to $write_row
do Write-Movement-Operation-Division

move '' to $write_row
do Write-Movement-Operation-Division


move '% of moves to the Destination Operating Division' to $write_row
do Write-Movement-Operation-Division

move '' to $write_row
do Write-Movement-Operation-Division

String 'S' ' ' ' ' 'DESTINATION' '' by $tab into $write_row 
do Write-Movement-Operation-Division

String 'O' ' ' 'COD' 'COL' 'POD' by $tab into $write_row
do Write-Movement-Operation-Division

move 'COD' to $operation_division
move 'U' to $prefix
do Movement-Operation-Division-Percent
do Write-Movement-Operation-Division

move 'COL' to $operation_division
move 'R' to $prefix
do Movement-Operation-Division-Percent
do Write-Movement-Operation-Division

move 'POD' to $operation_division
move 'C' to $prefix
do Movement-Operation-Division-Percent
do Write-Movement-Operation-Division

move 'E' to $write_row
do Write-Movement-Operation-Division

Let $GEXXX916_INCLUDE_JOBCODE_CRITERIA   =  $where_mdp_jobcodes 						 !Vendkxy added the code for ITG 56880

End-Procedure


!***********************************************************************************
Begin-Procedure MDP-Movement-Operation-Division
!***********************************************************************************
 !Vendkxy commented the code for ITG 56880
!let $where_mdp_jobcodes='AND GEX_NEW_JOBCODE IN ('''||'10007'||''','''||'10010'||''','''||'10012'||''','''
!		      ||'10013'||''','''||'10015'||''','''||'10018'||''','''||'10021'||''','''
!		      ||'10023'||''','''||'10027'||''','''||'10028'||''','''||'10029'||''','''
!		      ||'10031'||''','''||'10046'||''','''||'60004'||''','''||'60013'||''','''
!		      ||'70004'||''','''||'70013'||''','''||'70017'||''','''||'70029'||''','''
!		      ||'70031'||''','''||'80012'||''','''||'80017'||''','''||'80019'||''','''
!		      ||'80025'||''','''||'80044'||''','''||'80045'||''','''||'80066'||''','''
!		      ||'80069'||''')'
!show $where_mdp_jobcodes

Let $write_row = 'MDP Movement by Operating Division From: ' || $Rpt_From_Date || ' To: ' || $Rpt-Thru_Date 
do Write-MDP-Movement-Operation-Division

Move '' to $write_row
do Write-MDP-Movement-Operation-Division

String 'S' ' ' ' ' 'DESTINATION' by $tab into $write_row 
do Write-MDP-Movement-Operation-Division

String 'O' ' ' 'COD' 'COL' 'POD' 'Grand Total' by $tab into $write_row
do Write-MDP-Movement-Operation-Division

move 'COD' to $operation_division
do New-Operation-Division-Total
move &new_operation_division_total to #new_cod_total

move 'COL' to $operation_division
do New-Operation-Division-Total
move &new_operation_division_total to #new_col_total

move 'POD' to $operation_division
do New-Operation-Division-Total
move &new_operation_division_total to #new_pod_total


move 'COD' to $operation_division
move 'U' to $prefix
do Movement-Operation-Division-row
do Write-MDP-Movement-Operation-Division

move 'COL' to $operation_division
move 'R' to $prefix
do Movement-Operation-Division-row
do Write-MDP-Movement-Operation-Division

move 'POD' to $operation_division
move 'C' to $prefix
do Movement-Operation-Division-row
do Write-MDP-Movement-Operation-Division

let #grand_total=#new_cod_total + #new_col_total + #new_pod_total
move #grand_total to $grand_total 999,999
move #new_cod_total to $new_cod_total 999,999
move #new_col_total to $new_col_total 999,999
move #new_pod_total to $new_pod_total 999,999

String 'E' 'Grand Total' $new_cod_total $new_col_total $new_pod_total $grand_total by $tab into $write_row
do Write-MDP-Movement-Operation-Division


move '' to $write_row
do Write-MDP-Movement-Operation-Division

move '' to $write_row
do Write-MDP-Movement-Operation-Division


!let $where_mdp_jobcodes='AND Percent.GEX_NEW_JOBCODE IN ('''||'10007'||''','''||'10010'||''','''||'10012'||''','''
!		      ||'10013'||''','''||'10015'||''','''||'10018'||''','''||'10021'||''','''
!		      ||'10023'||''','''||'10027'||''','''||'10028'||''','''||'10029'||''','''
!		      ||'10031'||''','''||'10046'||''','''||'60004'||''','''||'60013'||''','''
!		      ||'70004'||''','''||'70013'||''','''||'70017'||''','''||'70029'||''','''
!		      ||'70031'||''','''||'80012'||''','''||'80017'||''','''||'80019'||''','''
!		      ||'80025'||''','''||'80044'||''','''||'80045'||''','''||'80066'||''','''
!		      ||'80069'||''')'
!show $where_mdp_jobcodes

move '% of moves to the Destination Operating Division' to $write_row
do Write-MDP-Movement-Operation-Division

move '' to $write_row
do Write-MDP-Movement-Operation-Division

String 'S' ' ' ' ' 'DESTINATION' '' by $tab into $write_row 
do Write-MDP-Movement-Operation-Division

String 'O' ' ' 'COD' 'COL' 'POD' by $tab into $write_row
do Write-MDP-Movement-Operation-Division

move 'COD' to $operation_division
move 'U' to $prefix
do Movement-Operation-Division-Percent
do Write-MDP-Movement-Operation-Division

move 'COL' to $operation_division
move 'R' to $prefix
do Movement-Operation-Division-Percent
do Write-MDP-Movement-Operation-Division

move 'POD' to $operation_division
move 'C' to $prefix
do Movement-Operation-Division-Percent
do Write-MDP-Movement-Operation-Division

move 'E' to $write_row
do Write-MDP-Movement-Operation-Division

End-Procedure


!***********************************************************************************
Begin-Procedure New-Operation-Division-Total
!***********************************************************************************

Begin-Select
COUNT(*) &new_operation_division_total
FROM PS_GEX_EVP_MVMNT percent														!Vendkxy changed the code for ITG 56880
WHERE percent.GEX_NEW_OPR_DIV = $operation_division			!Vendkxy changed the code for ITG 56880
AND percent.GEX_OLD_OPR_DIV <> ' '											!Vendkxy changed the code for ITG 56880
![$where_mdp_jobcodes]																	!Vendkxy commented the code for ITG 56880
And   [$GEXXX916_Include_Jobcode_Criteria]							!Vendkxy added the code for ITG 56880
End-Select

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-Operation-Division-row
!***********************************************************************************

move 0 to #count_operation_division_cod
move 0 to #count_operation_division_col
move 0 to #count_operation_division_pod
move 0 to #old_grand_total

Begin-Select
percent.GEX_NEW_OPR_DIV			 &movement.GEX_NEW_OPR_DIV			!Vendkxy changed the code for ITG 56880
COUNT(EMPLID) &count_operation_division

   Evaluate &movement.GEX_NEW_OPR_DIV												!Vendkxy changed the code for ITG 56880
   when = 'COD'
	move &count_operation_division to #count_operation_division_cod
	let #old_grand_total=#old_grand_total + &count_operation_division
	Break
   when = 'COL'
	move &count_operation_division to #count_operation_division_col
        let #old_grand_total=#old_grand_total + &count_operation_division
	Break
   when = 'POD'
	move &count_operation_division to #count_operation_division_pod
	let #old_grand_total=#old_grand_total + &count_operation_division
	Break
   End-Evaluate

FROM PS_GEX_EVP_MVMNT percent														!Vendkxy changed the code for ITG 56880
WHERE percent.GEX_OLD_OPR_DIV = $operation_division			!Vendkxy changed the code for ITG 56880
![$where_mdp_jobcodes]																	!Vendkxy commented the code for ITG 56880
And   [$GEXXX916_Include_Jobcode_Criteria]							!Vendkxy added the code for ITG 56880
GROUP BY percent.GEX_NEW_OPR_DIV												!Vendkxy changed the code for ITG 56880
End-Select

move #count_operation_division_cod to $count_operation_division_cod 999,999
move #count_operation_division_col to $count_operation_division_col 999,999
move #count_operation_division_pod to $count_operation_division_pod 999,999 
move #old_grand_total to $old_grand_total 999,999

String $prefix $operation_division $count_operation_division_cod $count_operation_division_col 
	$count_operation_division_pod $old_grand_total by $tab into $write_row

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-Operation-Division-Percent
!***********************************************************************************

move 0 to #count_operation_division_cod
move 0 to #count_operation_division_col
move 0 to #count_operation_division_pod
move 0 to #old_grand_total

move 0 to #percent_operation_division_cod
move 0 to #percent_operation_division_col
move 0 to #percent_operation_division_pod

Begin-Select
Percent.GEX_NEW_OPR_DIV
COUNT(Percent.EMPLID) &count_operation_division_per

   Evaluate &Percent.GEX_NEW_OPR_DIV
   when = 'COD'
	move &count_operation_division_per to #count_operation_division_cod
	let #old_grand_total = #old_grand_total + &count_operation_division_per
	let #percent_operation_division_cod = round((#count_operation_division_cod/#new_cod_total)*100,0)
	Break
   when = 'COL'
	move &count_operation_division_per to #count_operation_division_col
        let #old_grand_total = #old_grand_total + &count_operation_division_per
	let #percent_operation_division_coL = round((#count_operation_division_col/#new_col_total)*100,0)
	Break
   when = 'POD'
	move &count_operation_division_per to #count_operation_division_pod
	let #old_grand_total = #old_grand_total + &count_operation_division_per
	let #percent_operation_division_pod = round((#count_operation_division_pod/#new_pod_total)*100,0)
	Break
   End-Evaluate

FROM PS_GEX_EVP_MVMNT Percent
WHERE Percent.GEX_OLD_OPR_DIV = $operation_division
![$where_mdp_jobcodes]																!Vendkxy commented the code for ITG 56880
And   [$GEXXX916_Include_Jobcode_Criteria]							!Vendkxy added the code for ITG 56880
GROUP BY Percent.GEX_NEW_OPR_DIV
End-Select

move #percent_operation_division_cod to $percent_operation_division_cod 999
let $percent_operation_division_cod = $percent_operation_division_cod||'%'

move #percent_operation_division_col to $percent_operation_division_col 999
let $percent_operation_division_col = $percent_operation_division_col||'%'

move #percent_operation_division_pod to	$percent_operation_division_pod 999
let $percent_operation_division_pod = $percent_operation_division_pod||'%'

String $prefix $operation_division $percent_operation_division_cod 
	$percent_operation_division_col $percent_operation_division_pod 
	by $tab into $write_row

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-FullPartTime-EmployeeType
!***********************************************************************************

Let $write_row = 'Movement by Full/Part-Time Status & Employee Type From: ' || $Rpt_From_Date || ' To: ' || $Rpt-Thru_Date 
do Write-Movement-FullPartTime-EmployeeType

String ' ' by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

String ' ' ' ' ' ' 'DESTINATION' by $tab into $write_row 
do Write-Movement-FullPartTime-EmployeeType

String ' ' ' ' ' ' 'NEW FT/PT & EE TYPE' by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

String ' ' ' ' ' ' '         Full Time' '' 'Fulltime' '        Part Time' '' 'Parttime' 'Grand Total'
	 by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

String 'S' 'FT/PT' 'TYPE' 'Hourly' 'Salary' 'Total' 'Hourly' 'Salary' 'Total'
	by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

move 'H' to $new_empl_type 
move 'F' to $new_full_part_time
move 'F' to $old_full_part_time
do NewFullPartTime-EmployeeType-Total
move &new_ftpt_employeetype_total to #total1

move 'S' to $new_empl_type 
move 'F' to $new_full_part_time
move 'F' to $old_full_part_time
do NewFullPartTime-EmployeeType-Total
move &new_ftpt_employeetype_total to #total2

let #total3 = #total1 + #total2

move 'H' to $new_empl_type 
move 'P' to $new_full_part_time
move 'F' to $old_full_part_time
do NewFullPartTime-EmployeeType-Total
move &new_ftpt_employeetype_total to #total4

move 'S' to $new_empl_type 
move 'P' to $new_full_part_time
move 'F' to $old_full_part_time
do NewFullPartTime-EmployeeType-Total
move &new_ftpt_employeetype_total to #total5

let #total6 = #total4 + #total5
let #total7 = #total3 + #total6

move 'H' to $new_empl_type 
move 'F' to $new_full_part_time
move 'P' to $old_full_part_time
do NewFullPartTime-EmployeeType-Total
move &new_ftpt_employeetype_total to #total8

move 'S' to $new_empl_type 
move 'F' to $new_full_part_time
move 'P' to $old_full_part_time
do NewFullPartTime-EmployeeType-Total
move &new_ftpt_employeetype_total to #total9

let #total10 = #total8 + #total9

move 'H' to $new_empl_type 
move 'P' to $new_full_part_time
move 'P' to $old_full_part_time
do NewFullPartTime-EmployeeType-Total
move &new_ftpt_employeetype_total to #total11

move 'S' to $new_empl_type 
move 'P' to $new_full_part_time
move 'P' to $old_full_part_time
do NewFullPartTime-EmployeeType-Total
move &new_ftpt_employeetype_total to #total12

let #total13 = #total11 + #total12
let #total14 = #total10 + #total13

move 'F' to $full_part_time
move 'H' to $empl_type
move 'O' to $prefix
move 'Fulltime' to $prefix1
move 'Hourly' to $prefix2
do Movement-FullPartTime-EmployeeType-Row
let #moves_h_to_s = #count_fulltime_salary

move 'F' to $full_part_time
move 'S' to $empl_type
move 'U' to $prefix
move '' to $prefix1
move 'Salary' to $prefix2
do Movement-FullPartTime-EmployeeType-Row
let #moves_s_to_h = #count_fulltime_hourly + #count_parttime_hourly

move #total1 to $total1 999,999
move #total2 to $total2 999,999
move #total3 to $total3 999,999
move #total4 to $total4 999,999
move #total5 to $total5 999,999
move #total6 to $total6 999,999
move #total7 to $total7 999,999
String 'R' 'Fulltime Total' '' $total1 $total2 $total3 $total4 $total5 $total6 $total7
	by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

move 'P' to $full_part_time
move 'H' to $empl_type
move 'C' to $prefix
move 'Parttime' to $prefix1
move 'Hourly' to $prefix2
do Movement-FullPartTime-EmployeeType-Row
let #moves_h_to_s = #moves_h_to_s + #count_fulltime_salary

move 'P' to $full_part_time
move 'S' to $empl_type
move 'E' to $prefix
move '' to $prefix1
move 'Salary' to $prefix2
do Movement-FullPartTime-EmployeeType-Row

move #total8 to $total8 999,999
move #total9 to $total9 999,999
move #total10 to $total10 999,999
move #total11 to $total11 999,999
move #total12 to $total12 999,999
move #total13 to $total13 999,999
move #total14 to $total14 999,999
String '' 'Parttime Total' '' $total8 $total9 $total10 $total11 $total12 $total13 $total14
	by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

let #total15 = #total1 + #total8
let #total16 = #total2 + #total9
let #total17 = #total3 + #total10
let #total18 = #total4 + #total11
let #total19 = #total5 + #total12
let #total20 = #total6 + #total13
let #total21 = #total7 + #total14
move #total15 to $total15 999,999
move #total16 to $total16 999,999
move #total17 to $total17 999,999
move #total18 to $total18 999,999
move #total19 to $total19 999,999
move #total20 to $total20 999,999
move #total21 to $total21 999,999
String '' 'Grand Total    ' '' $total15 $total16 $total17 $total18 $total19 $total20 $total21
	by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

String ' ' by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

let #percent_ft_to_pt = round(((#total6/#total20) * 100),0)
move #percent_ft_to_pt to $percent_ft_to_pt 999
let $percent_ft_to_pt = $percent_ft_to_pt||'%'
String ' ' '% Moves from FT to PT' '' '' $percent_ft_to_pt by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

let #percent_pt_to_ft = round(((#total10/#total17) * 100),0)
move #percent_pt_to_ft to $percent_pt_to_ft 999
let $percent_pt_to_ft = $percent_pt_to_ft||'%'
String ' ' '% Moves from PT to FT' '' '' $percent_pt_to_ft by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

String ' ' by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType
If (#total16 + #total19) <> 0 !Abhishek added as it was giving error divide by zero in dev 90
let #percent_h_to_s = round(((#moves_h_to_s/(#total16 + #total19)) * 100),0)
Else !Abhishek added as it was giving error divide by zero in dev 90
let #percent_h_to_s = 0 !Abhishek added as it was giving error divide by zero in dev 90

End-if !Abhishek added as it was giving error divide by zero in dev 90
move #percent_h_to_s to $percent_h_to_s 999
let $percent_h_to_s = $percent_h_to_s||'%'
String ' ' '% Moves from H to S' '' '' $percent_h_to_s by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType
if (#total15 + #total18) <> 0  !Abhishek added as it was giving error divide by zero in dev 90
let #percent_s_to_h = round(((#moves_s_to_h/(#total15 + #total18)) * 100),0)
Else  !Abhishek added as it was giving error divide by zero in dev 90
let #percent_s_to_h = 0  !Abhishek added as it was giving error divide by zero in dev 90
End-if !Abhishek added as it was giving error divide by zero in dev 90

move #percent_s_to_h to $percent_s_to_h 999
let $percent_s_to_h = $percent_s_to_h||'%'
String ' ' '% Moves from S to H' '' '' $percent_s_to_h by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

End-Procedure


!***********************************************************************************
Begin-Procedure NewFullPartTime-EmployeeType-Total
!***********************************************************************************

Begin-Select
COUNT(*) &new_ftpt_employeetype_total
FROM PS_GEX_EVP_MVMNT
WHERE GEX_NEW_EMPL_TYPE = $new_empl_type 
AND GEX_NEW_FT_PT = $new_full_part_time
AND GEX_OLD_FT_PT = $old_full_part_time
End-Select

End-Procedure


!***********************************************************************************
Begin-Procedure Movement-FullPartTime-EmployeeType-Row
!***********************************************************************************

move 0 to #new_parttime_total
move 0 to #new_fulltime_total
move 0 to #count_fulltime_hourly
move 0 to #count_fulltime_salary
move 0 to #count_parttime_hourly
move 0 to #count_parttime_salary

Begin-Select
GEX_NEW_FT_PT
GEX_NEW_EMPL_TYPE
COUNT(EMPLID) &COUNT_EMPLTYPE_FTPT

   if &GEX_NEW_FT_PT = 'F' and &GEX_NEW_EMPL_TYPE = 'H'
	move &COUNT_EMPLTYPE_FTPT to #count_fulltime_hourly
	let #new_fulltime_total = #new_fulltime_total + #count_fulltime_hourly
   end-if

   if &GEX_NEW_FT_PT = 'F' and &GEX_NEW_EMPL_TYPE = 'S'
	move &COUNT_EMPLTYPE_FTPT to #count_fulltime_salary
	let #new_fulltime_total = #new_fulltime_total + #count_fulltime_salary
   end-if

   if &GEX_NEW_FT_PT = 'P' and &GEX_NEW_EMPL_TYPE = 'H'
	move &COUNT_EMPLTYPE_FTPT to #count_parttime_hourly
	let #new_parttime_total = #new_parttime_total + #count_parttime_hourly
   end-if

   if &GEX_NEW_FT_PT = 'P' and &GEX_NEW_EMPL_TYPE = 'S'
	move &COUNT_EMPLTYPE_FTPT to #count_parttime_salary
	let #new_parttime_total = #new_parttime_total + #count_parttime_salary
   end-if

FROM PS_GEX_EVP_MVMNT
WHERE GEX_OLD_EMPL_TYPE = $empl_type AND GEX_OLD_FT_PT = $full_part_time 
GROUP BY GEX_NEW_EMPL_TYPE, GEX_NEW_FT_PT
End-Select

let #old_grand_total = #new_parttime_total + #new_fulltime_total

move #count_fulltime_hourly to $count_fulltime_hourly 999,999
move #count_fulltime_salary to $count_fulltime_salary 999,999
move #new_fulltime_total to $new_fulltime_total 999,999
move #count_parttime_hourly to $count_parttime_hourly 999,999
move #count_parttime_salary to $count_parttime_salary 999,999
move #new_parttime_total to $new_parttime_total 999,999
move #old_grand_total to $old_grand_total 999,999

String $prefix $prefix1 $prefix2 $count_fulltime_hourly $count_fulltime_salary $new_fulltime_total
	$count_parttime_hourly $count_parttime_salary $new_parttime_total $old_grand_total
	 by $tab into $write_row
do Write-Movement-FullPartTime-EmployeeType

End-Procedure

!***********************************************************************************
Begin-Procedure Open-Files
!***********************************************************************************

!let $output_destination = '{OUTFILE}' !vendkxy for testing
Let $output_destination = '\\corp.gianteagle.com\common\HR\Metrics\EVP\Secure\Mobility - All Bus Areas\'   !vendkxy commented for testing
!let $output_destination =  '\\Ruchi\psprod\Temp\'				!GEX_MXT added

let $currdt = '_' || $fromdate || '_' || $thrudate
show '$currdt:' $currdt

   Let $file = 'Movement_Business_Area'
   Let $file = $output_destination || $file || $currdt || '.xls'
   show '$file:' $file
   Open $file
       As 1
       For-Writing
       Record=1000:Vary

   Let $file = 'Movement_Operation_Division'
   Let $file = $output_destination || $file || $currdt || '.xls'
   show '$file:' $file
   Open $file
       As 2
       For-Writing
       Record=1000:Vary

   Let $file = 'Movement_EVP'
   Let $file = $output_destination || $file || $currdt || '.xls'
   show '$file:' $file
   Open $file
       As 3
       For-Writing
       Record=1000:Vary

   Let $file = 'Movement_Salary_Grade'
   Let $file = $output_destination || $file || $currdt || '.xls'
   show '$file:' $file
   Open $file
       As 4
       For-Writing
       Record=1000:Vary

   Let $file = 'Movement_FullPartTime_EmployeeType'
   Let $file = $output_destination || $file || $currdt || '.xls'
   show '$file:' $file
   Open $file
       As 7
       For-Writing
       Record=1000:Vary

   !let $output_destination = 'S:\HR\Metrics\EVP\Secure\MDP\'
   Let $output_destination = '\\corp.gianteagle.com\common\HR\Metrics\EVP\Secure\MDP\'  !vendkxy commented for testing

   Let $file = 'MDP_Movement_Business_Area'
   Let $file = $output_destination || $file || $currdt || '.xls'
   show '$file:' $file
   Open $file
       As 5
       For-Writing
       Record=1000:Vary

   Let $file = 'MDP_Movement_Operation_Division'
   Let $file = $output_destination || $file || $currdt || '.xls'
   show '$file:' $file
   Open $file
       As 6
       For-Writing
       Record=1000:Vary
  
End-Procedure


!***********************************************************************************
Begin-Procedure Write-Movement-Business-Area
!***********************************************************************************

  Write 1 from $write_row Status=#filestat	

  If #filestat <> 0
     Show 'Error writing Movement_Business_Area file.  Program terminating.'
     Stop
  End-If

End-Procedure

!***********************************************************************************
Begin-Procedure Write-Movement-Operation-Division
!***********************************************************************************
  Write 2 from $write_row Status=#filestat	

  If #filestat <> 0
     Show 'Error writing file Movement_Operation_Division.  Program terminating.'
     Stop
  End-If

End-Procedure

!***********************************************************************************
Begin-Procedure Write-Movement-EVP
!***********************************************************************************
  Write 3 from $write_row Status=#filestat	

  If #filestat <> 0
     Show 'Error writing file Movement_EVP.  Program terminating.'
     Stop
  End-If

End-Procedure

!***********************************************************************************
Begin-Procedure Write-Movement-Salary-Grade
!***********************************************************************************
  Write 4 from $write_row Status=#filestat	

  If #filestat <> 0
     Show 'Error writing file Movement_Salary_Grade.  Program terminating.'
     Stop
  End-If

End-Procedure

!***********************************************************************************
Begin-Procedure Write-MDP-Movement-Business-Area
!***********************************************************************************
  Write 5 from $write_row Status=#filestat	

  If #filestat <> 0
     Show 'Error writing file MDP_Movement_Business_Area.  Program terminating.'
     Stop
  End-If

End-Procedure

!***********************************************************************************
Begin-Procedure Write-MDP-Movement-Operation-Division
!***********************************************************************************
  Write 6 from $write_row Status=#filestat	

  If #filestat <> 0
     Show 'Error writing file MDP_Movement_Operation_Division.  Program terminating.'
     Stop
  End-If

End-Procedure

!***********************************************************************************
Begin-Procedure Write-Movement-FullPartTime-EmployeeType
!***********************************************************************************
  Write 7 from $write_row Status=#filestat	

  If #filestat <> 0
     Show 'Error writing file Movement_FullPartTime_EmployeeType.  Program terminating.'
     Stop
  End-If

End-Procedure

#include 'curdttim.sqc'  !get-current-datetime procedure
#include 'datetime.sqc'  !routines for date and time formatting
#include 'number.sqc'    !routines to format numbers
#include 'stdapi.sqc'    !routines to update run status
#include 'gexxx922.sqc'  !Get pay single row run control
#include 'gexxx916.sqc'  !Get jobcode multiple row table			!Vendkxy added the code for ITG 56880