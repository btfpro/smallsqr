!**********************************************************************!
!  gpusyt40:  Create W-2 Print File                                    !
!**********************************************************************!
!                                                                      !
!               Confidentiality Information:                           !
!                                                                      !
!                                                                      !
! This module contains confidential and proprietary information        !
! of Oracle; it is not to be copied, reproduced, or transmitted        !
! in any form, by any means, in whole or in part, nor is it to         !
! be used for any purpose other than that for which it is              !
! expressly provided under the applicable license agreement.           !
!                                                                      !
! Copyright (C) 2006 Oracle. All Rights Reserved.                      !
!                                                                      !
!**********************************************************************!
!                                                                      !
!          $Date:  2006/08/31:17:55:45                                 !
!       $Release:  HR9                                                 !
!      $Revision:  104                                                 !
!                                                                      !
!**********************************************************************!

#DEFINE GPUSYT40        !Used for Tax Locality Sort
#include 'setenv.sqc'   !Set environment
#define PRINTER_TYPE LINEPRINTER

begin-setup
#include 'gpuspfrm.sqc' ! Form Layout selection
                        ! Edit this file to direct output to printer
#include 'setupdb.sqc'  ! Database specific setup

! The escape codes, unless otherwise noted, are for PCL-compatible printers
! being used as a line printer. If the printer you are using is not
! PCL-compatible, then these codes will not work as intended. Please refer
! to the user's manual for your printer to determine the correct codes.
!

#ifndef EBCDIC                       ! If not running on IBM MVS or AS/400

#if {PRINTER_TYPE} = 'LINEPRINTER'
declare-printer LP-definition
  type=LINEPRINTER
  init-string=<27>E<27>(0N<27>&l8D<27>&l0E<27>&l88F
!                 |      |      |       |       |
!                 |      |      |       |       |
!                 |      |      |       |        --> 88 text lines
!                 |      |      |        --> top margin = 0 lines
!                 |      |       --> 8 lines per inch
!                 |       --> ISO 8859-1 symbol set
!                  --> Reset
end-declare
#endif

#else                                ! EBCDIC Ports

#if {PRINTER_TYPE} = 'LINEPRINTER'
declare-printer LP-definition
  type=LINEPRINTER

! If you intended to download the output file created by SQR to print it on a
! PCL-compatible printer attached to an ASCII-bases operating system, such as
! Windows or Unix, use the following escape codes.
!
! Note: These codes may not work as intended if the output is copied to a
!       printer defined as a directly-attached printer or a remote network
!       printer, even if the printer is PCL-compatible
!
! init-string=<39>E<39>(0N<39>&l8D<39>&l0E<39>&l88F
!             |    |       |       |       |
!             |    |       |       |        --> 88 text lines
!             |    |       |        --> top margin = 0 lines
!             |    |        --> 8 lines per inch
!             |     --> ISO 8859-1 symbol set
!              --> Reset
!
! If you intended to copy the output file created by SQR to a printer defined as
! a directly-attached printer or a remote network printer on EBCDIC-bases operating
! systems, such as MVS or OS/400, use this init-string
!
! THIS IS THE DEFAULT FOR EBCDIC SYSTEMS
!
  init-string=<241>
!             |
!              --> FCFC "1" for top of page

end-declare
#endif

#endif

#if {PRINTER_TYPE} = 'POSTSCRIPT'
declare-printer PS-definition
  type={PRINTER_TYPE}
  point-size=12
  font=3                                 ! Courier font

! add STARTUP-FILE=dir\filename to change the symbol set

end-declare
#endif

#if {PRINTER_TYPE} = 'HPLASERJET'
declare-printer HP-definition
  type={PRINTER_TYPE}
  symbol-set=0U                          ! ASCII symbol set
  point-size=12
  pitch=10
  font=3

end-declare
#endif

declare-variable
      integer #MaxYear1
      integer #MaxYr_EIN
      integer #MaxYr-1
 end-declare

end-setup

begin-report
  do Init-Report
  do Stdapi-Term
end-report

begin-procedure Init-Report
  display ''
  display 'Printing W-2'

  display 'Start at: '  noline
  let $t1 =DateToStr(DateNow(),'hh:mi:ss')
  display $t1
  do Init-DateTime
  do Init-Number
  do Stdapi-Init
  do Initialization


     do Get-Tax-Reporting-Run-Controls
     do Convert-Parameters
     do emp-from-to

  move $TX.Reprint_Descr to $Reprint_Descr
  MOVE 1 TO #H
  MOVE 1 TO #G
  if &TX.GPUS_YE_ALIGNCOUNT > 0
    do Print-Alignment-Forms
  end-if

  let $MultiFormDescr   = ' '
  if $Reprint_Descr = '30'
    move 'REISSUED STATEMENT' to $ReprintDescr
    move 'REISSUED '          to $ReprintDescr1
    move 'STATEMENT'          to $ReprintDescr2
  else
    if $Reprint_Descr = '20'
      move 'CORRECTED         ' to $ReprintDescr
      move 'CORRECTED'          to $ReprintDescr1
      move '         '          to $ReprintDescr2
    else
      move '                  ' to $ReprintDescr
      move '         '          to $ReprintDescr1
      move '         '          to $ReprintDescr2
    end-if
  end-if
  do Report-File-Create
  if &TX.GPUS_YE_ALIGNCOUNT > 0
    add #Align_Count to #T_Count
  end-if

  if $EE_Selected = 'Y'
    do Delete-Sel-Employees-Table
  end-if

  if  $Company_Selected = 'Y'
    do  Delete-Sel-Company-Table
  end-if

  if $EmployeeFound = 'N'
    display ' '
    display '****** No Employee Records Selected ******'
    display ' '
    print '********************************'  (+3,1)
    print '  No Employee Records Selected  '  (+1,1)
    print '********************************'  (+1,1)
  else
    display ''
    display 'Upon successful conclusion of this program, one file will have'
    display 'been created:'
    display ''
    display '{IMPORTPREFIX}GPUSYT40.LIS contains print images for paper W-2s.'
    display ''
      do Print-Grand-Totals
  end-if

  display 'End at: '  noline
  let $t2 = DateToStr(DateNow(),'hh:mi:ss')
  display $t2
end-procedure

begin-procedure Initialization

!  Short edge offset - negative or positive decipoints
!     Modify the codes below to adjust up or down -
!     PCL code &lnnZ not effective on HP4000 printers

  let $LP6 = ''
  let $LP8L = ''
  let $LP8 = ''
#if {PRINTER_TYPE} = 'LINEPRINTER'
#ifndef EBCDIC
  encode '<27>&l6D<27>&l66F' into $LP6
  encode '<27>&l3A<27>&l104F<27>&l50Z' into $LP8L
  encode '<27>&l23Z' into $LP8
#else
!  encode '<39>&l6D<39>&l66F' into $LP6
!  encode '<39>&l3A<39>&l104F<39>&l50Z' into $LP8L
!  encode '<39>&l23Z' into $LP8
#endif
#endif

  do Get-Current-DateTime
  move '1' to $MMLZero
  move '1' to $Year4
  do Format-DateTime($AsOfToday, $910Date, {DEFYMD},'','')

  move $910Date to $AsOfYear xxxx   !extract the current year
  move $AsOfYear  to #AsOfYear
  move #AsOfYear  to #saveAsOfYear
  subtract 1    from #AsOfYear
  do Get-Tax-Reporting-Run-Controls
  if RTRIM(&TX.GPUS_PREPRTFORM,' ') = ''
    display '*********************************************************'
    display 'Form ID not specified on Tax Reporting Parameters Panel  '
    display 'Program stopped'
    display '*********************************************************'
    stop
  end-if

  move &TX.GPUS_YE_EE_PERPAGE to #EmployeesPerPage
  If not (#EmployeesPerPage > 0)
    display '**********************************************************************'
    display 'Employees Per Page not specified on Tax Reporting Parameters Panel    '
    display 'Program stopped'
    display '**********************************************************************'
    stop
  End-if

  let $Form_ID = RTRIM(&TX.GPUS_PREPRTFORM,' ')

  if $Form_ID <> '30'     !LSR03
     if $Form_ID <> '10'  !LPS4V
        display '*********************************************************'
        display 'U.S. Form ID  not specified on Tax Reporting             '
        display  &TX.GPUS_PREPRTFORM
        display 'Parameters Panel - Program stopped                       '
        display '*********************************************************'
        stop
     end-if
  end-if

  if $Form_ID = '10'      !LPS4V
      #ifndef LayoutW2-8LF
        show 'For FormId "LPS4V", LayoutW2-8LF should be defined in gpuspfrm.sqc'
        stop
      #endif
      if #EmployeesPerPage <> 1
        display '*********************************************************'
        display 'Employees per page specified in Tax reporting Parameters'
        display 'must be "1" for Form ID "LPS4V".'
        display 'Program stopped'
        display '*********************************************************'
        stop
      end-if
      let #WCOLUMN1 = 2
      let #WCOLUMN2 = 42
      print $LP8L () code               ! Decipoints

  end-if

  if $Form_ID = '30'      !LSR03
      #ifndef LayoutW2-6
        show 'For FormId "LSR03", LayoutW2-6 should be defined in gpuspfrm.sqc'
        stop
      #endif
      let #WCOLUMN1 = 3
      let #WCOLUMN2 = 42
      print $LP6 () code                 ! Decipoints

  end-if

  move &TX.CALENDAR_YEAR to $CalYear 9999
  let $BefAsOfDate = $CalYear || '0101'
  let $AsOfDate = $CalYear || '1231'
  do Format-DateTime($AsOfDate, $AsOfDate, {DEFCMP}, '', 'native')
  do Format-DateTime($BefAsOfDate, $BefAsOfDate, {DEFCMP}, '', 'native')
  do Load-W2-PRT

  move 0 to #T_Count
  move 0 to #Form#
  move 0 to #P_Count

  if $Layout_Style = '10'
    COLUMNS #WCOLUMN1
    move 2 to #FormsPerPage
  end-if

  if $Layout_Style = '20'
    COLUMNS #WCOLUMN1
    move 4 to #FormsPerPage
  end-if

  if #EmployeesPerPage  > #FormsPerPage
      or ($Layout_Style = '20' and #EmployeesPerPage = 2)
      or ($Layout_Style = '20' and #EmployeesPerPage = 3)
   display '*********************************************************'
   display 'Employees Per Page specifed on Tax Reporting Parameters  '
   display 'Panel is not valid for the Layout Style selected         '
   display '*********************************************************'
   stop
  end-if

begin-SELECT
TEMP_SSN_MASK
FROM PS_INSTALLATION
end-SELECT

  create-array name=Box14 size=27
    field=Text:char
    field=Column:number
    field=Amount:number

end-procedure

begin-procedure Report-File-Create
  move 'N' to $EmployeeFound
  let $SortSQL10 = $Sort2

begin-SELECT
A.GPUS_YE_RPT_CO
A.DESCR
A.GPUS_TAX_EIN
A.ADDRESS1
A.ADDRESS2
A.ADDRESS3
A.CITY
A.STATE
A.POSTAL
A.COUNTRY

  move &A.GPUS_TAX_EIN     to $Federal_EIN 099999999
  move $Federal_EIN       to $A.Federal_EIN xx-xxxxxxx
  move &A.Descr           to $A.Descr
  move &A.Address1        to $A.Address1
  move &A.Address2        to $A.Address2
  move &A.Address3        to $A.Address3
  move &A.Country         to $A.Country
  let  $A.City            =  RTRIM(&A.City,' ')
  let  $A.State = rtrim(&A.State, ' ')
  move &A.Postal          to $A.Zip
  move &A.GPUS_YE_RPT_CO to $A.W2_Reporting_Co

  UPPERCASE $A.Descr
  UPPERCASE $A.Address1
  UPPERCASE $A.Address2
  UPPERCASE $A.Address3
  UPPERCASE $A.Country
  UPPERCASE $A.City

  let $A.Federal_EIN = substr($A.Federal_EIN,1,#YE_ER_ID_Box_Size)
  let $A.Descr = substr($A.Descr,1,#YE_ER_Name_Box_Size)
  let $A.Address1 = substr($A.Address1,1,#YE_ER_Address1_Box_Size)
  let $A.Address2 = substr($A.Address2,1,#YE_ER_Address2_Box_Size)
  let $A.Address3 = substr($A.Address3,1,#YE_ER_Address2_Box_Size)

  move 0 to #I_Count

  evaluate $SortCode1

    when = '10'
    when = '50'
    when = '60'
      do Read-Employee-Data

    break

    when = '20'
    when = '30'
    when = '40'
      do W2-Sort
    break

  end-evaluate

  DO GET-MAX-EFFDATE

FROM  PS_GPUS_YE_CO_TBL A
WHERE A.EFFDT = ( SELECT MAX(B.EFFDT) FROM PS_GPUS_YE_CO_TBL B
                  WHERE B.GPUS_YE_RPT_CO = A.GPUS_YE_RPT_CO AND B.EFFDT <= $AsOfDate) 
 [$A.SelectedCompanies]    !NULL string if SELECT Company option not used
 ORDER BY A.GPUS_YE_RPT_CO
end-SELECT
end-procedure

begin-procedure GET-MAX-EFFDATE
begin-SELECT
MAX(W.EFFDT) &DT
 let  $YR_EFFDT = datetostr(&DT,'YYYY')
 let #MaxYr1 = to_Number($YR_EFFDT)

FROM PS_GPUS_YE_CO_TBL W
WHERE W.EFFDT <= $AsOfDate
  AND W.GPUS_YE_RPT_CO = &A.GPUS_YE_RPT_CO


END-SELECT
end-procedure


begin-procedure Read-Employee-Data

begin-SELECT
E.GPUS_TAX_EIN
E.GPUS_YE_RPT_CO
E.EMPLID           () on-break level=1 print=never before=Before-EmplID
E.GPUS_TAXFORM_ID
E.GPUS_SEQ_NBR     () on-break level=2 print=never AFTER=After-Seq
E.GPUS_CONTROL_NBR
E.GPUS_SWT_EIN
E.SSN
E.GPUS_YE_STATE
E.GPUS_YE_FNAME
E.GPUS_YE_MNAME
E.GPUS_YE_LNAME
E.GPUS_YE_SUFFIX
E.ADDRESS1
E.ADDRESS2
E.ADDRESS3
E.CITY
E.STATE
E.POSTAL
E.COUNTRY
E.GPUS_STATUTORYFLAG
E.GPUS_PENSION_FLAG
E.GPUS_3SICKPAY_FLAG
E.GPUS_YE_STATUS

  move &E.GPUS_SEQ_NBR to #tempnum
  let $tempEmplid = &E.EmplID

  if $tempEmplid = $E.Emplid and #tempnum = #E.Sequence_Number and rtrim(&E.GPUS_YE_STATE,' ') <> $E.GPUS_YE_STATE
       let $Check-ID = 'Y'
  end-if
  if &E.GPUS_STATUTORYFLAG  = 'Y'
     move &E.GPUS_STATUTORYFLAG  to $E.Statutory_Ee
  end-if
  if &E.GPUS_PENSION_FLAG   = 'Y'
     move &E.GPUS_PENSION_FLAG  to $E.Pension_Plan
  end-if
  if &E.GPUS_3SICKPAY_FLAG   = 'Y'
     move &E.GPUS_3SICKPAY_FLAG to $E.Thirdparty_Sickpay
  end-if

  move &E.GPUS_TAXFORM_ID      to $E.TaxForm_ID
  move &E.GPUS_SEQ_NBR to #E.Sequence_Number

  move &E.GPUS_TAX_EIN to $E.GPUS_TAX_EIN

  if $Check-ID = 'Y'
     if RTRIM(&E.GPUS_YE_STATE,' ') <> ''
       move &E.GPUS_YE_STATE to $E.GPUS_YE_STATE
       move &E.GPUS_SWT_EIN to $E.Employer_ID_SWT
     else
       if $TempST <> ' '
        let $E.GPUS_YE_STATE  = $TempST
        let $E.Employer_ID_SWT = $TempSWT
       else
        let $E.GPUS_YE_STATE = ' '
        let $E.Employer_ID_SWT = ' '
       end-if
     end-if
     let $Check-ID = 'N'
  else
    move &E.GPUS_YE_STATE to $E.GPUS_YE_STATE
    if RTRIM(&E.GPUS_SWT_EIN,' ') <> ''
       move &E.GPUS_SWT_EIN to $E.Employer_ID_SWT
    else
       let $E.Employer_ID_SWT = ' '
    end-if
  end-if

   let $E.Employer_ID_SWT = substr($E.Employer_ID_SWT,1,#YE_State_ID_Box_Size)

   let $TempSWT =  $E.Employer_ID_SWT
   let $TempST = $E.GPUS_YE_STATE

  move 'Y' to $EmployeeFound

  DO GET-MAX-EFFDT-EIN
FROM PS_GPUS_YE_EE5_VW E
where E.GPUS_CAL_YEAR    = &TX.CALENDAR_YEAR
  AND E.GPUS_TAX_EIN   = &A.GPUS_TAX_EIN
  [$E.SelectedCompanies]    !NULL string if SELECT Company option not used
  AND E.GPUS_TAXFORM_ID  = '10'
  [$E.SelectedEEs]          !NULL string if SELECT EEs option not used
  [$fromtoE]                !NULL string if STREAM NUMBER option not used
  AND E.GPUS_YE_STATUS  <> '20'
  AND #MaxYr_EIN        <= E.GPUS_CAL_YEAR
  [$Sort2]
end-SELECT
end-procedure

begin-procedure GET-MAX-EFFDT-EIN
begin-SELECT
MAX(W.EFFDT) &EFFDT

 let $MaxYr = DatetoStr(&EFFDT)
 let $MaxYr = substr($MaxYear,6,10)
 let #MaxYr_EIN = to_Number($MaxYear)


FROM PS_GPUS_YE_CO_TBL W
WHERE W.EFFDT <= $AsOfDate
 AND W.GPUS_TAX_EIN = &E.GPUS_TAX_EIN
END-SELECT
end-procedure


begin-procedure Before-EmplID
  move &E.EmplID   to $E.EmplID
  move 0 to #MultiForm
  let $TempSWT = ' '
  let $TempST = ' '

  move &E.SSN to $S123 xxx
  if $S123 = &Temp_SSN_Mask or RTRIM(&E.SSN, ' ') = ''
    move 'Applied For' to $E.SSN
  else
    move &E.SSN to $E.SSN xxx-xx-xxxx
  end-if
  move &E.GPUS_YE_FNAME to $E.Name
  move &E.GPUS_YE_FNAME to $E.Fname
  move &E.GPUS_YE_MNAME to $E.MiddleName
  move &E.GPUS_YE_LNAME to $E.Lname
  move &E.GPUS_YE_SUFFIX to $E.Suffix
  let $E.Fname = rtrim($E.Fname, ' ')  || ' '
  let $E.Name = rtrim($E.Name, ' ')  || ' '
  let $E.MiddleName = rtrim($E.MiddleName, ' ') || ' '
  let $E.Lname = rtrim($E.Lname, ' ')  || ' '
  let $E.Suffix =rtrim($E.Suffix, ' ')  || ' '
  if $E.MiddleName <> ' '
    let $E.YE_Name = $E.Name || $E.MiddleName || $E.Lname || $E.Suffix
  else
    let $E.YE_Name = $E.Name || $E.Lname || $E.Suffix
  end-if

  move $E.YE_Name to $YE_Name
  move $YE_Name to $E.YE_Name

  if $E.MiddleName <> ' '
    let $E.YE_Fname = $E.Fname || $E.MiddleName
  else
    let $E.YE_Fname = $E.Fname
  end-if

  if $E.Suffix <> ' '
    let $E.YE_Lname = $E.Lname ||  $E.Suffix
  else
    let $E.YE_Lname = $E.Lname
  end-if
  move $E.YE_Fname to $YE_Fname
  move $YE_Fname to $E.YE_Fname

  move $E.YE_LName to $YE_LName
  move $YE_LName to $E.YE_LName

  let $Use_Alternate_Name = 'N'

  if ($Form_ID = '30' and (Length($E.YE_FName) > #YE_EE_FName_Box_Size          !LSR03
                           or Length($E.YE_LName) > #YE_EE_LName_Box_Size))
  or ($Form_ID <> '30' and Length($E.YE_Name)  > #YE_EE_FullName_Box_Size)      !LSR03
      let $Use_Alternate_Name = 'Y'
      if $E.MiddleName <> ' '
          Let $Alternate_Name = substr($E.YE_FName,1,1) || ' ' || substr($E.MiddleName,1,1) || ' ' ||$E.YE_LName
      else
          Let $Alternate_Name = substr($E.YE_Fname,1,1) || ' ' || $E.YE_LName
      end-if
      if $Form_ID = '30'  !LSR03
         Let $Alternate_Name = substr($Alternate_Name,1,(#YE_EE_FName_Box_Size + #YE_EE_LName_Box_Size))
      else
         Let $Alternate_Name = substr($Alternate_Name,1,#YE_EE_FullName_Box_Size)
      end-if
  end-if


  move &E.GPUS_CONTROL_NBR  to $E.Control_Number
  move &E.Address1        to $E.Address1
  move &E.Address2        to $E.Address2
  move &E.Address3        to $E.Address3
  move &E.Country         to $E.Country
  let  $E.City            =  RTRIM(&E.City,' ')
  let $E.State = rtrim(&E.State, ' ')
  move &E.Postal          to $E.Zip

  uppercase $E.YE_Name
  uppercase $E.Address1
  uppercase $E.Address2
  uppercase $E.Address3
  uppercase $E.Country
  uppercase $E.City

  let $E.Control_Number = substr($E.Control_Number,1,#YE_Control_Nbr_Box_Size)
  let $E.SSN = substr($E.SSN,1,#YE_EE_SSN_Box_Size)
  let $E.YE_Name = substr($E.YE_Name,1,#YE_EE_FullName_Box_Size)
  let $E.Address1 = substr($E.Address1,1,#YE_EE_Address1_Box_Size)
  let $E.Address2 = substr($E.Address2,1,#YE_EE_Address2_Box_Size)
  let $E.Address3 = substr($E.Address3,1,#YE_EE_Address2_Box_Size)

  let $E.YE_FName = substr($E.YE_Fname,1,#YE_EE_FName_Box_Size)
  let $E.YE_LName = substr($E.YE_LName,1,#YE_EE_LName_Box_Size)

  if $Form_ID = '10'  !LPS4V
  and #Align_Count = 0
  end-if

  if #T_Count = 0
    move 0 to #Form#
  end-if

end-procedure


begin-procedure After-Seq
  do Load-Amounts
  do Print-W2

  if &E.GPUS_SEQ_NBR = 1
    add 1 to #I_Count
  end-if

end-procedure

begin-procedure Print-W2

    do Identify-Box12-Entries
    let $Box12PrintString = SUBSTR($Box12CheckString,1,4)

  move 0 to #NextLocal
  move 0 to #HoldNextLocal
  move 1 to #j
display 'STATS'
display #FormsPerPage
display #EmployeesPerPage
  if #EmployeesPerPage > 0
   while #j <= #FormsPerPage/#EmployeesPerPage  !loop for individual ee's

    if $Form_ID = '10'  !LPS4V
    and #Align_Count = 0
    and #j = 1
       do LongNameAddressEE
    end-if

    do Next-Form
    do Print-ER-Data

    do Print-EE-Data
    do Print-Fed-State-Amounts
    do Print-Box14
    if #E.Sequence_Number = 1 or #Align_Count > 0
      do Print-Box13
    end-if

    do Print-Box12

    add 1 to #j
   end-while
  end-if

      let $Box12CheckString = LTRIM($Box12CheckString,$Box12PrintString)
    while $Box12CheckString <> ''
      let $Box12PrintString = SUBSTR($Box12CheckString,1,4)
      move 1 to #j
      while #j <= #FormsPerPage/#EmployeesPerPage  !loop for individual ee's

        if $Form_ID = '10'   !LPS4V
        and #Align_Count = 0
        and #j = 1
           do LongNameAddressEE
        end-if

        do Next-Form
        do Print-ER-Data
        do Print-EE-Data
        do Print-Box12
        do Print-Suppl-Box14
        add 1 to #j
      end-while
      let $Box12CheckString = LTRIM($Box12CheckString,$Box12PrintString)
    end-while

  move 0 to #Fed_Wages
  move 0 to #Fed_Tax
  move 0 to #SS_Wages
  move 0 to #SS_Tax
  move 0 to #Med_Wages
  move 0 to #Med_Tax
  move 0 to #SS_Tips
  move 0 to #Alloc_Tips
  move 0 to #Adv_EIC
  move 0 to #Dep_Care
  move 0  to #Non_Qual_457_Amt
  move 'N' to $Non_Qual_457_Y
  move 'N' to $Non_Qual_457_N
  move 0 to #Uncoll_SS_Tax_On_Tips
  move 0 to #Uncoll_Med_Tax_On_Tips
  move 0 to #Group_Term_Life
  move 0 to #401K
  move 0 to #403B
  move 0 to #408K6
  move 0 to #457B
  move 0 to #501C18D
  move 0 to #Sick_Pay
  move 0 to #Excise_Tax
  move 0 to #Business_Exp
  move 0 to #Uncoll_SS_Tax_GTL
  move 0 to #Uncoll_Med_Tax_GTL
  move 0 to #Excl_Moving_Exp
  !move 0 to #Basic_Qtrs_and_Subsist
  move 0 to #NonTaxable_Combat_Pay
  move 0 to #Med_Svgs_Acct
  move 0 to #408P_Simple_Retirement
  move 0 to #Adoption_Exp
  move 0 to #NonStatutory_Stock_Opt
  move 0 to #NonQual_Def_Comp
  move 0 to #Income_NonQual_Def_Comp
  move 0 to #State_Wages
  move 0 to #State_Tax
  move 0 to #OtherA
  move 0 to #OtherB
  move 0 to #OtherC
  move 0 to #OtherD
  move 0 to #OtherE
  move 0 to #OtherF
  move 0 to #OtherG
  move 0 to #OtherH
  move 0 to #OtherI
  move 0 to #OtherJ
  move 0 to #OtherK
  move 0 to #OtherL
  move 0 to #OtherM
  move 0 to #OtherN
  move 0 to #OtherO
  move 0 to #OtherP
  move 0 to #OtherQ
  move 0 to #OtherR
  move 0 to #OtherS
  move 0 to #OtherT
  move 0 to #OtherU
  move 0 to #OtherV
  move 0 to #OtherW
  move 0 to #OtherX
  move 0 to #OtherY
  move 0 to #OtherZ
  if #Align_Count = 0
    do Zero-Box14
  end-if

  move ' ' to $E.Statutory_Ee
  move ' ' to $E.Pension_Plan
  move ' ' to $E.Thirdparty_Sickpay

end-procedure

begin-procedure Print-ER-Data

  if #H > #Align_Count
             Let $Name       = $A.Descr
             Let $address1   = $A.Address1
             Let $address2   = $A.Address2
             Let $address3   = $A.Address3
             Let $City       = $A.City
             Let $State      = $A.State
             Let $Postal     = $A.Zip
             Let $Country    = $A.Country

  do adformat
  do Compress-Address

        Let $COname         = $ADDLINE1
        Let $COADD1         = $ADDLINE2
        Let $COADD2         = $ADDLINE3
        Let $CSP            = $ADDLINE31
if RTRIM($COADD2, ' ') = 'USA'
               Let $COADD2 = ''
        end-if
        if RTRIM($CSP, ' ') = 'USA'
               Let $CSP = ''
        end-if

       IF (instr ($COADD2,$A.City,0) > 0 AND LENGTH($COADD2) > #YE_EE_Country_Box_Size)
        OR (instr ($CSP,$A.City,0) > 0 AND LENGTH($CSP) > #YE_EE_Country_Box_Size)

           IF LENGTH($COADD2) > #YE_EE_Country_Box_Size
             let #newlength = length($A.City) + #YE_State_City_Zip_Box_Size - length($COADD2)
             let $A.City = substr($A.City,1,#newlength)
           ELSE
             let #newlength = length($A.City) + #YE_EE_Country_Box_Size - length($CSP)
             let $A.City = substr($A.City,1,#newlength)
           END-IF

             Let $Name       = $A.Descr
             Let $address1   = $A.Address1
             Let $address2   = $A.Address2
             Let $address3   = $A.Address3
             Let $City       = $A.City
             Let $State      = $A.State
             Let $Postal     = $A.Zip
             Let $Country    = $A.Country

          do adformat
          do Compress-Address

             Let $COname         = $ADDLINE1
             Let $COADD1         = $ADDLINE2
             Let $COADD2         = $ADDLINE3
             Let $CSP            = $ADDLINE31

              if RTRIM($COADD2, ' ') = 'USA'
               Let $COADD2 = ''
              end-if
              if RTRIM($CSP, ' ') = 'USA'
               Let $CSP = ''
              end-if

      END-IF
       let #gok1 = instr ($CSP,$A.City,0)
        let #gok = instr ($COADD2,$A.City,0)
        let #gok2 = LENGTH($COADD2)
        LET $ADDLINE1       = ''
  do Print-Value($A.Federal_EIN,#L_B,#C_B,'Box B')
  do Print-Value($COname,#L_C1,#C_C1,'Box C1')
  do Print-Value($COADD1,#L_C2,#C_C2,'Box C2')

  if RTRIM($COADD2, ' ') <> ''
      do Print-Value($COADD2,#L_C3,#C_C3,'Box F2')
      move 'N' to $LineShift
  else
      move 'Y' to $LineShift
  end-if
  if $LineShift = 'Y'
      let #PrintLine = #L_C3
  else
      let #PrintLine = #L_C4
  end-if
    do Print-Value($CSP,#PrintLine,#C_C4,'Box F3')
else
       add 1 to #H
       do Print-Value($A.Federal_EIN,#L_B,#C_B,'Box B')
       do Print-Value($A.Descr,#L_C1,#C_C1,'Box C1')
       do Print-Value($A.Address1,#L_C2,#C_C2,'Box C2')
   if RTRIM($A.Address2, ' ') <> ''
       do Print-Value($A.Address2,#L_C3,#C_C3,'Box F2')
       move 'N' to $LineShift
   else
       move 'Y' to $LineShift
   end-if
   if #Align_Count = 0
    if $A.Country = 'USA'
      move $A.Zip            to $A.ZipExtsn ~~~~~~xxxx
      if instr($A.Zip,'-',6) = 0
      and $A.ZipExtsn <> '    '
        let $A.Zip = substr($A.Zip,1,5) || '-' || substr($A.Zip,6,4)
      end-if
      let $C4 = $A.City || ' ' || $A.State || ' ' || $A.Zip
      if length($C4) > #YE_State_City_Zip_Box_Size
          let #newlen = length($A.City) + #YE_State_City_Zip_Box_Size - length($C4)
          let $C4 = substr($A.City,1,#newlen) || ' ' || $A.State || ' ' || $A.Zip
      end-if
    else
      let $C4 = $A.City || ' ' || $A.State || ' ' ||
              $A.Country || ' ' || $A.Zip
      if length($C4) > #YE_State_City_Zip_Box_Size
          let #newlen = length($A.City) + #YE_State_City_Zip_Box_Size - length($C4)
          let $C4 = substr($A.City,1,#newlen) || ' ' || $A.State || ' ' ||
                  $A.Country || ' ' || $A.Zip
      end-if
    end-if
  end-if
  if $LineShift = 'Y'
    let #PrintLine = #L_C3
  else
    let #PrintLine = #L_C4
  end-if
  do Print-Value($C4,#PrintLine,#C_C4,'Box F3')
 end-if   

end-procedure

begin-procedure Print-EE-Data
 if #G > #Align_Count
  add 1 to #T_Count
  do Print-Value($E.Control_Number,#L_A,#C_A,'Box A')

  Evaluate $Form_id

   when = '10'      !LPS4V
  do Print-Value($ReprintDescr1, #L_R1, #C_R1, 'Box R1')
  do Print-Value($ReprintDescr2, #L_R2, #C_R2, 'Box R2')
      break
     when-other
       do Print-Value($ReprintDescr, #L_R, #C_R, 'Box R')
       break
   end-evaluate

  if $Form_ID <> '10'     !LPS4V
     if &E.GPUS_YE_STATUS = '20' or #Align_Count <> 0
        do Print-Value('X',#L_V,#C_V,'Box V')
     end-if
  end-if

  do Print-Value($E.SSN,#L_D,#C_D,'Box D')
  if $Form_ID <> '30'     !LSR03
    if $Use_Alternate_Name = 'Y'
        do Print-Value($Alternate_Name,#L_E,#C_E,'Box E')
    else
        do Print-Value($E.YE_Name,#L_E,#C_E,'Box E')
    end-if
  else
    if $Use_Alternate_Name = 'Y'
        do Print-Value($Alternate_Name,#L_E1,#C_E1,'Box E1')
    else
        do Print-Value($E.YE_FName,#L_E1,#C_E1,'Box E1')
        do Print-Value($E.YE_LName,#L_E3,#C_E3,'Box E3')
    end-if
  end-if


               Let $Name       = ''
               Let $address1   = $E.Address1
               Let $address2   = $E.Address2
               Let $address3   = $E.Address3
               Let $City       = $E.City
               Let $State      = $E.State
               Let $Postal     = $E.Zip
               Let $Country    = $E.Country

    do adformat
    do Compress-Address

            Let $EPADD1             = $ADDLINE1
            Let $EPADD2             = $ADDLINE2
            Let $EPCSP              = $ADDLINE3
         if RTRIM($EPADD2, ' ') = 'USA'
                Let $COADD2 = ''
         end-if
         if RTRIM($EPCSP, ' ') = 'USA'
                Let $EPCSP = ''
         end-if
 
          IF (instr ($EPADD2,$E.City,0) > 0 AND LENGTH($EPADD2) > #YE_EE_Country_Box_Size)
          OR (instr ($EPCSP,$E.City,0) > 0 AND LENGTH($EPCSP) > #YE_EE_Country_Box_Size)

           IF LENGTH($EPADD2) > #YE_EE_Country_Box_Size
             let #newlength = length($E.City) + #YE_EE_Country_Box_Size - length($EPADD2)
             let $E.City = substr($E.City,1,#newlength)
           ELSE
             let #newlength = length($E.City) + #YE_EE_Country_Box_Size - length($EPCSP)
             let $E.City = substr($E.City,1,#newlength)
           END-IF

                 Let $Name       = ''
                 Let $address1   = $E.Address1
                 Let $address2   = $E.Address2
                 Let $address3   = $E.Address3
                 Let $City       = $E.City
                 Let $State      = $E.State
                 Let $Postal     = $E.Zip
                 Let $Country    = $E.Country

          do adformat
          do Compress-Address

              Let $EPADD1             = $ADDLINE1
              Let $EPADD2             = $ADDLINE2
              Let $EPCSP              = $ADDLINE3

          if RTRIM($EPADD2, ' ') = 'USA'
                 Let $COADD2 = ''
          end-if
          if RTRIM($EPCSP, ' ') = 'USA'
                 Let $EPCSP = ''
          end-if

      END-IF

        let #gok1H = instr ($EPCSP,$E.City,0)
        let #gokH = instr ($EPADD2,$E.City,0)
        let #gok2H = LENGTH($EPADD2)

    do Print-Value($EPADD1,#L_F1,#C_F1,'Box F1')
    if RTRIM($EPADD2, ' ') <> ''
       do Print-Value($EPADD2,#L_F2,#C_F2,'Box F2')
       move 'N' to $LineShift
         else
           move 'Y' to $LineShift
    end-if
    if $LineShift = 'Y'
       let #PrintLine = #L_F2
     else
       let #PrintLine = #L_F3
    end-if
    do Print-Value($EPCSP,#PrintLine,#C_F3,'Box F3')
 ELSE

      add 1 to #T_Count
      add 1 to #G
      do Print-Value($E.Control_Number,#L_A,#C_A,'Box A')

      Evaluate $Form_id

        when = '10' !LPS4V
          do Print-Value($ReprintDescr1, #L_R1, #C_R1, 'Box R1')
          do Print-Value($ReprintDescr2, #L_R2, #C_R2, 'Box R2')
          break
        when-other
           do Print-Value($ReprintDescr, #L_R, #C_R, 'Box R')
           break
       end-evaluate

      if $Form_ID <> '10' !LPS4V
         if &E.GPUS_YE_STATUS = '20' or #Align_Count <> 0
           do Print-Value('X',#L_V,#C_V,'Box V')
         end-if
      end-if

      do Print-Value($E.SSN,#L_D,#C_D,'Box D')
      if $Form_ID <> '30'
        if $Use_Alternate_Name = 'Y'
            do Print-Value($Alternate_Name,#L_E,#C_E,'Box E')
        else
            do Print-Value($E.YE_Name,#L_E,#C_E,'Box E')
        end-if
      else
        if $Use_Alternate_Name = 'Y'
            do Print-Value($Alternate_Name,#L_E1,#C_E1,'Box E1')
        else
            do Print-Value($E.YE_FName,#L_E1,#C_E1,'Box E1')
            do Print-Value($E.YE_LName,#L_E3,#C_E3,'Box E3')
        end-if
      end-if
      do Print-Value($E.Address1,#L_F1,#C_F1,'Box F1')
      if RTRIM($E.Address2, ' ') <> ''
        do Print-Value($E.Address2,#L_F2,#C_F2,'Box F2')
        move 'N' to $LineShift
      else
        move 'Y' to $LineShift
      end-if

      if #Align_Count = 0
         do Get-EE-Address-Line3
      end-if

      if $LineShift = 'Y'
        let #PrintLine = #L_F2
      else
        let #PrintLine = #L_F3
      end-if
      do Print-Value($F3,#PrintLine,#C_F3,'Bo   x F3')

    END-IF      

end-procedure

begin-procedure Get-EE-Address-Line3
    if $E.Country = 'USA'
      move $E.Zip            to $E.ZipExtsn ~~~~~~xxxx
      if instr($E.Zip,'-',6) = 0
      and $E.ZipExtsn <> '    '
        let $E.Zip = substr($E.Zip,1,5) || '-' || substr($E.Zip,6,4)
      end-if
      let $E.Zip = rtrim($E.Zip, ' ')
      let $F3 = $E.City || ' ' || $E.State || ' ' || $E.Zip
      if length($F3) > #YE_EE_Country_Box_Size
          let #newlen = length($E.City) + #YE_EE_Country_Box_Size - length($F3)
          let $F3 = substr($E.City,1,#newlen) || ' ' || $E.State || ' ' || $E.Zip
      end-if
    else
      do Get-Country-Code
      let $Country = SUBSTR(&CT.Descr,1,15)
      let $Country = rtrim($Country, ' ')
      uppercase $Country
      let $E.Zip = rtrim($E.Zip, ' ')
      let $F3 = $E.City || ' ' || $E.State || ' ' ||
                $E.Zip  || ' '  || $Country
      if length($F3) > #YE_EE_Country_Box_Size
          let #newlen = length($E.City) + #YE_EE_Country_Box_Size - length($F3)
          let $F3 = substr($E.City,1,#newlen) || ' ' || $E.State || ' ' ||
                $E.Zip  || ' '  || $Country
      end-if
    end-if
end-procedure

begin-procedure Get-Country-Code
begin-SELECT
CT.DESCR
FROM  PS_COUNTRY_TBL CT
WHERE CT.COUNTRY = $E.Country
end-SELECT
end-procedure

begin-procedure Load-Amounts
begin-SELECT
C.GPUS_YE_RPT_CO
D.STATE
D.GPUS_TAXFORM_BOX
D.GPUS_TAX_EIN
#ifdef DB2ALL
DECIMAL(SUM(D.GPUS_YE_AMOUNT),15,3) &D.GPUS_YE_AMOUNT
#else
SUM(D.GPUS_YE_AMOUNT) &D.GPUS_YE_AMOUNT
#endif
  move &D.GPUS_YE_AMOUNT to #Amount

   let $D.Box = RTRIM(&D.GPUS_TAXFORM_BOX,' ')

   evaluate $D.Box
     when = $YE_Fed_Wages                        !Federal wages
       add  #Amount to #Fed_Wages
       break
     when = $YE_Fed_Tax                          !Federal tax
       add  #Amount to #Fed_Tax
       break
     when = $YE_SS_Wages                         !SS wages
       add  #Amount to #SS_Wages
       break
     when = $YE_SS_Tax                           !SS Tax
       add  #Amount to #SS_Tax
       break
     when = $YE_Med_Wages                        !Medicare wages
       add  #Amount to #Med_Wages
       break
     when = $YE_Med_Tax                          !Medicare tax
       add  #Amount to #Med_Tax
       break
     when = $YE_SS_Tips                          !SS tips
       add  #Amount to #SS_Tips
       break
     when = $YE_Alloc_Tips                       !Allocated tips
       add  #Amount to #Alloc_Tips
       break
     when = $YE_Adv_EIC                          !EIC
       add  #Amount to #Adv_EIC
       break
     when = $YE_Dep_Care                         !Dependent care
       add  #Amount to #Dep_Care
       break
     when = $YE_Non_Qual_457_Y                   !non-qualified 457
       add  #Amount to #Non_Qual_457_Amt
       move 'Y' to $Non_Qual_457_Y
       break
     when = $YE_Non_Qual_457_N                   !non-qualified non-457
       add  #Amount to #Non_Qual_457_Amt
       move 'Y' to $Non_Qual_457_N
       break
     when = $YE_Uncoll_SS_Tax_On_Tips            !Uncoll SS tax on tips
       add  #Amount to #Uncoll_SS_Tax_On_Tips
       break
     when = $YE_Uncoll_Med_Tax_On_Tips            !Uncoll Medi tax on tips
       add  #Amount to #Uncoll_Med_Tax_On_Tips
       break
     when = $YE_Group_Term_Life                   !GTL
       add  #Amount to #Group_Term_Life
       break
     when = $YE_401K                              !401(k)
       add  #Amount to #401K
       break
     when = $YE_403B                              !403(b)
       add  #Amount to #403B
       break
     when = $YE_408K6                             !408(k)(6)
       add  #Amount to #408K6
       break
     when = $YE_457B                              !457(b)
       add  #Amount to #457B
       break
     when = $YE_501C18D                           !501(c)(18)(D)
       add  #Amount to #501C18D
       break
     when = $YE_Sick_Pay                          !Sick pay
       add  #Amount to #Sick_Pay
       break
     when = $YE_Excise_Tax                        !Excise tax
       add  #Amount to #Excise_Tax
       break
     when = $YE_Business_Exp                      !Business expense
       add  #Amount to #Business_Exp
       break
     when = $YE_Uncoll_SS_Tax_GTL                 !Uncoll SS tax - GTL
       add  #Amount to #Uncoll_SS_Tax_GTL
       break
     when = $YE_Uncoll_Med_Tax_GTL                !Uncoll Medi tax - GTL
       add  #Amount to #Uncoll_Med_Tax_GTL
       break
     when = $YE_Excl_Moving_Exp                   !Excl Moving Exp
       add  #Amount to #Excl_Moving_Exp
       break
     when = $YE_Nontaxable_Combat_Pay            !Non Taxable Combat Pay
       add  #Amount to #Nontaxable_Combat_Pay
       break
     when = $YE_Med_Svgs_Acct                     !Medical Savings Account
       add  #Amount to #Med_Svgs_Acct
       break
     when = $YE_408P_Simple_Retirement            !Sec 408(p) SIMPLE retirement
       add  #Amount to #408P_Simple_Retirement
       break
     when = $YE_Adoption_Exp                      !Adoption Expenses
       add  #Amount to #Adoption_Exp
       break
     when = $YE_NonStatutory_Stock_Opt            !NonStatutory Stock Opt
       add  #Amount to #NonStatutory_Stock_Opt
       break
     when = $YE_NonQual_Def_Comp                  !Nonqualified deferred compensation
       add  #Amount to #NonQual_Def_Comp
       break
     when = $YE_Income_NonQual_Def_Comp           !Income on Nonqualified deferred compensation
       add  #Amount to #Income_NonQual_Def_Comp
       break
     when = $YE_State_Wages                       !State wages
       add  #Amount to #State_Wages
       break
     when = $YE_State_Tax                         !State tax
       add  #Amount to #State_Tax
       break
     when-other
       move $D.Box to $Box xx
       do Add-Misc-Box
       if $Box = $YE_Other
         let $Box14Letter = SUBSTR($D.Box,3,1)
         let #index = INSTR('ABCDEFGHIJKLMNOPQRSTUVWXYZ',$Box14Letter,1)
         ARRAY-ADD #Amount to BOX14(#INDEX) AMOUNT
       else
         display 'UNKNOWN BOX IDENTIFIER:'
         display $D.Box
         display 'Processing Stopped'
         STOP
       end-if
   end-evaluate

   DO GET-MAX-EFFDT-EIN-1

FROM PS_GPUS_YE_EE1_VW D,PS_GPUS_YE_CO_TBL C
WHERE D.GPUS_TAX_EIN    = &E.GPUS_TAX_EIN
  AND C.GPUS_TAX_EIN    = &E.GPUS_TAX_EIN
  [$D.SelectedCompanies]    !NULL string if SELECT Company option not used
  AND #MaxYr-1   <= D.GPUS_CAL_YEAR
  AND D.EMPLID          = $E.Emplid
  AND D.GPUS_CAL_YEAR   = &TX.CALENDAR_YEAR
  AND D.GPUS_TAXFORM_ID = $E.TaxForm_ID
  AND D.GPUS_SEQ_NBR = #E.Sequence_Number
  AND C.EFFDT = ( SELECT MAX(B.EFFDT) FROM PS_GPUS_YE_CO_TBL B
                  WHERE B.GPUS_YE_RPT_CO = C.GPUS_YE_RPT_CO AND 
               (B.EFFDT <= $AsOfDate or B.EFFDT >= $BefAsOfDate) )
GROUP BY C.GPUS_YE_RPT_CO, D.STATE, D.GPUS_TAXFORM_BOX, D.GPUS_TAX_EIN
ORDER BY C.GPUS_YE_RPT_CO, D.STATE, D.GPUS_TAXFORM_BOX, D.GPUS_TAX_EIN
end-SELECT
end-procedure

begin-procedure GET-MAX-EFFDT-EIN-1
begin-SELECT
MAX(W.EFFDT) &EFFDT_1

  let $MaxYr = DatetoStr(&EFFDT_1)
  let $MaxYr = substr($MaxYear,6,10)
  let #MaxYr-1 = to_Number($MaxYear)


FROM PS_GPUS_YE_CO_TBL W
WHERE W.EFFDT <= $AsOfDate
  AND W.GPUS_TAX_EIN = &D.GPUS_TAX_EIN
END-SELECT
end-procedure

begin-procedure Add-Misc-Box

   evaluate $D.Box

     when = $YE_OtherA
        add #Amount to #OtherA
        break
     when = $YE_OtherB
        add #Amount to #OtherB
        break
     when = $YE_OtherC
        add #Amount to #OtherC
        break
     when = $YE_OtherD
        add #Amount to #OtherD
        break
     when = $YE_OtherE
        add #Amount to #OtherE
        break
     when = $YE_OtherF
        add #Amount to #OtherF
        break
     when = $YE_OtherG
        add #Amount to #OtherG
        break
     when = $YE_OtherH
        add #Amount to #OtherH
        break
     when = $YE_OtherI
        add #Amount to #OtherI
        break
     when = $YE_OtherJ
        add #Amount to #OtherJ
        break
     when = $YE_OtherK
        add #Amount to #OtherK
        break
     when = $YE_OtherL
        add #Amount to #OtherL
        break
     when = $YE_OtherM
        add #Amount to #OtherM
        break
     when = $YE_OtherN
        add #Amount to #OtherN
        break
     when = $YE_OtherO
        add #Amount to #OtherO
        break
     when = $YE_OtherP
        add #Amount to #OtherP
        break
     when = $YE_OtherQ
        add #Amount to #OtherQ
        break
     when = $YE_OtherR
        add #Amount to #OtherR
        break
     when = $YE_OtherS
        add #Amount to #OtherS
        break
     when = $YE_OtherT
        add #Amount to #OtherT
        break
     when = $YE_OtherU
        add #Amount to #OtherU
        break
     when = $YE_OtherV
        add #Amount to #OtherV
        break
     when = $YE_OtherW
        add #Amount to #OtherW
        break
     when = $YE_OtherX
        add #Amount to #OtherX
        break
     when = $YE_OtherY
        add #Amount to #OtherY
        break
     when = $YE_OtherZ
        add #Amount to #OtherZ
        break

  end-evaluate
end-procedure

begin-procedure Print-Fed-State-Amounts
  if #T_Count > #Align_Count
    if #j = 1
      add #Fed_Wages to #Fed_Wages_I
      add #Fed_Tax to #Fed_Tax_I
      add #SS_Wages to #SS_Wages_I
      add #SS_Tax to #SS_Tax_I
      add #Med_Wages to #Med_Wages_I
      add #Med_Tax to #Med_Tax_I
      add #SS_Tips to #SS_Tips_I
      add #Alloc_Tips to #Alloc_Tips_I
      add #Adv_EIC to #Adv_EIC_I
      add #Dep_Care to #Dep_Care_I
      add #Non_Qual_457_Amt to #Non_Qual_457_Amt_I
      add #14 to #14_I
      add #State_Tax to #State_Tax_I
      add #State_Wages to #State_Wages_I
      add #Uncoll_SS_Tax_On_Tips to #Uncoll_SS_Tax_On_Tips_I
      add #Uncoll_Med_Tax_On_Tips to #Uncoll_Med_Tax_On_Tips_I
      add #Group_Term_Life to #Group_Term_Life_I
      add #401K to #401K_I
      add #403B to #403B_I
      add #457B to #457B_I
      add #408K6 to #408K6_I
      add #501C18D to #501C18D_I
      add #Sick_Pay to #Sick_Pay_I
      add #Excise_Tax to #Excise_Tax_I
      add #Business_Exp to #Business_Exp_I
      add #Uncoll_SS_Tax_GTL to #Uncoll_SS_Tax_GTL_I
      add #Uncoll_Med_Tax_GTL to #Uncoll_Med_Tax_GTL_I
      add #Excl_Moving_Exp to #Excl_Moving_Exp_I
      add #Nontaxable_Combat_Pay to #Nontaxable_Combat_Pay_I
      add #Med_Svgs_Acct to #Med_Svgs_Acct_I
      add #408P_Simple_Retirement to #408P_Simple_Retirement_I
      add #Adoption_Exp to #Adoption_Exp_I
      add #NonStatutory_Stock_Opt to #NonStatutory_Stock_Opt_I
      add #NonQual_Def_Comp to #NonQual_Def_Comp_I
      add #Income_NonQual_Def_Comp to #Income_NonQual_Def_Comp_I
      add #OtherA to #OtherA_I
      add #OtherB to #OtherB_I
      add #OtherC to #OtherC_I
      add #OtherD to #OtherD_I
      add #OtherE to #OtherE_I
      add #OtherF to #OtherF_I
      add #OtherG to #OtherG_I
      add #OtherH to #OtherH_I
      add #OtherI to #OtherI_I
      add #OtherJ to #OtherJ_I
      add #OtherK to #OtherK_I
      add #OtherL to #OtherL_I
      add #OtherM to #OtherM_I
      add #OtherN to #OtherN_I
      add #OtherO to #OtherO_I
      add #OtherP to #OtherP_I
      add #OtherQ to #OtherQ_I
      add #OtherR to #OtherR_I
      add #OtherS to #OtherS_I
      add #OtherT to #OtherT_I
      add #OtherU to #OtherU_I
      add #OtherV to #OtherV_I
      add #OtherW to #OtherW_I
      add #OtherX to #OtherX_I
      add #OtherY to #OtherY_I
      add #OtherZ to #OtherZ_I
      move 0 to #local
    end-if
  end-if

  do Format-Number(#Fed_Wages, $out, $F01)                      !Federal wages
  do Print-Value($out,#L_01,#C_01,'Box 01')

  do Format-Number(#Fed_Tax, $out, $F02)                        !Federal tax
  do Print-Value($out,#L_02,#C_02,'Box 02')

  do Format-Number(#SS_Wages, $out, $F03)                       !SS wages
  do Print-Value($out,#L_03,#C_03,'Box 03')

  do Format-Number(#SS_Tax, $out, $F04)                         !SS Tax
  do Print-Value($out,#L_04,#C_04,'Box 04')

  do Format-Number(#Med_Wages, $out, $F05)                      !Medicare wages
  do Print-Value($out,#L_05,#C_05,'Box 05')

  do Format-Number(#Med_Tax, $out, $F06)                        !Medicare tax
  do Print-Value($out,#L_06,#C_06,'Box 06')

  do Format-Number(#SS_Tips, $out, $F07)                        !SS tips
  do Print-Value($out,#L_07,#C_07,'Box 07')

  do Format-Number(#Alloc_Tips, $out, $F08)                     !Allocated tips
  do Print-Value($out,#L_08,#C_08,'Box 08')

  do Format-Number(#Adv_EIC, $out, $F09)                        !EIC
  do Print-Value($out,#L_09,#C_09,'Box 09')

  do Format-Number(#Dep_Care, $out, $F10)                       !Dependent care
  do Print-Value($out,#L_10,#C_10,'Box 10')

  do Format-Number(#Non_Qual_457_Amt, $out, $F11)               !Non-qualified plan total
  do Print-Value($out,#L_11,#C_11,'Box 11')

  if #State_Tax > 0
    if RTRIM($E.GPUS_YE_STATE,' ') <> ''
      do Print-Value($E.GPUS_YE_STATE,#L_15,#C_15,'Box 15')            !State
      do Print-Value($E.Employer_ID_SWT,#L_15A,#C_15A,'Box 15A')  !State employer ID
    else
      do Print-Value(' ',#L_15,#C_15,' ')
    end-if
  end-if
  do Format-Number(#State_Wages, $out, $F16)                 !State wages
  do Print-Value($out,#L_16,#C_16,'Box 16')

  do Format-Number(#State_Tax, $out, $F17)                   !State tax
  do Print-Value($out,#L_17,#C_17,'Box 17')
  if #E.Sequence_Number > 1
    do Print-Suppl-Box14
  end-if
end-procedure

begin-procedure Identify-Box12-Entries
  let $Box12CheckString = ''
  let #Box12_Entries = 0
  if #Uncoll_SS_Tax_On_Tips <> 0                                   !Uncoll SS tax on tips
    let $Box12CheckString = $Box12CheckString || 'A'
    add 1 to #Box12_Entries
  end-if

  if #Uncoll_Med_Tax_On_Tips <> 0                                   !Uncoll Medi tax on tips
    let $Box12CheckString = $Box12CheckString || 'B'
    add 1 to #Box12_Entries
  end-if

  if #Group_Term_Life <> 0                                          !GTL
    let $Box12CheckString = $Box12CheckString || 'C'
    add 1 to #Box12_Entries
  end-if

  if #401K <> 0                                                     !401(k)
    let $Box12CheckString = $Box12CheckString || 'D'
    add 1 to #Box12_Entries
  end-if

  if #403B <> 0                                                     !403(b)
    let $Box12CheckString = $Box12CheckString || 'E'
    add 1 to #Box12_Entries
  end-if

  if #408K6 <> 0                                                    !408(k)(6)
    let $Box12CheckString = $Box12CheckString || 'F'
    add 1 to #Box12_Entries
  end-if

  if #457B <> 0                                                     !457(b)
    let $Box12CheckString = $Box12CheckString || 'G'
    add 1 to #Box12_Entries
  end-if

  if #501C18D <> 0                                                  !501(c)(18)(D)
    let $Box12CheckString = $Box12CheckString || 'H'
    add 1 to #Box12_Entries
  end-if

  if #Sick_Pay <> 0                                                 !Sick pay
    let $Box12CheckString = $Box12CheckString || 'J'
    add 1 to #Box12_Entries
  end-if

  if #Excise_Tax <> 0                                               !Excise tax
    let $Box12CheckString = $Box12CheckString || 'K'
    add 1 to #Box12_Entries
  end-if

  if #Business_Exp <> 0                                             !Business expense
    let $Box12CheckString = $Box12CheckString || 'L'
    add 1 to #Box12_Entries
  end-if

  if #Uncoll_SS_Tax_GTL <> 0                                        !Uncoll SS tax - GTL
    let $Box12CheckString = $Box12CheckString || 'M'
    add 1 to #Box12_Entries
  end-if

  if #Uncoll_Med_Tax_GTL <> 0                                       !Uncoll Medi tax - GTL
    let $Box12CheckString = $Box12CheckString || 'N'
    add 1 to #Box12_Entries
  end-if
  if #Excl_Moving_Exp <> 0                                          !Excl Moving Exp
    let $Box12CheckString = $Box12CheckString || 'P'
    add 1 to #Box12_Entries
  end-if
  if #Nontaxable_Combat_Pay <> 0                                   !Non Taxable Combat Pay
    let $Box12CheckString = $Box12CheckString || 'Q'
    add 1 to #Box12_Entries
  end-if
  if #Med_Svgs_Acct <> 0                                            !Medical Spending Account
    let $Box12CheckString = $Box12CheckString || 'R'
    add 1 to #Box12_Entries
  end-if
  if #408P_Simple_Retirement <> 0                             !Section 418(p) SIMPLE Retirement
    let $Box12CheckString = $Box12CheckString || 'S'
    add 1 to #Box12_Entries
  end-if
  if #Adoption_Exp <> 0                                             !Adoption Expenses
    let $Box12CheckString = $Box12CheckString || 'T'
    add 1 to #Box12_Entries
  end-if
  if #NonStatutory_Stock_Opt <> 0                                   !NonStatutory Stock Opt
    let $Box12CheckString = $Box12CheckString || 'V'
    add 1 to #Box12_Entries
  end-if
  if #NonQual_Def_Comp <> 0                                !Non Qualified Deferred Compensation
      let $Box12CheckString = $Box12CheckString || 'Y'
      add 1 to #Box12_Entries
  end-if
  if #Income_NonQual_Def_Comp <> 0                        !Income Non Qualified Deferred Compensation
      let $Box12CheckString = $Box12CheckString || 'Z'
      add 1 to #Box12_Entries
  end-if
  if #Box12_Entries > 4
    move 1 to #MultiForm
  end-if
end-procedure

begin-procedure Print-Box12


  move #L_12_Start to #L_12

  if INSTR($Box12PrintString,'A',1)              !Uncoll SS tax on tips
    do Print-Value($T_Uncoll_SS_Tax_On_Tips,#L_12,#C_Uncoll_SS_Tax_On_Tips,'Box 12')
    do Format-Number(#Uncoll_SS_Tax_On_Tips, $out, $F_Uncoll_SS_Tax_On_Tips)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'B',1)              !Uncoll Medi tax on tips
    do Print-Value($T_Uncoll_Med_Tax_On_Tips,#L_12,#C_Uncoll_Med_Tax_On_Tips,'Box 12')
    do Format-Number(#Uncoll_Med_Tax_On_Tips, $out, $F_Uncoll_Med_Tax_On_Tips)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'C',1)               !GTL
    do Print-Value($T_Group_Term_Life,#L_12,#C_Group_Term_Life,'Box 12')
    do Format-Number(#Group_Term_Life, $out, $F_Group_Term_Life)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'D',1)               !401(k)
    do Print-Value($T_401K,#L_12,#C_401K,'Box 12')
    do Format-Number(#401K, $out, $F_401K)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'E',1)               !403(b)
    do Print-Value($T_403B,#L_12,#C_403B,'Box 12')
    do Format-Number(#403B, $out, $F_403B)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'F',1)               !408(k)(6)
    do Print-Value($T_408K6,#L_12,#C_408K6,'Box 12')
    do Format-Number(#408K6, $out, $F_408K6)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'G',1)               !457(b)
    do Print-Value($T_457B,#L_12,#C_457B,'Box 12')
    do Format-Number(#457B, $out, $F_457B)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'H',1)               !501(c)(18)(D)
    do Print-Value($T_501C18D,#L_12,#C_501C18D,'Box 12')
    do Format-Number(#501C18D, $out, $F_501C18D)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'J',1)               !Sick pay
    do Print-Value($T_Sick_Pay,#L_12,#C_Sick_Pay,'Box 12')
    do Format-Number(#Sick_Pay, $out, $F_Sick_Pay)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'K',1)               !Excise tax
    do Print-Value($T_Excise_Tax,#L_12,#C_Excise_Tax,'Box 12')
    do Format-Number(#Excise_Tax, $out, $F_Excise_Tax)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'L',1)               !Business expense
    do Print-Value($T_Business_Exp,#L_12,#C_Business_Exp,'Box 12')
    do Format-Number(#Business_Exp, $out, $F_Business_Exp)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'M',1)               !Uncoll SS tax - GTL
    do Print-Value($T_Uncoll_SS_Tax_GTL,#L_12,#C_Uncoll_SS_Tax_GTL,'Box 12')
    do Format-Number(#Uncoll_SS_Tax_GTL, $out, $F_Uncoll_SS_Tax_GTL)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'N',1)               !Uncoll Medi tax - GTL
    do Print-Value($T_Uncoll_Med_Tax_GTL,#L_12,#C_Uncoll_Med_Tax_GTL,'Box 12')
    do Format-Number(#Uncoll_Med_Tax_GTL, $out, $F_Uncoll_Med_Tax_GTL)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'P',1)               !Excl Moving Exp
    do Print-Value($T_Excl_Moving_Exp,#L_12,#C_Excl_Moving_Exp,'Box 12')
    do Format-Number(#Excl_Moving_Exp, $out, $F_Excl_Moving_Exp)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'Q',1)               !Nontaxable Combat Pay
    do Print-Value($T_Nontaxable_Combat_Pay,#L_12,#C_Nontaxable_Combat_Pay,'Box 12')
    do Format-Number(#Nontaxable_Combat_Pay, $out, $F_Nontaxable_Combat_Pay)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'R',1)               !Medical Spending Account
    do Print-Value($T_Med_Svgs_Acct,#L_12,#C_Med_Svgs_Acct,'Box 12')
    do Format-Number(#Med_Svgs_Acct, $out, $F_Med_Svgs_Acct)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'S',1)               !Section 418(p) SIMPLE retirement
    do Print-Value($T_408P_Simple_Retirement,#L_12,#C_408P_Simple_Retirement,'Box 12')
    do Format-Number(#408P_Simple_Retirement, $out, $F_408P_Simple_Retirement)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'T',1)               !Adoption Expenses
    do Print-Value($T_Adoption_Exp,#L_12,#C_Adoption_Exp,'Box 12')
    do Format-Number(#Adoption_Exp, $out, $F_Adoption_Exp)
    print $out (,+1)
    add 2 to #L_12
  end-if

  if INSTR($Box12PrintString,'V',1)               !NonStatutory Stock Opt
    do Print-Value($T_NonStatutory_Stock_Opt,#L_12,#C_NonStatutory_Stock_Opt,'Box 12')
    do Format-Number(#NonStatutory_Stock_Opt, $out, $F_NonStatutory_Stock_Opt)
    print $out (,+1)
    add 2 to #L_12
  end-if
  
  if INSTR($Box12PrintString,'Y',1)               !NonQualified Defered Compensation
      do Print-Value($T_NonQual_Def_Comp,#L_12,#C_NonQual_Def_Comp,'Box 12')
      do Format-Number(#NonQual_Def_Comp, $out, $F_NonQual_Def_Comp)
      print $out (,+1)
      add 2 to #L_12
  end-if
  
  if INSTR($Box12PrintString,'Z',1)               !Income on NonQualified Defered Compensation
      do Print-Value($T_Income_NonQual_Def_Comp,#L_12,#C_Income_NonQual_Def_Comp,'Box 12')
      do Format-Number(#Income_NonQual_Def_Comp, $out, $F_Income_NonQual_Def_Comp)
      print $out (,+1)
      add 2 to #L_12
  end-if

end-procedure

begin-procedure Print-Box14
  move #L_14_Start to #L_14

  if #L_14 <= 0
    display ''
    display '***************************************'
    display 'Print Line not defined for Box 14'
    display 'in Tax Form Print Parameters Table.'
    display 'Program Stopped.'
    display '***************************************'
    display ''
    stop
  end-if

  move 1 to #m
  move 4 to #Last_Box14_Line
  move 'N' to $Is_NJ_VDI

  if $E.GPUS_YE_STATE = 'NJ'
    while #m <= 26
      get #14 $T_14 #C_14_vdi from Box14(#m) Amount Text Column
      if upper($T_14) = 'VPDI' or upper($T_14) = 'VDI'
        if #14 > 0
          move #m to #Box14_VDI_Index
          move 'Y' to $Is_NJ_VDI
          move 3 to #Last_Box14_Line
          break
        end-if
      end-if
      add 1 to #m
    end-while
    move 1 to #m
  end-if

  while #m <= 26 and (#L_14 - #L_14_Start) < #Last_Box14_Line

    if $Is_NJ_VDI = 'Y' and (#L_14 - #L_14_Start) = (#Last_Box14_Line - 1) and #m < #Box14_VDI_Index
      move #Box14_VDI_Index to #m
    end-if

    get $T_14 #C_14 #14 from Box14(#m) Text Column Amount

    if #14 > 0
      if #Align_Count <> 0
        print 'XXXXX' (#L_14,#C_14,5)
      else
        print $T_14   (#L_14,#C_14,5)
      end-if
      do Format-Number(#14, $out, $F14)
      print $out ()
      add 1 to #L_14
    end-if
    add 1 to #m
  end-while

  if $E.GPUS_YE_STATE = 'NJ'
    do Print-NJSUT
  end-if

  if (#L_14 - #L_14_Start) = 5
    display 'Attempt to create more than 4 Box 14 entries for ' noline
    display $E.SSN noline
    display ' ' noline
    display $E.YE_Name
  end-if
end-procedure

begin-procedure Print-Suppl-Box14

  move #L_14_Start to #L_14
  move #C_14_Start to #C_14
  move 4 to #Last_Box14_Line
  add 2 to #L_14
  print 'FED W-2 DATA IS' (#L_14,#C_14,15)
  add 1 to #L_14
  print 'ON SEPARATE W-2' (#L_14,#C_14,15)
  add 1 to #L_14

end-procedure

begin-procedure Print-NJSUT
begin-SELECT
CS.GPUS_SUT_EIN

    if $Is_NJ_VDI = 'Y'
     move 'N' to $Is_NJ_VDI
    end-if

FROM PS_GPUS_CO_ST_TAX CS
WHERE CS.COMPANY = $A.GPUS_YE_RPT_CO
  AND CS.STATE = 'NJ'
  AND CS.EFFDT =
      (SELECT MAX(EFFDT)
       FROM   PS_GPUS_CO_ST_TAX
       WHERE  COMPANY = $A.GPUS_YE_RPT_CO
         AND  STATE   = 'NJ'
         AND  EFFDT  <= $AsOfDate)
end-SELECT
end-procedure

begin-procedure Zero-Box14
  move 1 to #m
  while #m <= 26
    put 0 into Box14(#m) Amount
    add 1 to #m
  end-while
end-procedure

begin-procedure Print-Box13
  if #Align_Count > 0
    do Print-Value('S',#L_13A,#C_13A,'Box 13A')
    do Print-Value('P',#L_13B,#C_13B,'Box 13B')
    do Print-Value('T',#L_13C,#C_13C,'Box 13C')
  end-if

  if $E.Statutory_Ee = 'Y'
    do Print-Value('X',#L_13A,#C_13A,'Box 13A')
  end-if
  if $E.Pension_Plan = 'Y'
    do Print-Value('X',#L_13B,#C_13B,'Box 13B')
  end-if
  if $E.Thirdparty_Sickpay = 'Y'
    do Print-Value('X',#L_13C,#C_13C,'Box 13C')
  end-if

end-procedure

begin-procedure Print-Intermediate-Total
  move 1 to #j
  while #j <= #FormsPerPage/#EmployeesPerPage  !loop for individual ee's
    do Next-Form
    do Print-ER-Data

    do Format-Number(#Fed_Wages_I, $out, $F01)          !Federal wages
    do Print-Value($out,#L_01,#C_01,'Box 01')

    do Format-Number(#Fed_Tax_I, $out, $F02)          !Federal tax
    do Print-Value($out,#L_02,#C_02,'Box 02')

    do Format-Number(#SS_Wages_I, $out, $F03)          !SS wages
    do Print-Value($out,#L_03,#C_03,'Box 03')

    do Format-Number(#SS_Tax_I, $out, $F04)          !SS Tax
    do Print-Value($out,#L_04,#C_04,'Box 04')

    do Format-Number(#Med_Wages_I, $out, $F05)          !Medicare wages
    do Print-Value($out,#L_05,#C_05,'Box 05')

    do Format-Number(#Med_Tax_I, $out, $F06)          !Medicare tax
    do Print-Value($out,#L_06,#C_06,'Box 06')

    do Format-Number(#SS_Tips_I, $out, $F07)          !SS tips
    do Print-Value($out,#L_07,#C_07,'Box 07')

    do Format-Number(#Alloc_Tips_I, $out, $F08)          !Allocated tips
    do Print-Value($out,#L_08,#C_08,'Box 08')

    do Format-Number(#Adv_EIC_I, $out, $F09)          !EIC
    do Print-Value($out,#L_09,#C_09,'Box 09')

    do Format-Number(#Dep_Care_I, $out, $F10)          !Dependent care
    do Print-Value($out,#L_10,#C_10,'Box 10')

    do Format-Number(#Non_Qual_457_Amt_I, $out, $F11)          !non-qualified plan total
    do Print-Value($out,#L_11,#C_11,'Box 11')

    add 1 to #j
  end-while

  add #Fed_Wages_I to #Fed_Wages_T
  move 0 to #Fed_Wages_I
  add #Fed_Tax_I to #Fed_Tax_T
  move 0 to #Fed_Tax_I
  add #SS_Wages_I to #SS_Wages_T
  move 0 to #SS_Wages_I
  add #SS_Tax_I to #SS_Tax_T
  move 0 to #SS_Tax_I
  add #Med_Wages_I to #Med_Wages_T
  move 0 to #Med_Wages_I
  add #Med_Tax_I to #Med_Tax_T
  move 0 to #Med_Tax_I
  add #SS_Tips_I to #SS_Tips_T
  move 0 to #SS_Tips_I
  add #Alloc_Tips_I to #Alloc_Tips_T
  move 0 to #Alloc_Tips_I
  add #Adv_EIC_I to #Adv_EIC_T
  move 0 to #Adv_EIC_I
  add #Dep_Care_I to #Dep_Care_T
  move 0 to #Dep_Care_I
  add #Non_Qual_457_Amt_I to #Non_Qual_457_Amt_T
  move 0 to #Non_Qual_457_Amt_I
  add #401K_I to #401K_T
  move 0 to #401K_I
  add #403B_I to #403B_T
  move 0 to #403B_I
  add #408K6_I to #408K6_T
  move 0 to #408K6_I
  add #501C18D_I to #501C18D_T
  move 0 to #501C18D_I
  add #Uncoll_SS_Tax_On_Tips_I to #Uncoll_SS_Tax_On_Tips_T
  move 0 to #Uncoll_SS_Tax_On_Tips_I
  add #Uncoll_Med_Tax_On_Tips_I to #Uncoll_Med_Tax_On_Tips_T
  move 0 to #Uncoll_Med_Tax_On_Tips_I
  add #Group_Term_Life_I to #Group_Term_Life_T
  move 0 to #Group_Term_Life_I
  add #Sick_Pay_I to #Sick_Pay_T
  move 0 to #Sick_Pay_I
  add #Excise_Tax_I to #Excise_Tax_T
  move 0 to #Excise_Tax_I
  add #Business_Exp_I to #Business_Exp_T
  move 0 to #Business_Exp_I
  add #Uncoll_SS_Tax_GTL_I to #Uncoll_SS_Tax_GTL_T
  move 0 to #Uncoll_SS_Tax_GTL_I
  add #Uncoll_Med_Tax_GTL_I to #Uncoll_Med_Tax_GTL_T
  move 0 to #Uncoll_Med_Tax_GTL_I
  add #Excl_Moving_Exp_I to #Excl_Moving_Exp_T
  move 0 to #Excl_Moving_Exp_I
  add #Nontaxable_Combat_Pay_I to #Nontaxable_Combat_Pay_T
  move 0 to #Nontaxable_Combat_Pay_I
  add #Med_Svgs_Acct_I to #Med_Svgs_Acct_T
  move 0 to #Med_Svgs_Acct_I
  add #408P_Simple_Retirement_I to #408P_Simple_Retirement_T
  move 0 to #408P_Simple_Retirement_I
  add #Adoption_Exp_I to #Adoption_Exp_T
  move 0 to #Adoption_Exp_I
  add #NonStatutory_Stock_Opt_I to #NonStatutory_Stock_Opt_T
  move 0 to #NonStatutory_Stock_Opt_I
  add #NonQual_Def_Comp_I to #NonQual_Def_Comp_T
  move 0 to #NonQual_Def_Comp_I
  add #Income_NonQual_Def_Comp_I to #Income_NonQual_Def_Comp_T
  move 0 to #Income_NonQual_Def_Comp_I
  add #State_Wages_I to #State_Wages_T
  move 0 to #State_Wages_I
  add #State_Tax_I to #State_Tax_T
  move 0 to #State_Tax_I
  add #OtherA_I to #OtherA_T
  move 0 to #OtherA_I
  add #OtherB_I to #OtherB_T
  move 0 to #OtherB_I
  add #OtherC_I to #OtherC_t
  move 0 to #OtherC_I
  add #OtherD_I to #OtherD_T
  move 0 to #OtherD_I
  add #OtherE_I to #OtherE_T
  move 0 to #OtherE_I
  add #OtherF_I to #OtherF_T
  move 0 to #OtherF_I
  add #OtherG_I to #OtherG_T
  move 0 to #OtherG_I
  add #OtherH_I to #OtherH_T
  move 0 to #OtherH_I
  add #OtherI_I to #OtherI_T
  move 0 to #OtherI_I
  add #OtherJ_I to #OtherJ_T
  move 0 to #OtherJ_I
  add #OtherK_I to #OtherK_T
  move 0 to #OtherK_I
  add #OtherL_I to #OtherL_T
  move 0 to #OtherL_I
  add #OtherM_I to #OtherM_T
  move 0 to #OtherM_I
  add #OtherN_I to #OtherN_T
  move 0 to #OtherN_I
  add #OtherO_I to #OtherO_T
  move 0 to #OtherO_I
  add #OtherP_I to #OtherP_T
  move 0 to #OtherP_I
  add #OtherQ_I to #OtherQ_T
  move 0 to #OtherQ_I
  add #OtherR_I to #OtherR_T
  move 0 to #OtherR_I
  add #OtherS_I to #OtherS_T
  move 0 to #OtherS_I
  add #OtherT_I to #OtherT_T
  move 0 to #OtherT_I
  add #OtherU_I to #OtherU_T
  move 0 to #OtherU_I
  add #OtherV_I to #OtherV_T
  move 0 to #OtherV_I
  add #OtherW_I to #OtherW_T
  move 0 to #OtherW_I
  add #OtherX_I to #OtherX_T
  move 0 to #OtherX_I
  add #OtherY_I to #OtherY_T
  move 0 to #OtherY_I
  add #OtherZ_I to #OtherZ_T
  move 0 to #OtherZ_I

end-procedure

begin-procedure Print-Grand-Totals

  if #Fed_Wages_I > 0
    do Format-Number(#Fed_Wages_I, $out,'999,999,999,999.99')          !Federal wages
    display 'Federal wages             ' noline
    display $out
  end-if

  if #Fed_Tax_I > 0
    do Format-Number(#Fed_Tax_I, $out,'999,999,999,999.99')          !Federal tax
    display 'Federal tax               ' noline
    display $out
  end-if

  if #SS_Wages_I > 0
    do Format-Number(#SS_Wages_I, $out,'999,999,999,999.99')          !SS wages
    display 'SS wages                  ' noline
    display $out
  end-if

  if #SS_Tax_I > 0
    do Format-Number(#SS_Tax_I, $out,'999,999,999,999.99')          !SS Tax
    display 'SS tax                    ' noline
    display $out
  end-if

  if #Med_Wages_I > 0
    do Format-Number(#Med_Wages_I, $out,'999,999,999,999.99')          !Medicare wages
    display 'Medicare wages            ' noline
    display $out
  end-if

  if #Med_Tax_I > 0
    do Format-Number(#Med_Tax_I, $out,'999,999,999,999.99')          !Medicare tax
    display 'Medicare tax              ' noline
    display $out
  end-if

  if #SS_Tips_I > 0
    do Format-Number(#SS_Tips_I, $out,'999,999,999,999.99')          !SS tips
    display 'SS tips                   ' noline
    display $out
  end-if

  if #Alloc_Tips_I > 0
    do Format-Number(#Alloc_Tips_I, $out,'999,999,999,999.99')          !Allocated tips
    display 'Allocated tips            ' noline
    display $out
  end-if

  if #Adv_EIC_I > 0
    do Format-Number(#Adv_EIC_I, $out,'999,999,999,999.99')          !EIC
    display 'EIC                       ' noline
    display $out
  end-if

  if #Dep_Care_I > 0
    do Format-Number(#Dep_Care_I, $out,'999,999,999,999.99')          !Dependent care
    display 'Dependent care            ' noline
    display $out
  end-if

  if #Non_Qual_457_Amt_I > 0
    do Format-Number(#Non_Qual_457_Amt_I, $out,'999,999,999,999.99')          !non-qualified plan total
    display 'Non-qual plan             ' noline
    display $out
  end-if

  if #Uncoll_SS_Tax_On_Tips_I > 0
    do Format-Number(#Uncoll_SS_Tax_On_Tips_I, $out,'999,999,999,999.99')         !Uncoll SS tax on tips
    display 'Uncoll SS Tax Tips Tot    ' noline
    display $out
  end-if

  if #Uncoll_Med_Tax_On_Tips_I > 0
    do Format-Number(#Uncoll_Med_Tax_On_Tips_I, $out,'999,999,999,999.99')         !Uncoll Medicare Tax on TIPS
    display 'Uncoll MED Tax TIPS       ' noline
    display $out
  end-if

  if #Group_Term_Life_I > 0
    do Format-Number(#Group_Term_Life_I, $out,'999,999,999,999.99')         !GTL
    display 'Group Term Life           ' noline
    display $out
  end-if

  if #401K_I > 0
    do Format-Number(#401K_I, $out,'999,999,999,999.99')          !401k
    display '401(K)                    ' noline
    display $out
  end-if

  if #403B_I > 0
    do Format-Number(#403B_I, $out,'999,999,999,999.99')          !403(b)
    display '403(b)                    ' noline
    display $out
  end-if

  if #408K6_I > 0
    do Format-Number(#408K6_I, $out,'999,999,999,999.99')          !408(k)6
    display '408(k)6                   ' noline
    display $out
  end-if

  if #457B_I > 0
    do Format-Number(#457B_I, $out,'999,999,999,999.99')          !457(b)
    display '457(b)                    ' noline
    display $out
  end-if

  if #501C18D_I > 0
    do Format-Number(#501C18D_I, $out,'999,999,999,999.99')          !501(c)18(d)
    display '501(c)18(d)               ' noline
    display $out
  end-if

  if #Sick_Pay_I > 0
    do Format-Number(#Sick_Pay_I, $out,'999,999,999,999.99')         !Sick Pay
    display 'Sick Pay total            ' noline
    display $out
  end-if

  if #Excise_Tax_I > 0
    do Format-Number(#Excise_Tax_I, $out,'999,999,999,999.99')         !Excise Tax
    display 'Excise Tax                ' noline
    display $out
  end-if

  if #Business_Exp_I > 0
    do Format-Number(#Business_Exp_I, $out,'999,999,999,999.99')         !Business Expense
    display 'Business Expense total    ' noline
    display $out
  end-if

  if #Uncoll_SS_Tax_GTL_I > 0
    do Format-Number(#Uncoll_SS_Tax_GTL_I, $out,'999,999,999,999.99')         !Uncoll SS Tax - GTL
    display 'Uncoll SS Tax - GTL       ' noline
    display $out
  end-if

  if #Uncoll_Med_Tax_GTL_I > 0
    do Format-Number(#Uncoll_Med_Tax_GTL_I, $out,'999,999,999,999.99')         !Uncoll Medicare Tax - GTL
    display 'Uncoll MED Tax - GTL      ' noline
    display $out
  end-if

  if #Excl_Moving_Exp_I > 0
    do Format-Number(#Excl_Moving_Exp_I, $out,'999,999,999,999.99')         !Excl Moving Exp
    display 'Excl Moving Exp           ' noline
    display $out
  end-if

  if #Nontaxable_Combat_Pay_I > 0
    do Format-Number(#Nontaxable_Combat_Pay_I, $out,'999,999,999,999.99')         !Nontaxable Combat Pay
    display 'NonTaxable Combat Pay     ' noline
    display $out
  end-if

  if #Med_Svgs_Acct_I > 0
    do Format-Number(#Med_Svgs_Acct_I, $out,'999,999,999,999.99')         !Medical Spending Acct
    display 'Medical Spending Acct     ' noline
    display $out
  end-if

  if #408P_Simple_Retirement_I > 0
    do Format-Number(#408P_Simple_Retirement_I, $out,'999,999,999,999.99')         !Sec 418(p) SIMPLE Ret
    display 'Sec 418(p) SIMPLE Ret     ' noline
    display $out
  end-if

  if #Adoption_Exp_I > 0
    do Format-Number(#Adoption_Exp_I, $out,'999,999,999,999.99')         !Adoption Expenses
    display 'Adoption Expenses         ' noline
    display $out
  end-if

  if #NonStatutory_Stock_Opt_I > 0
    do Format-Number(#NonStatutory_Stock_Opt_I, $out,'999,999,999,999.99')  !NonStatutory Stock Opt
    display 'NonStatutory Stock Opt    ' noline
    display $out
  end-if
  
  if #NonQual_Def_Comp_I > 0
      do Format-Number(#NonQual_Def_Comp_I, $out,'999,999,999,999.99')         !NonQual Def Comp
      display 'NonQualified Def Comp     ' noline
      display $out
  end-if
  
  if #Income_NonQual_Def_Comp_I > 0
      do Format-Number(#Income_NonQual_Def_Comp_I, $out,'999,999,999,999.99')         !Income NonQual Def Comp
      display 'Income NonQual Def Comp   ' noline
      display $out
  end-if

  if #State_Wages_I > 0
    do Format-Number(#State_Wages_I, $out,'999,999,999,999.99')          !State Wages
    display 'State Wages Total         ' noline
    display $out
  end-if

  if #State_Tax_I > 0
    do Format-Number(#State_Tax_I, $out,'999,999,999,999.99')          !State Taxes
    display 'State Tax Total           ' noline
    display $out
  end-if

  if #OtherA_I > 0
    do Format-Number(#OtherA_I, $out,'999,999,999,999.99')           !Box 14A
    display 'CASDI                     ' noline
    display $out
  end-if

  if #OtherB_I > 0
    do Format-Number(#OtherB_I, $out,'999,999,999,999.99')          !Box 14B
    display 'CA-VPDI                   ' noline
    display $out
  end-if

  if #OtherC_I > 0
    do Format-Number(#OtherC_I, $out,'999,999,999,999.99')          !Box 14C
    display 'NJWDPF                    ' noline
    display $out

  end-if
  if #OtherD_I > 0
    do Format-Number(#OtherD_I, $out,'999,999,999,999.99')          !Box 14D
    display 'NJ-UI/HC                  ' noline
    display $out
  end-if

  if #OtherE_I > 0
    do Format-Number(#OtherE_I, $out,'999,999,999,999.99')          !Box 14E
    display 'NJ-SDI                    ' noline
    display $out
  end-if

  if #OtherF_I > 0
    do Format-Number(#OtherF_I, $out,'999,999,999,999.99')          !Box 14F
    display 'PA UI                     ' noline
    display $out

  end-if
  if #OtherG_I > 0
    do Format-Number(#OtherG_I, $out,'999,999,999,999.99')          !Box 14G
    display 'NJ-VPDI                   ' noline
    display $out
  end-if

  if #OtherH_I > 0
    do Format-Number(#OtherH_I, $out,'999,999,999,999.99')          !Box 14H
    display 'Other H                   ' noline
    display $out
  end-if

  if #OtherI_I > 0
    do Format-Number(#OtherI_I, $out,'999,999,999,999.99')          !Box 14I
    display 'Other I                   ' noline
    display $out
  end-if

  if #OtherJ_I > 0
    do Format-Number(#OtherJ_I, $out,'999,999,999,999.99')          !Box 14J
    display 'Other J                   ' noline
    display $out
  end-if

  if #OtherK_I > 0
    do Format-Number(#OtherK_I, $out,'999,999,999,999.99')          !Box 14K
    display 'Other K                   ' noline
    display $out
  end-if

  if #OtherL_I > 0
    do Format-Number(#OtherL_I, $out,'999,999,999,999.99')          !Box 14L
    display 'Other L                   ' noline
    display $out

  end-if
  if #OtherM_I > 0
    do Format-Number( #OtherL_I, $out,'999,999,999,999.99')          !Box 14M
    display 'Other M                   ' noline
    display $out
  end-if

  if #OtherN_I > 0
    do Format-Number(#OtherN_I, $out,'999,999,999,999.99')          !Box 14N
    display 'Other N                   ' noline
    display $out
  end-if

  if #OtherO_I > 0
    do Format-Number(#OtherO_I, $out,'999,999,999,999.99')          !Box 14O
    display 'Other O                   ' noline
    display $out
  end-if

  if #OtherP_I > 0
    do Format-Number(#OtherP_I, $out,'999,999,999,999.99')          !Box 14P
    display 'Other K                   ' noline
    display $out
  end-if

  if #OtherQ_I > 0
    do Format-Number(#OtherQ_I, $out,'999,999,999,999.99')          !Box 14Q
    display 'Other Q                   ' noline
    display $out

  end-if
  if #OtherR_I > 0
    do Format-Number( #OtherR_I, $out,'999,999,999,999.99')          !Box 14R
    display 'Other R                   ' noline
    display $out
  end-if

  if #OtherS_I > 0
    do Format-Number(#OtherS_I, $out,'999,999,999,999.99')          !Box 14S
    display 'Other S                   ' noline
    display $out
  end-if

  if #OtherT_I > 0
    do Format-Number(#OtherT_I, $out,'999,999,999,999.99')          !Box 14T
    display 'Other T                   ' noline
    display $out
  end-if

  if #OtherU_I > 0
    do Format-Number(#OtherU_I, $out,'999,999,999,999.99')          !Box 14U
    display 'Other U                   ' noline
    display $out

  end-if
  if #OtherV_I > 0
    do Format-Number( #OtherV_I, $out,'999,999,999,999.99')          !Box 14V
    display 'Other V                   ' noline
    display $out
  end-if

  if #OtherW_I > 0
    do Format-Number(#OtherW_I, $out,'999,999,999,999.99')          !Box 14W
    display 'Other W                   ' noline
    display $out
  end-if

  if #OtherX_I > 0
    do Format-Number(#OtherX_I, $out,'999,999,999,999.99')          !Box 14X
    display 'Other X                   ' noline
    display $out
  end-if

  if #OtherY_I > 0
    do Format-Number(#OtherY_I, $out,'999,999,999,999.99')          !Box 14Y
    display 'Other Y                   ' noline
    display $out
  end-if

  if #OtherZ_I > 0
    do Format-Number(#OtherZ_I, $out,'999,999,999,999.99')          !Box 14Z
    display 'Other Z                   ' noline
    display $out
  end-if

  do Format-Number(#T_Count, $out,'999,999,999')
  display 'Total forms including alignment and subtotals'  noline
  display $out

end-procedure

begin-procedure Next-Form

  evaluate $Layout_Style
     when = '20'
      do Next-Form-FourVertical
      break
    when = '10'
      do Next-Form-TwoVertical
      break
  end-evaluate
end-procedure



begin-procedure Next-Form-FourVertical

  if #Form# <> 4
    add 1 to #Form#
  else
    move 1 to #form#
  end-if

  evaluate #Form#                 !use to position for next forms
    when = 1
      if $Form_ID = '10'
          next-listing
      else
          new-page
      end-if
      do Print-Value(' ',#Top_Margin,1,'Top Margin')
      next-listing
      do Print-Value(' ',#Last_Print_Line,1,'Last Print Line')
      break
    when = 2
      next-listing
      do Print-Value(' ',#Top_Split,1,'Top Split')
      next-listing
      do Print-Value(' ',#Last_Print_Line,1,'Last Print Line')
      break
    when = 3
      next-listing
      do Print-Value(' ',#Center_Split,1,'Center Split')
      next-listing
      do Print-Value(' ',#Last_Print_Line,1,'Last Print Line')
      break
    when = 4
      next-listing
      do Print-Value(' ',#Bottom_Split,1,'Bottom Split')
      next-listing
      do Print-Value(' ',#Last_Print_Line,1,'Last Print Line')
  end-evaluate
end-procedure

begin-procedure Next-Form-TwoVertical
  if #Form# <> 2
    add 1 to #Form#
  else
    move 1 to #form#
  end-if

  evaluate #Form#                 !use to position for next forms
    when = 1
      if #P_Count = 0
         add 1 to #P_Count
      else
         new-page
      end-if
      next-column
      do Print-Value(' ',#Top_Margin,1,'Top Margin')
      next-listing
      do Print-Value(' ',#Last_Print_Line,1,'Last Print Line')
      break
    when = 2
      next-listing
      do Print-Value(' ',#Center_Split,1,'Center Split')
      next-listing
      do Print-Value(' ',#Last_Print_Line,1,'Last Print Line')
  end-evaluate
end-procedure

begin-procedure Load-W2-PRT

begin-SELECT
F.GPUS_LAYOUT_FORMAT
F.GPUS_TOP_MARGIN
F.GPUS_TOP_SPLIT
F.GPUS_CENTER_SPLIT
F.GPUS_BOTTOM_SPLIT
F.GPUS_LAST_PRT_LINE
F.GPUS_TAXFORM_ID

  let $Layout_Style = RTRIM(&F.GPUS_LAYOUT_FORMAT,' ')

  move &F.GPUS_TOP_MARGIN      to #Top_Margin
  move &F.GPUS_TOP_SPLIT      to #Top_Split
  move &F.GPUS_CENTER_SPLIT     to #Center_Split
  move &F.GPUS_BOTTOM_SPLIT    to #Bottom_Split
  move &F.GPUS_LAST_PRT_LINE  to #Last_Print_Line
  move &F.GPUS_TAXFORM_ID      to $Taxform_Id

! encode '<27>E<27>(0N<27>&l6D<27>&l0E<27>&l66F' into $SetupString
! print $SetupString (1,1)
!            |    |       |       |       |
!            |    |       |       |        --> 66 text lines
!            |    |       |        --> top margin = 0 lines
!            |    |        --> 6 lines per inch
!            |     --> ISO 8859-1 symbol set
!             --> Reset

FROM  PS_GPUS_YE_PRT_FRM F
WHERE F.GPUS_PREPRTFORM = &TX.GPUS_PREPRTFORM
  AND F.GPUS_TAXFORM_ID = '10'
  AND F.EFFDT   =
      (SELECT MAX(EFFDT)
       FROM PS_GPUS_YE_TXFRM
       WHERE  GPUS_TAXFORM_ID = F.GPUS_TAXFORM_ID
       AND EFFDT  <= $AsOfDate)
end-SELECT

  do assign-year-end-variables


begin-SELECT
P.GPUS_TAXFORM_BOX
P.GPUS_PRINT_LINE
P.GPUS_PRINT_COLUMN
P.GPUS_PRINT_FORMAT
P.GPUS_PRINT_TEXT
  let $P.Box = LTRIM(RTRIM(&P.GPUS_TAXFORM_BOX,' '), ' ')
  evaluate $P.Box
    when = $YE_Fed_Wages                         !Federal wages
      move &P.GPUS_PRINT_LINE   to #L_01
      move &P.GPUS_PRINT_COLUMN    to #C_01
      let $F01 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Fed_Tax                           !Federal tax
      move &P.GPUS_PRINT_LINE   to #L_02
      move &P.GPUS_PRINT_COLUMN    to #C_02
      let $F02 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_SS_Wages                          !SS wages
      move &P.GPUS_PRINT_LINE   to #L_03
      move &P.GPUS_PRINT_COLUMN    to #C_03
      let $F03 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_SS_Tax                            !SS Tax
      move &P.GPUS_PRINT_LINE   to #L_04
      move &P.GPUS_PRINT_COLUMN    to #C_04
      let $F04 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Med_Wages                         !Medicare wages
      move &P.GPUS_PRINT_LINE   to #L_05
      move &P.GPUS_PRINT_COLUMN    to #C_05
      let $F05 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Med_Tax                           !Medicare tax
      move &P.GPUS_PRINT_LINE   to #L_06
      move &P.GPUS_PRINT_COLUMN    to #C_06
      let $F06 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_SS_Tips                           !SS tips
      move &P.GPUS_PRINT_LINE   to #L_07
      move &P.GPUS_PRINT_COLUMN    to #C_07
      let $F07 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Alloc_Tips                        !Allocated tips
      move &P.GPUS_PRINT_LINE   to #L_08
      move &P.GPUS_PRINT_COLUMN    to #C_08
      let $F08 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Adv_EIC                           !EIC
      move &P.GPUS_PRINT_LINE   to #L_09
      move &P.GPUS_PRINT_COLUMN    to #C_09
      let $F09 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Dep_Care                          !Dependent care
      move &P.GPUS_PRINT_LINE   to #L_10
      move &P.GPUS_PRINT_COLUMN    to #C_10
      let $F10 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Non_Qual_457                      !non-qualified plan total
      move &P.GPUS_PRINT_LINE   to #L_11
      move &P.GPUS_PRINT_COLUMN    to #C_11
      let $F11 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Box12_StartPos
      move &P.GPUS_PRINT_LINE   to #L_12_Start
      let $F12 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Uncoll_SS_Tax_On_Tips             !Uncoll SS tax on tips
      move &P.GPUS_PRINT_COLUMN    to #C_Uncoll_SS_Tax_On_Tips
      let $F_Uncoll_SS_Tax_On_Tips = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Uncoll_SS_Tax_On_Tips = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_Uncoll_Med_Tax_On_Tips            !Uncoll Medi tax on tips
      move &P.GPUS_PRINT_COLUMN    to #C_Uncoll_Med_Tax_On_Tips
      let $F_Uncoll_Med_Tax_On_Tips = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Uncoll_Med_Tax_On_Tips = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_Group_Term_Life                   !GTL
      move &P.GPUS_PRINT_COLUMN    to #C_Group_Term_Life
      let $F_Group_Term_Life = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Group_Term_Life = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_401K                              !401(k)
      move &P.GPUS_PRINT_COLUMN    to #C_401K
      let $F_401K = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_401K = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_403B                              !403(b)
      move &P.GPUS_PRINT_COLUMN    to #C_403B
      let $F_403B = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_403B = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_408K6                             !408(k)(6)
      move &P.GPUS_PRINT_COLUMN    to #C_408K6
      let $F_408K6 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_408K6 = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_457B                              !457(b)
      move &P.GPUS_PRINT_COLUMN    to #C_457B
      let $F_457B = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_457B = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_501C18D                           !501(c)(18)(D)
      move &P.GPUS_PRINT_COLUMN    to #C_501C18D
      let $F_501C18D = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_501C18D = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_Sick_Pay                          !Sick pay
      move &P.GPUS_PRINT_COLUMN    to #C_Sick_Pay
      let $F_Sick_Pay = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Sick_Pay = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_Excise_Tax                        !Excise tax
      move &P.GPUS_PRINT_COLUMN    to #C_Excise_Tax
      let $F_Excise_Tax = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Excise_Tax = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_Business_Exp                      !Business expense
      move &P.GPUS_PRINT_COLUMN    to #C_Business_Exp
      let $F_Business_Exp = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Business_Exp = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_Uncoll_SS_Tax_GTL                 !Uncoll SS tax - GTL
      move &P.GPUS_PRINT_COLUMN    to #C_Uncoll_SS_Tax_GTL
      let $F_Uncoll_SS_Tax_GTL = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Uncoll_SS_Tax_GTL = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_Uncoll_Med_Tax_GTL                !Uncoll Medi tax - GTL
      move &P.GPUS_PRINT_COLUMN    to #C_Uncoll_Med_Tax_GTL
      let $F_Uncoll_Med_Tax_GTL = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Uncoll_Med_Tax_GTL = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when = $YE_Excl_Moving_Exp                   !Excl Moving Exp
      move &P.GPUS_PRINT_COLUMN    to #C_Excl_Moving_Exp
      let $F_Excl_Moving_Exp = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Excl_Moving_Exp = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    !when = $YE_Basic_Qtrs_and_Subsist            !Basic Quarters and Subsistence
    !  move &P.GPUS_PRINT_COLUMN    to #C_Basic_Qtrs_and_Subsist
    !  let $F_Basic_Qtrs_and_Subsist = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
    !  let $T_Basic_Qtrs_and_Subsist = RTRIM(&P.GPUS_PRINT_TEXT,' ')
    ! break

    when = $YE_Nontaxable_Combat_Pay           !Non Taxable Combat Pay
      move &P.GPUS_PRINT_COLUMN    to #C_Nontaxable_Combat_Pay 
      let $F_Nontaxable_Combat_Pay  = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Nontaxable_Combat_Pay  = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break

    when = $YE_Med_Svgs_Acct                     !Medical Expense Account
      move &P.GPUS_PRINT_COLUMN    to #C_Med_Svgs_Acct
      let $F_Med_Svgs_Acct = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Med_Svgs_Acct = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break

    when = $YE_408P_Simple_Retirement            !Section 418(p) SIMPLE Retirement
      move &P.GPUS_PRINT_COLUMN    to #C_408P_Simple_Retirement
      let $F_408P_Simple_Retirement = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_408P_Simple_Retirement = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break

    when = $YE_Adoption_Exp                      !Adoption Expenses
      move &P.GPUS_PRINT_COLUMN    to #C_Adoption_Exp
      let $F_Adoption_Exp = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Adoption_Exp = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break

    when = $YE_NonStatutory_Stock_Opt            !NonStatutory Stock Opt
      move &P.GPUS_PRINT_COLUMN    to #C_NonStatutory_Stock_Opt
      let $F_NonStatutory_Stock_Opt = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_NonStatutory_Stock_Opt = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
      
    when = $YE_NonQual_Def_Comp            !NonQualified Deferred Compensation
      move &P.GPUS_PRINT_COLUMN    to #C_NonQual_Def_Comp
      let $F_NonQual_Def_Comp = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_NonQual_Def_Comp = RTRIM(&P.GPUS_PRINT_TEXT,' ')
    break
      
    when = $YE_Income_NonQual_Def_Comp      !Income on NonQualified Deferred Compensation
      move &P.GPUS_PRINT_COLUMN    to #C_Income_NonQual_Def_Comp
      let $F_Income_NonQual_Def_Comp = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Income_NonQual_Def_Comp = RTRIM(&P.GPUS_PRINT_TEXT,' ')
    break

    when = $YE_Statut_EE                         !Statutory EE checkbox
      move &P.GPUS_PRINT_LINE   to #L_13A
      move &P.GPUS_PRINT_COLUMN    to #C_13A
      break
    when = $YE_Retire_Plan                       !Deceased checkbox
      move &P.GPUS_PRINT_LINE   to #L_13B
      move &P.GPUS_PRINT_COLUMN    to #C_13B
      break
    when = $YE_Third_Party_Sick_Pay              !Third Party Sickpay checkbox
      move &P.GPUS_PRINT_LINE   to #L_13C
      move &P.GPUS_PRINT_COLUMN    to #C_13C
      break
    when = $YE_State                              !State
      move &P.GPUS_PRINT_LINE   to #L_15
      move &P.GPUS_PRINT_COLUMN    to #C_15
      let $F15 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_State_ID                           !State Employer ID
      move &P.GPUS_PRINT_LINE   to #L_15A
      move &P.GPUS_PRINT_COLUMN    to #C_15A
      let $F15A = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_State_ID_Box_Size = TO_NUMBER(SUBSTR($F15A,3,INSTR($F15A,')',1)-2))
      break
    when = $YE_State_Wages                        !State wages
      move &P.GPUS_PRINT_LINE   to #L_16
      move &P.GPUS_PRINT_COLUMN    to #C_16
      let $F16 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_State_Tax                          !State tax
      move &P.GPUS_PRINT_LINE   to #L_17
      move &P.GPUS_PRINT_COLUMN    to #C_17
      let $F17 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      break
    when = $YE_Control_Nbr
      move &P.GPUS_PRINT_LINE   to #L_A
      move &P.GPUS_PRINT_COLUMN    to #C_A
      let $FA = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_Control_Nbr_Box_Size = TO_NUMBER(SUBSTR($FA,3,INSTR($FA,')',1)-2))
      break
    when = $YE_ER_ID
      move &P.GPUS_PRINT_LINE   to #L_B
      move &P.GPUS_PRINT_COLUMN    to #C_B
      let $FB = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_ER_ID_Box_Size = TO_NUMBER(SUBSTR($FB,3,INSTR($FB,')',1)-2))
      break
    when = $YE_ER_Name
      move &P.GPUS_PRINT_LINE   to #L_C1
      move &P.GPUS_PRINT_COLUMN    to #C_C1
      let $FC1 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_ER_Name_Box_Size = TO_NUMBER(SUBSTR($FC1,3,INSTR($FC1,')',1)-2))
      break
    when = $YE_ER_Address1
      move &P.GPUS_PRINT_LINE   to #L_C2
      move &P.GPUS_PRINT_COLUMN    to #C_C2
      let $FC2 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_ER_Address1_Box_Size = TO_NUMBER(SUBSTR($FC2,3,INSTR($FC2,')',1)-2))
      break
    when = $YE_ER_Address2
      move &P.GPUS_PRINT_LINE   to #L_C3
      move &P.GPUS_PRINT_COLUMN    to #C_C3
      let $FC3 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_ER_Address2_Box_Size = TO_NUMBER(SUBSTR($FC3,3,INSTR($FC3,')',1)-2))
      break
    when = $YE_State_City_Zip
      move &P.GPUS_PRINT_LINE   to #L_C4
      move &P.GPUS_PRINT_COLUMN    to #C_C4
      let $FC4 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_State_City_Zip_Box_Size = TO_NUMBER(SUBSTR($FC4,3,INSTR($FC4,')',1)-2))
      break
    when = $YE_EE_SSN
      move &P.GPUS_PRINT_LINE   to #L_D
      move &P.GPUS_PRINT_COLUMN    to #C_D
      let $FD = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_EE_SSN_Box_Size = TO_NUMBER(SUBSTR($FD,3,INSTR($FD,')',1)-2))
      break
    when = $YE_EE_FullName
      move &P.GPUS_PRINT_LINE   to #L_E
      move &P.GPUS_PRINT_COLUMN    to #C_E
      let $FE = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_EE_FullName_Box_Size  = TO_NUMBER(SUBSTR($FE,3,INSTR($FE,')',1)-2))
      break
    when = $YE_EE_FName
      move &P.GPUS_PRINT_LINE   to #L_E1
      move &P.GPUS_PRINT_COLUMN    to #C_E1
      let $FE1 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_EE_FName_Box_Size = TO_NUMBER(SUBSTR($FE1,3,INSTR($FE1,')',1)-2))
      break
    when = $YE_EE_LName
      move &P.GPUS_PRINT_LINE   to #L_E3
      move &P.GPUS_PRINT_COLUMN    to #C_E3
      let $FE3 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_EE_LName_Box_Size = TO_NUMBER(SUBSTR($FE3,3,INSTR($FE3,')',1)-2))
      break
    when = $YE_EE_Address1
      move &P.GPUS_PRINT_LINE   to #L_F1
      move &P.GPUS_PRINT_COLUMN    to #C_F1
      let $FF1 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_EE_Address1_Box_Size = TO_NUMBER(SUBSTR($FF1,3,INSTR($FF1,')',1)-2))
      break
    when = $YE_EE_Address2
      move &P.GPUS_PRINT_LINE   to #L_F2
      move &P.GPUS_PRINT_COLUMN    to #C_F2
      let $FF2 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_EE_Address2_Box_Size = TO_NUMBER(SUBSTR($FF2,3,INSTR($FF2,')',1)-2))
      break
    when = $YE_EE_Country
      move &P.GPUS_PRINT_LINE   to #L_F3
      move &P.GPUS_PRINT_COLUMN    to #C_F3
      let $FF3 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let #YE_EE_Country_Box_Size = TO_NUMBER(SUBSTR($FF3,3,INSTR($FF3,')',1)-2))
      break
    when = 'R'
      move &P.GPUS_PRINT_LINE   to #L_R
      move &P.GPUS_PRINT_COLUMN    to #C_R
      let $FReprint  = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Reprint  = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      let #ReprintDescr_Box_Size = TO_NUMBER(SUBSTR($FReprint, 3,INSTR($FReprint,')',1)-2))
      break
    when = 'R1'
      move &P.GPUS_PRINT_LINE   to #L_R1
      move &P.GPUS_PRINT_COLUMN    to #C_R1
      let $FReprint1  = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Reprint1  = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      let #ReprintDescr_Box_Size = TO_NUMBER(SUBSTR($FReprint1, 3,INSTR($FReprint1,')',1)-2))
      break
    when = 'R2'
      move &P.GPUS_PRINT_LINE   to #L_R2
      move &P.GPUS_PRINT_COLUMN    to #C_R2
      let $FReprint2  = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Reprint2  = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      let #ReprintDescr_Box_Size = TO_NUMBER(SUBSTR($FReprint2, 3,INSTR($FReprint2,')',1)-2))
      break
    when = 'V'
      move &P.GPUS_PRINT_LINE   to #L_V
      move &P.GPUS_PRINT_COLUMN    to #C_V
      let $F_Void = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      let $T_Void = RTRIM(&P.GPUS_PRINT_TEXT,' ')
      break
    when-other
      if $P.Box = $YE_Other
        move &P.GPUS_PRINT_LINE   to #L_14_Start
        let $F14 = RTRIM(&P.GPUS_PRINT_FORMAT,' ')
      else
        move $P.Box to $Box xx
        if $Box = $YE_Other
          move &P.GPUS_PRINT_COLUMN    to #C_14_Start
          let $Box14Letter = SUBSTR($P.Box,3,1)
          let #index = INSTR('ABCDEFGHIJKLMNOPQRSTUVWXYZ',$Box14Letter,1)
          let $P.Print_Text = RTRIM(&P.GPUS_PRINT_TEXT,' ')
          PUT &P.GPUS_PRINT_COLUMN $P.Print_Text INTO BOX14(#INDEX) COLUMN TEXT
        end-if
      end-if
      break
  end-evaluate


 FROM  PS_GPUS_YE_PRT_BOX P
 WHERE  P.GPUS_PREPRTFORM = &TX.GPUS_PREPRTFORM
 AND P.GPUS_TAXFORM_ID = '10'
 AND P.EFFDT   =
   (SELECT MAX(EFFDT)
   FROM   PS_GPUS_YE_TXFRM
   WHERE  GPUS_TAXFORM_ID = P.GPUS_TAXFORM_ID
   AND  EFFDT  <= $AsOfDate)
ORDER BY P.GPUS_TAXFORM_BOX
end-SELECT
end-procedure

begin-procedure Load-Test-Data
  let $E.Control_Number =
         LPAD($x,TO_NUMBER(SUBSTR($FA,3,INSTR($FA,')',1)-2)),'X')

  let $A.Federal_EIN =
         LPAD($x,TO_NUMBER(SUBSTR($FB,3,INSTR($FB,')',1)-2)),'X')

  let $A.Descr =
         LPAD($x,TO_NUMBER(SUBSTR($FC1,3,INSTR($FC1,')',1)-2)),'X')

  let $A.Address1 =
         LPAD($x,TO_NUMBER(SUBSTR($FC2,3,INSTR($FC2,')',1)-2)),'X')

  let $A.Address2 =
         LPAD($x,TO_NUMBER(SUBSTR($FC3,3,INSTR($FC3,')',1)-2)),'X')

  let $C4 =
         LPAD($x,TO_NUMBER(SUBSTR($FC4,3,INSTR($FC4,')',1)-2)),'X')

  let $E.SSN =
         LPAD($x,TO_NUMBER(SUBSTR($FD,3,INSTR($FD,')',1)-2)),'X')

  let $E.YE_Name =
         LPAD($x,TO_NUMBER(SUBSTR($FE,3,INSTR($FE,')',1)-2)),'X')

  let $E.YE_FName =
         LPAD($x,TO_NUMBER(SUBSTR($FE1,3,INSTR($FE1,')',1)-2)),'X')

  let $E.YE_LName =
         LPAD($x,TO_NUMBER(SUBSTR($FE3,3,INSTR($FE3,')',1)-2)),'X')

  let $E.Address1 =
         LPAD($x,TO_NUMBER(SUBSTR($FF1,3,INSTR($FF1,')',1)-2)),'X')

  let $E.Address2 =
         LPAD($x,TO_NUMBER(SUBSTR($FF2,3,INSTR($FF2,')',1)-2)),'X')

  let $F3 =
         LPAD($x,TO_NUMBER(SUBSTR($FF3,3,INSTR($FF3,')',1)-2)),'X')

    let $ReprintDescr =
         LPAD($x,TO_NUMBER(SUBSTR($FReprint,3,INSTR($FReprint,')',1)-2)),'X')

  let $ReprintDescr1 =
         LPAD($x,TO_NUMBER(SUBSTR($FReprint1,3,INSTR($FReprint1,')',1)-2)),'X')

  let $ReprintDescr2 =
         LPAD($x,TO_NUMBER(SUBSTR($FReprint2,3,INSTR($FReprint2,')',1)-2)),'X')

  move $F01 to $01
  let $01 = TRANSLATE($01,'Bb','99')              !Federal wages
  move $01 to #Fed_Wages

  move $F02 to $02
  let $02 = TRANSLATE($02,'Bb','99')              !Federal tax
  move $02 to #Fed_Tax

  move $F03 to $03
  let $03 = TRANSLATE($03,'Bb','99')              !SS wages
  move $03 to #SS_Wages

  move $F04 to $04
  let $04 = TRANSLATE($04,'Bb','99')              !SS Tax
  move $04 to #SS_Tax

  move $F05 to $05
  let $05 = TRANSLATE($05,'Bb','99')              !Medicare wages
  move $05 to #Med_Wages

  move $F06 to $06
  let $06 = TRANSLATE($06,'Bb','99')              !Medicare tax
  move $06 to #Med_Tax

  move $F07 to $07
  let $07 = TRANSLATE($07,'Bb','99')              !SS tips
  move $07 to #SS_Tips

  move $F08 to $08
  let $08 = TRANSLATE($08,'Bb','99')              !Allocated tips
  move $08 to #Alloc_Tips

  move $F09 to $09
  let $09 = TRANSLATE($09,'Bb','99')              !EIC
  move $09 to #Adv_EIC

  move $F10 to $10
  let $10 = TRANSLATE($10,'Bb','99')              !Dependent care
  move $10 to #Dep_Care

  move $F11 to $11
  let $11 = TRANSLATE($11,'Bb','99')              !Non-qualified plans
  move $11 to #Non_Qual_457_Amt

  move $F12 to $12
  let $12 = TRANSLATE($12,'Bb','99')              !Box 12 Amounts
  move $12 to #Uncoll_SS_Tax_On_Tips
  move $12 to #Uncoll_Med_Tax_On_Tips
  move $12 to #Group_Term_Life
  move $12 to #401K

  move $F14 to $14
  let $14 = TRANSLATE($14,'Bb','99')              !Box 14 Amounts
  move $14 to #14
  move 1 to #i
  while #i <= 4
    put #14 into Box14(#i) Amount
    add 1 to #i
  end-while

  let $E.GPUS_YE_STATE =
         LPAD($x,TO_NUMBER(SUBSTR($F15,3,INSTR($F15,')',1)-2)),'X')

  let $E.Employer_ID_SWT =
         LPAD($x,TO_NUMBER(SUBSTR($F15A,3,INSTR($F15A,')',1)-2)),'X')

  move $F16 to $16
  let $16 = TRANSLATE($16,'Bb','99')              !State wages
  move $16 to #State_Wages

  move $F17 to $17
  let $17 = TRANSLATE($17,'Bb','99')              !State tax
  move $17 to #State_Tax

  let #LOCALSIZE = TO_NUMBER(SUBSTR($F20,3,INSTR($F20,')',1)-2))

  if #LOCALSIZE > #MAXLOCAL
     let $LocalityPrintName = LPAD($x,#MAXLOCAL,'X')
  else
     let $LocalityPrintName = LPAD($x,#LOCALSIZE,'X')
  end-if

end-procedure

begin-procedure Print-Alignment-Forms
  move &TX.GPUS_YE_ALIGNCOUNT to #Align_Count
  move 'Y' to $AlignForm
  let #Align_Count = #Align_Count * #FormsPerPage
  move #EmployeesPerPage to #temp
  move #FormsPerPage to #EmployeesPerPage
  move 1 to #k
  while #k <= #Align_Count
    do Load-Test-Data

    if $Form_ID = '10' and (#k = 1 or mod(#k - 1,4) = 0)      !LPS4V
       do LongNameAddressEE
    end-if

    do Print-W2
    add 1 to #k
  end-while
  let $FirstEE = 'Y'
  move 0 to #Align_Count
  move #temp to #EmployeesPerPage
  move '' to $priorState
  move '' to $priorLocality
  move '' to $LocalityPrintName
  do Zero-Box14
end-procedure

begin-procedure Print-Value($String,#Line,#Col,$Identifier)

Show 'String' $String 'Col' #Col
If #Col = 0
   let #Col = 1
end-if
  if #Line > 0 AND #Col > 0
    print $String (#Line,#Col)
  else
    display ''
    display '***************************************'
    display 'Print Line not defined for ' noline
    display $Identifier
    display 'in Tax Form Print Parameters Table.'
    display 'Program Stopped.'
    display '***************************************'
    display ''
    stop
  end-if
end-procedure


begin-procedure Convert-Parameters

  move $GPUS_YE_PRC_TYPE   to $SelectEEs
  move $GPUS_YE_PRC_TYPE   to $SelectCompanies
  move $GPUS_YE_SORT1        to $SortCode1
  move $GPUS_YE_SORT2        to $SortCode3

  if $SelectEEs = '30'
    do Read-EEs
  end-if

  if $SelectCompanies = '20'
    do Read-Companies
  end-if

  do Create-Order-By

end-procedure

begin-procedure Create-Order-By

  move 'ORDER BY E.EMPLID, E.GPUS_SEQ_NBR' to $Sort2
  move 'ORDER BY T.EMPLID, T.GPUS_SEQ_NBR' to $Sort3
  move 'ORDER BY T1.EMPLID, T1.GPUS_SEQ_NBR' to $Sort4

  if $SortCode1 <> '10'

    evaluate $SortCode3
      when = '20'               !ID
        evaluate $SortCode1
          when = '50'
            move 'ORDER BY E.STATE, E.EMPLID, E.GPUS_SEQ_NBR' to $Sort2
          when = '40'
            move 'ORDER BY J.GP_PAYGROUP, S.EMPLID' to $Sort1
            move 'ORDER BY T.EMPLID, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.EMPLID, T1.GPUS_SEQ_NBR' to $Sort4
          when = '20'
            move 'ORDER BY J.DEPTID, S.EMPLID' to $Sort1
            move 'ORDER BY T.EMPLID, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.EMPLID, T1.GPUS_SEQ_NBR' to $Sort4
          when = '60'
            move 'ORDER BY E.POSTAL, E.EMPLID, E.GPUS_SEQ_NBR' to $Sort2
          when = '30'
            move 'ORDER BY K.GP_PSLP_MAIL_DROP, G.EMPLID' to $Sort1
            move 'ORDER BY T.EMPLID, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.EMPLID, T1.GPUS_SEQ_NBR' to $Sort4
         end-evaluate

      when = '30'               !SSN
        evaluate $SortCode1
          when = '50'
            move 'ORDER BY E.STATE, E.SSN, E.GPUS_SEQ_NBR' to $Sort2
          when = '40'
            move 'ORDER BY J.GP_PAYGROUP, S.SSN' to $Sort1
            move 'ORDER BY T.SSN, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.SSN, T1.GPUS_SEQ_NBR' to $Sort4
          when = '20'
            move 'ORDER BY J.DEPTID, S.SSN' to $Sort1
            move 'ORDER BY T.SSN, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.SSN, T1.GPUS_SEQ_NBR' to $Sort4
          when = '60'
            move 'ORDER BY E.POSTAL, E.SSN, E.GPUS_SEQ_NBR' to $Sort2
          when = '30'
            move 'ORDER BY K.GP_PSLP_MAIL_DROP, G.SSN' to $Sort1
            move 'ORDER BY T.SSN, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.SSN, T1.GPUS_SEQ_NBR' to $Sort4
        end-evaluate

      when = '10'               !Name
        evaluate $SortCode1
          when = '50'
            move 'ORDER BY E.STATE,E.GPUS_YE_LNAME, E.SSN, E.GPUS_SEQ_NBR' to $Sort2
          when = '40'
            move 'ORDER BY J.GP_PAYGROUP, S.GPUS_YE_LNAME, S.SSN' to $Sort1
            move 'ORDER BY T.GPUS_YE_LNAME, T.SSN, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.GPUS_YE_LNAME, T1.SSN, T1.GPUS_SEQ_NBR' to $Sort4
          when = '20'
            move 'ORDER BY J.DEPTID, S.GPUS_YE_LNAME, S.SSN' to $Sort1
            move 'ORDER BY T.GPUS_YE_LNAME, T.SSN, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.GPUS_YE_LNAME, T1.SSN, T1.GPUS_SEQ_NBR' to $Sort4
          when = '60'
            move 'ORDER BY E.POSTAL, E.GPUS_YE_LNAME, E.SSN, E.GPUS_SEQ_NBR' to $Sort2
          when = '30'
            move 'ORDER BY K.GP_PSLP_MAIL_DROP, G.GPUS_YE_LNAME, G.SSN' to $Sort1
            move 'ORDER BY T.GPUS_YE_LNAME, T.SSN, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.GPUS_YE_LNAME, T1.SSN, T1.GPUS_SEQ_NBR' to $Sort4
        end-evaluate

      when = ''               ! None  - default Emplid
        evaluate $SortCode1
          when = '50'
            move 'ORDER BY E.STATE, E.EMPLID, E.GPUS_SEQ_NBR' to $Sort2
          when = '40'
            move 'ORDER BY J.GP_PAYGROUP, S.EMPLID' to $Sort1
            move 'ORDER BY T.EMPLID, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.EMPLID, T1.GPUS_SEQ_NBR' to $Sort4
          when = '20'
            move 'ORDER BY J.DEPTID, S.EMPLID' to $Sort1
            move 'ORDER BY T.EMPLID, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.EMPLID, T1.GPUS_SEQ_NBR' to $Sort4
          when = '60'
            move 'ORDER BY E.POSTAL, E.EMPLID, E.GPUS_SEQ_NBR' to $Sort2
          when = '30'
            move 'ORDER BY K.GP_PSLP_MAIL_DROP, G.EMPLID' to $Sort1
            move 'ORDER BY T.EMPLID, T.GPUS_SEQ_NBR' to $Sort3
            move 'ORDER BY T1.EMPLID, T1.GPUS_SEQ_NBR' to $Sort4
          end-evaluate

    end-evaluate
  else
    evaluate $SortCode3
      when = '20'
        move 'ORDER BY E.EMPLID, E.GPUS_SEQ_NBR, E.GPUS_TAX_EIN' to $Sort2
        move 'ORDER BY T.EMPLID, T.GPUS_SEQ_NBR, T.GPUS_TAX_EIN' to $Sort3
        move 'ORDER BY T1.EMPLID, T1.GPUS_SEQ_NBR, T1.GPUS_TAX_EIN' to $Sort4
      when = '30'
        move 'ORDER BY E.SSN, E.GPUS_SEQ_NBR, E.GPUS_TAX_EIN'    to $Sort2
        move 'ORDER BY T.SSN, T.GPUS_SEQ_NBR, T.GPUS_TAX_EIN'    to $Sort3
        move 'ORDER BY T1.SSN, T1.GPUS_SEQ_NBR, T1.GPUS_TAX_EIN'    to $Sort4
      when = '10'
        move 'ORDER BY E.GPUS_YE_LNAME, E.SSN, E.GPUS_SEQ_NBR, E.GPUS_TAX_EIN' to $Sort2
        move 'ORDER BY T.GPUS_YE_LNAME, T.SSN, T.GPUS_SEQ_NBR, T.GPUS_TAX_EIN' to $Sort3
        move 'ORDER BY T1.GPUS_YE_LNAME, T1.SSN, T1.GPUS_SEQ_NBR, T1.GPUS_TAX_EIN' to $Sort4
      when = ''
        move 'ORDER BY E.EMPLID, E.GPUS_SEQ_NBR, E.GPUS_TAX_EIN' to $Sort2
        move 'ORDER BY T.EMPLID, T.GPUS_SEQ_NBR, T.GPUS_TAX_EIN' to $Sort3
        move 'ORDER BY T1.EMPLID, T1.GPUS_SEQ_NBR, T1.GPUS_TAX_EIN' to $Sort4
    end-evaluate
  end-if
end-procedure

Begin-procedure emp-from-to

BEGIN-SELECT
EMPLID_FROM  &EFROM
EMPLID_TO   &ETO
  LET $EFRM = &EFROM
  LET $ET = &ETO
  LET $TEST = 'ABC,'''
   UNSTRING $TEST BY ',' INTO $B $A


  let $fromtoE  = 'AND E.EMPLID BETWEEN '''||$EFRM||''' AND '''||$ET||$A
  let $fromtoS  = 'AND S.EMPLID BETWEEN '''||$EFRM||''' AND '''||$ET||$A
  let $fromtoG  = 'AND G.EMPLID BETWEEN '''||$EFRM||''' AND '''||$ET||$A
  let $fromtoT  = 'AND T.EMPLID BETWEEN '''||$EFRM||''' AND '''||$ET||$A
  let $fromtoT1  = 'AND T1.EMPLID BETWEEN '''||$EFRM||''' AND '''||$ET||$A

from PS_GP_STRM
WHERE STRM_NUM = #STRM_NUM


END-SELECT
END-PROCEDURE


begin-procedure Read-EEs

move 'AND E.EMPLID in (''' to $E.SelectedEEs
move 'AND S.EMPLID in (''' to $S.SelectedEEs
move 'AND G.EMPLID in (''' to $G.SelectedEEs
move 'AND T.EMPLID in (''' to $T.SelectedEmpl
move 'AND T1.EMPLID in (''' to $T1.SelectedEmpl
move ' ' to $SelectedEmplID

begin-SELECT
C.EMPLID

  move &C.EMPLID     to $SelectedEmplID

  let $E.SelectedEEs = $E.SelectedEEs || $SelectedEmplID || ''','''
  let $S.SelectedEEs = $S.SelectedEEs || $SelectedEmplID || ''','''
  let $G.SelectedEEs = $G.SelectedEEs || $SelectedEmplID || ''','''
  let $T.SelectedEmpl = $T.SelectedEmpl || $SelectedEmplID || ''','''
  let $T1.SelectedEmpl = $T1.SelectedEmpl || $SelectedEmplID || ''','''
  move 'Y' to $EE_Selected

FROM  PS_GPUS_RC_YE4 C
WHERE C.OPRID         = $Prcs_OprID
  AND C.RUN_CNTL_ID   = $Prcs_Run_Cntl_ID
end-SELECT


let $E.SelectedEEs = SUBSTR($E.SelectedEEs,1,LENGTH($E.SelectedEEs) - 2)
let $E.SelectedEEs = $E.SelectedEEs || ')'

let $S.SelectedEEs = SUBSTR($S.SelectedEEs,1,LENGTH($S.SelectedEEs) - 2)
let $S.SelectedEEs = $S.SelectedEEs || ')'

let $G.SelectedEEs = SUBSTR($G.SelectedEEs,1,LENGTH($G.SelectedEEs) - 2)
let $G.SelectedEEs = $G.SelectedEEs || ')'

let $T.SelectedEmpl = SUBSTR($T.SelectedEmpl,1,LENGTH($T.SelectedEmpl) - 2)
let $T.SelectedEmpl = $T.SelectedEmpl || ')'

let $T1.SelectedEmpl = SUBSTR($T1.SelectedEmpl,1,LENGTH($T1.SelectedEmpl) - 2)
let $T1.SelectedEmpl = $T1.SelectedEmpl || ')'

end-procedure

begin-procedure Delete-Sel-Employees-Table
begin-SQL on-error=Ignore
  DELETE FROM PS_GPUS_RC_YE4
  WHERE OPRID       = $Prcs_OprID
    AND RUN_CNTL_ID = $Prcs_Run_Cntl_ID

end-SQL
end-procedure

begin-procedure Read-Companies

move 'AND A.GPUS_YE_RPT_CO in (''' to $A.SelectedCompanies
move 'AND E.GPUS_YE_RPT_CO in (''' to $E.SelectedCompanies
move 'AND D.GPUS_YE_RPT_CO in (''' to $D.SelectedCompanies

move ' ' to $SelectedEmplID

begin-SELECT
D1.GPUS_YE_RPT_CO
  move &D1.GPUS_YE_RPT_CO    to $SelectedCompany
  let $A.SelectedCompanies = $A.SelectedCompanies || $SelectedCompany || ''','''
  let $E.SelectedCompanies = $E.SelectedCompanies || $SelectedCompany || ''','''
  let $D.SelectedCompanies = $D.SelectedCompanies || $SelectedCompany || ''','''
  move 'Y' to $Company_Selected
FROM  PS_GPUS_RC_YE3 D1
WHERE D1.OPRID         = $Prcs_OprID
  AND D1.RUN_CNTL_ID   = $Prcs_Run_Cntl_ID

end-SELECT

let $A.SelectedCompanies = SUBSTR($A.SelectedCompanies,1,LENGTH($A.SelectedCompanies) - 2)
let $A.SelectedCompanies = $A.SelectedCompanies || ')'

let $E.SelectedCompanies = SUBSTR($E.SelectedCompanies,1,LENGTH($E.SelectedCompanies) - 2)
let $E.SelectedCompanies = $E.SelectedCompanies || ')'

let $D.SelectedCompanies = SUBSTR($D.SelectedCompanies,1,LENGTH($D.SelectedCompanies) - 2)
let $D.SelectedCompanies = $D.SelectedCompanies || ')'



end-procedure


begin-procedure Delete-Sel-Company-Table
begin-SQL on-error=Ignore
  DELETE FROM PS_GPUS_RC_YE3
  WHERE OPRID       = $Prcs_OprID
    AND RUN_CNTL_ID = $Prcs_Run_Cntl_ID

end-SQL
end-procedure

begin-procedure Ignore
! dummy procedure to avoid SQL error message on delete of empty table
end-procedure

begin-procedure LongNameAddressEE

  if #P_Count = 0
                 add 1 to #P_Count
  else
                 new-page
  end-if

  if #G > #Align_Count

                 Let $address1   = $E.Address1
                 Let $address2   = $E.Address2
                 Let $address3   = $E.Address3
                 Let $City       = $E.City
                 Let $State      = $E.State
                 Let $Postal     = $E.Zip
                 Let $Country    = $E.Country

      do adformat
      do Compress-Address

                     Let $EPADD1           = $ADDLINE1
                     Let $EPADD2           = $ADDLINE2
                     Let $EPCSP            = $ADDLINE3

         if RTRIM($EPADD2, ' ') = 'USA'
                 Let $COADD2 = ''
          end-if
          if RTRIM($EPCSP, ' ') = 'USA'
                 Let $EPCSP = ''
          end-if

          IF (instr ($EPADD2,$E.City,0) > 0 AND LENGTH($EPADD2) > #YE_EE_Country_Box_Size)
            OR (instr ($EPCSP,$E.City,0) > 0 AND LENGTH($EPCSP) > #YE_EE_Country_Box_Size)

           IF LENGTH($EPADD2) > #YE_EE_Country_Box_Size
             let #newlength = length($E.City) + #YE_State_City_Zip_Box_Size - length($EPADD2)
             let $E.City = substr($E.City,1,#newlength)
           ELSE
             let #newlength = length($E.City) + #YE_EE_Country_Box_Size - length($EPCSP)
             let $E.City = substr($E.City,1,#newlength)
           END-IF

                 Let $address1   = $E.Address1
                 Let $address2   = $E.Address2
                 Let $address3   = $E.Address3
                 Let $City       = $E.City
                 Let $State      = $E.State
                 Let $Postal     = $E.Zip
                 Let $Country    = $E.Country
           do adformat
           do Compress-Address

              Let $EPADD1           = $ADDLINE1
              Let $EPADD2           = $ADDLINE2
              Let $EPCSP            = $ADDLINE3

             if RTRIM($EPADD2, ' ') = 'USA'
                 Let $COADD2 = ''
             end-if
             if RTRIM($EPCSP, ' ') = 'USA'
                 Let $EPCSP = ''
             end-if
          END-IF

  if RTRIM($EPADD2, ' ') <> ''
   if $Use_Alternate_Name = 'Y'
       print $Alternate_Name     (6,24)
   else
       print $E.YE_Name          (6,24)
   end-if
   print $EPADD1    (+1,24)
   print $EPADD2    (+1,24)
   print $EPCSP     (+1,24)
 else
   if $Use_Alternate_Name = 'Y'
       print $Alternate_Name     (7,24)
   else
       print $E.YE_Name          (7,24)
   end-if
   print $EPADD1    (+1,24)
   print $EPCSP     (+1,24)
 end-if

ELSE
      if $FirstEE = 'Y'
        and #Align_Count = 0
        do Get-EE-Address-Line3
        let $firstEE = 'N'
      end-if

        if RTRIM($E.Address2, ' ') <> ''
            if $Use_Alternate_Name = 'Y'
                print $Alternate_Name     (6,24)
            else
                print $E.YE_Name          (6,24)
            end-if

            print $E.Address1    (+1,24)
            print $E.Address2    (+1,24)
            print $F3            (+1,24)
        else
            if $Use_Alternate_Name = 'Y'
                print $Alternate_Name     (7,24)
            else
                print $E.YE_Name          (7,24)
            end-if

            print $E.Address1    (+1,24)
            print $F3            (+1,24)


        END-IF
END-IF
end-procedure

#Include 'gpusrntl.sqc'
#Include 'curdttim.sqc'  !Get-Current-DateTime procedure
#Include 'rotname1.sqc'  !Rotate-Name procedure
#Include 'datetime.sqc'  !Routines for date and time formatting
#Include 'number.sqc'    !Routines to format numbers
#Include 'gpusw2so.sqc'
#Include 'adformat.sqc'  !Routines to format address
#Include 'stdapi.sqc'    !Update Process API
#Include 'gpusw2.sqc'