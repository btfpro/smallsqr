
!***********************************************************************     
! BRCAT01:  Comunicado de Acidente de Trabalho - CAT                   * 
!***********************************************************************     
!***********************************************************************     
!                                                                      *     
!               Confidentiality Information:                           *     
!                                                                      *     
!                                                                      *     
! This module contains confidential and proprietary information        *     
! of Oracle; it is not to be copied, reproduced, or transmitted             *
! in any form, by any means, in whole or in part, nor is it to              *
! be used for any purpose other than that for which it is                   *
! expressly provided under the applicable license agreement.                *
!                                                                           *
! Copyright (C) 2007 Oracle. All Rights Reserved.                      *
!                                                                      *     
!***********************************************************************     
!                                                                      *     
!          $Date:  2007/09/18:16:06:14                                 !
!       $Release:  HR9                                                 !
!    $Resolution:  689848                                              !
!             $Version:                                                !
!                                                                      *     
!***********************************************************************     

#include 'setenv.sqc'       !Set environment          

Begin-Setup                                               
#include 'setupdb.sqc' 
 Declare-Printer     THIS_REPORT
   Type=HPLASERJET
   Font=3
   Point-Size=1  
   Symbol-Set=0U     ! ASCII symbol set   
 End-Declare 
   
 Declare-Layout THIS_REPORT  
   Orientation   = Portrait
   Top-margin    = 0.3
   Left-margin   = 0.5 
   Right-margin  = 0.5
   Max-Lines     = 250                                                                           
   Char-Width    = 4      ! 7.2                            
   Line-Height   = 5
 End-Declare                        

 
 Declare-Report THIS_REPORT
   Printer-Type=HPLASERJET
   LayOut=THIS_REPORT
 End-Declare
  
 !Declare-Image Previdencia-Logo
 !  Type       = gif-file
 !  Source     = 'brcat01.gif'
 !  Image-size = (15,5)
 !End-Declare  

End-Setup   

!******** BEGIN PRINCIPAL *************

begin-report   
   Do Init-Report   
   Do Process-Main   
end-report  

!***************************************
Begin-procedure Init-Report
!***************************************
 Move 'GPBRAT01'    To $ReportID
 Move 'Comunicado de Acidente de Trabalho '   To $ReportTitle
 show $ReportID '  '  $ReportTitle
 Do Init-dateTime                
 Do Init-Number                    
 Do Stdapi-Init
 Do Get-Current-DateTime   
 Date-time () hh:mi:ss &timeBegan
 Let $DateBegan = Datenow()
 Display 'Report Began: ' $DateBegan noline
 Display &timeBegan
 
 Let #fonthel  = 2 
 Let #fontstd  = 4 
 
 Let #sizexsm2 = 3 
 Let #sizexsm  = 4 
 Let #sizesm   = 6
 Let #sizestd  = 7
 
 Let #sizehead = 6
 Let #sizetext = 8
 
 Let #sizegr   = 10    
 Do Stdapi-Term


let #pos  = instr($sqr-program,'brcat01',0)
   let #pos  = #pos - 1
   let $path = substr($sqr-program,1,#pos)
   let $FileDir = $path || 'brcat01.gif'
     
   #ifdef MVS
    let #pos  = instr($sqr-program,'brcat01',0)
    let #pos  = #pos - 1
    let $path = substr($sqr-program,1,#pos)
    let $FileDir = $path || 'brcat01)'
   #end-if
     
   #ifdef OS390
    let #pos  = instr($sqr-program,'brcat01',0)
    let #pos  = #pos - 1
    let $path = substr($sqr-program,1,#pos)
    let $FileDir = $path || 'brcat01)'
   #end-if
     
   #ifdef OS400
    let #pos  = instr($sqr-program,'gpbrrc01',0)
    let #pos  = #pos - 1
    let $path = substr($sqr-program,1,#pos)
    let $FileDir = $path || 'brcat01)'
   #end-if
     
   #ifdef UNIX
    let $FileDir = $path || 'brcat01.gif'
  #end-if

End-procedure Init-Report

!**************************************
Begin-procedure Process-Main
#debug show '***** Process-Main *****'
!**************************************
#debug show '$prcs_oprid       :' $prcs_oprid
#debug show '$prcs_run_cntl_id :' $prcs_run_cntl_id   
  
  Do Run-Control 
  let $SecurityClauseWithERN = ''
  let $_TableAlias = 'A'
  Do Security-Param
  #debug show '$SecurityClausewithERN: ' $SecurityClausewithERN  
  Do Coordinates  
  Do Employees-Info 
  
  
End-Procedure Process-Main

!**************************************
begin-procedure Run-Control
#debug show '*****Run-Control*****'
!**************************************

begin-select
RC.COMPANY
RC.CAT_VIANUMBER_BRA
RC.CAT_EMITED_BY_BRA
RC.CAT_LIST_OPT_BRA
RC.CAT_DATE_BRA  
RC.CAT_END_DATE_BRA
RC.CAT_EMIT_NAME_BRA
RC.CAT_LOC_DESCR_BRA
RC.CAT_EXCL_FLG_BRA
RC.DATE_FROM
 
 Let $Company                        = Rtrim(&RC.COMPANY, ' ')
 Let #Vianumber                      = &RC.CAT_VIANUMBER_BRA
 Let $Emitente                       = Rtrim(&RC.CAT_EMITED_BY_BRA, ' ') 
 Let $BeginDt                        = Rtrim(&RC.CAT_DATE_BRA, ' ') 
 Let $EndDt                          = Rtrim(&RC.CAT_END_DATE_BRA, ' ')
 Let $List_Option                    = Rtrim(&RC.CAT_LIST_OPT_BRA, ' ') 
 Let $Emited_Name                    = Rtrim(&RC.CAT_EMIT_NAME_BRA, ' ') 
 Let $Location                       = Rtrim(&RC.CAT_LOC_DESCR_BRA, ' ') 
 Let $Exclude                        = Rtrim(&RC.CAT_EXCL_FLG_BRA, ' ')
 Let $LocationDt                     = Rtrim(&RC.DATE_FROM, ' ')
 
 Do Convert-To-DTU-Date($LocationDt,$LocationDt)
 Do Format-DateTime($LocationDt,$LocationDt, {DEFDMY},'','')
 
 Let $Location = $Location || ' ' || $LocationDt
  
!  #debug show '$BeginDt:' $BeginDt
!  #debug show '#List_Option' $List_Option 
 
 Let $WhereRunC = 'WHERE RC.OPRID = ' || '''' || $prcs_oprid || '''' || ' AND RC.RUN_CNTL_ID = '
 Let $WhereRunC = $WhereRunC  || '''' || $prcs_run_cntl_id || '''' || ')'
 
 Let $InvertData = ''
 
 If $Exclude     = 'Y'
    Let $InvertData  = 'NOT'
 End-If
   
   
 Evaluate $List_Option
 when = '2'
   Let $TableOption = 'PS_RC_WR_EST_BRA'     
   Let $WhereOption = ' AND A.ESTABID ' 
   Let $WhereOption = $WhereOption || $InvertData
   Let $WhereOption = $WhereOption   ||' IN ' || ' (SELECT RC.ESTABID FROM PS_RC_WR_EST_BRA RC ' 
   Let $WhereOption = $WhereOption   || $WhereRunC  
   Do CheckEstab
   
  when = '3'
   Let $TableOption = 'PS_RC_WR_EMP_BRA'  
   Let $WhereOption = ' AND A.EMPLID ' 
   Let $WhereOption = $WhereOption   || $InvertData
   Let $WhereOption = $WhereOption   ||' IN ' || ' (SELECT RC.EMPLID FROM PS_RC_WR_EMP_BRA RC ' 
   Let $WhereOption = $WhereOption   || $WhereRunC  
   Do CheckEmpl
     
  when = '7'
   Let $TableOption = 'PS_RC_WR_DEP_BRA'  
   Let $WhereOption = ' AND A.DEPTID ' 
   Let $WhereOption = $WhereOption   || $InvertData
   Let $WhereOption = $WhereOption   ||' IN ' || ' (SELECT RC.DEPTID FROM PS_RC_WR_DEP_BRA RC ' 
   Let $WhereOption = $WhereOption   || $WhereRunC
   Do CheckDept

  when = '8' 
   Let $TableOption = 'PS_RC_WR_INC_BRA'  
   Let $WhereOption = ' AND A.EMPLID '   
   Let $WhereOption = $WhereOption ||' IN ' || ' (SELECT RCB.EMPLID FROM PS_INCIDENT_BRA RCB,PS_RC_WR_INC_BRA RC '  
   Let $WhereOption = $WhereOption ||'WHERE RCB.INCIDENT_NBR = RC.INCIDENT_NBR '  
   Let $WhereOption = $WhereOption || 'AND RC.OPRID = ' || '''' || $prcs_oprid || '''' || ' AND RC.RUN_CNTL_ID = '      
   Let $WhereOption = $WhereOption || '''' || $prcs_run_cntl_id || '''' || ')'
   Let $WhereOption = $WhereOption || ' AND INCDT.INCIDENT_NBR IN (SELECT RUNC.INCIDENT_NBR FROM PS_RC_WR_INC_BRA RUNC WHERE RUNC.OPRID ='|| '''' || $prcs_oprid || '''' 
   Let $WhereOption = $WhereOption || 'AND RUNC.RUN_CNTL_ID ='|| '''' || $prcs_run_cntl_id || '''' ||')'
   If $Exclude     = 'Y'
       Let $WhereOption = ' AND INCDT.INCIDENT_NBR NOT IN (SELECT RUNC.INCIDENT_NBR FROM PS_RC_WR_INC_BRA RUNC WHERE RUNC.OPRID ='|| '''' || $prcs_oprid || '''' 
       Let $WhereOption = $WhereOption || 'AND RUNC.RUN_CNTL_ID ='|| '''' || $prcs_run_cntl_id || '''' ||')'
   End-If
   Do CheckInci
   
  when-other
   Let $WhereOption = 'AND B.EMPLID=C.EMPLID'  

 End-Evaluate
  
FROM PS_RC_WR_REC_BRA RC
WHERE RC.OPRID = $prcs_oprid
AND   RC.RUN_CNTL_ID = $prcs_run_cntl_id
end-select

#debug show '$WhereOption:' $WhereOption
End-procedure  Run-Control

!**************************************
Begin-procedure CheckEstab
Begin-Select
rcE.ESTABID
  
  Let $Empty = Rtrim(&rcE.ESTABID, ' ')

FROM PS_RC_WR_EST_BRA rcE
WHERE rcE.OPRID = $prcs_oprid
AND   rcE.RUN_CNTL_ID = $prcs_run_cntl_id 
End-Select
If $Empty = ''
  Let $WhereOption = ''
End-If

End-procedure CheckEstab

!**************************************
Begin-procedure CheckEmpl
Begin-Select
rcEMP.EMPLID

    Let $Empty = Rtrim(&rcEMP.EMPLID, ' ')

FROM PS_RC_WR_EMP_BRA rcEMP
WHERE rcEMP.OPRID = $prcs_oprid
AND   rcEMP.RUN_CNTL_ID = $prcs_run_cntl_id 
End-Select
If $Empty = ''
  Let $WhereOption = ''
End-If
End-Procedure CheckEmpl

!**************************************
Begin-procedure CheckDept
Begin-Select
rcD.DEPTID
    Let $Empty = Rtrim(&rcD.DEPTID, ' ')

FROM PS_RC_WR_DEP_BRA rcD
WHERE rcD.OPRID = $prcs_oprid
AND   rcD.RUN_CNTL_ID = $prcs_run_cntl_id 
End-Select
If $Empty = ''
  Let $WhereOption = ''
End-If
End-procedure CheckDept

!**************************************
Begin-procedure CheckInci
Begin-Select
RCI.INCIDENT_NBR
    Let $Empty = Rtrim(&RCI.INCIDENT_NBR, ' ')

FROM PS_RC_WR_INC_BRA RCI
WHERE RCI.OPRID = $prcs_oprid
AND   RCI.RUN_CNTL_ID = $prcs_run_cntl_id 
End-Select
If $Empty = ''
  Let $WhereOption = ''
End-If
End-procedure CheckInci


!**************************************
Begin-procedure Employees-Info
If $BeginDt = ''
  Do Convert-From-DTU-Date ('1900-01-01',$BeginDt)  
End-If

If $EndDt = ''
  Do Convert-From-DTU-Date ('2099-12-31',$EndDt)
End-if

#debug show '****Employees-Info****'
#debug show '$BeginDt:' $BeginDt
#debug show '$EndDt  :' $EndDt
#debug show '$Company:' $Company
!**************************************

Begin-select
A.EMPLID
A.LOCATION
A.ESTABID              
A.EMPL_STATUS           &A.EMPL_STATUS
A.EFFDT
A.ACTION
A.ACTION_REASON
A.EMPL_RCD              
A.GP_PAYGROUP
A.MONTHLY_RT           
A.JOBCODE
A.SETID_JOBCODE
B.NAME
C.BIRTHDATE
V.SEFIP_CATEGORY_BRA
V.CBO_CD_BRA
X.TERMINATION_DT
X.LAST_DATE_WORKED
INCDT.INCIDENT_DT
INCDT.INCIDENT_NBR
!INCDTBRA.CAT_DATE_BRA
INCDTBRA.CAT_ID_BRA
INCDT.DESCRLONG
INJURY.COMMENTS
  
  Let $Emplid             = Rtrim(&A.EMPLID, ' ') 
  Let $Estabid            = Rtrim(&A.ESTABID, ' ')
  Let $Effdt              = Rtrim(&A.EFFDT, ' ')
  Let $Dt_Af              = Rtrim(&X.TERMINATION_DT, ' ')
  If $Dt_Af=''
      Let $Dt_Af          = Rtrim(&X.LAST_DATE_WORKED, ' ')
  End-If   
  Let $Action             = Rtrim(&A.ACTION, ' ')
  Let $Causa_Af           = Rtrim(&A.ACTION_REASON, ' ')
  Let #EmplRcd            = &A.EMPL_RCD   
  Let $GPPayGroup         = Rtrim(&A.GP_PAYGROUP, ' ')
! Let #Salary             = &A.MONTHLY_RT   
  Let $JJobCode           = Rtrim(&A.JOBCODE,' ')
  Let $JJCSetid           = Rtrim(&A.SETID_JOBCODE, ' ')
  Let $Name               = Rtrim(&B.NAME, ' ')  
  Let $Dt_Birth           = Rtrim(&C.BIRTHDATE, ' ')
  Let $Category           = Rtrim(&V.SEFIP_CATEGORY_BRA, ' ') 
  Let $CBO                = Rtrim(&V.CBO_CD_BRA, ' ') 
! Let $Last_Day           = Rtrim(&X.LAST_DATE_WORKED, ' ')
  Let $IncDate            = Rtrim(&INCDT.INCIDENT_DT, ' ')
  Let #CATidx             = &INCDTBRA.CAT_ID_BRA
  Let $Inc_Nbr            = Rtrim(&INCDT.INCIDENT_NBR, ' ')
  Let $DescrLng           = Rtrim(&INCDT.DESCRLONG, ' ')
  Let $Comments           = Rtrim(&INJURY.COMMENTS, ' ')
    
    
   Do Incident-Information  
   Do Name-Employeer
   Do Employeer-Info  
   Do Estab-ID
!   Do Serv-Taker
   Do Select-Estab-Phone 
   Do Select-Sex
   Do Select-PIS
   Do Select-Employee-Address
   Do Select-CTPS
   Do Select-RG
   Do Select-INNS-Type
   Do Select-Carteira  
   Do Mother-Name
   Do Select-PhoneEmp
   !Do Select-CBO-JobCode
   Do Select-JobCode-Descr
   Do JobCode-Lang   
   Let #Copies = 1
   While #Copies <= #Vianumber
     Do Format 
     Let #Copies = #Copies + 1
   End-While
   
  
FROM PS_JOB A
,PS_NAMES B
,PS_PERSON C
,PS_JOB_JR V
,PS_EMPLOYMENT X
,PS_INJURY_ILL_VW INJURY
,PS_INCIDENT_DATA INCDT
,PS_INCIDENT_BRA INCDTBRA

WHERE A.COMPANY=$Company
AND A.EMPLID                =  INJURY.EMPLID
AND A.EMPLID                =  INCDTBRA.EMPLID
AND A.EMPL_RCD              =  INCDTBRA.EMPL_RCD
AND A.EMPL_RCD              =  INJURY.EMPL_RCD
AND INCDTBRA.CAT_DATE_BRA   >= $BeginDt 
AND INCDTBRA.CAT_DATE_BRA   <= $EndDt
AND INCDTBRA.INCIDENT_NBR   =  INCDT.INCIDENT_NBR
AND INJURY.INCIDENT_NBR     =  INCDT.INCIDENT_NBR
AND A.EFFDT              = (
                             SELECT MAX(AA.EFFDT) 
                             FROM PS_JOB AA
                             WHERE AA.EMPLID   = A.EMPLID
                             AND   AA.EMPL_RCD = A.EMPL_RCD
                             AND   AA.EFFDT   <= INCDT.INCIDENT_DT
                           )
AND A.EFFSEQ             = (
                             SELECT MAX(A_ES.EFFSEQ)
                             FROM PS_JOB A_ES 
                             WHERE A.EMPLID = A_ES.EMPLID 
                             AND A.EMPL_RCD = A_ES.EMPL_RCD
                             AND A.EFFDT = A_ES.EFFDT
                           )
[$WhereOption]
AND A.EMPLID             = B.EMPLID
AND B.NAME_TYPE          = 'PRI'
AND B.EFFDT              = (
                             SELECT MAX(BB.EFFDT) FROM PS_NAMES BB
                             WHERE BB.EMPLID = B.EMPLID
                             AND BB.NAME_TYPE = B.NAME_TYPE
                             AND BB.EFFDT <= INCDT.INCIDENT_DT
                           )
AND A.EMPLID             = C.EMPLID
AND A.EMPLID             = V.EMPLID
AND V.EFFDT              = (
                             SELECT MAX(VV.EFFDT) 
                             FROM PS_JOB VV
                             WHERE VV.EMPLID   = V.EMPLID
                             AND VV.EMPL_RCD = V.EMPL_RCD
                             AND VV.EFFDT   <= INCDT.INCIDENT_DT
                           )  
AND A.EMPL_RCD           = V.EMPL_RCD
AND A.EFFSEQ             = V.EFFSEQ
AND A.EMPLID             = X.EMPLID
AND A.EMPL_RCD           = X.EMPL_RCD
[$SecurityClauseWithERN]
end-select
End-procedure Employees-Info

!**************************************
Begin-procedure Incident-Information 
#debug show '***Incident-Information***'
!**************************************

Begin-select
HS.INCIDENT_NBR
CAT.CAT_TYPE_BRA
HS.CAT_INC_TYPE_BRA
HS.CAT_POLICE_REG_BRA
HS.CAT_SPEC_LOC_BRA
HS.CAT_LOCTYPE_BRA
HS.ESTABID
HS.NID_SPECIAL_CHAR  
CAT.CAT_ID_BRA
CAT.CAT_MONTH_SAL_BRA 
CAT.CAT_DEATH_BRA 
CAT.CAT_DEATH_DATE_BRA
CAT.CAT_DEATH_CERT_BRA
CAT.CAT_SAL_TYPE_BRA
CAT.COMP_RATECD
CAT.CAT_DIAGNOS_BRA
  
  Let $Inc_Nbr  = Rtrim(&HS.INCIDENT_NBR, ' ')
  Let $Cat_Type = Rtrim(&CAT.CAT_TYPE_BRA, ' ')
  Let $Inc_Type = Rtrim(&HS.CAT_INC_TYPE_BRA, ' ')
  Let $Pol_Reg  = Rtrim(&HS.CAT_POLICE_REG_BRA, ' ')
    If $Pol_Reg='Y'
       Let $Pol_Reg ='1'
    Else
       Let $Pol_Reg ='2'
    End-If
  Let $Spec_Loc   = Rtrim(&HS.CAT_SPEC_LOC_BRA, ' ')
  Let $Local_Ac   = Rtrim(&HS.CAT_LOCTYPE_BRA, ' ')
  Let $CNPJ_Ac    = Rtrim(&HS.NID_SPECIAL_CHAR, ' ')
  Let $Death      = Rtrim(&CAT.CAT_DEATH_BRA, ' ') 
    If $Death='Y'
       Let $Death ='1'
    Else
       Let $Death ='2'
    End-If
 

 
  Let $Sal_type   = Rtrim(&CAT.CAT_SAL_TYPE_BRA, ' ')
  Let #Salary     = &CAT.CAT_MONTH_SAL_BRA   
      
  
  Let $Ratecd = Rtrim(&CAT.COMP_RATECD , ' ')
  Let $Observations = Rtrim(&CAT.CAT_DIAGNOS_BRA, ' ')
  Let $AccEstabID = Rtrim(&HS.ESTABID, ' ')
    
    #debug show '$Inc_Nbr   :'   $Inc_Nbr
    #debug show '$Cat_Type  :'  $Cat_Type
    #debug show '$Inc_Type  :'  $Inc_Type
    #debug show '$Pol_Reg   :'   $Pol_Reg
    #debug show '$Spec_Loc  :'  $Spec_Loc  
    #debug show '$Local_Ac  :'  $Local_Ac
    #debug show '$Area      :'      $Area
    #debug show '#Work_Hrs  :'  #Work_Hrs
    #debug show '$Death     :'     $Death
    #debug show 'Area       :'      $Area
    #debug show '$Sal_type  :'  $Sal_type
    #debug show '$Ratecd    :'    $Ratecd
    
    
  Do Select-Incident-Inf
  If $Local_Ac = '1'
     Do AccEstab
  End-if
  Do Select-Testemunhas
  Do Select-Afastamento
  !Do Select-Lesion
  Do Select-Body-Part
  Do Select-Cause-Ac
  Do Select-Unidad-Atendimiento
  Do Select-Atendimiento-Dt
  Do Select-Lesion
   

FROM PS_HS_INCIDENT_BRA HS
,PS_INCIDENT_BRA CAT
WHERE 
CAT.EMPLID=$Emplid 
AND CAT.INCIDENT_NBR = HS.INCIDENT_NBR
AND CAT.INCIDENT_NBR = $Inc_Nbr
AND CAT.CAT_ID_BRA = #CATidx 
end-select

!******* Obtain Salary ***************************
  Evaluate $Sal_type
    When = '1' !Global Payroll
      !Use Job Page Monthly Rate
Begin-Select
GPMR.MONTHLY_RT 
      
         Let #MonthlyRt = &GPMR.MONTHLY_RT
FROM PS_JOB GPMR
WHERE GPMR.EMPLID = $Emplid
AND GPMR.EFFDT = (SELECT MAX(GPMR2.EFFDT) 
FROM PS_JOB GPMR2 
WHERE GPMR2.EMPLID = GPMR.EMPLID 
AND GPMR2.EMPL_RCD = GPMR.EMPL_RCD 
AND GPMR2.EFFDT <= $IncDate)
End-Select
        #debug show '#MonthlyRt:'#MonthlyRt
        Let #Salary = #MonthlyRt
      
      
      
      break
    When = '2' 
!Job Monthly Pay Rate*******************
Begin-Select
MR.MONTHLY_RT 

   Let #MonthlyRt = &MR.MONTHLY_RT

FROM PS_JOB MR
WHERE MR.EMPLID = $Emplid
AND MR.EFFDT=(SELECT MAX(MR2.EFFDT) 
                 FROM PS_JOB MR2
                 WHERE MR2.EMPLID   = MR.EMPLID
                 AND   MR2.EMPL_RCD = MR.EMPL_RCD
                 AND   MR2.EFFDT   <= $IncDate)
End-Select
        #debug show '#MonthlyRt:'#MonthlyRt
        Let #Salary = #MonthlyRt

      break
    When = '3' 
!Job Rate Code***************************
Begin-Select
CR.COMPRATE

   LET #Rate_CD = &CR.COMPRATE
      
FROM PS_COMPENSATION CR
WHERE CR.EMPLID = $Emplid
AND CR.COMP_RATECD = $Ratecd
AND CR.EFFDT = ( SELECT MAX(CR2.EFFDT)
                 FROM PS_COMPENSATION CR2
                 WHERE CR2.EMPLID = CR.EMPLID
                 AND CR2.EMPL_RCD = CR.EMPL_RCD
                 AND CR2.EFFDT <= $IncDate)
End-Select
      #debug show '#Rate_CD:'#Rate_CD
      Let #Salary = #Rate_CD
      break
    When = '4' !Other
    !Do Nothig... Already have the correct amount in #Salary
      break
  End-Evaluate
  #debug show '#Salary:' #Salary
End-procedure Incident-Information 



!**************************************
Begin-procedure AccEstab 
#debug show '***AccEstab***'
!**************************************


Begin-Select
ACC.CITY
ACC.STATE
  Let $MunicipalityInc = Rtrim(&ACC.CITY, ' ')
  Let $UF_inc          = Rtrim(&ACC.STATE, ' ')
  
FROM PS_ESTAB_TBL ACC
WHERE ACC.ESTABID = $AccEstabID
AND ACC.EFFDT = (SELECT MAX(ACC2.EFFDT)
                  FROM PS_ESTAB_TBL ACC2
                  WHERE ACC2.ESTABID = ACC.ESTABID
                  AND ACC2.EFFDT <= $IncDate)
End-Select

Begin-Select
ACE.ESTAB_ID_BRA

   Let $CNPJ_Ac = Rtrim(&ACE.ESTAB_ID_BRA, ' ')
FROM PS_ESTAB_ID_BRA ACE
WHERE ACE.ESTABID = $AccEstabID
AND ACE.ESTAB_ID_TYPE_BRA = 'CNPJ'
AND ACE.EFFDT = (SELECT MAX(ACE2.EFFDT)
                 FROM PS_ESTAB_ID_BRA ACE2
                 WHERE ACE2.ESTABID = ACE.ESTABID
                 AND ACE2.ESTAB_ID_TYPE_BRA = ACE.ESTAB_ID_TYPE_BRA
                 AND ACE2.EFFDT <= $IncDate)
End-Select
End-Procedure AccEstab

!**************************************
Begin-procedure Name-Employeer 
#debug show '***Name-Employeer***'
!**************************************

Begin-select
D.DESCR  
  Let $Name_Emp              = Rtrim(&D.DESCR, ' ')
!  #debug show '$Name_Employeer:' $Name_Emp

FROM PS_COMPANY_TBL D
WHERE D.COMPANY=$Company
AND  D.EFFDT = (SELECT MAX(DD.EFFDT)          
                FROM PS_COMPANY_TBL DD                 
                WHERE DD.COMPANY   = D.COMPANY   
                AND   DD.EFFDT    <= $IncDate) 

end-select
End-procedure Name-Employeer
!**************************************
Begin-procedure Employeer-Info
!#debug show '****Employeer Info****'
!**************************************

Begin-select
E.ESTAB_ID_BRA
  Let $CNAE = Rtrim(&E.ESTAB_ID_BRA, ' ')
  Let $CNAEF1 = substr($CNAE   ,1,4)
  Let $CNAEF2 = substr($CNAE   ,5,1)
  Let $CNAEF = $CNAEF1 ||'-' || $CNAEF2
  
F.ADDRESS1
  Let $AddresEr = Rtrim(&F.ADDRESS1, ' ')
F.NUM1
  Let $NumEr = Rtrim(&F.NUM1, ' ')
  
F.ADDRESS2
F.ADDRESS3
   Let $AddresEr =  $AddresEr ||' ' || $NumEr || ' ' || Rtrim(&F.ADDRESS2, ' ')|| ' ' || Rtrim(&F.ADDRESS3, ' ')
F.ADDRESS4
   Let $BairroEr = Rtrim(&F.ADDRESS4, ' ')
F.CITY
   Let $MunicipalityEr = Rtrim(&F.CITY, ' ')
F.STATE
   Let $UFE = Rtrim(&F.STATE, ' ')
F.POSTAL
   Let $CEPE = Rtrim(&F.POSTAL, ' ')
   Do Check-Strings     
   
FROM PS_ESTAB_ID_BRA E
,PS_ESTAB_TBL F
WHERE E.COUNTRY='BRA' 
AND E.ESTABID=$Estabid 
AND E.ESTAB_ID_TYPE_BRA = 'CNAE'
AND E.EFFDT = (SELECT MAX(EE.EFFDT)          
                FROM PS_ESTAB_ID_BRA EE                 
                WHERE EE.ESTABID     = E.ESTABID   
                AND   EE.EFFDT    <= $IncDate)  
AND E.ESTABID = F.ESTABID
AND F.EFFDT = (SELECT MAX(FF.EFFDT)          
                FROM PS_ESTAB_TBL FF                 
                WHERE FF.ESTABID  = F.ESTABID   
                AND   FF.EFFDT    <= $IncDate)

end-select    
End-procedure Employeer-Info
!**************************************
Begin-procedure Estab-ID
#debug show '****Estab-ID****'
!**************************************

Let $CNPJ = ''
Let $CEI = ''
Begin-select
G.ESTAB_ID_TYPE_BRA
        Let $EstabIdType = Rtrim(&G.ESTAB_ID_TYPE_BRA, ' ')
G.ESTAB_ID_BRA 
        Let $CNPJ_CEI = Rtrim(&G.ESTAB_ID_BRA, ' ')
  
  Evaluate $EstabIdType    
    when = 'CNPJ'
         Let $CNPJ = Rtrim(&G.ESTAB_ID_BRA, ' ')
 when = 'CEI'
      Let $CEI  = Rtrim(&G.ESTAB_ID_BRA, ' ')
  End-Evaluate  

FROM PS_ESTAB_ID_BRA G
,PS_ESTAB_TBL_BRA H
WHERE G.ESTABID=$Estabid
AND G.EFFDT=(SELECT MAX(GG.EFFDT) 
                 FROM PS_ESTAB_ID_BRA GG 
                 WHERE GG.ESTABID   = G.ESTABID                
                 AND   GG.EFFDT   <= $IncDate)   
AND G.ESTAB_ID_TYPE_BRA IN ('CNPJ','CEI')
AND G.ESTABID=H.ESTABID
AND G.EFFDT=H.EFFDT
AND G.COUNTY_CD_BRA=H.COUNTY_CD_BRA

end-select
End-procedure Estab-ID


!**************************************                    
begin-procedure Select-Estab-Phone                         
#debug show '** Select-Estab-Phone **'   
#debug show '$Estabid :' $Estabid 
!**************************************  
Let $Phone = ''                                            
Let $Ext   = '00000'                                       
                                                           
Begin-Select                                               
P.PHONE_TYPE                                               
P.PHONE                                                    
P.COUNTRY_CODE                                             
                                                           
    Let $PhoneE = Rtrim(&P.COUNTRY_CODE, ' ') || ' ' || Rtrim(&P.PHONE, ' ')
                                                         
FROM  PS_ESTAB_PHONE P                                     
WHERE P.ESTABID = $Estabid
AND   P.EFFDT = (SELECT MAX(PP.EFFDT)                      
                 FROM PS_ESTAB_PHONE PP                    
                 WHERE PP.ESTABID = P.ESTABID
                 AND PP.EFFDT     <= $IncDate)
 AND P.PHONE_TYPE IN ('MAIN','BUSN')
End-Select                                                 
End-Procedure Select-Estab-Phone                                                                                  


!**************************************                    
begin-procedure Select-Sex                         
#debug show '** Select-Sex **'                           
!**************************************  
Let $Sex = ''              
                                                           
Begin-Select                                               
Z.SEX         &Z.SEX    
Z.MAR_STATUS  &Z.MAR_STATUS
      Let $Sex = Rtrim(&Z.SEX, ' ')                 
      Let $MarStatus = Rtrim(&Z.MAR_STATUS, ' ')
      
      Evaluate $Sex
       when = 'M'
         Let $Sex = '1'             
       when = 'F'
         Let $Sex = '2'    
      End-Evaluate
      
      Evaluate $MarStatus
       when = 'S'
         Let $MarStD = 'Solteiro'  
         Let $MarStatus = '1'
       when = 'M'
         Let $MarStD = 'Casado'   
         Let $MarStatus = '2'
       when = 'W'
         Let $MarStD = 'Vi?vo' 
         Let $MarStatus = '3'
       when = 'E'
         Let $MarStD = 'Separado'
         Let $MarStatus = '4'
       when = ' '
         Let $MarStD = 'Ignorado'   
         Let $MarStatus = '6'   
       when-other 
         Let $MarStD = 'Outro'   
         Let $MarStatus = '5'
         
      End-Evaluate
                                                           
FROM  PS_PERS_DATA_EFFDT Z                                    
WHERE Z.EMPLID = $Emplid                                 
AND Z.EFFDT  = (SELECT MAX(ZZ.EFFDT) 
                  FROM PS_PERS_DATA_EFFDT ZZ 
                 WHERE ZZ.EMPLID = Z.EMPLID
                 AND ZZ.EFFDT <= $IncDate)    
End-Select                                                 
End-Procedure Select-Sex  

!**************************************
Begin-procedure Select-PIS
#debug show '****Select-PIS****'
!**************************************
Let $PIS = ''
Let $PASEP = ''
Begin-select
L.NATIONAL_ID_TYPE
L.NATIONAL_ID
  Let $NationalIdType = Rtrim(&L.NATIONAL_ID_TYPE, ' ')

  Evaluate $NationalIdType  
  when = 'PIS'
       Let $PIS = Rtrim(&L.NATIONAL_ID, ' ')
 
  when = 'PASEP'
       Let $PIS = Rtrim(&L.NATIONAL_ID, ' ') 
    
  End-Evaluate 
  
FROM PS_PERS_NID L 
WHERE L.EMPLID= $Emplid
AND (L.NATIONAL_ID_TYPE = 'PIS' OR  L.NATIONAL_ID_TYPE = 'PASEP')

end-select
End-procedure Select-PIS

!**************************************
Begin-procedure Select-Employee-Address
#debug show '*****Select-Employee-Address****'
!**************************************
Let $Endereco =''
Let $CEP=''
Let $UF=''
Let $Municipality=''

Begin-select
P.ADDRESS1             
  Let $Endereco  =  Rtrim(&P.ADDRESS1, ' ')
P.ADDRESS2
P.ADDRESS3
  Let $Endereco2 = Rtrim(&P.ADDRESS2, ' ') || ' ' || Rtrim(&P.ADDRESS3, ' ')
P.NUM1
  Let $Num1   =  Rtrim(&P.NUM1, ' ')
P.ADDRESS4
  Let $Bairro =  Rtrim(&P.ADDRESS4, ' ')
P.CITY
  Let $Municipality =  Rtrim(&P.CITY, ' ')
P.STATE
  Let $UF     =  Rtrim(&P.STATE, ' ')
P.POSTAL   
  Let $CEP    =  Rtrim(&P.POSTAL, ' ')
 
  Let $Endereco = $Endereco || ' ' || $Num1 || ' ' || $Endereco2 
  
  
!#debug show '$Endereco:' $Endereco
!#debug show '$Bairro:' $Bairro
!#debug show '$Municipality:' $Municipality
!#debug show '$UF:' $UF
!#debug show '$CEP:' $CEP  
   
FROM PS_ADDRESSES P
WHERE P.EMPLID=$Emplid
AND P.EFFDT  = (SELECT MAX(PP.EFFDT) 
                  FROM PS_ADDRESSES PP 
                 WHERE PP.EMPLID = P.EMPLID
                 AND PP.EFFDT <= $IncDate)
AND P.ADDRESS_TYPE = 'HOME'  

end-select
End-procedure Select-Employee-Address

!*************************************
Begin-procedure Select-CTPS
#debug show '****Select-CTPS****'
!*************************************
Let $CTPS  = ''

Begin-select
R1.NATIONAL_ID 
  Let $CTPS  =    Rtrim(&R1.NATIONAL_ID, ' ')
!  #debug show '$NatID:' $NatID 
FROM PS_PERS_NID R1
WHERE R1.EMPLID=$Emplid
AND NATIONAL_ID_TYPE='CTPS'

end-select
End-procedure Select-CTPS

!*************************************
Begin-Procedure Select-RG
#debug show '****Select-RG****'
!*************************************
Let $RG_Id = ''
Begin-Select
RG.NATIONAL_ID

   Let $RG_Id = Rtrim(&RG.NATIONAL_ID, ' ')

FROM PS_PERS_NID RG
WHERE EMPLID = $Emplid
AND NATIONAL_ID_TYPE = 'RG'
End-Select

Begin-Select
RG2.RG_ISSUED_DT_BRA
RG2.RG_ISSUEDBY_BRA
RG2.RG_STATE_BRA

  Let $RG_dt    = Rtrim(&RG2.RG_ISSUED_DT_BRA,' ')
  Let $RG_by    = Rtrim(&RG2.RG_ISSUEDBY_BRA, ' ')
  Let $RG_State = Rtrim(&RG2.RG_STATE_BRA,' ')

FROM PS_PERSON_BRA RG2
WHERE EMPLID = $Emplid
End-Select

End-Procedure Select-RG

!*************************************
Begin-procedure Select-Carteira
#debug show '****Select-Carteira****'
!*************************************
Let $Serie= ''
Let $Emision= ''
Let $UF_Tra= ''
Begin-select
R.CTPS_EXP_DT_BRA
  Let $Emision  =  Rtrim(&R.CTPS_EXP_DT_BRA, ' ')
R.CTPS_SERIES_BRA
  Let $Serie  =    Rtrim(&R.CTPS_SERIES_BRA, ' ')
R.CTPS_STATE_BRA
  Let $UF_Tra  =   Rtrim(&R.CTPS_STATE_BRA, ' ')  

FROM PS_PERSON_BRA R
WHERE R.EMPLID=$Emplid
end-select
End-procedure Select-Carteira

!*************************************
Begin-procedure Mother-Name
#debug show '****Mother-NAme****'
!**************************************
Let $Mother_Name   = ''
Begin-Select                                         
R.FIRST_NAME
R.MIDDLE_NAME
R.LAST_NAME

  Let $Mother_Name   =   Rtrim(&R.FIRST_NAME, ' ') ||' '|| Rtrim(&R.MIDDLE_NAME, ' ') ||' '|| Rtrim(&R.LAST_NAME, ' ')
FROM PS_NAMES R  
WHERE R.EMPLID = $Emplid AND              
R.NAME_TYPE = 'MTR'                              
AND R.COUNTRY_NM_FORMAT = 'BRA'                      
AND R.EFFDT IN (SELECT MAX(EFFDT) FROM  PS_NAMES RR  
                 WHERE RR.EMPLID    = R.EMPLID       
                   AND RR.NAME_TYPE = R.NAME_TYPE
           AND RR.EFFDT <= $IncDate)          

end-select
End-procedure Mother-Name

!**************************************
begin-procedure Select-PhoneEmp
#debug show '** Select-TelefoneEmp **'
!**************************************
Let $PHONE='' 
Begin-Select     
PE.PHONE
  Let $PHONE       = Rtrim(&PE.PHONE, ' ') 
FROM PS_PERSONAL_PHONE PE
WHERE PE.EMPLID    = $Emplid
AND PE.PHONE_TYPE  = 'HOME'
End-Select

End-Procedure Select-PhoneEmp


!**************************************
Begin-Procedure Select-CBO-JobCode
#debug show  '** Select-CBO-JobCode ***'
!**************************************
Let $JobCode       = ''
Let $JJobCode      = ''
Let $JobCode_Descr = ''
BEGIN-SELECT DISTINCT
A.CBO_CD_BRA
B.JOBCODE
B.DESCR

  Let $JJobCode = Rtrim(&B.JOBCODE,' ')

FROM PS_JOBCODE_TBL_BRA A 
, PS_JOBCODE_TBL B
WHERE A.JOBCODE  = B.JOBCODE
AND A.CBO_CD_BRA = $CBO
AND A.EFFDT      = (
                     SELECT MAX(AA.EFFDT)
                     FROM PS_JOBCODE_TBL_BRA AA
                     WHERE AA.SETID = A.SETID 
                     AND AA.JOBCODE = A.JOBCODE
                     AND AA.EFFDT  <= $IncDate
                   )
END-SELECT

#debug show '$IncDate:'$IncDate '  $CBO:'$CBO '--> $JJobCode :' $JJobCode
End-Procedure Select-CBO-JobCode

!**************************************
begin-procedure Select-JobCode-Descr
#debug show '** Select-Jobcode-Descr **'
!**************************************
Let $JobJobCode = ''
Let $Function   = ''
Let $FunCd      = ''

Begin-Select     
A.DESCR 
A.JOB_FUNCTION

  Let $JobCode  = Rtrim(&A.DESCR,' ')
  Let $FunCd    = Rtrim(&A.JOB_FUNCTION,' ')
  
  #debug show '$JobCode:' $JobJobCode
  #debug show '$FunCd:  ' $FunCd
FROM PS_JOBCODE_TBL A
WHERE A.SETID  = $JJCSetid
AND   A.JOBCODE = $JJobCode
AND   A.EFFDT = (SELECT MAX(AA.EFFDT) FROM PS_JOBCODE_TBL AA
                 WHERE A.SETID = AA.SETID
                 AND   A.JOBCODE = AA.JOBCODE)       
End-Select

If $FunCd <> ''
Begin-Select     
BB.DESCR
  
  Let $Function = Rtrim(&BB.DESCR,' ')
  #debug show '$Function:' $Function
  
FROM PS_JOBFUNCTION_TBL BB
WHERE BB.JOB_FUNCTION = $FunCd            
End-Select
else
Let $Function = ''
End-if                  
#debug show '$JobCode_Descr:' $JobCode_Descr
End-Procedure Select-Jobcode-Descr


!**************************************
begin-procedure JobCode-Lang
#debug show '** JobCode-Lang **'
!**************************************
#debug show '$JJCSetid         :'$JJCSetid ':'
#debug show '$JJobCode          :'$JJobCode ':'
#debug show '$Curr_language_Cd :'$Curr_language_Cd ':'

Let $JobCode_Descr=''
Begin-select
JC.DESCR
    MOVE &JC.DESCR TO $JobCode_Descr
    #debug show '$JobCode:' $JobCode_Descr
from PS_JOBCODE_LANG JC
where JC.SETID = $JJCSetid
AND   JC.JOBCODE = $JJobCode
AND   JC.LANGUAGE_CD = $Curr_language_Cd
and   JC.EFFDT =  (SELECT MAX(JC2.EFFDT) FROM PS_JOBCODE_LANG JC2
       WHERE JC2.SETID = JC.SETID
       and   JC2.JOBCODE = JC.JOBCODE
       AND   JC2.LANGUAGE_CD = JC.LANGUAGE_CD
       and   JC2.EFFDT <= $IncDate)
end-select

If $JobCode_Descr=''
    MOVE $JobCode TO $JobCode_Descr     
End-If   
#debug show '$JobCode_Descr:' $JobCode_Descr
End-Procedure JobCode-Lang

!**************************************
begin-procedure Select-INNS-Type
#debug show '** Select-INNS-Type **'
!**************************************
Let $INSS_type = ''
Let $Area = ''
Let #WrkHrs = 0
Begin-Select
INJBRA.CAT_TYPE_INSS_BRA
INJBRA.CAT_WORKED_HR_BRA
INJBRA.CID_CODE_BRA
INJBRA.CAT_PENSIONER_BRA
INJBRA.CAT_RENDERTYPE_BRA

  Let $INSS_type = Rtrim(&INJBRA.CAT_TYPE_INSS_BRA,' ')
  Let #WrkHrs    = &INJBRA.CAT_WORKED_HR_BRA
  Let $CID-Code  = Rtrim(&INJBRA.CID_CODE_BRA,' ')
  Let $Pensioner = Rtrim(&INJBRA.CAT_PENSIONER_BRA,' ')
  Let $Area      = Rtrim(&INJBRA.CAT_RENDERTYPE_BRA,' ')
  If $Pensioner = 'Y'
           Let $Aposentado ='1'
        Else
           Let $Aposentado ='2'
      End-If
  
FROM PS_INJURY_ILL_BRA INJBRA
WHERE INJBRA.EMPLID = $Emplid
AND INJBRA.EMPL_RCD = #EmplRcd
AND INJBRA.INCIDENT_NBR = $Inc_Nbr
End-Select
End-Procedure Select-INNS-Type

!**************************************
begin-procedure Select-Incident-Inf
#debug show '** Select-Incident-Inf **'
!**************************************
Let $Inc_Dt=''
Let $Inc_Time=''
Let $Inc_Tm=''
Let $UF_Inc=''
Let $MunicipalityInc=''

Begin-Select 
ID.INCIDENT_DT 
  Let $Inc_Dt   = Rtrim(&ID.INCIDENT_DT, ' ')
ID.INCIDENT_TIME 
 
  Let $Inc_Time = Rtrim(&ID.INCIDENT_TIME, ' ')
  Find ':' in $Inc_Time 0 #Loc
  Let #Loc = #Loc - 2
  Let $Inc_Tm = substr($Inc_Time,#Loc,6)
ID.STATE  
ID.CITY 
  Let $UF_Inc   = Rtrim(&ID.STATE, ' ')
  Let $MunicipalityInc = Rtrim(&ID.CITY, ' ')
  
FROM PS_INCIDENT_DATA ID
WHERE ID.INCIDENT_NBR= $Inc_Nbr
End-Select
#debug show '******************************** $Inc_Nbr:'$Inc_Nbr
#debug show '******************************** $Inc_Dt:'$Inc_Dt

End-Procedure Select-Incident-Inf


!**************************************
Begin-procedure Select-Testemunhas
#debug show '*****Select-Testemunhas****'
!**************************************

Let $TestEmplid     = ''
Let $TestNEmplid    = ''

Let $EnderecoT      = ''
Let $Num1T          = ''
Let $BairroT        = ''
Let $MunicipalityT  = ''
Let $UF_T           = ''
Let $CEP_T          = ''
Let $Endereco_T     = ''
Let $Name_T         = ''

Let $2EnderecoT     = ''
Let $2Num1T         = ''
Let $2BairroT       = ''
Let $2MunicipalityT = ''
Let $2UF_T          = ''
Let $2CEP_T         = ''
Let $2Endereco_T    = ''
Let $2Name_T        = ''

Let #pass           = 1

Begin-select
IP.EMPLID
IP.NON_EMPLOYEE_ID
IP.ADDRESS1
IP.ADDRESS2
IP.ADDRESS3
IP.NUM1
IP.ADDRESS4
IP.CITY
IP.STATE
IP.POSTAL


  Let $TestEmplid    = Rtrim(&IP.EMPLID, ' ')
  Let $TestNEmplid   = Rtrim(&IP.NON_EMPLOYEE_ID, ' ')

  If #pass = 1 
    #debug show '************pass 1***'
    Let $EnderecoT     =  Rtrim(&IP.ADDRESS1, ' ')
    Let $Endereco2T    =  Rtrim(&IP.ADDRESS2, ' ') || ' ' || Rtrim(&IP.ADDRESS3, ' ')
    Let $Num1T         =  Rtrim(&IP.NUM1, ' ')
    Let $BairroT       =  Rtrim(&IP.ADDRESS4, ' ')
    Let $MunicipalityT =  Rtrim(&IP.CITY, ' ')
    Let $UF_T          =  Rtrim(&IP.STATE, ' ')
    Let $CEP_T         =  Rtrim(&IP.POSTAL, ' ')
    Let $Endereco_T    =  $EnderecoT ||' '|| $Num1T  ||' '|| $Endereco2T
    
    Do GetNameTeste
    Let $Name_T        =  $TesteName
    
    DO GetPhoneTest
    Let $TPhone = $XPHONE
    
    IF $EnderecoT = ''
      
      DO GetTestAdress
      
          Let $EnderecoT     =  $AD1
          Let $Endereco2T    =  $AD2
          Let $Num1T         =  $ANum1
          Let $BairroT       =  $ABairro
          Let $MunicipalityT =  $AMunicip
          Let $UF_T          =  $AUF
          Let $CEP_T         =  $ACEP
          Let $Endereco_T    =  $EnderecoT ||' '|| $Num1T  ||' '|| $Endereco2T
          
    End-If
  End-If 

  If #pass = 2
    #debug show '************pass 2***'
    Let $2EnderecoT     =  Rtrim(&IP.ADDRESS1, ' ')
    Let $2Endereco2T    =  Rtrim(&IP.ADDRESS2, ' ') || ' ' || Rtrim(&IP.ADDRESS3, ' ')
    Let $2Num1T         =  Rtrim(&IP.NUM1, ' ')
    Let $2BairroT       =  Rtrim(&IP.ADDRESS4, ' ')
    Let $2MunicipalityT =  Rtrim(&IP.CITY, ' ')
    Let $2UF_T          =  Rtrim(&IP.STATE, ' ')
    Let $2CEP_T         =  Rtrim(&IP.POSTAL, ' ')
    Let $2Endereco_T    =  $2EnderecoT ||' '|| $2Num1T  ||' '|| $2Endereco2T
    
        Do GetNameTeste
        
    Let $2Name_T        =  $TesteName
  
    
    DO GetPhoneTest
    Let $T2Phone = $XPHONE
    
    IF $2EnderecoT = ''
          DO GetTestAdress
          
              Let $2EnderecoT     =  $AD1
              Let $2Endereco2T    =  $AD2
              Let $2Num1T         =  $ANum1
              Let $2BairroT       =  $ABairro
              Let $2MunicipalityT =  $AMunicip
              Let $2UF_T          =  $AUF
              Let $2CEP_T         =  $ACEP
              Let $2Endereco_T    =  $2EnderecoT ||' '|| $2Num1T  ||' '|| $2Endereco2T
    End-If
  End-If 
  Let #pass = 2

FROM PS_INCIDENT_PEOPLE IP 
WHERE IP.INCIDENT_NBR=$Inc_Nbr
AND IP.INCIDENT_ROLE IN ('IW','EW')
end-select

#debug show '$Name_T:'$Name_T
#debug show '$2Name_T:' $2Name_T

End-procedure Select-Testemunhas

!**************************************
begin-procedure GetNameTeste
#debug show '** GetNameTeste **'
#debug show '$TestEmplid :' $TestEmplid
#debug show '$TestNEmplid:' $TestNEmplid
!**************************************

Let $TesteName = ''

If $TestEmplid <> ''

Begin-Select
NMEmp.NAME
   Let $TesteName = Rtrim(&NMEmp.Name, ' ')

FROM PS_PERSON_NAME NMEmp
WHERE NMEmp.EMPLID = $TestEmplid
AND NMEmp.NAME_TYPE = 'PRI'

End-Select
Else
Begin-Select
NonE.NAME

   Let $TesteName = Rtrim(&NonE.Name, ' ')
   
FROM PS_NE_PERSONAL_DTA NonE
WHERE NON_EMPLOYEE_ID = $TestNEmplid
End-Select
End-if
End-procedure GetNameTeste



!**************************************
begin-procedure GetTestAdress
#debug show '** GetTestAdress **'
#debug show '$TestEmplid:'$TestEmplid
#debug show '$TestNEmplid:'$TestNEmplid
!**************************************
Let $AD1      =  ''
Let $AD2      =  ''
Let $ANum1    =  ''
Let $ABairro  =  ''
Let $AMunicip =  ''
Let $AUF      =  ''
Let $ACEP     =  ''

If $TestEmplid <> ''

Begin-Select
Test.ADDRESS1
Test.ADDRESS2
Test.ADDRESS3
Test.NUM1
Test.ADDRESS4
Test.CITY
Test.STATE
Test.POSTAL

    Let $AD1      =  Rtrim(&Test.ADDRESS1, ' ')
    Let $AD2      =  Rtrim(&Test.ADDRESS2, ' ') || ' ' || Rtrim(&Test.ADDRESS3, ' ')
    Let $ANum1    =  Rtrim(&Test.NUM1, ' ')
    Let $ABairro  =  Rtrim(&Test.ADDRESS4, ' ')
    Let $AMunicip =  Rtrim(&Test.CITY, ' ')
    Let $AUF      =  Rtrim(&Test.STATE, ' ')
    Let $ACEP     =  Rtrim(&Test.POSTAL, ' ')

FROM PS_ADDRESSES Test
WHERE Test.EMPLID = $TestEmplid
AND   Test.EFFDT  = (SELECT MAX(ADTest.EFFDT) 
                     FROM PS_ADDRESSES ADTest 
                     WHERE ADTest.EMPLID = Test.EMPLID
                     AND ADTest.EFFDT <= $IncDate)
AND Test.ADDRESS_TYPE = 'HOME'
End-Select

Else

Begin-Select
Test2.ADDRESS1
Test2.ADDRESS2
Test2.ADDRESS3
Test2.NUM1
Test2.ADDRESS4
Test2.CITY
Test2.STATE
Test2.POSTAL

    Let $AD1      =  Rtrim(&Test2.ADDRESS1, ' ')
    Let $AD2      =  Rtrim(&Test2.ADDRESS2, ' ') || ' ' || Rtrim(&Test2.ADDRESS3, ' ')
    Let $ANum1    =  Rtrim(&Test2.NUM1, ' ')
    Let $ABairro  =  Rtrim(&Test2.ADDRESS4, ' ')
    Let $AMunicip =  Rtrim(&Test2.CITY, ' ')
    Let $AUF      =  Rtrim(&Test2.STATE, ' ')
    Let $ACEP     =  Rtrim(&Test2.POSTAL, ' ')

FROM PS_NE_PERSONAL_DTA Test2
WHERE Test2.NON_EMPLOYEE_ID = $TestNEmplid
End-Select
End-If

End-procedure GetTestAdress


!**************************************
begin-procedure GetPhoneTest
#debug show '** GetPhoneTest **'
!**************************************
Let $XPHONE = '' 
Begin-Select     
XPE.PHONE
  Let $XPHONE       = Rtrim(&XPE.PHONE, ' ') 
FROM PS_PERSONAL_PHONE XPE
WHERE XPE.EMPLID    = $TestEmplid
AND XPE.PHONE_TYPE  = 'HOME'
End-Select


End-procedure GetPhoneTest


!**************************************
begin-procedure Select-Afastamento
#debug show '** Select-Afastamento **'
#debug show '#EmplRcd:'#EmplRcd
#debug show '$Inc_Nbr:'$Inc_Nbr
!**************************************
Let $Afastamento=''
Let #Away_Workdays=0
Let $Last_Day = ''

Begin-Select 
SA.LAST_FULL_WORK_DAY   
SA.AWAY_FROM_WORKDAYS
SA.INJURY_TREATMENT
   Let $Last_Day = Rtrim(&SA.LAST_FULL_WORK_DAY, ' ')
   Let #Away_Workdays = &SA.AWAY_FROM_WORKDAYS    
   If  #Away_Workdays > 1
      Let $Afastamento  = '1'       
   Else   
      Let $Afastamento  = '2' 
   End-If
   Let $Hospitalized = &SA.INJURY_TREATMENT   
      If $Hospitalized  = '4' 
         Let $Internacion = 'Y'
      Else   
         Let $Internacion = 'N'
   End-If
FROM PS_INJURY_ILL SA
WHERE EMPLID=$Emplid
AND EMPL_RCD=#EmplRcd
AND INCIDENT_NBR= $Inc_Nbr
End-Select

End-Procedure Select-Select-Afastamento

!**************************************
begin-procedure Select-Unidad-Atendimiento
#debug show '** Select-Unidad-Atendimiento **'
#debug show '#EmplRcd:'#EmplRcd
#debug show '$Inc_Nbr:'$Inc_Nbr
!**************************************
Let $Unidad_At=''

Begin-Select 
UA.HOSPITAL 
 Let $Unidad_At = Rtrim(&UA.HOSPITAL, ' ')
FROM PS_INJ_ILL_ADDR_VW UA
WHERE UA.INCIDENT_NBR=$Inc_Nbr
AND UA.EMPLID=$Emplid
AND UA.EMPL_RCD=#EmplRcd
End-Select

End-Procedure Select-Unidad-At

!**************************************
begin-procedure Select-Atendimiento-Dt
#debug show '** Select-Atendimiento-Dt **'
!**************************************
Let $Tr_Dt=''
Let $Tr_Time=''
Let $Tr_Tm=''

Begin-Select 
IA.TREATMENT_DT
  Let $Tr_Dt = Rtrim(&IA.TREATMENT_DT, ' ')
  Do Convert-To-DTU-Date ($Tr_Dt,$Tr_Dt)
IA.TREATMENT_TM 
  Let $Tr_Time = Rtrim(&IA.TREATMENT_TM , ' ')
  Let $Tr_Tm = substr($Tr_Time   ,12,5)

FROM PS_INJURY_ILL_AID IA
WHERE IA.INCIDENT_NBR=$Inc_Nbr
AND IA.EMPLID=$Emplid
AND IA.EMPL_RCD=#EmplRcd
End-Select

End-Procedure Select-Atendimiento-Dt


!**************************************
begin-procedure Select-Lesion
#debug show '** Select-Lesion **'
!**************************************
Let $Lesao=''

Begin-Select 
DT.DESCR 
  If $Lesao = ''
    Let $Lesao = Rtrim(&DT.DESCR, ' ')
  Else
    Let $Lesao = $Lesao ||', '|| Rtrim(&DT.DESCR, ' ')
  End-if
  
FROM PS_INJ_ILL_DIAG_VW II
,PS_DIAGNOSIS_TBL DT
WHERE II.EMPLID = $Emplid
AND II.INCIDENT_NBR = $Inc_Nbr
AND II.DIAGNOSIS_CD= DT.DIAGNOSIS_CD
AND DT.EFFDT = (SELECT MAX(DT2.EFFDT)
                FROM PS_DIAGNOSIS_TBL DT2
                WHERE DT2.DIAGNOSIS_CD = II.DIAGNOSIS_CD
                AND DT2.EFF_STATUS = 'A'
                AND DT2.EFFDT <= $IncDate)
End-Select
Let $Lesao = $Lesao ||'.'
End-Procedure Select-Lesion

!**************************************
begin-procedure Select-Body-Part
#debug show '** Select-Body-Part **'
!**************************************
Let $Body_Part=''

Begin-Select 
IV.BODY_PART_CD 
IV.SIDE_OF_BODY
BT.DESCR100
  
  Let $SideB = Rtrim(&IV.SIDE_OF_BODY, ' ')
  Evaluate $SideB
  When = 'B'
    Let $suf = 'posterior'
  break
  When = 'F'
    Let $suf = 'frontal'
  break
  When = 'L'
    Let $suf = 'esquerda(o)'
  break
  When = 'R'
    Let  $suf = 'direita(o)'
  End-Evaluate
  
  
  If $Body_Part = ''
     Let $Body_Part = Rtrim(&BT.DESCR100, ' ') || ' ' || $suf
  Else
    Let $Body_Part = $Body_Part ||', '|| Rtrim(&BT.DESCR100, ' ') || ' ' || $suf
  End-if
  

FROM PS_INJ_ILL_BP_VW IV
,PS_BODY_PART_TBL BT
WHERE IV.EMPLID=$Emplid
AND IV.EMPL_RCD=#EmplRcd
AND IV.INCIDENT_NBR=$Inc_Nbr
!AND BT.SETID=$JJCSetid
AND BT.BODY_PART_CD=IV.BODY_PART_CD
End-Select

Let $Body_Part = $Body_Part ||'.'
#debug show '$Body_Part:'$Body_Part

End-Procedure Select-Body-Part

!**************************************
begin-procedure Select-Cause-Ac
#debug show '** Select-Cause-Ac **'
!**************************************
Let $Cause-Ac = ''

Begin-Select 
YY.INJURY_SOURCE_CD
JT.DESCR100
  Let $Cause-Ac = Rtrim(&JT.DESCR100, ' ')
FROM PS_INJURY_ILL_SOI YY
,PS_INJURY_SRCE_TBL JT
WHERE YY.EMPLID=$Emplid
AND YY.EMPL_RCD=#EmplRcd
AND YY.INCIDENT_NBR=$Inc_Nbr
AND YY.INJURY_SOURCE_CD=JT.INJURY_SOURCE_CD
!AND JT.SETID=$JJCSetid

End-Select

#debug show '$Cause-Ac:'$Cause-Ac

End-Procedure Select-Cause-Ac
!**************************************                                                                   
begin-procedure Check-Strings                                                                     
#debug show 'Check-Strings'
!**************************************   
 
let $String_In  = ltrim(rtrim($Postal, ' '),' ')
let #I = 1
Let $String_Out = ''
let #Len = Length($String_In)

While #I  <= #Len
   Let $Test_Char    = Substr($String_In,#I, 1)

   evaluate $Test_Char
      when = '-'
         break
      when = ' '
         break
      when-other
      let $String_Out  = $String_Out || $Test_Char         
      end-evaluate
   add 1 To #I
End-While
let $String_In  = ''
Let $Postal = $String_Out

End-procedure Check-Strings

 
!**************************************
Begin-procedure Format 
  #debug show '****Format****'
!**************************************

!****************************    REPORT TITLE ******************************************              
 graphic (8,1,5) box 141 3 5
 graphic (7,134,141) vert-line    !final
 
 #debug show '$FileDir:' $FileDir
 print-image (1,1)
   type       = gif-file
   image-size =(10,5)
   source     = $FileDir
   
 
 Alter-Printer Point-size = #sizegr Font-Type = Proportional Font = #fontstd  
 print 'Comunicado de Acidente de Trabalho - CAT' (#r1a,#c6) Bold  !Title
 
 Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd
 print '01- Emitente'                 (#r1 ,#c7)
 print $Emitente                      (#r1a ,73) bold
 print $Cat_Type                      (#r1d ,73) bold
 print '02- Tipo de CAT'              (#r1b,#c7)   
 graphic (2,#c7,2) box 2 2          !Draw box 01
 graphic (#r1c,#c7,2) box 2 2       !Draw box 02    
 
 
! graphic (#r1c,#c7,3) box 2 2       !Draw box 02   
 
 Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd 
 print '1.Empregador 2.Sindicato 3.M?dico 4.Seg. ou Dependente 5.Autoridade P?blica' (#r1a,77) 
 print '1 Inicial 2 Reabertura 3 Comunicado de ?bito em:'                            (#r1d,77) 
  
!**************************** VERTICAL TITLES ******************************************              
   
    Alter-Printer Point-size = #sizegr Font-Type = Proportional Font = #fontstd 
     print 'E'   ( 38,#c2) Bold
     print 'M'   ( +2,#c2) Bold
     print 'I'   ( +2,#c2) Bold
     print 'T'   ( +2,#c2) Bold
     print 'E'   ( +2,#c2) Bold  
     print 'N'   ( +2,#c2) Bold
     print 'T'   ( +2,#c2) Bold
     print 'E'   ( +2,#c2) Bold
    
   
     print 'A'   ( 93,#c2) Bold
     print 'T'   ( +2,#c2) Bold
     print 'E'   ( +2,#c2) Bold
     print 'S'   ( +2,#c2) Bold
     print 'T'   ( +2,#c2) Bold  
     print 'A'   ( +2,#c2) Bold
     print 'D'   ( +2,#c2) Bold
     print 'O'   ( +2,#c2) Bold    
    
     print 'M'   ( +3,#c2) Bold
     print 'E'   ( +2,#c2) Bold
     print 'D'   ( +2,#c2) Bold
     print 'I'   ( +2,#c2) Bold
     print 'C'   ( +2,#c2) Bold  
     print 'O'   ( +2,#c2) Bold
     
     
     print 'I'   ( 136,#c2) Bold
     print 'N'   ( +2,#c2) Bold
     print 'S'   ( +2,#c2) Bold
     print 'S'   ( +2,#c2) Bold
    
     
!*********************** EMPREGADOR ******************************** 
 Alter-Printer Point-size = #sizegr   Font-Type = Proportional Font = #fontstd
 graphic (#r1d,#c3,4) horz-line    
 print 'Empregador'                               (#r1d,11) Bold
 graphic (#r1d,26,108) horz-line  

 Alter-Printer Point-size = #sizehead   Font-Type = Proportional Font = #fontstd
 
 print '03 Raz?o Social'                          (#r2a,#c4)  
 print '04 Inscri??o'                             (#r2a,75)
 print '05 CNAE'                                  (#r2a,108)
 
 print '06 Endere?o'                              (#r2c,#c4) 
 print 'Bairro'                                   (#r2c,51)
 print 'CEP'                                      (#r2c,68)
 print '07 Municipio'                             (#r2c,80)  
 print '08 UF'                                    (#r2c,102)
 print '09 Telefone'                              (#r2c,111)
 
Alter-Printer Point-size = #sizetext   Font-Type = Proportional Font = #fontstd
 print $Name_Emp                                  (#r2b,#c4)  bold
 print $CNPJ_CEI                                  (#r2b,75)   bold
 print $CNAE                                      (#r2b,108)  bold
 
 print $AddresEr                                  (#r2d,#c4)  bold
 print $BairroEr                                  (#r2d,51)   bold
 print $CEPE                                      (#r2d,68)   bold
 print $MunicipalityEr                            (#r2d,80)   bold 
 print $UFE                                       (#r2d,102)  bold
 print $PhoneE                                    (#r2d,111)  bold 
  
!******************** ACIDENTADO **************************************
Alter-Printer Point-size = #sizegr   Font-Type = Proportional Font = #fontstd
 graphic (#r3,#c3,4) horz-line 
 print 'Acidentado'                               (#r3,11) Bold
 graphic (#r3,25,109) horz-line 

Alter-Printer Point-size = #sizehead   Font-Type = Proportional Font = #fontstd
     
   print '10 Nome'                                (#r3a,#c4) 
   print '11 Nome da M?e'                         (#r3a,71) 
   print '12 Nascimento'                          (#r3c,#c4)  
   print '13 Sexo'                                (#r3c,22)   
   print '14 Estado Civil'                        (#r3c,46)  
   print '15 CTPS'                                (#r3c,64)    
   print 'S?rie'                                  (#r3c,78)    
   print 'Emiss?o'                                (#r3c,88)
   print '16 UF'                                  (#r3c,99)  
   print '17 Remunera??o Mensal'                  (#r3c,108)  
   
   print '18 Identidade'                          (#r3e,#c4)  
   print 'Emiss?o'                                (#r3e,30)   
   print 'Org?o Expeditor'                        (#r3e,45)       
   print '19 UF'                                  (#r3e,64)   
   print '20 PIS/PASEP/NIT'                       (#r3e,77)   
   
   print '21 Endere?o'                            (#r3g,#c4) 
   print 'Bairro'                                 (#r3g,51)
   print 'CEP'                                    (#r3g,70)         
   print '22 Munic?pio'                           (#r3g,85)    
   print '23 UF'                                  (#r3g,106)   
   print '24 Telefone'                            (#r3g,113)  
   print '25 Nome Ocupa??o'                       (#r3i,#c4)   
   print '26 CBO'                                 (#r3i,46)    
   print '27 Filia??o INSS'                       (#r3i,60)    
   print '28 Aposentado?'                         (#r3i,80) 
   print '29 ?rea'                                (#r3i,99) 
   
Alter-Printer Point-size = #sizetext   Font-Type = Proportional Font = #fontstd   
   
   Do Convert-From-DTU-Date($Dt_Birth,$Dt_Birth2)
   Do Format-DateTime($Dt_Birth2,$Dt_Birth2, {DEFDMY},'','')
   
   print $Name                                    (#r3b,#c4) bold
   print $Mother_Name                             (#r3b,71)  bold
   print $Dt_Birth2                                (#r3d,#c4) bold 
   print $Sex                                     (#r3d,22)  bold 
   
   graphic (#r3c1,22,2) box 2 2       !Draw box 01 
Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd    
   print '1=Masc 2=Fem'                          (#r3d1,25)
Alter-Printer Point-size = #sizetext   Font-Type = Proportional Font = #fontstd

   print $MarStatus                               (#r3d,47) bold  
   graphic (#r3c1,46,2) box 2 2       !Draw box 01 
   print $MarStD                                 (#r3d1,49) bold   
   print $CTPS                                    (#r3d,64) bold
   print $Serie                                   (#r3d,78) bold   
   Do Convert-From-DTU-Date($Emision,$Emision2)
   Do Format-DateTime($Emision2,$Emision2, {DEFDMY},'','')
   print $Emision2                                 (#r3d,88) bold
   print $UF_Tra                                  (#r3d,99) bold 
   print #Salary                                  (#r3d,108) bold EDIT b8,8888,888.88c
   
   print $RG_Id                                   (#r3f,#c4) bold
   Do Convert-From-DTU-Date($RG_dt,$RG_dt2)
   Do Format-DateTime($RG_dt2,$RG_dt2, {DEFDMY},'','')
   print $RG_dt2                                   (#r3f,30) bold  
   print $RG_by                                   (#r3f,45) bold
   print $RG_State                                (#r3f,64) bold  
   print $PIS                                     (#r3f,77) bold  
   
   print $Endereco                                (#r3h,#c4) bold wrap 41 1
   print $Bairro                                  (#r3h,51) bold
   print $CEP                                     (#r3h,70) bold        
   print $Municipality                            (#r3h,85) bold   
   print $UF                                      (#r3h,106) bold   
   print $PHONE                                   (#r3h,113) bold  
   print $JobCode_Descr                           (#r3j,#c4) bold   
   print $CBO                                     (#r3j,46)  bold   
   print $INSS_type                               (#r3j1,60) bold 
   graphic (#r3j,60,2) box 2 2                    !Draw box 01 
Alter-Printer Point-size = #sizesm     Font-Type = Proportional Font = #fontstd    
   Evaluate $INSS_type
     When = '1'
       print 'Empregado'                           (#r3j1,63) bold
       break
     When = '2'
       print 'trabalhador avulso'                  (#r3j1,63) bold
       break
     When = '7'
       print 'segurado especial'                   (#r3j1,63) bold
       break
     When = '8'
       print 'm?dico residente'                    (#r3j1,63) bold
       break
   End-Evaluate
Alter-Printer Point-size = #sizetext   Font-Type = Proportional Font = #fontstd   
   print $Aposentado                              (#r3j1,80) bold
   graphic (#r3j,80,2) box 2 2                    !Draw box 01 
Alter-Printer Point-size = #sizesm     Font-Type = Proportional Font = #fontstd       
   print '1=Sim 2=N?o'                            (#r3j1,83) 
Alter-Printer Point-size = #sizetext   Font-Type = Proportional Font = #fontstd    
   print $Area                                    (#r3j1,99)  bold
   graphic (#r3j,99,2) box 2 2                    !Draw box 01 
Alter-Printer Point-size = #sizesm     Font-Type = Proportional Font = #fontstd 
   print '1=Urbana 2=Rural'                       (#r3j1,102) 

     
!************************** ACIDENTE OU DOENCA *******************************************
Alter-Printer Point-size = #sizegr   Font-Type = Proportional Font = #fontstd
 graphic (#r4,#c3,4) horz-line 
 print 'Acidente ou Doenca'                       (#r4,11) Bold 
 graphic (#r4,36,98) horz-line 

Alter-Printer Point-size = #sizehead   Font-Type = Proportional Font = #fontstd
   print '30 Data acidente'                       (#r4a,#c4)   
   print '31 Hora acidente'                       (#r4a,30) 
   print '32 Horas trabalhadas'                   (#r4a,50)
   print '33 Tipo'                                (#r4a,72)         
   graphic (#r4a1,72,2) box 2 2                   !Draw box 01 
Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd 
   print '1 T?pico 2 Doen?a 3 Trajeto'            (#r4b,75) 
Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd
   print '34 Houve Afastamento?'                  (#r4a,100)
   graphic (#r4a1,100,2) box 2 2                  !Draw box 01 
Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd       
   print '1=Sim 2=N?o'                            (#r4b,103) 
Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd    
   print '35 ?ltimo dia Trabalhdo'                (#r4c,#c4)   
   print '36 Local acidente'                      (#r4c,37)
   graphic (#r4c1,37, 2) box 2 2        !Draw box 01 
Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd       
   Evaluate $Local_Ac
     When = '1'
       print 'No estabel.Emprega'                  (#r4d,40) 
       break
     When = '2'
       print 'Na prestadora servi?o'               (#r4d,40) 
       break
     When = '3'
       print 'via p?blica'                         (#r4d,40) 
       break
     When = '4'
       print '?rea rural'                          (#r4d,40) 
       break
     When = '5'
       print 'outros'                              (#r4d,40) 
       Break
   End-Evaluate
Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd       
   print '37 Especifica??o Loca'                  (#r4c,62)   
   print '38 CNPJ'                                (#r4c,95)    
   print '39 UF'                                  (#r4c,111)    
   print '40 Munic?pio'                           (#r4c,118) 
   print '41 Parte do Corpo Atingida'             (#r4e,#c4) 
   print '42 Agente Causador'                     (#r4e,85)    
   print '43 Descri??o da situa??o geradora do acidente ou Doen?a'   (#r4g,#c4)    
   print '44 Houve Registro Policial?'            (#r4g,105) 
   print '45 Houve Morte?'                        (#r4j,105) 
   graphic (#r4h,105,2) box 2 2       !Draw box 01 
   graphic (#r4k,105,2) box 2 2       !Draw box 01 
Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd       
   print '1=Sim 2=N?o'                            (#r4i,108) 
   print '1=Sim 2=N?o'                            (#r4l,108) 
Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd       

#debug show '******************************** $Inc_Nbr :'$Inc_Nbr
#debug show '******************************** $Inc_Dt  :'$Inc_Dt
#debug show '******************************** $Inc_Dt2 :'$Inc_Dt2
   
   Do Convert-From-DTU-Date($Inc_Dt,$Inc_Dt2)
   Do Format-DateTime($Inc_Dt,$Inc_Dt2, {DEFDMY},'','')
   
#debug show '******************************** $Inc_Nbr :'$Inc_Nbr
#debug show '******************************** $Inc_Dt  :'$Inc_Dt
#debug show '******************************** $Inc_Dt2 :'$Inc_Dt2

   print $Inc_Dt2                                 (#r4b,#c4)   bold   
   print $Inc_Tm                                  (#r4b,30)    bold
   print #WrkHrs                                  (#r4b,50)    bold
   print $Inc_Type                                (#r4b,72)    bold        
   print $Afastamento                             (#r4b,100)   bold    
   Do Convert-From-DTU-Date($Last_Day,$Last_Day2)
   Do Format-DateTime($Last_Day2,$Last_Day2, {DEFDMY},'','')
   print $Last_Day2                                (#r4d,#c4)   bold   
   print $Local_Ac                                (#r4d,37)    bold 
   print $Spec_Loc                                (#r4d,62)    bold  wrap 32 1 
   print $CNPJ_Ac                                 (#r4d,95)    bold   
   print $UF_Inc                                  (#r4d,111)   bold    
   print $MunicipalityInc                         (#r4d,118)   bold 
   print $Body_Part                               (#r4f,#c4)   bold  wrap 70 2
   print $Cause-Ac                                (#r4f,85)    bold  wrap 45 2
   print $DescrLng                                (#r4i1,#c4)  bold  wrap 90 3
   print $Pol_Reg                                 (#r4i,106)   bold
   print $Death                                   (#r4l,106)   bold
   

!*********************************** TESTEMUNHAS *****************************************
 Alter-Printer Point-size = #sizegr   Font-Type = Proportional Font = #fontstd
 graphic (#r5,#c3,4) horz-line 
 print 'Testemunhas'                              (#r5,11) Bold 
 graphic (#r5,28,106) horz-line 
 Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd
   print '46 Nome'                                (#r5a,#c4)     
   print '47 Endere?o'                            (#r5c,#c4) 
   print 'Bairro'                                 (#r5c,55)
   print 'CEP'                                    (#r5c,72)         
   print '48 Munic?pio'                           (#r5c,85)    
   print '49 UF'                                  (#r5c,112)   
   print 'Telefone'                               (#r5c,122)    
   print '50 Nome'                                (#r5e,#c4)     
   print '51 Endere?o'                            (#r5g,#c4) 
   print 'Bairro'                                 (#r5g,55)
   print 'CEP'                                    (#r5g,71)         
   print '52 Munic?pio'                           (#r5g,85)    
   print '53 UF'                                  (#r5g,112)   
   print 'Telefone'                               (#r5g,122)  
   
   print $Name_T                                  (#r5a,20)   bold  
   print $Endereco_T                              (#r5d,#c4)  bold
   print $BairroT                                 (#r5d,55)   bold wrap 14 1
   print $CEP_T                                   (#r5d,72)   bold      
   print $MunicipalityT                           (#r5d,85)   bold 
   print $UF_T                                    (#r5d,112)  bold 
   print $TPhone                                  (#r5d,122)  bold 
   
   print $2Name_T                                  (#r5e,20)  bold   
   print $2Endereco_T                              (#r5h,#c4) bold
   print $2BairroT                                 (#r5h,55)  bold wrap 14 1
   print $2CEP_T                                   (#r5h,71)  bold       
   print $2MunicipalityT                           (#r5h,85)  bold  
   print $2UF_T                                    (#r5h,112) bold  
   print $T2Phone                                  (#r5h,122) bold  
   
   graphic (#r5i,#c3,128) horz-line 
   graphic (#r5j,85,35) horz-line
   print 'Local e Data'                           (#r5k,#c4) 
Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd       
   print 'Assinatura e Carimbo do Emitente'       (#r5k,90)   
Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd       
   print  $Location                               (#r5j,#c4) bold
!   Do Convert-Fron-DTU-Date($BeginDt,$BeginDt)
!   Do Format-DateTime($BeginDt,$BeginDt, {DEFDMY},'','')
   !print  $IncDate                                (#r5j,40) 
      
!********************************** ATENDIMENTO ******************************************
 Alter-Printer Point-size = #sizegr   Font-Type = Proportional Font = #fontstd
 graphic (#r6,1,10) horz-line 
 print 'Atendimento'                              (#r6,11) Bold 
 graphic (#r6,27,107) horz-line 

 Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd
   print '54 Unidade de Atendimiento M?dico'      (#r6a,#c4)     
   print '55 Data'                                (#r6a,85) 
   print '56 Hora'                                (#r6a,107)
   print '57 Houve Interna??o?'                   (#r6c,#c4)       
   graphic (#r6e,7,2) box 2 2       !Draw box 01 
Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd       
   print '1=Sim 2=N?o'                            (#r6d1,10)      
Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd    
   print '58 Dura??o Prov?vel do Tratamento'      (#r6c,32) 
   print '59 Afastamento do Trabalho?'            (#r6c,82)   
   graphic (#r6e,82,2) box 2 2       !Draw box 01 
Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd       
   print '1=Sim 1=N?o'                            (#r6d1,85)      
Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd       
    
   print $Unidad_At                               (#r6b,#c4)     bold
   
   Do Convert-From-DTU-Date($Tr_Dt,$Tr_Dt2)
   Do Format-DateTime($Tr_Dt2,$Tr_Dt2, {DEFDMY},'','')
   
   print $Tr_Dt2                                   (#r6b,85)      bold
   print $Tr_Tm                                   (#r6b,107)     bold
   
   If $Internacion = 'Y'
     Let $Internacion = '1'
   Else
     Let $Internacion = '2'
   End-if
   
   print $Internacion                             (#r6d1,#c4)    bold   
   print #Away_Workdays                           (#r6d1,32)     bold
   print $Afastamento                             (#r6d1,82)     bold
   
!************************************* LESAO  ********************************************
 Alter-Printer Point-size = #sizegr   Font-Type = Proportional Font = #fontstd
 graphic (#r7,#c3,4) horz-line 
 print 'Les?o'                                    (#r7,11) Bold 
 graphic (#r7,18,116) horz-line 

 Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd
   print '60 Descri??o e Natureza da Les?o'       (#r7a,#c4)        
   print $Comments                                (#r7b,#c4)      bold wrap 120 3
      
!********************************** DIAGNOSTICO ******************************************
 Alter-Printer Point-size = #sizegr   Font-Type = Proportional Font = #fontstd
 graphic (#r8,#c3,4) horz-line 
 print 'Diagn?stico'                              (#r8,11) 
 graphic (#r8,26,108) horz-line 

 Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd
 graphic (#r8a,118 ,14) box 7 4      !Draw box CID  
   print '61 Diagn?stico Prov?vel'                (#r8a,#c4)   
   print '62 CID                 '                (#r8b,119)   
   print '63 Observa??es'                         (#r8c,#c4)   
   
   print $Lesao                                   (#r8b,#c4)   bold wrap 117 3
   print $CID-Code                                (#r8b1,119)   bold
   print $Observations                            (#r8d,#c4)    bold wrap 117 3
   
   graphic (#r8e,#c3,128) horz-line 
   print  $Location                               (#r8f,#c4)  bold
   graphic (#r8f,88,38) horz-line
   print 'Local e Data'                           (#r8g,#c4) 
Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd       
   print 'Assinatura e Carimbo do M?dico com CRM' (#r8g,90) 
Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd    

   
   !print  $IncDate                                (#r8f,40) 
   
!************************************* INSS  *********************************************
 Alter-Printer Point-size = #sizestd   Font-Type = Proportional Font = #fontstd
 graphic (#r8h,1,133) box 20 4         !Draw box INSS  
 
   print '64 Recebida em'                        (#r9,#c4)   
   print '65 C?digo da Unidade'                  (#r9,52)   
   print '66 N?mero da CAT'                      (#r9,90) 
   graphic (#r9a,7,20)   horz-line 
   graphic (#r9a,55,20)  horz-line
   graphic (#r9a,92,20) horz-line
   
   print '67 Matricula do Servidor'              (#r9b,#c4)
   graphic (#r9c,#c4,20) horz-line
   graphic (#r9c,100,27) horz-line 
   print 'Matricula'                             (#r9d,#c5)  
   print 'Assinatura do servidor'                (#r9d,104)  
  
   Alter-Printer Point-size = #sizesm   Font-Type = Proportional Font = #fontstd
!   print 'Notas:'                                (#r9e,#c4)   
   print 'Notas:1.A inexatid?o das declara??es desta comunica??o implicara as san??es previstas nos arts. 171 e 299 do c?digo penal'  (#r9f,#c4)   
   print '2.A comunica??o de acidente de trabalho dever? ser feita at? o 1o.dia ?til ap?s o acidente, sob pena multa, na forma prevista no artigo 22 da Lei n. 8213/91'  (#r9g,#c4)   
 
   Alter-Printer Point-size = #sizesm Font-Type = Fixed Font = #fontstd    !Para control                                
   print $Prcs_Process_Instance  (#r10,  5)                                                
   print $Emplid                 (#r10, 10)                                                
   print $Name                   (#r10, 19)   
   print $Inc_Nbr                (#r10, 40)
   print $DateBegan              (#r10, 50)
   !print &timeBegan              (#r10,110)  

 
 New-page  
 
End-procedure Format

!**************************************
begin-procedure Coordinates
!************************************** 
#debug show 'Coordinates'
                                                     
Let #c1 =  1                                          
Let #c2 =  3 
Let #c3 =  6
Let #c4 =  7
Let #c5 = 10
Let #c6 = 15 
Let #c7 = 73
Let #c8 =135

Let #r1  =    1
Let #r1a =  #r1 + 2
Let #r1b =  #r1 + 4
Let #r1c =  #r1 + 5
Let #r1d =  #r1 + 6
Let #r1e =  #r1 + 7


Let #r2  =    8
Let #r2a =  #r2 + 1
Let #r2b =  #r2 + 3
Let #r2c =  #r2 + 6
Let #r2d =  #r2 + 8

Let #r3  =   18
Let #r3a =  #r3 + 2
Let #r3b =  #r3 + 4
Let #r3c =  #r3 + 6
Let #r3c1=  #r3 + 7
Let #r3d =  #r3 + 8
Let #r3d1=  #r3 + 8
Let #r3e =  #r3 +11
Let #r3f =  #r3 +13
Let #r3g =  #r3 +16
Let #r3h =  #r3 +18
Let #r3i =  #r3 +21
Let #r3j =  #r3 +23
Let #r3j1=  #r3 +24



Let #r4  =   43 
Let #r4a =  #r4 + 2
Let #r4a1=  #r4 + 3
Let #r4b =  #r4 + 4
Let #r4c =  #r4 + 6
Let #r4c1=  #r4 + 7
Let #r4d =  #r4 + 8
Let #r4d1=  #r4 + 8
Let #r4e =  #r4 +10 
Let #r4f =  #r4 +12
Let #r4g =  #r4 +15
Let #r4h =  #r4 +16
Let #r4i =  #r4 +17
Let #r4i1=  #r4 +17
Let #r4j =  #r4 +19
Let #r4k =  #r4 +20
Let #r4l =  #r4 +21

Let #r5  =   65
Let #r5a =  #r5 + 2
!Let #r5b =  #r5 + 3
Let #r5c =  #r5 + 4
Let #r5d =  #r5 + 6
Let #r5e =  #r5 + 8
!Let #r5f =  #r5 + 9
Let #r5g =  #r5 +10
Let #r5h =  #r5 +12
Let #r5i =  #r5 +13
Let #r5j =  #r5 +18
Let #r5k =  #r5 +20



Let #r6  =  87
Let #r6a =  #r6 + 2
Let #r6b =  #r6 + 4
Let #r6c =  #r6 + 7
Let #r6d =  #r6 + 8
Let #r6d1=  #r6 + 9
Let #r6e =  #r6 + 8
Let #r6ei=  #r6 + 10


Let #r7  =  98
Let #r7a =  #r7 + 2
Let #r7b =  #r7 + 4

Let #r8  =  106
Let #r8a =  #r8 + 2 
Let #r8b =  #r8 + 4
Let #r8b1=  #r8 + 6
Let #r8c =  #r8 + 8
Let #r8d =  #r8 + 9
Let #r8e =  #r8 +12 
Let #r8f =  #r8 +19
Let #r8g =  #r8 +22
Let #r8h =  #r8 +23

Let #r9 =  131
Let #r9a =  #r9 + 4
Let #r9b =  #r9 + 7
Let #r9c =  #r9 + 12
Let #r9d =  #r9 +14
!Let #r9e =  #r9 +12 
Let #r9f =  #r9 +16
Let #r9g =  #r9 +17

Let #r10 =  150
                                                      
end-procedure Coordinates

!***********************************************************************
#Include 'reset.sqc'     !Reset Printer procedure           
#Include 'curdttim.sqc'  !Get-Current-DateTime procedure    
#include 'datetime.sqc'
#include 'number.sqc'
#Include 'readxlat.sqc'  !Read-Translate-Table procedure
#include 'prcsapi.sqc'   !Process API
#include 'stdapi.sqc'    !Update Process API
#include 'datemath.sqc'  !Routines for date
#include 'prcslng.sqc'   !Process Language
#include 'getcombr.sqc'  !Get selected fields from Company Table and Brazil Fields
#include 'hrsecty.sqc'   !Get SQR Security parameters            

!*********************************************************************** 

